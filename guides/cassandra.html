<!DOCTYPE html>
<html lang="en">







<head>
  <title>Using the Cassandra Client - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://embed.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/guides/cassandra" />
  <meta property="og:title" content="Using the Cassandra Client" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/cassandra">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/guides/cassandra" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/guides/cassandra" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/guides/cassandra" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/guides/cassandra" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/guides/cassandra" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/continuum" class="">VERSATILITY</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/guides/cassandra" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/guides/cassandra">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/guides/cassandra">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/guides/cassandra">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/guides/cassandra">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" selected>3.16.2 - Latest</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        
        
        
        <option value="3.2" >3.2</option>
        
        
        
        <option value="2.16" >2.16</option>
        
        
        
        <option value="2.13" >2.13</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <a class="editlink" href="https://github.com/quarkusio/quarkus/edit/main/docs/src/main/asciidoc/cassandra.adoc">Edit this Page</a>
      
      <h1 class="text-caps">Using the Cassandra Client </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apache Cassandra® is a free and open-source, distributed, wide column store, NoSQL database
management system designed to handle large amounts of data across many commodity servers, providing
high availability with no single point of failure.</p>
</div>
<div class="paragraph">
<p>In this guide, we will see how you can get your REST services to use a Cassandra database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This extension is developed by a third party and is part of the Quarkus Platform.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roughly 15 minutes</p>
</li>
<li>
<p>An IDE</p>
</li>
<li>
<p>JDK 17+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.9.9</p>
</li>
<li>
<p>Optionally the <a href="cli-tooling">Quarkus CLI</a> if you want to use it</p>
</li>
<li>
<p>Optionally Mandrel or GraalVM installed and <a href="building-native-image#configuring-graalvm">configured appropriately</a> if you want to build a native executable (or Docker if you use a native container build)</p>
</li>
<li>
<p>A running <a href="https://cassandra.apache.org">Apache Cassandra</a>,
<a href="https://www.datastax.fr/products/datastax-enterprise">DataStax Enterprise</a> (DSE) or
<a href="https://astra.datastax.com">DataStax Astra</a> database; or alternatively, a fresh Docker
installation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This quickstart guide shows how to build a REST application using the
<a href="https://github.com/datastax/cassandra-quarkus">Cassandra Quarkus extension</a>, which allows you to
connect to an Apache Cassandra, DataStax Enterprise (DSE) or DataStax Astra database, using the
<a href="https://docs.datastax.com/en/developer/java-driver/latest">DataStax Java driver</a>.</p>
</div>
<div class="paragraph">
<p>This guide will also use the
<a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/mapper">DataStax Object Mapper</a>
– a powerful Java-to-CQL mapping framework that greatly simplifies your application&#8217;s data access
layer code by sparing you the hassle of writing your CQL queries by hand.</p>
</div>
<div class="paragraph">
<p>The application built in this quickstart guide is quite simple: the user can add elements in a list
using a form, and the items list is updated. All the information between the browser and the server
is formatted as JSON, and the elements are stored in the Cassandra database.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution"><a class="anchor" href="#solution"></a>Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step
by step. However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>The solution is located in the
<a href="https://github.com/datastax/cassandra-quarkus/tree/main/quickstart">quickstart directory</a> of
the Cassandra Quarkus extension GitHub repository.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-blank-maven-project"><a class="anchor" href="#creating-a-blank-maven-project"></a>Creating a Blank Maven Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, create a new Maven project and copy the <code>pom.xml</code> file that is present in the <code>quickstart</code>
directory.</p>
</div>
<div class="paragraph">
<p>The <code>pom.xml</code> is importing all the Quarkus extensions and dependencies you need.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-data-model-and-data-access-objects"><a class="anchor" href="#creating-the-data-model-and-data-access-objects"></a>Creating the Data Model and Data Access Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this example, we will create an application to manage a list of fruits.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s create our data model – represented by the <code>Fruit</code> class – as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@PropertyStrategy(mutable = false)
public class Fruit {

    @PartitionKey
    private final String name;

    private final String description;

    public Fruit(String name, String description) {
      this.name = name;
      this.description = description;
    }
  // getters, hashCode, equals, toString methods omitted for brevity
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As stated above, we are using the DataStax Object Mapper. In other words, we are not going to write
our CQL queries manually; instead, we will annotate our data model with a few annotations, and the
mapper will generate proper CQL queries underneath.</p>
</div>
<div class="paragraph">
<p>This is why the <code>Fruit</code> class is annotated with <code>@Entity</code>: this annotation marks it as an <em>entity
class</em> that is mapped to a Cassandra table. Its instances are meant to be automatically persisted
into, and retrieved from, the Cassandra database. Here, the table name will be inferred from the
class name: <code>fruit</code>.</p>
</div>
<div class="paragraph">
<p>Also, the <code>name</code> field represents a Cassandra partition key, and so we are annotating it with
<code>@PartitionKey</code> – another annotation from the Object Mapper library.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Entity classes are normally required to have a default no-arg constructor, unless they
are annotated with <code>@PropertyStrategy(mutable = false)</code>, which is the case here.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next step is to create a DAO (Data Access Object) interface that will manage instances of
<code>Fruit</code> entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Dao
public interface FruitDao {
  @Update
  void update(Fruit fruit);

  @Select
  PagingIterable&lt;Fruit&gt; findAll();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This interface exposes operations that will be used in our REST service. Again, the annotation
<code>@Dao</code> comes from the DataStax Object Mapper, which will also automatically generate an
implementation of this interface for you.</p>
</div>
<div class="paragraph">
<p>Note also the special return type of the <code>findAll</code> method,
<a href="https://docs.datastax.com/en/drivers/java/latest/com/datastax/oss/driver/api/core/PagingIterable.html"><code>PagingIterable</code></a>:
it&#8217;s the base type of result sets returned by the driver.</p>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s create a Mapper interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Mapper
public interface FruitMapper {
  @DaoFactory
  FruitDao fruitDao();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Mapper</code> annotation is yet another annotation recognized by the DataStax Object Mapper. A
mapper is responsible for constructing DAO instances – in this case, out mapper is constructing
an instance of our only DAO, <code>FruitDao</code>.</p>
</div>
<div class="paragraph">
<p>Think of the mapper interface as a factory for DAO beans. If you intend to construct and inject a
specific DAO bean in your own code, then you first must add a <code>@DaoFactory</code> method for it in a
<code>@Mapper</code> interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>@DaoFactory</code> method names are irrelevant.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@DaoFactory</code> methods should return beans of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any <code>@Dao</code>-annotated interface, e.g. <code>FruitDao</code>;</p>
</li>
<li>
<p>A <code>CompletionStage</code> of any <code>@Dao</code>-annotated interface, e.g. <code>CompletionStage&lt;FruitDao&gt;</code>.</p>
</li>
<li>
<p>A <code>Uni</code> of any <code>@Dao</code>-annotated interface, e.g. <code>Uni&lt;FruitDao&gt;</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>Uni</code> is a type from the Mutiny library, which is the reactive programming library used by
Quarkus. This will be explained in more detail in the "Reactive Programming" section below.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generating-the-dao-and-mapper-implementations"><a class="anchor" href="#generating-the-dao-and-mapper-implementations"></a>Generating the DAO and mapper implementations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you probably guessed already, we are not going to implement the interfaces above. Instead, the
Object Mapper will generate such implementations for us.</p>
</div>
<div class="paragraph">
<p>The Object Mapper is composed of 2 pieces:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A (compile-time) annotation processor that scans the classpath for classes annotated with
<code>@Mapper</code>, <code>@Dao</code> or <code>@Entity</code>, and generates code and CQL queries for them; and</p>
</li>
<li>
<p>A runtime module that contains the logic to execute the generated queries.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Therefore, enabling the Object Mapper requires two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declare the <code>cassandra-quarkus-mapper-processor</code> annotation processor. With Maven, this is done
by modifying the compiler plugin configuration in the project&#8217;s <code>pom.xml</code> file as follows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
  &lt;version&gt;3.10.1&lt;/version&gt;
  &lt;configuration&gt;
    &lt;source&gt;${java.version}&lt;/source&gt;
    &lt;target&gt;${java.version}&lt;/target&gt;
    &lt;annotationProcessorPaths&gt;
      &lt;path&gt;
        &lt;groupId&gt;com.datastax.oss.quarkus&lt;/groupId&gt;
        &lt;artifactId&gt;cassandra-quarkus-mapper-processor&lt;/artifactId&gt;
        &lt;version&gt;${cassandra-quarkus.version}&lt;/version&gt;
      &lt;/path&gt;
    &lt;/annotationProcessorPaths&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With Gradle, this is done by adding the following line to the <code>build.gradle</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">annotationProcessor "com.datastax.oss.quarkus:cassandra-quarkus-mapper-processor:${cassandra-quarkus.version}"</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Verify that you are enabling the right annotation processor! The Cassandra driver ships
with its Object Mapper annotation processor, called <code>java-driver-mapper-processor</code>. But the
Cassandra Quarkus extension also ships with its own annotation processor:
<code>cassandra-quarkus-mapper-processor</code>, which has more capabilities than the driver&#8217;s. This annotation
processor is the only one suitable for use in a Quarkus application, so check that this is the one
in use. Also, never use both annotation processors together.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Declare the <code>java-driver-mapper-runtime</code> dependency in compile scope in the project&#8217;s <code>pom.xml</code>
file as follows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.datastax.oss&lt;/groupId&gt;
  &lt;artifactId&gt;java-driver-mapper-runtime&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Although this module is called "runtime", it must be declared in compile scope.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your project is correctly set up, you should now be able to compile it without errors, and you
should see the generated code in the <code>target/generated-sources/annotations</code> directory (if you are
using Maven). It&#8217;s not required to get familiar with the generated code though, as it is mostly
internal machinery to interact with the database.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-service-json-rest-endpoint"><a class="anchor" href="#creating-a-service-json-rest-endpoint"></a>Creating a service &amp; JSON REST endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let&#8217;s create a <code>FruitService</code> that will be the business layer of our application and store/load
the fruits from the Cassandra database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class FruitService {

  @Inject FruitDao dao;

  public void save(Fruit fruit) {
    dao.update(fruit);
  }

  public List&lt;Fruit&gt; getAll() {
    return dao.findAll().all();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the service is being injected a <code>FruitDao</code> instance. This DAO instance is injected
automatically, thanks to the generated implementations.</p>
</div>
<div class="paragraph">
<p>The Cassandra Quarkus extension allows you to inject any of the following beans in your own
components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All <code>@Mapper</code>-annotated interfaces in your project.</p>
</li>
<li>
<p>You can also inject a <code>CompletionStage</code> or <code>Uni</code> of any <code>@Mapper</code>-annotated interface.</p>
</li>
<li>
<p>Any bean returned by a <code>@DaoFactory</code> method (see above for possible bean types).</p>
</li>
<li>
<p>The
<a href="https://javadoc.io/doc/com.datastax.oss.quarkus/cassandra-quarkus-client/latest/com/datastax/oss/quarkus/runtime/api/session/QuarkusCqlSession.html"><code>QuarkusCqlSession</code></a>
bean: this application-scoped, singleton bean is your main entry point to the Cassandra client; it
is a specialized Cassandra driver session instance with a few methods tailored especially for
Quarkus. Read its javadocs carefully!</p>
</li>
<li>
<p>You can also inject <code>CompletionStage&lt;QuarkusCqlSession&gt;</code> or <code>Uni&lt;QuarkusCqlSession&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example, both <code>FruitMapper</code> and <code>FruitDao</code> could be injected anywhere. We chose to inject
<code>FruitDao</code> in <code>FruitService</code>.</p>
</div>
<div class="paragraph">
<p>The last missing piece is the REST API that will expose GET and POST methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/fruits")
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public class FruitResource {

  @Inject FruitService fruitService;

  @GET
  public List&lt;FruitDto&gt; getAll() {
    return fruitService.getAll().stream().map(this::convertToDto).collect(Collectors.toList());
  }

  @POST
  public void add(FruitDto fruit) {
    fruitService.save(convertFromDto(fruit));
  }

  private FruitDto convertToDto(Fruit fruit) {
    return new FruitDto(fruit.getName(), fruit.getDescription());
  }

  private Fruit convertFromDto(FruitDto fruitDto) {
    return new Fruit(fruitDto.getName(), fruitDto.getDescription());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how <code>FruitResource</code> is being injected a <code>FruitService</code> instance automatically.</p>
</div>
<div class="paragraph">
<p>It is generally not recommended using the same entity object between the REST API and the data
access layer. These layers should indeed be decoupled and use distinct APIs in order to allow each
API to evolve independently of the other. This is the reason why our REST API is using a different
object: the <code>FruitDto</code> class – the word DTO stands for "Data Transfer Object". This DTO object will
be automatically converted to and from JSON in HTTP messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class FruitDto {

  private String name;
  private String description;

  public FruitDto() {}

  public FruitDto(String name, String description) {
    this.name = name;
    this.description = description;
  }
  // getters and setters omitted for brevity
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The translation to and from JSON is done automatically by the Quarkus REST (formerly RESTEasy Reactive) extension, which is
included in this guide&#8217;s pom.xml file. If you want to add it manually to your application, add the
below snippet to your application&#8217;s pom.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-rest&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-rest-jackson&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
DTO classes used by the JSON serialization layer are required to have a default no-arg
constructor.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The conversion from DTO to JSON is handled automatically for us, but we still must convert from
<code>Fruit</code> to <code>FruitDto</code> and vice versa. This must be done manually, which is why we have two
conversion methods declared in <code>FruitResource</code>: <code>convertToDto</code> and <code>convertFromDto</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In our example, <code>Fruit</code> and <code>FruitDto</code> are very similar, so you might wonder why not use
<code>Fruit</code> everywhere. In real life cases though, it&#8217;s not uncommon to see DTOs and entities having
very different structures.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connecting-to-the-cassandra-database"><a class="anchor" href="#connecting-to-the-cassandra-database"></a>Connecting to the Cassandra Database</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="connecting-to-apache-cassandra-or-datastax-enterprise-dse"><a class="anchor" href="#connecting-to-apache-cassandra-or-datastax-enterprise-dse"></a>Connecting to Apache Cassandra or DataStax Enterprise (DSE)</h3>
<div class="paragraph">
<p>The main properties to configure are: <code>contact-points</code>, to access the Cassandra database;
<code>local-datacenter</code>, which is required by the driver; and – optionally – the keyspace to bind to.</p>
</div>
<div class="paragraph">
<p>A sample configuration should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.cassandra.contact-points={cassandra_ip}:9042
quarkus.cassandra.local-datacenter={dc_name}
quarkus.cassandra.keyspace={keyspace}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we are using a single instance running on localhost, and the keyspace containing
our data is <code>k1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.cassandra.contact-points=127.0.0.1:9042
quarkus.cassandra.local-datacenter=datacenter1
quarkus.cassandra.keyspace=k1</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your cluster requires plain text authentication, you must also provide two more settings:
<code>username</code> and <code>password</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.cassandra.auth.username=john
quarkus.cassandra.auth.password=s3cr3t</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connecting-to-a-datastax-astra-cloud-database"><a class="anchor" href="#connecting-to-a-datastax-astra-cloud-database"></a>Connecting to a DataStax Astra Cloud Database</h3>
<div class="paragraph">
<p>When connecting to <a href="https://astra.datastax.com">DataStax Astra</a>, instead of providing a contact
point and a datacenter, you should provide a so-called <em>secure connect bundle</em>, which should point
to a valid path to an Astra secure connect bundle file. You can download your secure connect bundle
from the Astra web console.</p>
</div>
<div class="paragraph">
<p>You will also need to provide a username and password, since authentication is always required on
Astra clusters.</p>
</div>
<div class="paragraph">
<p>A sample configuration for DataStax Astra should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.cassandra.cloud.secure-connect-bundle=/path/to/secure-connect-bundle.zip
quarkus.cassandra.auth.username=john
quarkus.cassandra.auth.password=s3cr3t
quarkus.cassandra.keyspace=k1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-driver-configuration"><a class="anchor" href="#advanced-driver-configuration"></a>Advanced Driver Configuration</h3>
<div class="paragraph">
<p>You can configure other Java driver settings using <code>application.conf</code> or <code>application.json</code> files.
They need to be located in the classpath of your application. All settings will be passed
automatically to the underlying driver configuration mechanism. Settings defined in
<code>application.properties</code> with the <code>quarkus.cassandra</code> prefix will have priority over settings
defined in <code>application.conf</code> or <code>application.json</code>.</p>
</div>
<div class="paragraph">
<p>To see the full list of settings, please refer to the
<a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/reference/">driver
settings reference</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-a-local-cassandra-database"><a class="anchor" href="#running-a-local-cassandra-database"></a>Running a Local Cassandra Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the Cassandra client is configured to access a local Cassandra database on port 9042
(the default Cassandra port).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Make sure that the setting <code>quarkus.cassandra.local-datacenter</code> matches the datacenter of
your Cassandra cluster.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you don&#8217;t know the name of your local datacenter, this value can be found by running the
following CQL query: <code>SELECT data_center FROM system.local</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to use Docker to run a Cassandra database, you can use the following command to launch
one in the background:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker run --name local-cassandra-instance -p 9042:9042 -d cassandra</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next you need to create the keyspace and table that will be used by your application. If you are
using Docker, run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker exec -it local-cassandra-instance cqlsh -e "CREATE KEYSPACE IF NOT EXISTS k1 WITH replication = {'class':'SimpleStrategy', 'replication_factor':1}"
docker exec -it local-cassandra-instance cqlsh -e "CREATE TABLE IF NOT EXISTS k1.fruit(name text PRIMARY KEY, description text)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the CQLSH utility to interactively interrogate your database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker exec -it local-cassandra-instance cqlsh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-rest-api"><a class="anchor" href="#testing-the-rest-api"></a>Testing the REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the project root directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <code>mvn clean package</code> and then <code>java -jar ./target/cassandra-quarkus-quickstart-*-runner.jar</code> to start the application;</p>
</li>
<li>
<p>Or better yet, run the application in dev mode: <code>mvn clean quarkus:dev</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you can use curl commands to interact with the underlying REST API.</p>
</div>
<div class="paragraph">
<p>To create a fruit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"name":"apple","description":"red and tasty"}' \
  http://localhost:8080/fruits</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve fruits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">curl -X GET http://localhost:8080/fruits</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-frontend"><a class="anchor" href="#creating-a-frontend"></a>Creating a Frontend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let&#8217;s add a simple web page to interact with our <code>FruitResource</code>.</p>
</div>
<div class="paragraph">
<p>Quarkus automatically serves static resources located under the <code>META-INF/resources</code> directory. In
the <code>src/main/resources/META-INF/resources</code> directory, add a <code>fruits.html</code> file with the contents
from <a href="src/main/resources/META-INF/resources/fruits.html">this file</a> in it.</p>
</div>
<div class="paragraph">
<p>You can now interact with your REST service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you haven&#8217;t done yet, start your application with <code>mvn clean quarkus:dev</code>;</p>
</li>
<li>
<p>Point your browser to <code><a href="http://localhost:8080/fruits.html" class="bare">http://localhost:8080/fruits.html</a></code>;</p>
</li>
<li>
<p>Add new fruits to the list via the form.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reactive"><a class="anchor" href="#reactive"></a>Reactive Programming with the Cassandra Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The
<a href="https://javadoc.io/doc/com.datastax.oss.quarkus/cassandra-quarkus-client/latest/com/datastax/oss/quarkus/runtime/api/session/QuarkusCqlSession.html"><code>QuarkusCqlSession</code>
interface</a> gives you access to a series of reactive methods that integrate seamlessly with Quarkus
and its reactive framework, Mutiny.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are not familiar with Mutiny, please check <a href="mutiny-primer">Mutiny - an intuitive reactive programming library</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s rewrite our application using reactive programming with Mutiny.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s declare another DAO interface that works in a reactive way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Dao
public interface ReactiveFruitDao {

  @Update
  Uni&lt;Void&gt; updateAsync(Fruit fruit);

  @Select
  MutinyMappedReactiveResultSet&lt;Fruit&gt; findAll();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the usage of <code>MutinyMappedReactiveResultSet</code> - it is a specialized <code>Mutiny</code> type converted from
the original <code>Publisher</code> returned by the driver, which also exposes a few extra methods, e.g. to
obtain the query execution info. If you don&#8217;t need anything in that interface, you can also simply
declare your method to return <code>Multi</code>: <code>Multi&lt;Fruit&gt; findAll()</code>,</p>
</div>
<div class="paragraph">
<p>Similarly, the method <code>updateAsync</code> returns a <code>Uni</code> - it is automatically converted from the
original result set returned by the driver.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Cassandra driver uses the Reactive Streams <code>Publisher</code> API for reactive calls. The Quarkus
framework however uses Mutiny. Because of that, the <code>CqlQuarkusSession</code> interface transparently
converts the <code>Publisher</code> instances returned by the driver into the reactive type <code>Multi</code>.
<code>CqlQuarkusSession</code> is also capable of converting a <code>Publisher</code> into a <code>Uni</code> – in this case, the
publisher is expected to emit at most one row, then complete. This is suitable for write queries
(they return no rows), or for read queries guaranteed to return one row at most (count queries, for
example).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, we need to adapt the <code>FruitMapper</code> to construct a <code>ReactiveFruitDao</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Mapper
public interface FruitMapper {
  // the existing method omitted

  @DaoFactory
  ReactiveFruitDao reactiveFruitDao();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can create a <code>ReactiveFruitService</code> that leverages our reactive DAO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class ReactiveFruitService {

  @Inject ReactiveFruitDao fruitDao;

  public Uni&lt;Void&gt; add(Fruit fruit) {
    return fruitDao.update(fruit);
  }

  public Multi&lt;Fruit&gt; getAll() {
    return fruitDao.findAll();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can create a <code>ReactiveFruitResource</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/reactive-fruits")
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public class ReactiveFruitResource {

  @Inject ReactiveFruitService service;

  @GET
  public Multi&lt;FruitDto&gt; getAll() {
    return service.getAll().map(this::convertToDto);
  }

  @POST
  public Uni&lt;Void&gt; add(FruitDto fruitDto) {
    return service.add(convertFromDto(fruitDto));
  }

  private FruitDto convertToDto(Fruit fruit) {
    return new FruitDto(fruit.getName(), fruit.getDescription());
  }

  private Fruit convertFromDto(FruitDto fruitDto) {
    return new Fruit(fruitDto.getName(), fruitDto.getDescription());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above resource is exposing a new endpoint, <code>reactive-fruits</code>. Its capabilities are identical to
the ones that we created before with <code>FruitResource</code>, but everything is handled in a reactive
fashion, without any blocking operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>getAll()</code> method above returns <code>Multi</code>, and the <code>add()</code> method returns <code>Uni</code>. These types
are the same Mutiny types that we met before; they are automatically recognized by the Quarkus
reactive REST API, so we don&#8217;t need to convert them into JSON ourselves.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Quarkus REST natively supports the Mutiny reactive types e.g. <code>Uni</code> and <code>Multi</code>.</p>
</div>
<div class="paragraph">
<p>This dependency is already included in this guide&#8217;s pom.xml, but if you are starting a new project
from scratch, make sure to include it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-reactive-rest-api"><a class="anchor" href="#testing-the-reactive-rest-api"></a>Testing the Reactive REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run the application in dev mode as explained above, then you can use curl commands to interact with
the underlying REST API.</p>
</div>
<div class="paragraph">
<p>To create a fruit using the reactive REST endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"name":"banana","description":"yellow and sweet"}' \
  http://localhost:8080/reactive-fruits</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve fruits with the reactive REST endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">curl -X GET http://localhost:8080/reactive-fruits</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-reactive-frontend"><a class="anchor" href="#creating-a-reactive-frontend"></a>Creating a Reactive Frontend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let&#8217;s add a simple web page to interact with our <code>ReactiveFruitResource</code>. In the
<code>src/main/resources/META-INF/resources</code> directory, add a <code>reactive-fruits.html</code> file with the
contents from <a href="src/main/resources/META-INF/resources/reactive-fruits.html">this file</a> in it.</p>
</div>
<div class="paragraph">
<p>You can now interact with your reactive REST service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you haven&#8217;t done yet, start your application with <code>mvn clean quarkus:dev</code>;</p>
</li>
<li>
<p>Point your browser to <code><a href="http://localhost:8080/reactive-fruits.html" class="bare">http://localhost:8080/reactive-fruits.html</a></code>;</p>
</li>
<li>
<p>Add new fruits to the list via the form.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="health-checks"><a class="anchor" href="#health-checks"></a>Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are using the Quarkus SmallRye Health extension, then the Cassandra client will automatically
add a readiness health check to validate the connection to the Cassandra cluster. This extension is
already included in this guide&#8217;s pom.xml, but if you need to include it manually in your
application, add the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-smallrye-health&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When health checks are available, you can access the <code>/health/ready</code> endpoint of your application
and have information about the connection validation status.</p>
</div>
<div class="paragraph">
<p>Running in dev mode with <code>mvn clean quarkus:dev</code>, if you point your browser to
<a href="http://localhost:8080/health/ready" class="bare">http://localhost:8080/health/ready</a> you should see an output similar to the following one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">{
    "status": "UP",
    "checks": [
        {
            "name": "DataStax Apache Cassandra Driver health check",
            "status": "UP",
            "data": {
                "cqlVersion": "3.4.4",
                "releaseVersion": "3.11.7",
                "clusterName": "Test Cluster",
                "datacenter": "datacenter1",
                "numberOfNodes": 1
            }
        }
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need health checks globally enabled in your application, but don&#8217;t want to activate
Cassandra health checks, you can disable Cassandra health checks by setting the
<code>quarkus.cassandra.health.enabled</code> property to <code>false</code> in your <code>application.properties</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics"><a class="anchor" href="#metrics"></a>Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Cassandra Quarkus client can provide metrics about the Cassandra session and about individual
Cassandra nodes. It supports both Micrometer and MicroProfile.</p>
</div>
<div class="paragraph">
<p>The first step to enable metrics is to add a few additional dependencies depending on the metrics
framework you plan to use.</p>
</div>
<div class="sect2">
<h3 id="enabling-metrics-with-micrometer"><a class="anchor" href="#enabling-metrics-with-micrometer"></a>Enabling Metrics with Micrometer</h3>
<div class="paragraph">
<p>Micrometer is the recommended metrics framework in Quarkus applications.</p>
</div>
<div class="paragraph">
<p>To enable Micrometer metrics in your application, you need to add the following to your pom.xml.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.datastax.oss&lt;/groupId&gt;
  &lt;artifactId&gt;java-driver-metrics-micrometer&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-micrometer-registry-prometheus&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This guide uses Micrometer, so the above dependencies are already included in this guide&#8217;s pom.xml.</p>
</div>
</div>
<div class="sect2">
<h3 id="enabling-metrics-with-microprofile-metrics"><a class="anchor" href="#enabling-metrics-with-microprofile-metrics"></a>Enabling Metrics with MicroProfile Metrics</h3>
<div class="paragraph">
<p>Remove any dependency to Micrometer from your pom.xml, then add the following ones instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.datastax.oss&lt;/groupId&gt;
  &lt;artifactId&gt;java-driver-metrics-microprofile&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-smallrye-metrics&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-cassandra-metrics"><a class="anchor" href="#enabling-cassandra-metrics"></a>Enabling Cassandra Metrics</h3>
<div class="paragraph">
<p>Even when metrics are enabled in your application, the Cassandra client will not report any metrics,
unless you opt in for this feature. So your next step is to enable Cassandra metrics in your
<code>application.properties</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.cassandra.metrics.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it!</p>
</div>
<div class="paragraph">
<p>The final (and optional) step is to customize which specific Cassandra metrics you would like the
Cassandra client to track. Several metrics can be tracked; if you skip this step, a default set of
useful metrics will be automatically tracked.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For the full list of available metric names, please refer to the
<a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/reference/">driver
settings reference</a> page; search for the <code>advanced.metrics</code> section.
Also, Cassandra driver metrics are covered in detail in the
<a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/core/metrics/">driver manual</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you do wish to customize which metrics to track, you should use the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus.cassandra.metrics.session.enabled</code> should contain the session-level metrics to enable
(metrics that are global to the session).</p>
</li>
<li>
<p><code>quarkus.cassandra.metrics.node.enabled</code> should contain the node-level metrics to enable (metrics
for which each node contacted by the Cassandra client gets its own metric value).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both properties accept a comma-separated list of valid metric names.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s assume that you wish to enable the following three Cassandra metrics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Session-level: <code>session.connected-nodes</code> and <code>session.bytes-sent</code>;</p>
</li>
<li>
<p>Node-level: <code>node.pool.open-connections</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then you should add the following settings to your <code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.cassandra.metrics.enabled=true
quarkus.cassandra.metrics.session.enabled=connected-nodes,bytes-sent
quarkus.cassandra.metrics.node.enabled=pool.open-connections</code></pre>
</div>
</div>
<div class="paragraph">
<p>This guide&#8217;s <code>application.properties</code> file has already many metrics enabled; you can use its metrics
list as a good starting point for exposing useful Cassandra metrics in your application.</p>
</div>
<div class="paragraph">
<p>When metrics are properly enabled, metric reports for all enabled metrics are available at the
<code>/metrics</code> REST endpoint of your application.</p>
</div>
<div class="paragraph">
<p>Running in dev mode with <code>mvn clean quarkus:dev</code>, if you point your browser to
<code><a href="http://localhost:8080/metrics" class="bare">http://localhost:8080/metrics</a></code> you should see a list of metrics; search for metrics whose names
contain <code>cassandra</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For Cassandra metrics to show up, the Cassandra client needs to be initialized and
connected; if you are using lazy initialization (see below), you won&#8217;t see any Cassandra metrics
until your application actually connects and hits the database for the first time.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-in-native-mode"><a class="anchor" href="#running-in-native-mode"></a>Running in native mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you installed GraalVM, you can <a href="building-native-image">build a native image</a> using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn clean package -Dnative</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beware that native compilation can take a significant amount of time! Once the compilation is done,
you can run the native executable as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./target/cassandra-quarkus-quickstart-*-runner</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then point your browser to <code><a href="http://localhost:8080/fruits.html" class="bare">http://localhost:8080/fruits.html</a></code> and use your application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="choosing-between-eager-and-lazy-initialization"><a class="anchor" href="#choosing-between-eager-and-lazy-initialization"></a>Choosing between eager and lazy initialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As explained above, this extension allows you to inject many types of beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A simple bean like <code>QuarkusCqlSession</code> or <code>FruitDao</code>;</p>
</li>
<li>
<p>The asynchronous version of that bean, for example <code>CompletionStage&lt;QuarkusCqlSession&gt;</code> or
`CompletionStage&lt;FruitDao&gt;;</p>
</li>
<li>
<p>The reactive version of that bean, for example <code>Uni&lt;QuarkusCqlSession&gt;</code> or <code>Uni&lt;FruitDao&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most straightforward approach is obviously to inject the bean directly. This should work just
fine for most applications. However, the <code>QuarkusCqlSession</code> bean, and all DAO beans that depend on
it, might take some time to initialize before they can be used for the first time, and this process
is blocking.</p>
</div>
<div class="paragraph">
<p>Fortunately, it is possible to control when the initialization should happen: the
<code>quarkus.cassandra.init.eager-init</code> parameter determines if the <code>QuarkusCqlSession</code> bean should be
initialized on its first access (lazy) or when the application is starting (eager). The default
value of this parameter is <code>false</code>, meaning the init process is lazy: the <code>QuarkusCqlSession</code> bean
will be initialized lazily on its first access – for example, when there is a first REST request
that needs to interact with the Cassandra database.</p>
</div>
<div class="paragraph">
<p>Using lazy initialization speeds up your application startup time, and avoids startup failures if
the Cassandra database is not available. However, it could also prove dangerous if your code is
fully non-blocking, for example if it uses <a href="reactive-routes">reactive routes</a>.
Indeed, the lazy initialization could accidentally happen on a thread that is not allowed
to block, such as a Vert.x event loop thread. Therefore, setting <code>quarkus.cassandra.init.eager-init</code>
to <code>false</code> and injecting <code>QuarkusCqlSession</code> should be avoided in these contexts.</p>
</div>
<div class="paragraph">
<p>If you want to use Vert.x (or any other non-blocking framework) and keep the lazy initialization
behavior, you should instead inject only a <code>CompletionStage</code> or a <code>Uni</code> of the desired bean. When
injecting these beans, the initialization process will be triggered lazily, but it will happen in
the background, in a non-blocking way, leveraging the Vert.x event loop. This way you don&#8217;t risk
blocking the Vert.x thread.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can set <code>quarkus.cassandra.init.eager-init</code> to true: in this case the session
bean and all DAO beans will be initialized eagerly during application startup, on the Quarkus main
thread. This would eliminate any risk of blocking a Vert.x thread, at the cost of making your
startup time (much) longer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Accessing a Cassandra database from a client application is easy with Quarkus and the Cassandra
extension, which provides configuration and native support for the DataStax Java driver for Apache
Cassandra.</p>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#solution">Solution</a></li>
<li><a href="#creating-a-blank-maven-project">Creating a Blank Maven Project</a></li>
<li><a href="#creating-the-data-model-and-data-access-objects">Creating the Data Model and Data Access Objects</a></li>
<li><a href="#generating-the-dao-and-mapper-implementations">Generating the DAO and mapper implementations</a></li>
<li><a href="#creating-a-service-json-rest-endpoint">Creating a service &amp; JSON REST endpoint</a></li>
<li><a href="#connecting-to-the-cassandra-database">Connecting to the Cassandra Database</a>
<ul class="sectlevel2">
<li><a href="#connecting-to-apache-cassandra-or-datastax-enterprise-dse">Connecting to Apache Cassandra or DataStax Enterprise (DSE)</a></li>
<li><a href="#connecting-to-a-datastax-astra-cloud-database">Connecting to a DataStax Astra Cloud Database</a></li>
<li><a href="#advanced-driver-configuration">Advanced Driver Configuration</a></li>
</ul>
</li>
<li><a href="#running-a-local-cassandra-database">Running a Local Cassandra Database</a></li>
<li><a href="#testing-the-rest-api">Testing the REST API</a></li>
<li><a href="#creating-a-frontend">Creating a Frontend</a></li>
<li><a href="#reactive">Reactive Programming with the Cassandra Client</a></li>
<li><a href="#testing-the-reactive-rest-api">Testing the Reactive REST API</a></li>
<li><a href="#creating-a-reactive-frontend">Creating a Reactive Frontend</a></li>
<li><a href="#health-checks">Health Checks</a></li>
<li><a href="#metrics">Metrics</a>
<ul class="sectlevel2">
<li><a href="#enabling-metrics-with-micrometer">Enabling Metrics with Micrometer</a></li>
<li><a href="#enabling-metrics-with-microprofile-metrics">Enabling Metrics with MicroProfile Metrics</a></li>
<li><a href="#enabling-cassandra-metrics">Enabling Cassandra Metrics</a></li>
</ul>
</li>
<li><a href="#running-in-native-mode">Running in native mode</a></li>
<li><a href="#choosing-between-eager-and-lazy-initialization">Choosing between eager and lazy initialization</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></div>
    </div>
  </div>
  <h2>Related content</h2>
  <div class="grid-wrapper relations">
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same topics</h3>
      <ul class="related-content">
      
        
        <li class="guide"><a href="/guides/cache">Application Data Caching</a></li>
      
        
        <li class="reference"><a href="/guides/datasource">Configure data sources in Quarkus</a></li>
      
        
        <li class="guide"><a href="/guides/elasticsearch">Connecting to an Elasticsearch cluster</a></li>
      
        
        <li class="guide"><a href="/guides/databases-dev-services">Dev Services for Databases</a></li>
      
        
        <li class="guide"><a href="/guides/elasticsearch-dev-services">Dev Services for Elasticsearch</a></li>
      
        
        <li class="guide"><a href="/guides/infinispan-dev-services">Dev Services for Infinispan</a></li>
      
        
        <li class="guide"><a href="/guides/redis-dev-services">Dev Services for Redis</a></li>
      
        
        <li class="reference"><a href="/guides/cache-infinispan-reference">Infinispan Cache</a></li>
      
        
        <li class="reference"><a href="/guides/infinispan-client-reference">Infinispan Client Extension Reference Guide</a></li>
      
        
        <li class="guide"><a href="/guides/lra">Narayana LRA Participant Support</a></li>
      
        
        <li class="guide"><a href="/guides/reactive-sql-clients">Reactive SQL Clients</a></li>
      
        
        <li class="reference"><a href="/guides/cache-redis-reference">Redis Cache</a></li>
      
        
        <li class="reference"><a href="/guides/redis-reference">Redis Extension Reference Guide</a></li>
      
        
        <li class="guide"><a href="/guides/hibernate-orm-panache">Simplified Hibernate ORM with Panache</a></li>
      
        
        <li class="guide"><a href="/guides/hibernate-orm-panache-kotlin">Simplified Hibernate ORM with Panache and Kotlin</a></li>
      
        
        <li class="guide"><a href="/guides/hibernate-reactive-panache">Simplified Hibernate Reactive with Panache</a></li>
      
        
        <li class="guide"><a href="/guides/mongodb-panache">Simplified MongoDB with Panache</a></li>
      
        
        <li class="guide"><a href="/guides/mongodb-panache-kotlin">Simplified MongoDB with Panache and Kotlin</a></li>
      
        
        <li class="guide"><a href="/guides/hibernate-search-standalone-elasticsearch">Use Hibernate Search in Standalone mode with Elasticsearch/OpenSearch</a></li>
      
        
        <li class="guide"><a href="/guides/hibernate-search-orm-elasticsearch">Use Hibernate Search with Hibernate ORM and Elasticsearch/OpenSearch</a></li>
      </ul>
    </div>
    </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
