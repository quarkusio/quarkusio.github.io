<!DOCTYPE html>
<html lang="en">







<head>
  <title>Using Apache Kafka with Schema Registry and Avro - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://embed.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/guides/kafka-schema-registry-avro" />
  <meta property="og:title" content="Using Apache Kafka with Schema Registry and Avro" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/kafka-schema-registry-avro">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/guides/kafka-schema-registry-avro" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/guides/kafka-schema-registry-avro" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/guides/kafka-schema-registry-avro" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/guides/kafka-schema-registry-avro" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/guides/kafka-schema-registry-avro" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/continuum" class="">VERSATILITY</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/guides/kafka-schema-registry-avro" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/guides/kafka-schema-registry-avro">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/guides/kafka-schema-registry-avro">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/guides/kafka-schema-registry-avro">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/guides/kafka-schema-registry-avro">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" selected>3.16.2 - Latest</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        
        
        
        <option value="3.2" >3.2</option>
        
        
        
        <option value="2.16" >2.16</option>
        
        
        
        <option value="2.13" >2.13</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <a class="editlink" href="https://github.com/quarkusio/quarkus/edit/main/docs/src/main/asciidoc/kafka-schema-registry-avro.adoc">Edit this Page</a>
      
      <h1 class="text-caps">Using Apache Kafka with Schema Registry and Avro </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide shows how your Quarkus application can use Apache Kafka, <a href="https://avro.apache.org/docs/current/">Avro</a> serialized
records, and connect to a schema registry (such as the <a href="https://docs.confluent.io/platform/current/schema-registry/index.html">Confluent Schema Registry</a> or <a href="https://www.apicur.io/registry/">Apicurio Registry</a>).</p>
</div>
<div class="paragraph">
<p>If you are not familiar with Kafka and Kafka in Quarkus in particular, consider
first going through the <a href="kafka">Using Apache Kafka with Reactive Messaging</a> guide.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roughly 30 minutes</p>
</li>
<li>
<p>An IDE</p>
</li>
<li>
<p>JDK 17+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.9.9</p>
</li>
<li>
<p>Docker and Docker Compose or <a href="podman">Podman</a>, and Docker Compose</p>
</li>
<li>
<p>Optionally the <a href="cli-tooling">Quarkus CLI</a> if you want to use it</p>
</li>
<li>
<p>Optionally Mandrel or GraalVM installed and <a href="building-native-image#configuring-graalvm">configured appropriately</a> if you want to build a native executable (or Docker if you use a native container build)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide we are going to implement a REST resource, namely <code>MovieResource</code>, that
will consume movie DTOs and put them in a Kafka topic.</p>
</div>
<div class="paragraph">
<p>Then, we will implement a consumer that will consume and collect messages from the same topic.
The collected messages will be then exposed by another resource, <code>ConsumedMovieResource</code>, via
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events">Server-Sent Events</a>.</p>
</div>
<div class="paragraph">
<p>The <em>Movies</em> will be serialized and deserialized using Avro.
The schema, describing the <em>Movie</em>, is stored in Apicurio Registry.
The same concept applies if you are using the Confluent Avro <em>serde</em> and Confluent Schema Registry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution"><a class="anchor" href="#solution"></a>Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step.
However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>Clone the Git repository: <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code>, or download an <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>The solution is located in the <code>kafka-avro-schema-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/kafka-avro-schema-quickstart">directory</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project"><a class="anchor" href="#creating-the-maven-project"></a>Creating the Maven Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we need a new project. Create a new project with the following command:</p>
</div>
<div class="sidebarblock primary asciidoc-tabs-sync-cli">
<div class="content">
<div class="title">CLI</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus create app org.acme:kafka-avro-schema-quickstart \
    --extension='rest-jackson,messaging-kafka,apicurio-registry-avro' \
    --no-code
cd kafka-avro-schema-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a Gradle project, add the <code>--gradle</code> or <code>--gradle-kotlin-dsl</code> option.</p>
</div>
<div class="paragraph">
<p>For more information about how to install and use the Quarkus CLI, see the <a href="cli-tooling">Quarkus CLI</a> guide.</p>
</div>
</div>
</div>
<div class="sidebarblock secondary asciidoc-tabs-sync-maven">
<div class="content">
<div class="title">Maven</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus.platform:quarkus-maven-plugin:3.16.2:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=kafka-avro-schema-quickstart \
    -Dextensions='rest-jackson,messaging-kafka,apicurio-registry-avro' \
    -DnoCode
cd kafka-avro-schema-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a Gradle project, add the <code>-DbuildTool=gradle</code> or <code>-DbuildTool=gradle-kotlin-dsl</code> option.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>For Windows users:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If using cmd, (don&#8217;t use backward slash <code>\</code> and put everything on the same line)</p>
</li>
<li>
<p>If using Powershell, wrap <code>-D</code> parameters in double quotes e.g. <code>"-DprojectArtifactId=kafka-avro-schema-quickstart"</code></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use Confluent Schema Registry, you don&#8217;t need the <code>quarkus-apicurio-registry-avro</code> extension.
Instead, you need the <code>quarkus-confluent-registry-avro</code> extension and a few more dependencies.
See <a href="#confluent">Using the Confluent Schema Registry</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="avro-schema"><a class="anchor" href="#avro-schema"></a>Avro schema</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Avro is a data serialization system. Data structures are described using schemas.
The first thing we need to do is to create a schema describing the <code>Movie</code> structure.
Create a file called <code>src/main/avro/movie.avsc</code> with the schema for our record (Kafka message):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "namespace": "org.acme.kafka.quarkus",
  "type": "record",
  "name": "Movie",
  "fields": [
    {
      "name": "title",
      "type": "string"
    },
    {
      "name": "year",
      "type": "int"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you build the project with:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build</code></pre>
</div>
</div>
<div class="paragraph">
<p>the <code>movies.avsc</code> will get compiled to a <code>Movie.java</code> file
placed in the <code>target/generated-sources/avsc</code> directory.</p>
</div>
<div class="paragraph">
<p>Take a look at the <a href="https://avro.apache.org/docs/current/spec.html#schemas">Avro specification</a> to learn more about
the Avro syntax and supported types.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
With Quarkus, there&#8217;s no need to use a specific Maven plugin to process the Avro schema, this is all done for you by the <code>quarkus-avro</code> extension!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you run the project with:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev</code></pre>
</div>
</div>
<div class="paragraph">
<p>the changes you do to the schema file will be
automatically applied to the generated Java files.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-movie-producer"><a class="anchor" href="#the-movie-producer"></a>The <code>Movie</code> producer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Having defined the schema, we can now jump to implementing the <code>MovieResource</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s open the <code>MovieResource</code>, inject an <a href="https://quarkus.io/blog/reactive-messaging-emitter/"><code>Emitter</code></a> of <code>Movie</code> DTO and implement a <code>@POST</code> method
that consumes <code>Movie</code> and sends it through the <code>Emitter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.kafka;

import org.acme.kafka.quarkus.Movie;
import org.eclipse.microprofile.reactive.messaging.Channel;
import org.eclipse.microprofile.reactive.messaging.Emitter;
import org.jboss.logging.Logger;

import jakarta.ws.rs.POST;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.core.Response;

@Path("/movies")
public class MovieResource {
    private static final Logger LOGGER = Logger.getLogger(MovieResource.class);

    @Channel("movies")
    Emitter&lt;Movie&gt; emitter;

    @POST
    public Response enqueueMovie(Movie movie) {
        LOGGER.infof("Sending movie %s to Kafka", movie.getTitle());
        emitter.send(movie);
        return Response.accepted().build();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we need to <em>map</em> the <code>movies</code> channel (the <code>Emitter</code> emits to this channel) to a Kafka topic.
To achieve this, edit the <code>application.properties</code> file, and add the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># set the connector for the outgoing channel to `smallrye-kafka`
mp.messaging.outgoing.movies.connector=smallrye-kafka

# set the topic name for the channel to `movies`
mp.messaging.outgoing.movies.topic=movies

# automatically register the schema with the registry, if not present
mp.messaging.outgoing.movies.apicurio.registry.auto-register=true</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You might have noticed that we didn&#8217;t define the <code>value.serializer</code>.
That&#8217;s because Quarkus can <a href="kafka#serialization-autodetection">autodetect</a> that <code>io.apicurio.registry.serde.avro.AvroKafkaSerializer</code> is appropriate here, based on the <code>@Channel</code> declaration, structure of the <code>Movie</code> type, and presence of the Apicurio Registry libraries.
We still have to define the <code>apicurio.registry.auto-register</code> property.</p>
</div>
<div class="paragraph">
<p>If you use Confluent Schema Registry, you don&#8217;t have to configure <code>value.serializer</code> either.
It is also detected automatically.
The Confluent Schema Registry analogue of <code>apicurio.registry.auto-register</code> is called <code>auto.register.schemas</code>.
It defaults to <code>true</code>, so it doesn&#8217;t have to be configured in this example.
It can be explicitly set to <code>false</code> if you want to disable automatic schema registration.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-movie-consumer"><a class="anchor" href="#the-movie-consumer"></a>The <code>Movie</code> consumer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So, we can write records into Kafka containing our <code>Movie</code> data.
That data is serialized using Avro.
Now, it&#8217;s time to implement a consumer for them.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create <code>ConsumedMovieResource</code> that will consume <code>Movie</code> messages
from the <code>movies-from-kafka</code> channel and will expose it via Server-Sent Events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.kafka;

import jakarta.enterprise.context.ApplicationScoped;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

import org.acme.kafka.quarkus.Movie;
import org.eclipse.microprofile.reactive.messaging.Channel;
import org.jboss.resteasy.reactive.RestStreamElementType;

import io.smallrye.mutiny.Multi;

@ApplicationScoped
@Path("/consumed-movies")
public class ConsumedMovieResource {

    @Channel("movies-from-kafka")
    Multi&lt;Movie&gt; movies;

    @GET
    @Produces(MediaType.SERVER_SENT_EVENTS)
    @RestStreamElementType(MediaType.TEXT_PLAIN)
    public Multi&lt;String&gt; stream() {
        return movies.map(movie -&gt; String.format("'%s' from %s", movie.getTitle(), movie.getYear()));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last bit of the application&#8217;s code is the configuration of the <code>movies-from-kafka</code> channel in
<code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># set the connector for the incoming channel to `smallrye-kafka`
mp.messaging.incoming.movies-from-kafka.connector=smallrye-kafka

# set the topic name for the channel to `movies`
mp.messaging.incoming.movies-from-kafka.topic=movies

# disable auto-commit, Reactive Messaging handles it itself
mp.messaging.incoming.movies-from-kafka.enable.auto.commit=false

mp.messaging.incoming.movies-from-kafka.auto.offset.reset=earliest</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You might have noticed that we didn&#8217;t define the <code>value.deserializer</code>.
That&#8217;s because Quarkus can <a href="kafka#serialization-autodetection">autodetect</a> that <code>io.apicurio.registry.serde.avro.AvroKafkaDeserializer</code> is appropriate here, based on the <code>@Channel</code> declaration, structure of the <code>Movie</code> type, and presence of the Apicurio Registry libraries.
We don&#8217;t have to define the <code>apicurio.registry.use-specific-avro-reader</code> property either, that is also configured automatically.</p>
</div>
<div class="paragraph">
<p>If you use Confluent Schema Registry, you don&#8217;t have to configure <code>value.deserializer</code> or <code>specific.avro.reader</code> either.
They are both detected automatically.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-application"><a class="anchor" href="#running-the-application"></a>Running the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Start the application in dev mode:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kafka broker and Apicurio Registry instance are started automatically thanks to Dev Services.
See <a href="kafka-dev-services">Dev Services for Kafka</a> and <a href="apicurio-registry-dev-services">Dev Services for Apicurio Registry</a> for more details.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You might have noticed that we didn&#8217;t configure the schema registry URL anywhere.
This is because Dev Services for Apicurio Registry configures all Kafka channels in Quarkus Messaging to use the automatically started registry instance.</p>
</div>
<div class="paragraph">
<p>Apicurio Registry, in addition to its native API, also exposes an endpoint that is API-compatible with Confluent Schema Registry.
Therefore, this automatic configuration works both for Apicurio Registry serde and Confluent Schema Registry serde.</p>
</div>
<div class="paragraph">
<p>However, note that there&#8217;s no Dev Services support for running Confluent Schema Registry itself.
If you want to use a running instance of Confluent Schema Registry, configure its URL, together with the URL of a Kafka broker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">kafka.bootstrap.servers=PLAINTEXT://localhost:9092
mp.messaging.connector.smallrye-kafka.schema.registry.url=http://localhost:8081</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the second terminal, query the <code>ConsumedMovieResource</code> resource with <code>curl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -N http://localhost:8080/consumed-movies</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the third one, post a few movies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"title":"The Shawshank Redemption","year":1994}' \
  http://localhost:8080/movies

curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"title":"The Godfather","year":1972}' \
  http://localhost:8080/movies

curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"title":"The Dark Knight","year":2008}' \
  http://localhost:8080/movies

curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"title":"12 Angry Men","year":1957}' \
  http://localhost:8080/movies</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observe what is printed in the second terminal. You should see something along the lines of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">data:'The Shawshank Redemption' from 1994

data:'The Godfather' from 1972

data:'The Dark Knight' from 2008

data:'12 Angry Men' from 1957</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-in-jvm-or-native-mode"><a class="anchor" href="#running-in-jvm-or-native-mode"></a>Running in JVM or Native mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When not running in dev or test mode, you will need to start your own Kafka broker and Apicurio Registry.
The easiest way to get them running is to use <code>docker-compose</code> to start the appropriate containers.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you use Confluent Schema Registry, you already have a Kafka broker and Confluent Schema Registry instance running and configured.
You can ignore the <code>docker-compose</code> instructions here, as well as the Apicurio Registry configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a <code>docker-compose.yaml</code> file at the root of the project with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">version: '2'

services:

  zookeeper:
    image: quay.io/strimzi/kafka:0.41.0-kafka-3.7.0
    command: [
        "sh", "-c",
        "bin/zookeeper-server-start.sh config/zookeeper.properties"
    ]
    ports:
      - "2181:2181"
    environment:
      LOG_DIR: /tmp/logs

  kafka:
    image: quay.io/strimzi/kafka:0.41.0-kafka-3.7.0
    command: [
        "sh", "-c",
        "bin/kafka-server-start.sh config/server.properties --override listeners=$${KAFKA_LISTENERS} --override advertised.listeners=$${KAFKA_ADVERTISED_LISTENERS} --override zookeeper.connect=$${KAFKA_ZOOKEEPER_CONNECT}"
    ]
    depends_on:
      - zookeeper
    ports:
      - "9092:9092"
    environment:
      LOG_DIR: "/tmp/logs"
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181

  schema-registry:
    image: apicurio/apicurio-registry-mem:2.4.2.Final
    ports:
      - 8081:8080
    depends_on:
      - kafka
    environment:
      QUARKUS_PROFILE: prod</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before starting the application, let&#8217;s first start the Kafka broker and Apicurio Registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker-compose up</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To stop the containers, use <code>docker-compose down</code>. You can also clean up
the containers with <code>docker-compose rm</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can build the application with:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build</code></pre>
</div>
</div>
<div class="paragraph">
<p>And run it in JVM mode with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">java -Dmp.messaging.connector.smallrye-kafka.apicurio.registry.url=http://localhost:8081/apis/registry/v2 -jar target/quarkus-app/quarkus-run.jar</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the application tries to connect to a Kafka broker listening at <code>localhost:9092</code>.
You can configure the bootstrap server using: <code>java -Dkafka.bootstrap.servers=... -jar target/quarkus-app/quarkus-run.jar</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Specifying the registry URL on the command line is not very convenient, so you can add a configuration property only for the <code>prod</code> profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">%prod.mp.messaging.connector.smallrye-kafka.apicurio.registry.url=http://localhost:8081/apis/registry/v2</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can build a native executable with:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build -Dquarkus.native.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>and run it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./target/kafka-avro-schema-quickstart-1.0.0-SNAPSHOT-runner -Dkafka.bootstrap.servers=localhost:9092</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-application"><a class="anchor" href="#testing-the-application"></a>Testing the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned above, Dev Services for Kafka and Apicurio Registry automatically start and configure a Kafka broker and Apicurio Registry instance in dev mode and for tests.
Hence, we don&#8217;t have to set up Kafka and Apicurio Registry ourselves.
We can just focus on writing the test.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s add test dependencies on REST Client and Awaitility to the build file:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- we'll use Jakarta REST Client for talking to the SSE endpoint --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-rest-client&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.awaitility&lt;/groupId&gt;
    &lt;artifactId&gt;awaitility&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">testImplementation("io.quarkus:quarkus-rest-client")
testImplementation("org.awaitility:awaitility")</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the test, we will send movies in a loop and check if the <code>ConsumedMovieResource</code> returns
what we send.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.kafka;

import io.quarkus.test.common.QuarkusTestResource;
import io.quarkus.test.common.http.TestHTTPResource;
import io.quarkus.test.junit.QuarkusTest;
import io.restassured.http.ContentType;
import org.hamcrest.Matchers;
import org.junit.jupiter.api.Test;

import jakarta.ws.rs.client.Client;
import jakarta.ws.rs.client.ClientBuilder;
import jakarta.ws.rs.client.WebTarget;
import jakarta.ws.rs.sse.SseEventSource;
import java.net.URI;
import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import static io.restassured.RestAssured.given;
import static java.util.concurrent.TimeUnit.MILLISECONDS;
import static java.util.concurrent.TimeUnit.SECONDS;
import static org.awaitility.Awaitility.await;
import static org.hamcrest.MatcherAssert.assertThat;

@QuarkusTest
public class MovieResourceTest {

    @TestHTTPResource("/consumed-movies")
    URI consumedMovies;

    @Test
    public void testHelloEndpoint() throws InterruptedException {
        // create a client for `ConsumedMovieResource` and collect the consumed resources in a list
        Client client = ClientBuilder.newClient();
        WebTarget target = client.target(consumedMovies);

        List&lt;String&gt; received = new CopyOnWriteArrayList&lt;&gt;();

        SseEventSource source = SseEventSource.target(target).build();
        source.register(inboundSseEvent -&gt; received.add(inboundSseEvent.readData()));

        // in a separate thread, feed the `MovieResource`
        ExecutorService movieSender = startSendingMovies();

        source.open();

        // check if, after at most 5 seconds, we have at least 2 items collected, and they are what we expect
        await().atMost(5, SECONDS).until(() -&gt; received.size() &gt;= 2);
        assertThat(received, Matchers.hasItems("'The Shawshank Redemption' from 1994",
                "'12 Angry Men' from 1957"));
        source.close();

        // shutdown the executor that is feeding the `MovieResource`
        movieSender.shutdownNow();
        movieSender.awaitTermination(5, SECONDS);
    }

    private ExecutorService startSendingMovies() {
        ExecutorService executorService = Executors.newSingleThreadExecutor();
        executorService.execute(() -&gt; {
            while (true) {
                given()
                        .contentType(ContentType.JSON)
                        .body("{\"title\":\"The Shawshank Redemption\",\"year\":1994}")
                .when()
                        .post("/movies")
                .then()
                        .statusCode(202);

                given()
                        .contentType(ContentType.JSON)
                        .body("{\"title\":\"12 Angry Men\",\"year\":1957}")
                .when()
                        .post("/movies")
                .then()
                        .statusCode(202);

                try {
                    Thread.sleep(200L);
                } catch (InterruptedException e) {
                    break;
                }
            }
        });
        return executorService;
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We modified the <code>MovieResourceTest</code> that was generated together with the project. This test class has a
subclass, <code>NativeMovieResourceIT</code>, that runs the same test against the native executable.
To run it, execute:
</td>
</tr>
</table>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build -Dquarkus.native.enabled=true</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="manual-setup"><a class="anchor" href="#manual-setup"></a>Manual setup</h3>
<div class="paragraph">
<p>If we couldn&#8217;t use Dev Services and wanted to start a Kafka broker and Apicurio Registry instance manually, we would define a <a href="getting-started-testing#quarkus-test-resource">QuarkusTestResourceLifecycleManager</a>.</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.strimzi&lt;/groupId&gt;
    &lt;artifactId&gt;strimzi-test-container&lt;/artifactId&gt;
    &lt;version&gt;0.105.0&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">testImplementation("io.strimzi:strimzi-test-container:0.105.0") {
    exclude group: "org.apache.logging.log4j", module: "log4j-core"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.kafka;

import java.util.HashMap;
import java.util.Map;

import org.testcontainers.containers.GenericContainer;

import io.quarkus.test.common.QuarkusTestResourceLifecycleManager;
import io.strimzi.StrimziKafkaContainer;

public class KafkaAndSchemaRegistryTestResource implements QuarkusTestResourceLifecycleManager {

    private final StrimziKafkaContainer kafka = new StrimziKafkaContainer();

    private GenericContainer&lt;?&gt; registry;

    @Override
    public Map&lt;String, String&gt; start() {
        kafka.start();
        registry = new GenericContainer&lt;&gt;("apicurio/apicurio-registry-mem:2.4.2.Final")
                .withExposedPorts(8080)
                .withEnv("QUARKUS_PROFILE", "prod");
        registry.start();
        Map&lt;String, String&gt; properties = new HashMap&lt;&gt;();
        properties.put("mp.messaging.connector.smallrye-kafka.apicurio.registry.url",
                "http://" + registry.getHost() + ":" + registry.getMappedPort(8080) + "/apis/registry/v2");
        properties.put("kafka.bootstrap.servers", kafka.getBootstrapServers());
        return properties;
    }

    @Override
    public void stop() {
        registry.stop();
        kafka.stop();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
@QuarkusTestResource(KafkaAndSchemaRegistryTestResource.class)
public class MovieResourceTest {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="apicurio-versions-compatibility"><a class="anchor" href="#apicurio-versions-compatibility"></a>Using compatible versions of the Apicurio Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>quarkus-apicurio-registry-avro</code> extension depends on recent versions of Apicurio Registry client,
and most versions of Apicurio Registry server and client are backwards compatible.
For some you need to make sure that the client used by Serdes is compatible with the server.</p>
</div>
<div class="paragraph">
<p>For example, with Apicurio Dev Service if you set the image name to use version <code>2.1.5.Final</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.apicurio-registry.devservices.image-name=quay.io/apicurio/apicurio-registry-mem:2.1.5.Final</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to make sure that <code>apicurio-registry-serdes-avro-serde</code> dependency
and the REST client <code>apicurio-common-rest-client-vertx</code> dependency are set to compatible versions:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-apicurio-registry-avro&lt;/artifactId&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
            &lt;artifactId&gt;apicurio-common-rest-client-vertx&lt;/artifactId&gt;
        &lt;/exclusion&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
            &lt;artifactId&gt;apicurio-registry-serdes-avro-serde&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-client&lt;/artifactId&gt;
    &lt;version&gt;2.1.5.Final&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-common&lt;/artifactId&gt;
    &lt;version&gt;2.1.5.Final&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-serdes-avro-serde&lt;/artifactId&gt;
    &lt;version&gt;2.1.5.Final&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
            &lt;artifactId&gt;apicurio-common-rest-client-jdk&lt;/artifactId&gt;
        &lt;/exclusion&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
            &lt;artifactId&gt;apicurio-registry-client&lt;/artifactId&gt;
        &lt;/exclusion&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
            &lt;artifactId&gt;apicurio-registry-common&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-common-rest-client-vertx&lt;/artifactId&gt;
    &lt;version&gt;0.1.5.Final&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">dependencies {
    implementation(platform("io.quarkus.platform:quarkus-bom:2.12.3.Final"))

    ...

    implementation("io.quarkus:quarkus-apicurio-registry-avro")
    implementation("io.apicurio:apicurio-registry-serdes-avro-serde") {
        exclude group: "io.apicurio", module: "apicurio-common-rest-client-jdk"
        exclude group: "io.apicurio", module: "apicurio-registry-client"
        exclude group: "io.apicurio", module: "apicurio-registry-common"
        version {
            strictly "2.1.5.Final"
        }
    }
    implementation("io.apicurio:apicurio-registry-client") {
        version {
            strictly "2.1.5.Final"
        }
    }
    implementation("io.apicurio:apicurio-registry-common") {
        version {
            strictly "2.1.5.Final"
        }
    }
    implementation("io.apicurio:apicurio-common-rest-client-vertx") {
        version {
            strictly "0.1.5.Final"
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Known previous compatible versions for <code>apicurio-registry-client</code> and <code>apicurio-common-rest-client-vertx</code> are the following</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>apicurio-registry-client</code> 2.1.5.Final with <code>apicurio-common-rest-client-vertx</code> 0.1.5.Final</p>
</li>
<li>
<p><code>apicurio-registry-client</code> 2.3.1.Final with <code>apicurio-common-rest-client-vertx</code> 0.1.13.Final</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="confluent"><a class="anchor" href="#confluent"></a>Using the Confluent Schema Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to use the Confluent Schema Registry, you need the <code>quarkus-confluent-registry-avro</code> extension, instead of the <code>quarkus-apicurio-registry-avro</code> extension.
Also, you need to add a few dependencies and a custom Maven repository to your <code>pom.xml</code> / <code>build.gradle</code> file:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;!-- the extension --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
        &lt;artifactId&gt;quarkus-confluent-registry-avro&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;!-- Confluent registry libraries use Jakarta REST client --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
        &lt;artifactId&gt;quarkus-rest-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.confluent&lt;/groupId&gt;
        &lt;artifactId&gt;kafka-avro-serializer&lt;/artifactId&gt;
        &lt;version&gt;7.2.0&lt;/version&gt;
        &lt;exclusions&gt;
            &lt;exclusion&gt;
                &lt;groupId&gt;jakarta.ws.rs&lt;/groupId&gt;
                &lt;artifactId&gt;jakarta.ws.rs-api&lt;/artifactId&gt;
            &lt;/exclusion&gt;
        &lt;/exclusions&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;repositories&gt;
    &lt;!-- io.confluent:kafka-avro-serializer is only available from this repository: --&gt;
    &lt;repository&gt;
        &lt;id&gt;confluent&lt;/id&gt;
        &lt;url&gt;https://packages.confluent.io/maven/&lt;/url&gt;
        &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
        &lt;/snapshots&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">repositories {
    ...

    maven {
        url "https://packages.confluent.io/maven/"
    }
}

dependencies {
    ...

    implementation("io.quarkus:quarkus-confluent-registry-avro")

    // Confluent registry libraries use Jakarta REST client
    implementation("io.quarkus:quarkus-rest-client")

    implementation("io.confluent:kafka-avro-serializer:7.2.0") {
        exclude group: "jakarta.ws.rs", module: "jakarta.ws.rs-api"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In JVM mode, any version of <code>io.confluent:kafka-avro-serializer</code> can be used.
In native mode, Quarkus supports the following versions: <code>6.2.x</code>, <code>7.0.x</code>, <code>7.1.x</code>, <code>7.2.x</code>, <code>7.3.x</code>.</p>
</div>
<div class="paragraph">
<p>For version <code>7.4.x</code> and <code>7.5.x</code>, due to an issue with the Confluent Schema Serializer, you need to add another dependency:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-dataformat-csv&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">dependencies {
    implementation("com.fasterxml.jackson.dataformat:jackson-dataformat-csv")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For any other versions, the native configuration may need to be adjusted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="avro-code-generation-details"><a class="anchor" href="#avro-code-generation-details"></a>Avro code generation details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide we used the Quarkus code generation mechanism to generate Java files
from Avro schema.</p>
</div>
<div class="paragraph">
<p>Under the hood, the mechanism uses <code>org.apache.avro:avro-compiler</code>.</p>
</div>
<div class="paragraph">
<p>You can use the following configuration properties to alter how it works:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>avro.codegen.[avsc|avdl|avpr].imports</code> - a list of files or directories that should be compiled first thus making them
importable by subsequently compiled schemas. Note that imported files should not reference each other. All paths should be relative
to the <code>src/[main|test]/avro</code> directory, or <code>avro</code> sub-directory in any source directory configured by the build system. Passed as a comma-separated list.</p>
</li>
<li>
<p><code>avro.codegen.stringType</code> - the Java type to use for Avro strings. May be one of <code>CharSequence</code>, <code>String</code> or
<code>Utf8</code>. Defaults to <code>String</code></p>
</li>
<li>
<p><code>avro.codegen.createOptionalGetters</code> - enables generating the <code>getOptional&#8230;&#8203;</code>
methods that return an Optional of the requested type. Defaults to <code>false</code></p>
</li>
<li>
<p><code>avro.codegen.enableDecimalLogicalType</code> - determines whether to use Java classes for decimal types, defaults to <code>false</code></p>
</li>
<li>
<p><code>avro.codegen.createSetters</code> - determines whether to create setters for the fields of the record.
Defaults to <code>false</code></p>
</li>
<li>
<p><code>avro.codegen.gettersReturnOptional</code> - enables generating <code>get&#8230;&#8203;</code> methods that
return an Optional of the requested type. Defaults to <code>false</code></p>
</li>
<li>
<p><code>avro.codegen.optionalGettersForNullableFieldsOnly</code>, works in conjunction with <code>gettersReturnOptional</code> option.
If it is set, <code>Optional</code> getters will be generated only for fields that are nullable. If the field is mandatory,
regular getter will be generated. Defaults to <code>false</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="further-reading"><a class="anchor" href="#further-reading"></a>Further reading</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/3.4/kafka/kafka.html">SmallRye Reactive Messaging Kafka</a> documentation</p>
</li>
<li>
<p><a href="https://quarkus.io/blog/kafka-avro/">How to Use Kafka, Schema Registry and Avro with Quarkus</a> - a blog post on which
the guide is based. It gives a good introduction to Avro and the concept of schema registry</p>
</li>
</ul>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#solution">Solution</a></li>
<li><a href="#creating-the-maven-project">Creating the Maven Project</a></li>
<li><a href="#avro-schema">Avro schema</a></li>
<li><a href="#the-movie-producer">The <code>Movie</code> producer</a></li>
<li><a href="#the-movie-consumer">The <code>Movie</code> consumer</a></li>
<li><a href="#running-the-application">Running the application</a></li>
<li><a href="#running-in-jvm-or-native-mode">Running in JVM or Native mode</a></li>
<li><a href="#testing-the-application">Testing the application</a>
<ul class="sectlevel2">
<li><a href="#manual-setup">Manual setup</a></li>
</ul>
</li>
<li><a href="#apicurio-versions-compatibility">Using compatible versions of the Apicurio Registry</a></li>
<li><a href="#confluent">Using the Confluent Schema Registry</a></li>
<li><a href="#avro-code-generation-details">Avro code generation details</a></li>
<li><a href="#further-reading">Further reading</a></li>
</ul></div>
    </div>
  </div>
  <h2>Related content</h2>
  <div class="grid-wrapper relations">
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same extensions</h3>
      <ul class="related-content">
      
        
        <li class="guide"><a href="/guides/apicurio-registry-dev-services">Dev Services for Apicurio Registry</a></li>
      
        
        <li class="guide"><a href="/guides/kafka">Apache Kafka Reference Guide</a></li>
      
        
        <li class="guide"><a href="/guides/kafka-dev-services">Dev Services for Kafka</a></li>
      
        
        <li class="guide"><a href="/guides/kafka-getting-started">Getting Started to Quarkus Messaging with Apache Kafka</a></li>
      
        
        <li class="guide"><a href="/guides/kafka-dev-ui">Kafka Dev UI</a></li>
      
        
        <li class="guide"><a href="/guides/messaging-virtual-threads">Quarkus Virtual Thread support with Reactive Messaging</a></li>
      
        
        <li class="guide"><a href="/guides/kafka-schema-registry-json-schema">Using Apache Kafka with Schema Registry and JSON Schema</a></li>
      </ul>
    </div>
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same topics</h3>
      <ul class="related-content">
      
        
        <li class="guide"><a href="/guides/apicurio-registry-dev-services">Dev Services for Apicurio Registry</a></li>
      
        
        <li class="guide"><a href="/guides/kafka-schema-registry-json-schema">Using Apache Kafka with Schema Registry and JSON Schema</a></li>
      
        
        <li class="guide"><a href="/guides/kafka">Apache Kafka Reference Guide</a></li>
      
        
        <li class="guide"><a href="/guides/kafka-dev-services">Dev Services for Kafka</a></li>
      
        
        <li class="guide"><a href="/guides/kafka-getting-started">Getting Started to Quarkus Messaging with Apache Kafka</a></li>
      
        
        <li class="guide"><a href="/guides/kafka-dev-ui">Kafka Dev UI</a></li>
      
        
        <li class="guide"><a href="/guides/messaging-virtual-threads">Quarkus Virtual Thread support with Reactive Messaging</a></li>
      
        
        <li class="guide"><a href="/guides/kafka-streams">Using Apache Kafka Streams</a></li>
      
        
        <li class="guide"><a href="/guides/pulsar">Apache Pulsar Reference Guide</a></li>
      
        
        <li class="guide"><a href="/guides/amqp-dev-services">Dev Services for AMQP</a></li>
      
        
        <li class="guide"><a href="/guides/pulsar-dev-services">Dev Services for Pulsar</a></li>
      
        
        <li class="guide"><a href="/guides/rabbitmq-dev-services">Dev Services for RabbitMQ</a></li>
      
        
        <li class="guide"><a href="/guides/amqp">Getting Started to Quarkus Messaging with AMQP 1.0</a></li>
      
        
        <li class="guide"><a href="/guides/pulsar-getting-started">Getting Started to Quarkus Messaging with Apache Pulsar</a></li>
      
        
        <li class="guide"><a href="/guides/rabbitmq">Getting Started to Quarkus Messaging with RabbitMQ</a></li>
      
        
        <li class="guide"><a href="/guides/messaging">Quarkus Messaging Extensions</a></li>
      
        
        <li class="reference"><a href="/guides/amqp-reference">Reactive Messaging AMQP 1.0 Connector Reference Documentation</a></li>
      
        
        <li class="reference"><a href="/guides/rabbitmq-reference">Reactive Messaging RabbitMQ Connector Reference Documentation</a></li>
      
        
        <li class="guide"><a href="/guides/jms">Using JMS</a></li>
      
        
        <li class="guide"><a href="/guides/reactive-event-bus">Using the event bus</a></li>
      </ul>
    </div>
    </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
