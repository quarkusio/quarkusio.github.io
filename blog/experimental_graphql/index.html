<!DOCTYPE html>
<html lang="en">







<head>
  <title>Experimental GraphQL - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/experimental_graphql/" />
  <meta property="og:title" content="Experimental GraphQL" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/experimental_graphql/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/blog/experimental_graphql/" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/blog/experimental_graphql/" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/blog/experimental_graphql/" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/blog/experimental_graphql/" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/blog/experimental_graphql/" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="post">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>          
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="active">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/blog/experimental_graphql/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/blog/experimental_graphql/">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/blog/experimental_graphql/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/blog/experimental_graphql/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/blog/experimental_graphql/">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> Experimental GraphQL</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          October 27, 2020 
          
            <span class="tags"><a href="/blog/tag/extension">#extension</a><a href="/blog/tag/graphql">#graphql</a></span>
          
        </div>
        <h1 class="post-title">Experimental GraphQL</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/c3e7539e1144f33342b9062ce5c0f728">
            
            <p class="byline">By <a href="/author/phillipkruger">Phillip Kruger</a></p>
          </div>
          <div class="width-12-12">
              <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This blog post is a follow up on the initial introductory post, <a href="/blog/supersonic-subatomic-graphql/">Supersonic Subatomic GraphQL</a>, and here we will explore more features, some that is experimental, that we hope to eventually move to the MicroProfile GraphQL Specification (based on your feedback !)</p>
</div>
<div class="paragraph">
<p>We will look at the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operational Context - Optimize your downstream processes.</p>
</li>
<li>
<p>Cache - Caching your endpoints.</p>
</li>
<li>
<p>Asynchronous - Concurrent execution of multiple requests or sources.</p>
</li>
<li>
<p>Batch - Solving N+1.</p>
</li>
<li>
<p>Generics support.</p>
</li>
<li>
<p>Events and custom execution.</p>
</li>
<li>
<p>Transformation and mapping.</p>
</li>
<li>
<p>Build tools - Maven and Gradle support.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All source code is available here: <a href="https://github.com/phillip-kruger/graphql-experimental">github.com/phillip-kruger/graphql-experimental</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operational-context"><a class="anchor" href="#operational-context"></a>Operational Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Context Object is an experimental Object that can be injected anywhere in your code, downstream from your <code>@GraphQLApi</code>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s in the <code>api</code> module in SmallRye GraphQL, with the intention to eventually move this up to the MicroProfile GraphQL Api.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>We have a Person GraphQL Endpoint, that uses some service to get the person from where ever it is stored.</p>
</div>
<div class="paragraph">
<p>The endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GraphQLApi
public class PersonEndpoint {

    @Inject
    PersonService personService;

    @Query
    public List&lt;Person&gt; getPeople(){
        return personService.getAllPeople();
    }

    @Query
    public Person getPerson(int id){
        return personService.getPerson(id);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Person is a basic POJO, that can have multiple relationships, that in turn has a Person. So making a call to the database to get a person, can end up retuning more people, depending on the number of relationships. In our example, we have Person 1 that has a <code>Spouse</code>, Person 2.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/experimental-graphql/PersonClassDiagram.png" alt="classdiagramm">
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s assume that <code>PersonService</code> makes a call to a database or some other storage to get the data. We can now inject the context object to get
details on the request, and optimise our call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class PersonService {

    @Inject Context context;

    public Person getPerson(int id){
        // Use context to get more information on the query
        // Let's print out the context here and see what we have
        System.out.println(context);

        // Get the person from the datastore here.
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s do a <code>Query</code> to get the name and surname of Person 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  person(id:1){
    names
    surname
  }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="so-what-can-you-get-from-context"><a class="anchor" href="#so-what-can-you-get-from-context"></a>So what can you get from context ?</h3>
<div class="paragraph">
<p>There are a few things we can get:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">executionId = 30337360
request = {"query":"{\n  person(id:1){\n    names\n    surname\n  }\n}","variables":null}
operationName = null
operationTypes = [Query]
parentTypeName = Query
variables = null
query = {
  person(id:1){
    names
    surname
  }
},
fieldName = person
selectedFields = ["names","surname"]
source = null
arguments = {id=1}
path = /person</code></pre>
</div>
</div>
<div class="paragraph">
<p>What we probably want to know is which fields have been requested, so that we can do a better database query.</p>
</div>
<div class="paragraph">
<p>So the fieldName (<code>person</code>) and the selectedFields (<code>names</code>,<code>surname</code>) is what we need.</p>
</div>
<div class="paragraph">
<p>A more complex GraphQL Request, will then lead to a more complex datasource query, example, if we want to know the relationships we would do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  person(id:1){
    names
    surname
    relations{
      relationType
      person{
        names
        surname
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That will give us this in the <code>Context</code> selectedFields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
   "names",
   "surname",
   {
      "relations":[
         {
            "relationType":[
            ]
         },
         {
            "person":[
               "names",
               "surname"
            ]
         }
      ]
   }
]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="context-in-source-methods"><a class="anchor" href="#context-in-source-methods"></a>Context in source methods</h3>
<div class="paragraph">
<p>Let&#8217;s add a field to person using <code>@Source</code> and see what the context can give us then. First we will add a service that fetches the exchange rate from an api (<a href="http://exchangeratesapi.io/">exchangeratesapi.io</a>). This allows us to add the exchange rate for that person against some currency.</p>
</div>
<div class="paragraph">
<p>In Java we add this <code>Source</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public ExchangeRate getExchangeRate(@Source Person person, CurencyCode against){
    Map&lt;CurencyCode, Double&gt; map = exchangeRateService.getExchangeRates(against);
    Double rate = map.get(person.curencyCode);
    return new ExchangeRate(person.curencyCode, against, rate);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can query that (<code>ExchangeRate</code>) field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  person(id:1){
    names
    surname
    exchangeRate(against:GBP){
      rate
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we <code>Inject</code> and print the context in the <code>ExchangeRateService</code> we now get:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">executionId = 17333236733
request = {"query":"{\n  person(id:1){\n    names\n    surname\n    exchangeRate(against:GBP){\n      rate\n    }\n  }\n}","variables":null}
operationName = null
operationTypes = [Query]
parentTypeName = Person
variables = null
query = {
  person(id:1){
    names
    surname
    exchangeRate(against:GBP){
      rate
    }
  }
}
fieldName = exchangeRate
selectedFields = ["rate"]
source = com.github.phillipkruger.user.model.Person@7929ad0a
arguments = {against=GBP}
fieldName = exchangeRate
path = /person/exchangeRate</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the fieldName is now <code>exchangeRate</code> and the selectedFields is <code>["rate"]</code>. You will also note that the source field is populated with the person.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cache"><a class="anchor" href="#cache"></a>Cache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another question that comes up regularly is how can you cache your endpoint results. As an example, let&#8217;s say the Exchange Rate information can be updated daily, so we do not want to make a call to the <a href="http://exchangeratesapi.io/">exchangeratesapi.io</a> for every call.</p>
</div>
<div class="paragraph">
<p>You can just use the caching that comes with Quarkus! Simply include the cache extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-cache&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the <code>@CacheResult</code> annotation to your method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CacheResult(cacheName = "exchange-rate-cache")
public ExchangeRate getExchangeRate(@Source Person person, CurencyCode against){
    Map&lt;CurencyCode, Double&gt; map = exchangeRateService.getExchangeRates(against);
    Double rate = map.get(person.curencyCode);
    return new ExchangeRate(person.curencyCode, against, rate);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more about caching in Quarkus here: <a href="https://quarkus.io/guides/cache">quarkus.io/guides/cache</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="asynchronous"><a class="anchor" href="#asynchronous"></a>Asynchronous</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now, let&#8217;s add another service that returns the weather conditions for a city:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GraphQLApi
public class TravelEndpoint {

    @Inject
    WeatherService weatherService;

    @Query
    public Weather getWeather(String city){
        return weatherService.getWeather(city);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s say this person is traveling to London, you can now do something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  person(id:1){
    names
    surname
    exchangeRate(against:GBP){
      rate
    }
  }
  weather(city:"London"){
    description
    min
    max
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the moment the person and weather query will execute sequentially, and there is no real reason that this should be the case. We can get the weather at the same time that we get the person.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/experimental-graphql/async1.png" alt="async1">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s change the java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Query
public CompletableFuture&lt;Person&gt; getPerson(int id){
    return CompletableFuture.supplyAsync(() -&gt; personService.getPerson(id));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Query
public CompletableFuture&lt;Weather&gt; getWeather(String city){
    return weatherService.getWeather(city);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now person and weather are being fetched concurrently.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say this person actually wants to travel to London <em>and</em> New York, we can do something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  person(id:1){
    names
    surname
    gbp:exchangeRate(against:GBP){
      rate
    }
    usd:exchangeRate(against:USD){
      rate
    }
  }
  uk:weather(city:"London"){
    description
    min
    max
  }
  us:weather(city:"New York"){
    description
    min
    max
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now change the code to also fetch the exchange rates concurrently:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/experimental-graphql/async2.png" alt="async2">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public CompletableFuture&lt;ExchangeRate&gt; getExchangeRate(@Source Person person, CurencyCode against){
    return CompletableFuture.supplyAsync(() -&gt; exchangeRateService.getExchangeRate(against,person.curencyCode));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch"><a class="anchor" href="#batch"></a>Batch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to get ALL people, and you are including a field (like <code>exchangeRate</code>) with a <code>Source</code> method, it means that for every person, we will call the <code>getExchangeRate</code> method. Depending on the number of people, that could be a lot of calls. So you might rather want to do a batch source method.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/experimental-graphql/batch.png" alt="batch">
</div>
</div>
<div class="paragraph">
<p>This will allow you to get all the people in one method and do one call to get their exchange rates.</p>
</div>
<div class="paragraph">
<p>So, let&#8217;s change the <code>getExchangeRate</code> method to take a <code>List</code> of person and return a <code>List</code> of <code>ExchangeRate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public List&lt;ExchangeRate&gt; getExchangeRate(@Source List&lt;Person&gt; people, CurencyCode against){
    Map&lt;CurencyCode, Double&gt; map = exchangeRateService.getExchangeRates(against);

    List&lt;ExchangeRate&gt; rates = new ArrayList&lt;&gt;();
    for(Person person : people){
        Double rate = map.get(person.curencyCode);
        rates.add(new ExchangeRate(person.curencyCode, against, rate));
    }

    return rates;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Above will still work on <code>getPerson</code> method where there is only one person.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Doing a query on all people:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  people{
    names
    surname
    exchangeRate(against:GBP){
      rate
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will call the <code>getExchangeRate</code> method with all people.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generics"><a class="anchor" href="#generics"></a>Generics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s the year 2050 and we need to extend our travel service to also cater for aliens. Let&#8217;s add a generic <code>Being</code> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Being&lt;T&gt; {

    private T being;

    public Being() {
    }

    public Being(T being) {
        this.being = being;
    }

    public T getBeing() {
        return being;
    }

    public void setBeing(T being) {
        this.being = being;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now change the Endpoint to allow people and alien queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Query
public Being&lt;Person&gt; getPerson(int id){
    return new Being&lt;&gt;(personService.getPerson(id));
}

@Query
public Being&lt;Alien&gt; getAlien(int id){
    return new Being&lt;&gt;(alienService.getAlien(id));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then query both human and alien beings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  person(id:1){
    being{
      names
      surname
    }
  }
  alien(id:1){
    being{
      type
      from
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="events-and-custom-execution"><a class="anchor" href="#events-and-custom-execution"></a>Events and custom execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Events are used internally when you enable integration with MicroProfile Metrics, MicroProfile OpenTracing and Bean Validation, but you can also take part in these events.
These are all CDI Events and can be used with the <code>@Observes</code> annotation.</p>
</div>
<div class="sect2">
<h3 id="while-building-the-schema"><a class="anchor" href="#while-building-the-schema"></a>While building the schema</h3>
<div class="paragraph">
<p>When we scan the classpath for annotations and types, we build up a <a href="https://github.com/smallrye/smallrye-graphql/tree/main/common/schema-model">model</a> of all the operations. You can manipulate this model by taking part in the <em>create operation</em> event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public Operation createOperation(@Observes Operation operation) {
    // Here manipulate operation
    return operation;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just before the final schema is built, after scanning all annotations and after the above event, you can <em>take part</em> and contribute to the schema:
This exposes the underlying <code>graphql-java</code> implementation details, and can be useful when you want to do things that are not yet implemented in SmallRye GraphQL, like subscriptions for instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public GraphQLSchema.Builder beforeSchemaBuild(@Observes GraphQLSchema.Builder builder) {
    // Here add you own, in example a subscription
    return builder;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="while-running-a-request"><a class="anchor" href="#while-running-a-request"></a>While running a request</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/experimental-graphql/events.png" alt="events">
</div>
</div>
<div class="paragraph">
<p>In this example request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  person(id:1){
    names
    surname
    exchangeRate(against:USD){
      rate
      base
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the request flow is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Execution service gets the request.</p>
</li>
<li>
<p>The person is being fetched with a <code>datafetcher</code>.</p>
</li>
<li>
<p>Your CDI bean (<code>@GraphQLApi</code>) method (<code>getPerson</code>) is being invoked.</p>
</li>
<li>
<p>The exchange rate is being fetched, passing the above person as an argument.</p>
</li>
<li>
<p>Your CDI bean (<code>@GraphQLApi</code>) method (<code>getExchangeRate</code>) is being invoked.</p>
</li>
<li>
<p>Data is being returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can receive events on all of these points:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void beforeExecute(@Observes @BeforeExecute Context context) {
    System.err.println("&gt;&gt;&gt;&gt;&gt; Received beforeExecute event [" + context.getQuery() + "]");
}

public void beforeDataFetch(@Observes @BeforeDataFetch Context context) {
    System.err.println("&gt;&gt;&gt;&gt;&gt; Received beforeDataFetch event [" + context.getQuery() + "]");
}

public void beforeInvoke(@Observes InvokeInfo invokeInfo) {
    System.err.println("&gt;&gt;&gt;&gt;&gt; Received beforeInvoke event [" + invokeInfo.getOperationMethod().getName() + "]");
}

public void afterDataFetch(@Observes @AfterDataFetch Context context) {
    System.err.println("&gt;&gt;&gt;&gt;&gt; Received afterDataFetch event [" + context.getQuery() + "]");
}

public void afterExecute(@Observes @AfterExecute Context context) {
    System.err.println("&gt;&gt;&gt;&gt;&gt; Received afterExecute event [" + context.getQuery() + "]");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also get events when an error occurs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void errorExecute(@Observes @ErrorExecute ErrorInfo errorInfo) {
    System.err.println("&gt;&gt;&gt;&gt;&gt; Received errorExecute event [" + errorInfo.getT() + "]");
}

public void errorDataFetch(@Observes @ErrorDataFetch ErrorInfo errorInfo) {
    System.err.println("&gt;&gt;&gt;&gt;&gt; Received errorDataFetch event [" + errorInfo.getT() + "]");
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-execution-service-directly"><a class="anchor" href="#using-the-execution-service-directly"></a>Using the Execution Service directly</h3>
<div class="paragraph">
<p>The default assumed behavior is to interact with your endpoint via HTTP, you can however inject the <code>ExecutionService</code> yourself and execute requests.</p>
</div>
<div class="paragraph">
<p>As an example, lets do a request that gets all the names of all the people on startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  people{
    names
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class StartupService {

    @Inject ExecutionService executionService;

    public void init(@Observes StartupEvent event){

        JsonObjectBuilder builder = Json.createObjectBuilder();
        builder.add("query", ALL_NAMES);
        JsonObject request = builder.build();
        JsonObject response = executionService.execute(request);

        System.err.println("&gt;&gt;&gt;&gt;&gt; " + response);

    }

    private static final String ALL_NAMES = "{\n" +
                                            "people{\n" +
                                            "    names\n" +
                                            "  }\n" +
                                            "}";
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transformation-and-mapping"><a class="anchor" href="#transformation-and-mapping"></a>Transformation and mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, Date and Number values can be transformed using <a href="https://javaee.github.io/jsonb-spec/docs/user-guide.html#date-number-formats">JsonB Formats</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Person {
    public String name;

    @JsonbDateFormat("dd.MM.yyyy")
    private Date birthDate;

    @JsonbNumberFormat("#0.00")
    public BigDecimal salary;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>MicroProfile GraphQL Specification maps the relevant Java types to a GraphQL Scalar. You can change the mapping of an existing field to map to another Scalar type like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ToScalar(Scalar.Int.class)
Long id; // This usually maps to BigInteger</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the GraphQL Schema this will now map to an <code>int</code>.</p>
</div>
<div class="paragraph">
<p>You can also add an Object that should transform to a <code>Scalar</code> Type and not a complex object, example you might have an <code>Email</code> Object, but do not want to use a complex type in GraphQL, and rather map this to a <code>String</code>:</p>
</div>
<div class="paragraph">
<p>To do this your <code>Email</code> POJO needs to implement the <code>toString</code> method and have a constructor that takes a String, or a static <code>Email fromString(String s)</code> method, or a <code>setValue(String value)</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Email {
    private String value;

    public Email() {
    }

    public Email(String value) {
        this.value = value;
    }

    public String getValue() {
        return value;
    }

    public void setValue(String value) {
        this.value = value;
    }

    @Override
    public String toString() {
        return value;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then use this as a field on your Response and add the <code>@ToScalar</code> annotation, i.e. person:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ToScalar(Scalar.String.class)
Email email; // This usually maps to a complex object</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-tools"><a class="anchor" href="#build-tools"></a>Build tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lastly, support has been added to generate the schema on <a href="https://github.com/smallrye/smallrye-graphql/tree/main/tools">build</a> using <a href="https://github.com/smallrye/smallrye-graphql/tree/main/tools/maven-plugin"><code>maven</code></a> (or <a href="https://github.com/smallrye/smallrye-graphql/tree/main/tools/gradle-plugin"><code>gradle</code></a>).</p>
</div>
<div class="paragraph">
<p>Example, in <code>maven</code> you can add this to your <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;smallrye-graphql-maven-plugin&lt;/artifactId&gt;
    &lt;groupId&gt;io.smallrye&lt;/groupId&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;
                &lt;goal&gt;generate-schema&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the generated schema will be stored in <code>target/generated/</code>.</p>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/experimental_graphql/&title=Experimental GraphQL" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fa-brands fa-linkedin fa-xl"></i>
  </a>
  <a class="share-x" href="https://x.com/intent/tweet?text=Experimental GraphQL&url=https://quarkus.io/blog/experimental_graphql/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on X">
    <i class="fa-brands fa-square-x-twitter fa-xl"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/experimental_graphql/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fa-brands fa-square-facebook fa-xl"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/experimental_graphql/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fa-brands fa-square-reddit fa-xl"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Experimental GraphQL&amp;body=Experimental GraphQL https://quarkus.io/blog/experimental_graphql/" title="Share via Email" >
    <i class="fa-solid fa-envelope fa-xl"></i>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
