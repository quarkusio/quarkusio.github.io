<!DOCTYPE html>
<html lang="en">







<head>
  <title>How Quarkus has been used to deploy applications on OpenShift - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://embed.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/quarkus-deploys-apps-on-openshift/" />
  <meta property="og:title" content="How Quarkus has been used to deploy applications on OpenShift" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/quarkus-deploys-apps-on-openshift/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/blog/quarkus-deploys-apps-on-openshift/" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/blog/quarkus-deploys-apps-on-openshift/" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/blog/quarkus-deploys-apps-on-openshift/" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/blog/quarkus-deploys-apps-on-openshift/" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/blog/quarkus-deploys-apps-on-openshift/" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="post">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/continuum" class="">VERSATILITY</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="">DOCUMENTATION</a></li>
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="active">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/blog/quarkus-deploys-apps-on-openshift/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/blog/quarkus-deploys-apps-on-openshift/">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/blog/quarkus-deploys-apps-on-openshift/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/blog/quarkus-deploys-apps-on-openshift/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/blog/quarkus-deploys-apps-on-openshift/">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> How Quarkus has been used to deploy applications on OpenShift</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          June 25, 2021 
          
            <span class="tags"><a href="/blog/tag/openshift">#openshift</a><a href="/blog/tag/user-story">#user-story</a></span>
          
        </div>
        <h1 class="post-title">How Quarkus has been used to deploy applications on OpenShift</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/70ce41ab2185391f57cdf3391649d09d">
            
            <p class="byline">By <a href="/author/vsevel">Vincent Sevel</a></p>
          </div>
          <div class="width-12-12">
              <div class="paragraph">
<p>This post gives some feedback on a particular challenge I have been facing in a professional context with respect to deploying applications on Kubernetes, and how we were able to provide a solution that met our goals using Quarkus.</p>
</div>
<div class="sect1">
<h2 id="the-challenge"><a class="anchor" href="#the-challenge"></a>The challenge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a few years now I have been involved in a Kubernetes project, aiming at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Onboarding more easily and more quickly new technologies (either applicative frameworks, or middleware products).</p>
</li>
<li>
<p>Lowering the administrative burden of deploying distributed inter-related services by creating a logical deployment abstraction on top of these
services; something like the <a href="https://helm.sh/docs/howto/charts_tips_and_tricks/#complex-charts-with-many-dependencies">umbrella chart</a> pattern.</p>
</li>
<li>
<p>Limiting the work needed by an application team to deploy a component, and hyper-standardize Kubernetes deployment objects.</p>
</li>
<li>
<p>Transitioning to an hybrid cloud deployment model.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to those goals, there was a constraint related to the fact that applications may be deployed by tenant (i.e. they are not multi-tenant, for different reasons, some being regulatory related). Depending on the application, there may be a few dozens tenants, which would translate into deploying the application once per tenant (so if we had 10 tenants for an application, there would be 10 processes running in production). However, if processes needed to be physically separated, often some portions of configuration could be shared between some tenants, and/or IT environments, and/or geographical zones according to different business rules. Highly simplified and factorized bits of configuration would be a true source of simplicity for the development team, and a true source of complexity for the deployment process.</p>
</div>
<div class="paragraph">
<p>Some projections indicated that at project end, the different clusters in production would contain 10'000 pods.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="first-attempts"><a class="anchor" href="#first-attempts"></a>First attempts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Given that complexity we created our own tool for configuration and deployment. The initial version was based on Ansible and ran into Tower workflows. For different reasons we decided to rewrite it in Java a year ago, mainly to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get better performances.</p>
</li>
<li>
<p>Use a high level language that could cope with algorithm complexity.</p>
</li>
<li>
<p>Get better support for unit and integration testing.</p>
</li>
<li>
<p>Improve productivity with quality development tools (e.g. IDE).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One thing we were concerned about though, was memory consumption, CPU usage and startup times since for a given application, each tenant is deployed in isolation in its own deployment process. For that reason we decided to not depend on any application framework when we started the Java rewrite, because if they do offer productivity and standardization, the abstraction they provide comes with a resource cost. So the program was written in plain Java, and it was small enough in size and use cases that we were able get away with it, provided we relied on a few patterns (e.g. constructor based injection by hand) for clean code. This program is called <em>ocpdeploy</em>.</p>
</div>
<div class="paragraph">
<p>As we were moving away from Tower, we decided to leverage our Kubernetes infrastructure by running <em>ocpdeploy</em> as tasks in Tekton pipelines. This gave us repeatability, a way to deploy different applications, or even different tenants for the same application with different <em>ocpdeploy</em> versions. The use of java (any other high level language would have been a good fit) provided us with a high level of productivity, and maintainable code, while being able to implement complex algorithms for configuration processing, and raised the level of quality of <em>ocpdeploy</em> releases thanks to our extensive regression testing suite.</p>
</div>
<div class="paragraph">
<p>All was well&#8230;&#8203; until we started deploying multiple tenants at the same time, and/or different applications. We had sized the <em>ocpdeploy</em> container to <code>200 millicores</code> and <code>280 Mb</code> of RAM. For some applications there were around 30 tenants, that would be all deployed in parallel. This meant 30 pods, which accounted for <code>6 cores</code> and <code>8 Gb</code> of RAM. This seems livable, but deployments tend to be done after business hours, between 7 and 8pm for many. And we started being afraid of the impact <em>ocpdeploy</em> itself would have if we were running multiple deployments in parallel, on top of our SpringBoot or WildFly applications, which take their toll on the cluster at startup.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enter-the-quarkus-universe"><a class="anchor" href="#enter-the-quarkus-universe"></a>Enter the Quarkus Universe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So less than a year ago we decided to launch a Quarkus POC on <em>ocpdeploy</em>, the goal being to deploy it as a GraalVM executable.
The main challenges we ran into were related to the lack of support for GraalVM in some of the libraries we were using: FreeMarker, <a href="https://github.com/hierynomus/smbj">SMBJ</a> (a java client library that implements the Server Message Block SMB2 and SMB3 protocols), the Fabric8 OpenShift client (when instantiating OpenShift specific CRDs), and a home made java agent that ships logs to a proprietary centralized logging system.</p>
</div>
<div class="paragraph">
<p>Fortunately, other bits were already there in Quarkus, such as support for command mode applications, a rest client, the Vault extension, and support for the Fabric8 Kubernetes Client, which provided a nice base for a new OpenShift Client extension that was added to the core. The Kubernetes Client extension alone was a huge push for the project because when we started we did not have Argo available, so we had to implement <em>apply</em> and <em>prune</em> ourselves.</p>
</div>
<div class="paragraph">
<p>For FreeMarker we pushed a new extension to the Quarkiverse, with code largely inspired from work by <a href="https://github.com/ppalaga">ppalaga</a> and <a href="https://github.com/carlosthe19916">carlosthe19916</a>.
For SMBJ we created an extension in our internal Quarkiverse. And for our logging client, I was able to draw some inspiration from the <code>quarkus-logging-gelf</code> extension, and created an additional internal extension.</p>
</div>
<div class="paragraph">
<p>Getting a library to run in native was facilitated by the very good documentation that comes from the Quarkus project and support in the framework (e.g. <em>processors</em> and <em>recorders</em>): <a href="https://quarkus.io/guides/writing-native-applications-tips#native-in-extension">Supporting native in a Quarkus extension</a>.</p>
</div>
<div class="paragraph">
<p>When things got a little hairy (SMBJ was trickier than we thought), we got some help from the <a href="https://medium.com/GraalVM/introducingthe-tracing-agent-simplifying-GraalVM-native-image-configuration-c3b56c486271">GraalVM tracing agent</a>.</p>
</div>
<div class="paragraph">
<p>Here is the list of extensions that we happened to use: <code>cdi, config-yaml, freemarker, hibernate-validator, kubernetes-client, openshift-client, rest-client, restclient-jackson, vault</code> (plus internal extensions for SMBJ and our internal centralized logging system).</p>
</div>
<div class="paragraph">
<p>Eventually we got all the required libraries to work in native mode, and we could switch efforts toward migrating the application to look like a <em>real</em> Quarkus application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using injection, with qualifiers and producers when necessary.</p>
</li>
<li>
<p>Rewriting tests to use the different mocking approaches, including the new (at the time) <a href="https://quarkus.io/blog/quarkus-test-profiles/">QuarkusTest profiles</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This allowed us to provide extensive testing through Kubernetes yaml generation, <em>snapshotting</em> and <em>replay</em> in a variety of situations transforming all the configuration to be <em>MP config</em> compliant.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="benchmarks"><a class="anchor" href="#benchmarks"></a>Benchmarks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Then, we ran some benchmarks to assess resource consumption compared to the old version. We were not really worried about startup time. We knew it would be very good. And as long as it stayed in the few seconds window (which we were experiencing on the plain Java version), we were OK. But memory and CPU consumption was another story. The whole exercise was motivated by hopes for some real gains.</p>
</div>
<div class="paragraph">
<p>With the plain Java version we were able to squeeze the container down to <code>180 Mb</code> (below that it would either go <em>OOM</em>, or the <em>GC</em> would kill the performances). And for the native version, we were able to go as low as <code>50 Mb</code>.</p>
</div>
<div class="paragraph">
<p>Then we executed several runs with different configurations (<code>plain Java 180 Mb</code>, <code>Quarkus native 180 Mb</code>, <code>Quarkus jvm 180 Mb</code>, <code>Quarkus native 50 Mb</code> , starting from <code>50 millicores request=limit</code>, moving up to <code>100</code>, <code>150</code>, …</p>
</div>
<div class="paragraph">
<p>At <code>50 millicores</code>, <code>Quarkus native 180 Mb</code> would run in 20 seconds, <code>Quarkus native 50 Mb</code> in 60 seconds, and the others 2 in 300 seconds. This meant that if we allowed <code>180 Mb</code> to <em>ocpdeploy</em>, we could go from 300 to 20 seconds. A <em>x15</em> times improvement.</p>
</div>
<div class="paragraph">
<p>At <code>250 millicores</code> we had <code>Quarkus native 180 Mb</code> under 5 seconds, <code>Quarkus native 50 Mb</code> at 10 seconds, and the 2 others around 40 seconds.</p>
</div>
<div class="paragraph">
<p>We searched also how much CPU was needed to get a deployment under 60 seconds.</p>
</div>
<div class="paragraph">
<p>For <code>Quarkus native 50 Mb</code> it was <code>50 millicores</code>, for <code>plain Java 180 Mb</code> and <code>Quarkus jvm 180 Mb</code> it was <code>240 millicores</code> (<code>Quarkus native 180 Mb</code> was out of scope since its "worst" result was 20 seconds as discussed in the first test). This meant that if time was our constraint, we could go from <code>240 millicores</code> to <code>50 millicores</code>, while going from <code>180 Mb</code> to <code>50 Mb</code> by moving to Quarkus native.</p>
</div>
<div class="paragraph">
<p>The comparison between <code>Quarkus native 180 Mb</code> and <code>50 Mb</code> was interesting as well, because it showed that by pushing up and down the memory and CPU knobs we could work on the use case execution duration. It was then up to us to decide where was the sweet spot between execution time and resource consumption.</p>
</div>
<div class="paragraph">
<p>The last interesting observation we made was that the results for <code>plain Java 180 Mb</code> were nearly identical to <code>Quarkus jvm 180 Mb</code>. This meant that the cost of the applicative framework, which provides maintainability and productivity, was 0 in our case. It&#8217;s like having your cake and eating it as well. In our case we did not mind slow executions, as long as we could save a lot on memory and CPU, which we were able to achieve.</p>
</div>
<div class="paragraph">
<p>Program execution in seconds for different limits (in millicores)</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">plain Java (180Mb)</th>
<th class="tableblock halign-left valign-top">Quarkus Native (180Mb)</th>
<th class="tableblock halign-left valign-top">Quarkus JVM (180Mb)</th>
<th class="tableblock halign-left valign-top">Quarkus Native (50Mb)</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">50m</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">283</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">306</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">61</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">100m</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">95</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">250m</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">38</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">500m</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">1000m</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">1500m</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">2000m</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">No Limit</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/quarkus-user-stories/ocpdeploy/results.png" alt="results">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-few-issues"><a class="anchor" href="#a-few-issues"></a>A few issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Beside the challenges of running ad hoc libraries in GraalVM, there were a few unexpected behaviors or minor pain points we ran into, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Missing warning on unknown application configuration property <a href="https://github.com/quarkusio/quarkus/issues/14889">#14889</a></p>
</li>
<li>
<p>Default on config pojo should behave the same if set in <code>src/main/resources/application.yaml</code> <a href="https://github.com/quarkusio/quarkus/issues/13423">#13423</a></p>
</li>
<li>
<p>Warn or fail if an application.yaml is provided without the <code>quarkus-config-yaml</code> dependency <a href="https://github.com/quarkusio/quarkus/issues/13227">#13227</a></p>
</li>
<li>
<p>Upgrade to <em>MP Rest Client</em> 2.0 <a href="https://github.com/quarkusio/quarkus/issues/10520">#10520</a>, which we have been waiting for, to get "follow redirects"</p>
</li>
<li>
<p>I wished there was a way to define mock alternatives per test through annotation, but this was answered in <a href="https://groups.google.com/g/quarkus-dev/c/IBojyD1BplY/m/NWFmsX3NBwAJ">this thread</a></p>
</li>
<li>
<p>Inability to provide certificates at run time instead of build time (GraalVM limitation) <a href="https://github.com/oracle/graal/pull/3091">#3091</a></p>
</li>
<li>
<p>Visibility of <code>src/main/resources/application.properties</code> in test as discussed in <a href="https://groups.google.com/g/Quarkus-dev/c/xCU6Yvw__ks/m/cogHVvNsAwAJ">this thread</a>; A lot of work has been done since then such as "Use AbstractLocationConfigSourceLoader to load application.properties and application.yaml" <a href="https://github.com/quarkusio/quarkus/pull/15282">#15282</a>, so I need to recheck</p>
</li>
<li>
<p>Optional config property overriden with empty value as discussed in <a href="https://groups.google.com/g/Quarkus-dev/c/_g-6qfUFA3A/m/2s9XjTVxAwAJ">this thread</a></p>
</li>
<li>
<p>Quarkus YAML configuration keys are implicitly escaped <a href="https://github.com/quarkusio/quarkus/issues/11744">#11744</a></p>
</li>
<li>
<p><a href="https://groups.google.com/g/Quarkus-dev/c/KXzJ2UPGRvI/m/3AEsLvZNBAAJ">application.properties included in archive</a></p>
</li>
<li>
<p>Warn or fail if an application.yaml is provided without the <code>quarkus-config-yaml</code> dependency <a href="https://github.com/quarkusio/quarkus/issues/13227">#13227</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This seems quite a bit, but actually none of those bullet points were major issues, or something we could not work around. Several issues were related to configuration, in part because the program was run as a Tekton task, and there is limited flexibility on how you define optional parameters in Tekton. I have listed only those points that we had to work around. Many issues or questions were actually resolved as we were making progress through answers in the google group, or actual fixes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ci-for-native-builds"><a class="anchor" href="#ci-for-native-builds"></a>CI for native builds</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another challenge was related to native build time, memory and CPU usage during those builds. The approach we took was to only generate a native executable on master, and run tests in jvm mode on the feature branches. We would still have an option to test against native in a particular feature branch if we needed to. But unless we were integrating a new library, getting the jvm tests to pass gave us sufficient confidence that we would have an identical behavior in native.</p>
</div>
<div class="paragraph">
<p>The other trick we applied was to cancel the current build on <em>master</em> if a new one got triggered; that way we would not have multiple native builds running at the same time. In theory it could be frustrating to get a build killed because another commit was done. In practice this was not an issue because the rate of PRs getting merged on <em>master</em> stayed low.</p>
</div>
<div class="paragraph">
<p>But there are definitely some questions around sizing a build infrastructure if we had wanted to increase the number of Quarkus applications developed internally.</p>
</div>
<div class="paragraph">
<p>The only drawback compared to the original solution was that our regression test suite was slower to run, essentially because our tests generated resources in the context of a specific configuration. And since we were using <em>MP config</em>, we needed to boot a new Quarkus context every time we wanted to test a different configuration. Fortunately booting a new context is extremely fast in Quarkus, but still a lot slower than with our original plain Java solution.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="it-is-all-about-the-community"><a class="anchor" href="#it-is-all-about-the-community"></a>It is all about the community</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Beside work on the Vault, FreeMarker and OpenShift Client extensions, we started contributing a few PRs in and outside Quarkus, hoping to speed up the process of getting improvements, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add <code>appendResourceVersionInObject</code> for CRD objects <a href="https://github.com/fabric8io/kubernetes-client/pull/2365">#2365</a> (merged)</p>
</li>
<li>
<p>Add cert-manager extension support <a href="https://github.com/fabric8io/kubernetes-client/pull/2930">#2930</a> (merged)</p>
</li>
<li>
<p>Build distroless image using cekit in ci <a href="https://github.com/quarkusio/quarkus-images/pull/118">#118</a> (merged)</p>
</li>
<li>
<p>Allow root certificates to be configured at run time of native image <a href="https://github.com/oracle/graal/pull/3091">#3091</a> (<em>teshull</em> assigned by Christian Wimmer at Oracle to work on this for the GraalVM 21.3 release)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is worth noting that the Quarkus community has been a huge factor for success, by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Answering questions on the google group, zulip or other means such as stackoverflow.</p>
</li>
<li>
<p>Investigating issues in a timely fashion, and depending on the situation either providing fixes, guidance on applying the right approach, or workarounds.</p>
</li>
<li>
<p>Being open to improvements (e.g. on configuration).</p>
</li>
<li>
<p>Reviewing PRs quickly, and facilitating contributions.</p>
</li>
<li>
<p>Releasing with high frequency.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="takeovers"><a class="anchor" href="#takeovers"></a>Takeovers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It took us only a few months to do the migration, and we started deploying our first OpenShift application with our Quarkus powered <em>ocpdeploy</em> end of last year. Since then, it was used to run hundreds of deployments. We were able to follow the pace of new releases with limited effort. We incurred very few bugs, usually fixed in time for the next release. The applicative framework provided by Quarkus allowed us to better structure our code, making it more maintainable, and easy to tests with mock features and test profiles. It is interesting to note as well that <em>ocpdeploy</em> development was done by team members that were not Quarkus developers, or even strong Java specialists. This is a sign that the framework is light enough that once the overall structure (e.g. components, tests, configuration, ci) is in place, we can forget about it.</p>
</div>
<div class="paragraph">
<p>Our program was not business critical in the sense that if it did not work, business would not stop. But it is the only mean to deploy all of our OpenShift microservices. And given the pace of internal developments, it is considered a critical piece in the value chain. <em>ocpdeploy</em> is not evidently ultra sophisticated, and we only scratched the surface of what could be done with Quarkus, but yet it worked for us, showing that it can tackle many different use cases.</p>
</div>
<div class="paragraph">
<p>In conclusion, I think the strong selling points for Quarkus are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A vivid community, which listens actively for feedback, and welcome contributions</p>
</li>
<li>
<p>A project developed with high velocity</p>
</li>
<li>
<p>The right positioning (cloud native, developer joy, …) with versatility</p>
</li>
<li>
<p>Willingness to pragmatically bend, a little, specifications when they would work against the Quarkus values</p>
</li>
<li>
<p>An architecture with a compact core and extensions, allowing for rapid expansion, which will nurture innovation</p>
</li>
<li>
<p>Support for native by default, but also some improvements in jvm mode also</p>
</li>
<li>
<p>Fast growing eco-system through the core extensions, the universe extensions (e.g. camel) and the Quarkiverse</p>
</li>
<li>
<p>Dev mode (local and remote)</p>
</li>
<li>
<p>A framework for developing extensions that facilitate implementing patterns such as the build time initialization</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main challenge I see going forward, similarly to app stores 10 or 15 years ago, is to make sure that the extension eco-system grows in quantity without sacrifice for quality. Or at least provide a way to rate extensions, so that people building business critical applications get assurances that their investment in the technology is sound. In other words going deep in addition to going wide.
The other challenge I see is progressively filling the gaps of enterprise readiness; for instance finishing up solutions sometimes partially developed today, and making sure there is a clear and mature solution for the most common use cases.</p>
</div>
<div class="paragraph">
<p>That is how Quarkus will win over enterprises. And I can see this being in motion.</p>
</div>
<div class="paragraph">
<p>I am very hopeful for the project. Can&#8217;t wait to expand the use cases.</p>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/quarkus-deploys-apps-on-openshift/&title=How Quarkus has been used to deploy applications on OpenShift" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fa-brands fa-linkedin fa-xl"></i>
  </a>
  <a class="share-x" href="https://x.com/intent/tweet?text=How Quarkus has been used to deploy applications on OpenShift&url=https://quarkus.io/blog/quarkus-deploys-apps-on-openshift/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on X">
    <i class="fa-brands fa-square-x-twitter fa-xl"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/quarkus-deploys-apps-on-openshift/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fa-brands fa-square-facebook fa-xl"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/quarkus-deploys-apps-on-openshift/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fa-brands fa-square-reddit fa-xl"></i>
  </a>
  <a class="share-email" href="mailto:?subject=How Quarkus has been used to deploy applications on OpenShift&amp;body=How Quarkus has been used to deploy applications on OpenShift https://quarkus.io/blog/quarkus-deploys-apps-on-openshift/" title="Share via Email" >
    <i class="fa-solid fa-envelope fa-xl"></i>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
