<!DOCTYPE html>
<html lang="en">







<head>
  <title>Crafting a Local RAG application with Quarkus - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/granite-rag/" />
  <meta property="og:title" content="Crafting a Local RAG application with Quarkus" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/granite-rag/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/blog/granite-rag/" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/blog/granite-rag/" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/blog/granite-rag/" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/blog/granite-rag/" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/blog/granite-rag/" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="post">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>          
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="active">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/blog/granite-rag/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/blog/granite-rag/">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/blog/granite-rag/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/blog/granite-rag/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/blog/granite-rag/">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> Crafting a Local RAG application with Quarkus</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          June 13, 2024 
          
            <span class="tags"><a href="/blog/tag/llm">#llm</a><a href="/blog/tag/rag">#rag</a></span>
          
        </div>
        <h1 class="post-title">Crafting a Local RAG application with Quarkus</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/ab937f7df990a673446f1e30fd9ccfba">
            
            <p class="byline">By <a href="/author/cescoffier">Clement Escoffier</a></p>
          </div>
          <div class="width-12-12">
              <div class="paragraph">
<p>This blog post demonstrate how to build an AI-infused chatbot application using Quarkus, LangChain4j, <a href="https://infinispan.org/">Infinispan</a>, and the <a href="https://github.com/ibm-granite/granite-code-models">Granite LLM</a>.
In this post, we will create an <strong>entirely</strong> local solution, eliminating the need for any cloud services, including the LLM.</p>
</div>
<div class="paragraph">
<p>Our chatbot leverages the Granite LLM, a language model that generates contextually relevant text based on user prompts.
To run Granite locally, we&#8217;ll be utilizing <a href="https://instructlab.ai/">InstructLab</a>, though <a href="https://github.com/containers/podman-desktop-extension-ai-lab">Podman AI Lab</a> is another viable option.</p>
</div>
<div class="paragraph">
<p>The core of our application is based on the RAG (Retrieval-Augmented Generation) pattern.
This approach enhances the chatbot&#8217;s responses by retrieving pertinent information from a vector database — in this case, Infinispan — before generating a response.</p>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Our chatbot application is composed of four main components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Web Socket Endpoint</strong>: This component serves as the communication bridge between the chatbot&#8217;s backend and the frontend interface.
This component uses the new Quarkus WebSocket-Next extension to handle WebSocket connections efficiently.
It relies on the AI Service to interact with the LLM.</p>
</li>
<li>
<p><strong>Ingestor</strong>: The ingestor is responsible for populating the database with relevant data. It processes a set of local documents, split them into text segments, compute their vector representation and store them into Infinispan.</p>
</li>
<li>
<p><strong>Retriever</strong>: The retriever allows finding relevant text segments into Infinispan. When a user inputs a query, the retriever searches the vector database to find the most relevant pieces of information.</p>
</li>
<li>
<p><strong>AI Service</strong>: This is the core component of the chatbot, combining the capabilities of the retriever and the Granite LLM. The AI service takes the relevant information fetched by the retriever and uses the Granite LLM to generate the appropriate responses.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following picture illustrates the high-level architecture:</p>
</div>
<div class="imageblock right text-center">
<div class="content">
<img src="/assets/images/posts/llms/chatbot-architecture.png" alt="Architecture of the application">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-simple-explanation-of-the-rag-pattern"><a class="anchor" href="#a-simple-explanation-of-the-rag-pattern"></a>A simple explanation of the RAG pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RAG (Retrieval-Augmented Generation) pattern is one of the most popular AI patterns, combining a retrieval mechanism with a generation mechanism to provide more accurate and relevant responses.</p>
</div>
<div class="paragraph">
<p>The RAG pattern operates in two main steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Ingestion</strong>: The application ingests a set of documents, processes them, and stores them in a vector database.</p>
</li>
<li>
<p><strong>Retrieval</strong>: When a user inputs a query, the application retrieves the most relevant information from the vector database.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following image gives a high-level overview of the <em>traditional</em> RAG pattern:</p>
</div>
<div class="imageblock right text-center">
<div class="content">
<img src="/assets/images/posts/llms/traditional-rag-pattern.png" alt="The traditional RAG pattern">
</div>
</div>
<div class="paragraph">
<p>There are more advanced version of the RAG pattern, but let&#8217;s stick to the basics for this application.</p>
</div>
<div class="sect2">
<h3 id="ingestion"><a class="anchor" href="#ingestion"></a>Ingestion</h3>
<div class="paragraph">
<p>Let&#8217;s first look at the ingestion step.
The ingestion process involves reading a set of documents, splitting them into text segments, computing their vector representations, and storing them in Infinispan.</p>
</div>
<div class="paragraph">
<p>The secret of an effective RAG implementation lies in how the text segments are computed.
In our application, we will follow a straightforward approach, but more advanced techniques are available and often required.
Depending on the document, you can use a variety of techniques to split the text into segments, such as paragraph splitting, sentence splitting, or more advanced techniques like the <code>recursive</code> splitter.
Also, if the document has a specific structure, you can use this structure to split the text into segments (like sections, chapters, etc.).</p>
</div>
<div class="paragraph">
<p>The embedding model is responsible for converting text into a vector representation.
For simplicity, we use an in-process embedding model (<code>BGE-small</code>).
Other options, like the Universal Angle Embedding, are available, but we&#8217;ll stick with BGE-small for simplicity.</p>
</div>
</div>
<div class="sect2">
<h3 id="retrieval"><a class="anchor" href="#retrieval"></a>Retrieval</h3>
<div class="paragraph">
<p>The second step is the retrieval process.
When a user inputs a query, the application searches the vector database to find the most relevant text segments.</p>
</div>
<div class="paragraph">
<p>To achieve this, the application computes the vector representation of the user query using the <strong>same</strong> embedding model and compares it with the vector representations of the stored text segments in Infinispan.
It selects the most relevant text segments based on the similarity between the query vector and the text segment vectors.</p>
</div>
<div class="paragraph">
<p>Then, it augments the user query with the retrieved text segments and sends it to the LLM.
Note that until this step, the LLM is not used.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-the-chatbot"><a class="anchor" href="#implementing-the-chatbot"></a>Implementing the chatbot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enough theory—let&#8217;s dive into the implementation.
You can find the final version on <a href="https://github.com/cescoffier/quarkus-granite-rag-demo">GitHub</a>.</p>
</div>
<div class="sect2">
<h3 id="used-extensions-and-dependencies"><a class="anchor" href="#used-extensions-and-dependencies"></a>Used extensions and dependencies</h3>
<div class="paragraph">
<p>To implement our chatbot, we rely on the following Quarkus extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus-langchain4j-openai</code>: Integrates LLM providers using the OpenAI API, suitable for both InstructLab and Podman AI Lab.</p>
</li>
<li>
<p><code>quarkus-websockets-next</code>: Provides support for WebSocket communication.</p>
</li>
<li>
<p><code>quarkus-langchain4j-infinispan</code>: Integrates Infinispan with LangChain4j, allowing us to store and retrieve vector representations of text segments.</p>
</li>
<li>
<p><code>quarkus-web-bundler</code>: Bundles frontend resources with the Quarkus application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We also need a specific dependency to use the BGE-small embedding model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;
    &lt;artifactId&gt;langchain4j-embeddings-bge-small-en-q&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h3>
<div class="paragraph">
<p>We need a bit of configuration to ensure our application uses Granite and sets up the Infinispan database correctly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># Configure the Infinispan vectors:
quarkus.langchain4j.infinispan.dimension=384 <i class="conum" data-value="1"></i><b>(1)</b>

# Configure the OpenAI service to use instruct lab:
quarkus.langchain4j.openai.base-url=http://localhost:8000/v1 <i class="conum" data-value="2"></i><b>(2)</b>
quarkus.langchain4j.openai.timeout=60s

quarkus.langchain4j.embedding-model.provider=dev.langchain4j.model.embedding.BgeSmallEnQuantizedEmbeddingModel <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure the dimension of the vectors stored in Infinispan, which depends on the embedding model (BGE-small in our case).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the OpenAI service to use InstructLab.
You can replace the base URL with the one for Podman AI Lab if you prefer.
Indeed, InstructLab and Podman AI Lab expose an OpenAI-compatible API.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the default embedding model to BGE-small.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="the-ingestor"><a class="anchor" href="#the-ingestor"></a>The Ingestor</h3>
<div class="paragraph">
<p>With the configuration in place, let&#8217;s implement the <a href="https://github.com/cescoffier/quarkus-granite-rag-demo/blob/main/src/main/java/me/escoffier/granite/rag/Ingestion.java">ingestion part (Ingestion.java)</a>.
The ingestor reads documents from the <code>documents</code> directory, splits them into text segments, computes their vector representations, and stores them in Infinispan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Startup <i class="conum" data-value="1"></i><b>(1)</b>
public class Ingestion {

    public Ingestion(EmbeddingStore&lt;TextSegment&gt; store, EmbeddingModel embedding) { <i class="conum" data-value="2"></i><b>(2)</b>

        EmbeddingStoreIngestor ingestor = EmbeddingStoreIngestor.builder()
                .embeddingStore(store)
                .embeddingModel(embedding)
                .documentSplitter(recursive(1024, 0))  <i class="conum" data-value="3"></i><b>(3)</b>
                .build();

        Path dir = Path.of("documents");
        List&lt;Document&gt; documents = FileSystemDocumentLoader.loadDocuments(dir);
        Log.info("Ingesting " + documents.size() + " documents");

        ingestor.ingest(documents);

        Log.info("Document ingested");
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Startup</code> annotation ensures that the ingestion process starts when the application launches.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>Ingestion</code> class uses an (automatically injected) <code>EmbeddingStore&lt;TextSegment&gt;</code> (Infinispan) and an <code>EmbeddingModel</code> (BGE-small).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We use a simple document splitter (<code>recursive(1024, 0)</code>) to split the documents into text segments.
More advanced techniques may be used to improve the accuracy of the RAG model.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="the-retriever"><a class="anchor" href="#the-retriever"></a>The retriever</h3>
<div class="paragraph">
<p>Next, let&#8217;s implement the <a href="https://github.com/cescoffier/quarkus-granite-rag-demo/blob/main/src/main/java/me/escoffier/granite/rag/Retriever.java">retriever (Retriever.java)</a>.
The retriever finds the most relevant text segments in Infinispan based on the user query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class Retriever implements Supplier&lt;RetrievalAugmentor&gt; {

    private final DefaultRetrievalAugmentor augmentor;

    Retriever(EmbeddingStore&lt;TextSegment&gt; store, EmbeddingModel model) {
        EmbeddingStoreContentRetriever contentRetriever = EmbeddingStoreContentRetriever.builder()
                .embeddingModel(model)
                .embeddingStore(store)
                .maxResults(2) // Large segments
                .build();
        augmentor = DefaultRetrievalAugmentor
                .builder()
                .contentRetriever(contentRetriever)
                .build();
    }

    @Override
    public RetrievalAugmentor get() {
        return augmentor;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To implement a retriever, expose a bean that implements the <code>Supplier&lt;RetrievalAugmentor&gt;</code> interface.
The <code>Retriever</code> class uses <code>EmbeddingStore&lt;TextSegment&gt;</code> (Infinispan) and <code>EmbeddingModel</code> (BGE-small) to build the retriever.</p>
</div>
<div class="paragraph">
<p>The <code>maxResults</code> method in the EmbeddingStoreContentRetriever builder specifies the number of text segments to retrieve.
Since our segments are large, we retrieve only two segments.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-ai-service"><a class="anchor" href="#the-ai-service"></a>The AI Service</h3>
<div class="paragraph">
<p>The <a href="https://github.com/cescoffier/quarkus-granite-rag-demo/blob/main/src/main/java/me/escoffier/granite/rag/ChatBot.java">AI Service (ChatBot.java)</a> is the core component of our chatbot, combining the capabilities of the retriever and the Granite LLM to generate appropriate responses.</p>
</div>
<div class="paragraph">
<p>With Quarkus, implementing an AI service is straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RegisterAiService(retrievalAugmentor = Retriever.class) <i class="conum" data-value="1"></i><b>(1)</b>
@SystemMessage("You are Mona, a chatbot answering question about a museum. Be polite, concise and helpful.") <i class="conum" data-value="2"></i><b>(2)</b>
@SessionScoped <i class="conum" data-value="3"></i><b>(3)</b>
public interface ChatBot {

    String chat(String question); <i class="conum" data-value="4"></i><b>(4)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@RegisterAiService</code> annotation specifies the retrieval augmentor to use, which in our case is the <code>Retriever</code> bean defined earlier.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@SystemMessage</code> annotation provides the main instructions for the AI model.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@SessionScoped</code> annotation ensures that the AI service is stateful, maintaining context between user interactions for more engaging conversations.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>ChatBot</code> interface defines a single method, <code>chat</code>, which takes a user question as input and returns the chatbot&#8217;s response.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="the-websocket-endpoint"><a class="anchor" href="#the-websocket-endpoint"></a>The WebSocket endpoint</h3>
<div class="paragraph">
<p>The final piece is the <a href="https://github.com/cescoffier/quarkus-granite-rag-demo/blob/main/src/main/java/me/escoffier/granite/rag/ChatWebSocket.java">WebSocket endpoint (ChatWebSocket.java)</a>, which serves as the communication bridge between the chatbot&#8217;s backend and the frontend interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebSocket(path = "/chat") <i class="conum" data-value="1"></i><b>(1)</b>
public class ChatWebSocket {

    @Inject ChatBot bot; // Inject the AI service

    @OnOpen <i class="conum" data-value="2"></i><b>(2)</b>
    String welcome() {
        return "Welcome, my name is Mona, how can I help you today?";
    }

    @OnTextMessage <i class="conum" data-value="3"></i><b>(3)</b>
    String onMessage(String message) {
        return bot.chat(message);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@WebSocket</code> annotation specifies the WebSocket path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@OnOpen</code> method sends a welcome message when a user connects to the <em>WebSocket</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@OnTextMessage</code> method processes the user&#8217;s messages and returns the chatbot&#8217;s responses, using the injected AI service.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That&#8217;s it! Our chatbot is now ready to chat with users, providing contextually relevant responses based on the RAG pattern.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-application"><a class="anchor" href="#running-the-application"></a>Running the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s run the application and see our chatbot in action.
First, clone the <a href="https://github.com/cescoffier/quarkus-granite-rag-demo/tree/main">repository</a> and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command starts the Quarkus application in development mode.
Ensure you have InstructLab or Podman AI Lab running to use the Granite LLM.
You will also need Docker or Podman to automatically start Infinispan.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Podman AI Lab or InstructLab?</div>
<div class="paragraph">
<p>You can use either Podman AI Lab or InstructLab to run the Granite LLM locally.
Depending on the OS, Podman may not have GPU support. Thus, response time can be high.
In this case, InstructLab is the preferred option for better response times.
Typically, on a Mac, you would use InstructLab, while on Linux, Podman AI Lab shows great performances.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the application is up and running, open your browser and navigate to <a href="http://localhost:8080" class="bare">http://localhost:8080</a>.
You should see the chatbot interface, where you can start chatting with Mona:</p>
</div>
<div class="imageblock right text-center">
<div class="content">
<img src="/assets/images/posts/llms/mona-screenshot.png" alt="The Mon chatbot">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>That&#8217;s it!
With just a few lines of code, we have implemented a chatbot using the RAG pattern, combining the capabilities of the Granite LLM, Infinispan, and Quarkus.
This application runs entirely locally, eliminating the need for any cloud services and addressing privacy concerns.</p>
</div>
<div class="paragraph">
<p>This is just an example of what you can achieve with the Quarkus LangChain4j extension.
You can easily extend this application by adding more advanced features, such as sophisticated document splitters, embedding models, or retrieval mechanisms.
Quarkus LangChain4J also provides support for <a href="https://docs.langchain4j.dev/tutorials/rag/#advanced-rag"><em>advanced</em> RAG</a>, many other LLM and embedding models and vector stores.
Find out more on <a href="https://docs.quarkiverse.io/quarkus-langchain4j/dev/index.html">Quarkus LangChain4J</a>.</p>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/granite-rag/&title=Crafting a Local RAG application with Quarkus" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fa-brands fa-linkedin fa-xl"></i>
  </a>
  <a class="share-x" href="https://x.com/intent/tweet?text=Crafting a Local RAG application with Quarkus&url=https://quarkus.io/blog/granite-rag/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on X">
    <i class="fa-brands fa-square-x-twitter fa-xl"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/granite-rag/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fa-brands fa-square-facebook fa-xl"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/granite-rag/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fa-brands fa-square-reddit fa-xl"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Crafting a Local RAG application with Quarkus&amp;body=Crafting a Local RAG application with Quarkus https://quarkus.io/blog/granite-rag/" title="Share via Email" >
    <i class="fa-solid fa-envelope fa-xl"></i>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
