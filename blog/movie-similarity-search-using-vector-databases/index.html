<!DOCTYPE html>
<html lang="en">







<head>
  <title>Movie similarity search using vector databases - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/movie-similarity-search-using-vector-databases/" />
  <meta property="og:title" content="Movie similarity search using vector databases" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/movie-similarity-search-using-vector-databases/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/blog/movie-similarity-search-using-vector-databases/" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/blog/movie-similarity-search-using-vector-databases/" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/blog/movie-similarity-search-using-vector-databases/" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/blog/movie-similarity-search-using-vector-databases/" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/blog/movie-similarity-search-using-vector-databases/" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="post">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>          
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="active">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/blog/movie-similarity-search-using-vector-databases/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/blog/movie-similarity-search-using-vector-databases/">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/blog/movie-similarity-search-using-vector-databases/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/blog/movie-similarity-search-using-vector-databases/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/blog/movie-similarity-search-using-vector-databases/">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> Movie similarity search using vector databases</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          March 24, 2025 
          
            <span class="tags"><a href="/blog/tag/langchain4j,">#langchain4j,</a><a href="/blog/tag/llm,">#llm,</a><a href="/blog/tag/ai">#ai</a></span>
          
        </div>
        <h1 class="post-title">Movie similarity search using vector databases</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/8f8a26223c5f15683eafd40b22595d88">
            
            <p class="byline">By <a href="/author/iocanel">Ioannis Canellos</a></p>
          </div>
          <div class="width-12-12">
              <div class="sect2">
<h3 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h3>
<div class="paragraph">
<p>With LLMs becoming increasingly popular we often see them being used even for tasks that are not directly related to text generation.
Such case is using LLMs for recommendation systems. In this post we&#8217;ll see how you can build such a system using <a href="https://docs.quarkiverse.io/quarkus-langchain4j/dev/index.html">Quarkus LangChain4j</a>
but without using LLMs. More specifically we&#8217;ll create a simple movie similarity search system using a vector database. The role
of <a href="https://docs.quarkiverse.io/quarkus-langchain4j/dev/index.html">Quarkus LangChain4j</a> in this story is to abstract the underlying vector database through the <code>EmbeddingStore</code> interface.</p>
</div>
<div class="paragraph">
<p>A relevant sample has been recently added to the <a href="https://github.com/quarkiverse/quarkus-langchain4j/tree/main/samples/">Quarkus LangChain4j samples</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="embeddings"><a class="anchor" href="#embeddings"></a>Embeddings</h3>
<div class="paragraph">
<p>An embedding is a way to represent unstructured data (text, images etc.) in a structured way. This is done by mapping the data into a vector.
As we are able to perform mathematical operations on vectors, such as calculating the distance between them, we can use embeddings to calculate
how close (or similar) two pieces of data are. In our case, comparing the embeddings of the movie overview can give us a measure of how similar
the two movies are. This is the premise of this post.</p>
</div>
<div class="sect3">
<h4 id="how-are-embeddings-created"><a class="anchor" href="#how-are-embeddings-created"></a>How are embeddings created?</h4>
<div class="paragraph">
<p>There are multiple ways to create embeddings. <a href="https://docs.quarkiverse.io/quarkus-langchain4j/dev/index.html">Quarkus LangChain4j</a> provides the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.quarkiverse.io/quarkus-langchain4j/dev/in-process-embedding.html">In-process embedding</a></p>
</li>
<li>
<p><a href="https://docs.quarkiverse.io/quarkus-langchain4j/dev/llms.html">Model provider</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this post we&#8217;ll use the former. Did I mention that we won&#8217;t be using LLMs?
Instead, we&#8217;ll be using <a href="https://github.com/pgvector/pgvector">pgvector</a> which is a PostgreSQL extension that provides vector operations and indexing.</p>
</div>
<div class="paragraph">
<p>Our project will need the following dependencies, for <a href="https://github.com/pgvector/pgvector">pgvector</a> and <a href="https://docs.quarkiverse.io/quarkus-langchain4j/dev/in-process-embedding.html">in-process embedding</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
        &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;
        &lt;artifactId&gt;langchain4j-embeddings-bge-small-en-q&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.quarkiverse.langchain4j&lt;/groupId&gt;
        &lt;artifactId&gt;quarkus-langchain4j-pgvector&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To be able to use these dependencies without needing to specify versions, the BOM can be imported to the <code>dependencyManagement</code> of the project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkiverse.langchain4j&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-langchain4j-bom&lt;/artifactId&gt;
    &lt;version&gt;0.25.0&lt;/version&gt;
    &lt;type&gt;pom&lt;/type&gt;
    &lt;scope&gt;import&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To properly use the in-process embedding model we need to configure it in the <code>application.properties</code> file.
We also need to configure the pgvector dimension and ensure it&#8217;s aligned with the dimension of the embedding model.
In our case, it&#8217;s 384 (the <a href="https://docs.quarkiverse.io/quarkus-langchain4j/dev/index.html">Quarkus LangChain4j</a> documentation provides the size used by each model).</p>
</div>
<div class="paragraph">
<p>So, the <code>application.properties</code> file should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.langchain4j.pgvector.dimension=384
quarkus.langchain4j.embedding-model.provider=dev.langchain4j.model.embedding.onnx.bgesmallenq.BgeSmallEnQuantizedEmbeddingModel</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: We can use any other document store supported by <a href="https://docs.quarkiverse.io/quarkus-langchain4j/dev/index.html">Quarkus LangChain4j</a>, in fact that&#8217;s one of the key benefits of using it, the abstraction
of embeddings stores.</p>
</div>
</div>
<div class="sect3">
<h4 id="storing-the-embedding"><a class="anchor" href="#storing-the-embedding"></a>Storing the embedding</h4>
<div class="paragraph">
<p>To store the embedding we&#8217;ll need an <code>EmbeddingStoreIngestor</code> The ingestor is created using the <code>EmbeddingModel</code> and the <code>EmbeddingStore</code>, both provided
as beans and can be easily injected. Alternatively, the user can specify a document splitter, for splitting large documents into smaller chunks, but we won&#8217;t be needing that
in this post, as the movie overview are relatively small.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/similarity-search-using-vector-dbs/ingestion.png" alt="ingestion">
</div>
</div>
<div class="paragraph">
<p>Before passing the unstructured text to the ingestor we need to wrap it in a <code>Document</code> object. The <code>Document</code> also contains a <code>Metadata</code> object which holds key-value pairs.
The <code>Metadata</code> is really handy as we can add there information needed for correlating the <code>Document</code> with other data. In our case we&#8217;ll use the <code>Metadata</code> to store the id of the movie.
That id will help us correlate the movie overview with the actual movie.</p>
</div>
<div class="paragraph">
<p>The simplified code below shows, how the actual ingestor is created and how the embedding is stored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
EmbeddingModel embeddingModel;

@Inject
EmbeddingStore embeddingStore;

public EmbeddingStoreIngestor createIngestor()  {
    return EmbeddingStoreIngestor.builder()
    .embeddingModel(embeddingModel)
    .embeddingStore(embeddingStore)
    .build();
}

public void ingest(Long movieId, String overview) {
      Metadata metadata = Metadata.from(Map.of("id", id));
      Document document = Document.from(overview, metadata);
      createIngestor().ingest(document);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, how exactly do we use the movie id ? This depends really on how we store the rest of the movie data. In our case, we&#8217;ll store the movie data in a PostgreSQL database.
This means that the movie id, corresponds to the id of the Movie in the database.</p>
</div>
</div>
<div class="sect3">
<h4 id="querying-the-embedding"><a class="anchor" href="#querying-the-embedding"></a>Querying the embedding</h4>
<div class="paragraph">
<p>To query the embedding we&#8217;ll use the <code>EmbeddingStore</code> and the <code>EmbeddingModel</code> in order to execute <code>EmbeddingSearchRequest</code>.
The code is pretty straight forward. We use the movie overview to create a search request. The <code>EmbeddingSearchRequest</code> builder
also allows us to specify the maximum number of results and also the minimum similarity threshold. The later allows us to filter
out embeddings that are not similar enough to the query embedding. In other words, it tells the store that if there are not enough similar results
to avoid adding irrelevant results to the response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkiverse.langchain4j.sample;

import java.util.List;

import dev.langchain4j.data.embedding.Embedding;
import dev.langchain4j.data.segment.TextSegment;
import dev.langchain4j.model.embedding.EmbeddingModel;
import dev.langchain4j.store.embedding.EmbeddingSearchRequest;
import dev.langchain4j.store.embedding.EmbeddingStore;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.inject.Inject;
import jakarta.transaction.Transactional;

@ApplicationScoped
public class MovieRecommendationService {

  @Inject
  EmbeddingStore&lt;TextSegment&gt; embeddingStore;

  @Inject
  EmbeddingModel embeddingModel;

  @Transactional
  public List&lt;Movie&gt; searchSimilarMovies(String overview) {

    Embedding embedding = embeddingModel.embed(overview).content();
    EmbeddingSearchRequest request = EmbeddingSearchRequest.builder()
    .queryEmbedding(embedding)
    .minScore(0.5)
    .maxResults(10)
    .build();

    return embeddingStore.search(request).matches().stream().map(m -&gt; {
      Long id = m.embedded().metadata().getLong("id");
      Movie movie = Movie.findById(id);
      return movie;
    }).toList();

  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="loading-the-movies"><a class="anchor" href="#loading-the-movies"></a>Loading the movies</h4>
<div class="paragraph">
<p>To populate the movies in the database, we&#8217;ll use a CSV file containing the top 1000 movies from IMDB.
The important columns for us are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>title</code> the movie title</p>
</li>
<li>
<p><code>overview</code> the movie overview</p>
</li>
<li>
<p><code>link</code> the link to the image poster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To easily map CSV entries to <code>Movie</code> objects we&#8217;ll use <code>Jackson</code>. Specifically, we will use the <code>@JsonProperty</code>
annotation to map the CSV columns to the <code>Movie</code> fields. Also, we&#8217;ll use <code>@JsonIgnoreProperties(ignoreUnknown = true)</code>
to ignore unknown fields.</p>
</div>
<div class="paragraph">
<p>So, a simplified version of our Movie entity object looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

import io.quarkus.hibernate.orm.panache.PanacheEntity;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import java.util.List;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;


@Entity
@JsonIgnoreProperties(ignoreUnknown = true)
public class Movie extends PanacheEntity {

    @JsonProperty("Poster_Link")
    public String link;
    @JsonProperty("Series_Title")
    public String title;
    @JsonProperty("Overview")
    @Column(length = 1000)
    public String overview;

    public static List&lt;Movie&gt; searchByTitleLike(String title) {
      return find("title like ?1", "%" + title + "%").list();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, now we are ready to load our movies from the CSV to our relational and vector databases.</p>
</div>
<div class="paragraph">
<p>Key points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Observing the <code>StartupEvent</code> allows us to load the movies when the application starts</p>
</li>
<li>
<p>CSVMapper is used to map the CSV entries to <code>Movie</code> objects</p>
</li>
<li>
<p>We save each movie using a @Transaction method because we need that <code>id</code> that&#8217;s often generated by the database</p>
</li>
<li>
<p>We ingest the documents in a batch. This can make a huge difference especially, if we move from in-process to remote embedding models.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

import io.quarkus.logging.Log;
import io.quarkus.runtime.StartupEvent;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.enterprise.event.Observes;
import jakarta.transaction.Transactional;

import java.nio.file.Files;
import java.nio.file.Path;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.eclipse.microprofile.config.inject.ConfigProperty;

import com.fasterxml.jackson.databind.MappingIterator;
import com.fasterxml.jackson.dataformat.csv.CsvMapper;
import com.fasterxml.jackson.dataformat.csv.CsvSchema;

import dev.langchain4j.data.document.Document;
import dev.langchain4j.data.document.Metadata;
import dev.langchain4j.model.embedding.EmbeddingModel;
import dev.langchain4j.store.embedding.EmbeddingStore;
import dev.langchain4j.store.embedding.EmbeddingStoreIngestor;

@ApplicationScoped
public class MovieLoader {


  public void load(@Observes StartupEvent event, @ConfigProperty(name = "movies.file") Path moviesFile,
                   EmbeddingStore embeddingStore, EmbeddingModel embeddingModel) throws Exception {
    if (!Files.exists(moviesFile)) {
      throw new IllegalStateException("Missing movies file: " + moviesFile);
    }

    embeddingStore.removeAll();

    EmbeddingStoreIngestor ingester = EmbeddingStoreIngestor.builder()
    .embeddingModel(embeddingModel)
    .embeddingStore(embeddingStore)
    .build();

    List&lt;Document&gt; docs = new ArrayList&lt;&gt;();
    try (MappingIterator&lt;Movie&gt; it = new CsvMapper().readerFor(Movie.class).with(CsvSchema.emptySchema().withHeader()).readValues(moviesFile.toFile())) {
      for (Movie movie : it.readAll()) {
        Long id = save(movie).id;
        Metadata metadata = Metadata.from(Map.of("id", id, "title", movie.title));
      Document document = Document.from(movie.overview, metadata);
      docs.add(document);

      }
    }

    Log.info("Ingesting movies...");
    ingester.ingest(docs);
    Log.info("Application initalized!");
  }

  @Transactional
  public Movie save(Movie m) {
    m.persist();
    return m;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the CSV mapper, we&#8217;ll need to Jackson&#8217;s CSV dataformat dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;dependency&gt;
            &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-dataformat-csv&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path of the movies file is specified in the <code>application.properties</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">movies.file=src/main/resources/movies.csv</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bringing-it-all-together"><a class="anchor" href="#bringing-it-all-together"></a>Bringing it all together</h4>
<div class="paragraph">
<p>The only thing that&#8217;s left is to create a REST endpoint that allows us to search for similar movies. We could also use a simple UI.
Let&#8217;s start with the REST endpoint. It&#8217;s pretty straightforward. We need two methods, one for searching movies and one for searching similar movies.
For the former we just use the <code>Movie</code> entity, for the latter we inject and use the <code>MovieRecommendationService</code> we created earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkiverse.langchain4j.sample;

import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;
import java.util.List;

@Path("/movies")
public class MovieResource {

    @Inject
    MovieRecommendationService recommendationService;

    @GET
    @Produces(MediaType.APPLICATION_JSON)
    @Path("/by-title/{title}")
    public List&lt;Movie&gt; searchByTitle(String title) {
      return Movie.searchByTitleLike(title);
    }

    @GET
    @Produces(MediaType.APPLICATION_JSON)
    @Path("/similar/{id}")
    public List&lt;Movie&gt; searchSimilar(Long id) {
      Movie m = Movie.findById(id);
      return recommendationService.searchSimilarMovies(m.overview);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the UI, let&#8217;s just use a simple HTML page that uses the REST endpoint to search for similar movies.</p>
</div>
<div class="paragraph">
<p>The key elements of that page are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>movie-box: a text field for entering the movie title</p>
</li>
<li>
<p>search-results: an unordered list for displaying the search results</p>
</li>
<li>
<p>movie-overview: div for displaying the overview of the selected movie</p>
</li>
<li>
<p>movie-poster: an image for displaying the movie poster</p>
</li>
<li>
<p>similar-results: an additional unordered list for displaying the similar movies</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s important to remember that the <code>Movie</code> entity is using Jackson to map the CSV columns to the entity fields.
This means that when a <code>Movie</code> is serialized to JSON, it will use the CSV column names as the field names and not
the entity field names. The HTML code below needs to take that into consideration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
	&lt;head&gt;
    &lt;title&gt;{{_title_}}&lt;/title&gt;
		&lt;meta charset="UTF-8"/&gt;
		&lt;meta name="viewport" content="width=device-width, initial-scale=1"/&gt;
	&lt;/head&gt;
	&lt;body&gt;
    &lt;h2&gt;Movie Similarity Search&lt;/h2&gt;
    &lt;input type="text" id="movie-box" placeholder="Enter a movie title"&gt;
    &lt;h3 hidden="true" id="movie-results-heading"&gt;Click on of the movies below&lt;/h3&gt;
    &lt;ul id="search-results"&gt;&lt;/ul&gt;
    &lt;img id="movie-poster"&gt;&lt;img&gt;
    &lt;div id="movie-overview"&gt;&lt;/div&gt;
    &lt;h3 hidden="true" id="similar-heading"&gt;Similar movies&lt;/h3&gt;
    &lt;ul id="similar-results"&gt;&lt;/ul&gt;

    &lt;script&gt;
    document.getElementById("movie-box").addEventListener("input", async function() {
        const query = this.value.trim();
        if (query.length === 0) {
          document.getElementById("search-results").innerHTML = "";
          return;
        }
      const response = await fetch(`/movies/by-title/${encodeURIComponent(query)}`);
        const movies = await response.json();

        if (movies.length &gt; 0) {
          document.getElementById("movie-results-heading").hidden = false;
        }
        movies.forEach(movie =&gt; {
          const li = document.createElement("li");
          li.textContent = movie.Series_Title;
          li.addEventListener("click", () =&gt; displayMovie(movie));
          document.getElementById("search-results").appendChild(li);
        });
    });

    async function displayMovie(movie) {
      console.log('Displaying movie:', movie);
      document.getElementById("search-results").innerHTML = "";
      document.getElementById("movie-poster").src = movie.Poster_Link;
      document.getElementById("movie-poster").style.display = "block";
      document.getElementById("movie-overview").textContent = movie.Overview;
      document.getElementById("similar-heading").hidden = false;
      document.getElementById("movie-results-heading").hidden = true;
      document.getElementById("similar-results").innerHTML = "";

      const response = await fetch(`/movies/similar/${encodeURIComponent(movie.id)}`);
      const similarMovies = await response.json();
        similarMovies.forEach(similarMovie =&gt; {
           const li = document.createElement("li");
           li.textContent = similarMovie.Series_Title;
           li.addEventListener("click", () =&gt; displayMovie(similarMovie));
           document.getElementById("similar-results").appendChild(li);
        });
    }
    &lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>I won&#8217;t go into much detail about the HTML code as it&#8217;s outside the scope of this post.
The final results should look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/similarity-search-using-vector-dbs/movie-similarity-search-ui.png" alt="movie similarity search ui">
</div>
</div>
</div>
<div class="sect3">
<h4 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h4>
<div class="paragraph">
<p>The quality of the recommendations depends on the accuracy of the movie overview and also on the quality of the embeddings.
This means that better embedding models can lead to better recommendations. The vector database used could possibly also
affect the quality of the recommendations, but that&#8217;s a topic for another post.</p>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/movie-similarity-search-using-vector-databases/&title=Movie similarity search using vector databases" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fa-brands fa-linkedin fa-xl"></i>
  </a>
  <a class="share-x" href="https://x.com/intent/tweet?text=Movie similarity search using vector databases&url=https://quarkus.io/blog/movie-similarity-search-using-vector-databases/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on X">
    <i class="fa-brands fa-square-x-twitter fa-xl"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/movie-similarity-search-using-vector-databases/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fa-brands fa-square-facebook fa-xl"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/movie-similarity-search-using-vector-databases/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fa-brands fa-square-reddit fa-xl"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Movie similarity search using vector databases&amp;body=Movie similarity search using vector databases https://quarkus.io/blog/movie-similarity-search-using-vector-databases/" title="Share via Email" >
    <i class="fa-solid fa-envelope fa-xl"></i>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
