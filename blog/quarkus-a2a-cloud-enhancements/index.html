<!DOCTYPE html>
<html lang="en">







<head>
  <title>How to Use Your A2A Server Agent in a Distributed or Cloud Native Environment - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/quarkus-a2a-cloud-enhancements/" />
  <meta property="og:title" content="How to Use Your A2A Server Agent in a Distributed or Cloud Native Environment" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/quarkus-a2a-cloud-enhancements/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/blog/quarkus-a2a-cloud-enhancements/" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/blog/quarkus-a2a-cloud-enhancements/" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/blog/quarkus-a2a-cloud-enhancements/" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/blog/quarkus-a2a-cloud-enhancements/" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/blog/quarkus-a2a-cloud-enhancements/" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="post">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="active">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/blog/quarkus-a2a-cloud-enhancements/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/blog/quarkus-a2a-cloud-enhancements/">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/blog/quarkus-a2a-cloud-enhancements/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/blog/quarkus-a2a-cloud-enhancements/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/blog/quarkus-a2a-cloud-enhancements/">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> How to Use Your A2A Server Agent in a Distributed or Cloud Native Environment</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          October 31, 2025 
          
            <span class="tags"><a href="/blog/tag/ai">#ai</a><a href="/blog/tag/a2a">#a2a</a><a href="/blog/tag/cloud">#cloud</a></span>
          
        </div>
        <h1 class="post-title">How to Use Your A2A Server Agent in a Distributed or Cloud Native Environment</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/3da43b71f2d9e45a079af1d1f3e8bfff">
            
            <p class="byline">By <a href="/author/kkhan">Kabir Khan</a></p>
          </div>
          <div class="width-12-12">
              <div class="paragraph">
<p>The recent <a href="https://github.com/a2aproject/a2a-java/tree/v0.3.0.Final">0.3.0.Final</a> release of the A2A Java SDK, included a bunch of improvements.</p>
</div>
<div class="paragraph">
<p>Farah recently blogged about the <a href="https://quarkus.io/blog/quarkus-a2a-java-security/">new security features</a> in the A2A Java SDK.</p>
</div>
<div class="paragraph">
<p>This post will focus on the significant cloud-related enhancements which also are part of this release. These provide the building blocks for running the SDK in a distributed, cloud-native environment. We will demonstrate this with a simple A2A Agent, which simply appending <code>Artifacts</code> to a <code>Task</code> that contain the name of the pod handling the incoming `Message`s.</p>
</div>
<div class="paragraph">
<p>Note that we have done a <a href="https://github.com/wildfly-extras/a2a-java-sdk-server-jakarta">0.3.1.Final</a> release since. The links in the examples will use this very latest release.</p>
</div>
<div class="paragraph">
<p>We will cover the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initially, we will look at the simple, in-memory components that form the core of the SDK&#8217;s asynchronous model. These core classes were inspired by the Python version of the SDK, <a href="https://github.com/a2aproject/a2a-python">a2a-python</a>.</p>
</li>
<li>
<p>Next, we&#8217;ll introduce the new, persistent and replicated implementations designed for distributed environments.</p>
</li>
<li>
<p>Finally, we&#8217;ll walk through an <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/README.md">example</a> that combines these components and deploys an application in a Kubernetes cluster, showing that the components enable us to work in a load-balanced environment.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="core-sdk-in-memory-components"><a class="anchor" href="#core-sdk-in-memory-components"></a>Core SDK In-Memory Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The A2A Java SDK provides the tools to manage asynchronous, long-running processes, which we call Tasks. As described in the <a href="https://a2a-protocol.org/latest/topics/key-concepts/">Core Concepts</a> section of the A2A protocol documentation (as well as the <a href="https://a2a-protocol.org/latest/topics/life-of-a-task/">Life of a Task</a> and <a href="https://a2a-protocol.org/latest/topics/streaming-and-async/">Streaming and Asynchronous Operations for Long-Running Tasks</a> sections), a Task can move through various states.</p>
</div>
<div class="paragraph">
<p>A key design principle is that as long as a Task is in a non-final state, it must be possible to send messages to do more work on it, or re-subscribe to its events.</p>
</div>
<div class="paragraph">
<p>To manage this, the SDK relies on a few core components, and provides simple, default implementations of those:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/server-common/src/main/java/io/a2a/server/tasks/TaskStore.java"><code>TaskStore</code></a>: Manages the lifecycle and persistence of <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/spec/src/main/java/io/a2a/spec/Task.java"><code>Task</code></a> objects. The default implementation is <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/server-common/src/main/java/io/a2a/server/tasks/InMemoryTaskStore.java"><code>InMemoryTaskStore</code></a>, which holds all <code>Task</code> information in memory.</p>
</li>
<li>
<p><a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/server-common/src/main/java/io/a2a/server/tasks/PushNotificationConfigStore.java"><code>PushNotificationConfigStore</code></a>: Stores a client&#8217;s push notification configurations (like webhook URLs). The default is the <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/server-common/src/main/java/io/a2a/server/tasks/InMemoryPushNotificationConfigStore.java"><code>InMemoryPushNotificationConfigStore</code></a>.</p>
</li>
<li>
<p><a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/server-common/src/main/java/io/a2a/server/events/QueueManager.java"><code>QueueManager</code></a>: This is central to the asynchronous model. It creates and manages <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/server-common/src/main/java/io/a2a/server/events/EventQueue.java"><code>EventQueue</code></a>s for tasks. In your A2A applications, you will typically implement an <code>AgentExecutor</code>, which takes an incoming message, and then puts events on the <code>EventQueue</code> to update the <code>Task</code> with the results of the processing. The SDK then listens on this <code>EventQueue</code> to update the <code>Task</code> in the <code>TaskStore</code>, and notify any clients listening for updates. Clients listening for updates are ones that have asked to resubscribe, or ones having sent a message, and are waiting for results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These in-memory implementations are simple and fast, making them perfect for single-instance deployments, getting started, or testing. However, in a distributed or cloud environment where service instances can be created or destroyed, this in-memory state is lost, which breaks the guarantee for long-running tasks. Also, since all the state is kept in memory, there are overheads associated with this approach.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="distributed-and-cloud-ready-implementations"><a class="anchor" href="#distributed-and-cloud-ready-implementations"></a>Distributed and Cloud Ready Implementations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run in a distributed environment, we needed to replace these in-memory components with implementations that could persist state and coordinate across multiple service instances. For this release, we introduced several new components, which you can find in the <a href="https://github.com/a2aproject/a2a-java/tree/v0.3.1.Final/extras"><code>extras/</code></a> directory of the <code>a2a-java</code> repository.</p>
</div>
<div class="paragraph">
<p>Essentially, they are alternative implementations of the <code>TaskStore</code>, <code>PushNotificationConfigStore</code> and <code>QueueManager</code> interfaces. They have been annotated with the <code>@Alternative</code> and <code>@Priority</code> CDI annotations, so that if their Maven modules is included in your build, these implementations will take precedence over the default, in-memory ones.</p>
</div>
<div class="paragraph">
<p>Each component has a README, and is fully tested with an integration test for additional information about how to set it up.</p>
</div>
<div class="paragraph">
<p>While we are not aiming to provide support for every possible backend in this repository, we hope that the examples given show that it is relatively simple to provide other mechanisms to back the functionality.</p>
</div>
<div class="sect2">
<h3 id="database-backed-taskstore-and-pushnotificationstore"><a class="anchor" href="#database-backed-taskstore-and-pushnotificationstore"></a>Database-Backed TaskStore and PushNotificationStore</h3>
<div class="paragraph">
<p>The simplest problem to solve was persistence. We introduced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/a2aproject/a2a-java/tree/v0.3.1.Final/extras/task-store-database-jpa/src/main/java/io/a2a/extras/taskstore/database/jpa/JpaDatabaseTaskStore.java"><code>JpaDatabaseTaskStore</code></a>: This persists <code>Task</code> state to a relational database using Jakarta JPA. See the <a href="https://github.com/a2aproject/a2a-java/tree/v0.3.1.Final/extras/task-store-database-jpa/README.md">README</a> for more details. The module also contains tests for additional guidance for how to set it up.</p>
</li>
<li>
<p><a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/extras/push-notification-config-store-database-jpa/src/main/java/io/a2a/extras/pushnotificationconfigstore/database/jpa/JpaDatabasePushNotificationConfigStore.java"><code>JpaDatabasePushNotificationConfigStore</code></a>: This persists <code>PushNotificationConfig</code> instances to a relational database using Jakarta JPA. The <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/extras/push-notification-config-store-database-jpa/README.md">README</a> and the module&#8217;s tests contain more details.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="replicated-queuemanager"><a class="anchor" href="#replicated-queuemanager"></a>Replicated QueueManager</h3>
<div class="paragraph">
<p>As for the <code>QueueManager</code>, it doesn&#8217;t just store state. It also manages active, in-memory message queues. If a client sends a message to a <code>Task</code> via one A2A Agent instance, we need to make sure that subscribers to the <code>Task</code> on other A2A Agent instances forming part of the cluster, also receive the resulting <code>EventQueue</code> messages.</p>
</div>
<div class="paragraph">
<p>We introduced the <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/extras/queue-manager-replicated/core/src/main/java/io/a2a/extras/queuemanager/replicated/core/ReplicatedQueueManager.java">ReplicatedQueueManager</a> for this. The component is built with a pluggable <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/extras/queue-manager-replicated/core/src/main/java/io/a2a/extras/queuemanager/replicated/core/ReplicationStrategy.java"><code>ReplicationStrategy</code></a> responsible for pushing the events to other nodes in the cluster. It also notifies the other nodes when an <code>EventQueue</code> for a <code>Task</code> is created, and when it is closed.</p>
</div>
<div class="paragraph">
<p>We provide one implementation of <code>ReplicationStrategy</code>, <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/extras/queue-manager-replicated/replication-mp-reactive/src/main/java/io/a2a/extras/queuemanager/replicated/mp_reactive/ReactiveMessagingReplicationStrategy.java"><code>ReactiveMessagingReplicationStrategy</code></a>, which uses MicroProfile Reactive Messaging under the hood to send and receive the replicated <code>EventQueue</code> events. The nice thing about MicroProfile Reactive Messaging, is that it is simple to configure alternative providers to do the actual messaging part by changing properties in your <code>application.properties</code>. In our tests, and examples we chose Kafka as the provider.</p>
</div>
<div class="paragraph">
<p>However, you are not stuck with Kafka or MicroProfile Reactive Messaging. It should be possible to plug in whichever mechanism you choose, as long as you provide your own implementation of <code>ReactiveMessagingReplicationStrategy</code>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/extras/queue-manager-replicated/README.md">README</a>, and the tests in the module provide more information to help you, whether you want to learn more about how to configure the <code>ReplicatedQueueManager</code>, or implement your own <code>ReactiveMessagingReplicationStrategy</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="stabilising-the-server-side"><a class="anchor" href="#stabilising-the-server-side"></a>Stabilising the Server-Side</h3>
<div class="paragraph">
<p>Getting the <code>ReplicatedQueueManager</code> to work reliably required significant improvements to our server-side request handling. We did a lot of work to ensure that the event <code>EventQueue</code> associated with a <code>Task</code> is always available for non-final <code>Task</code> s, and that they are reliably cleaned up when a <code>Task</code> finishes, while ensuring that existing subscribers still get all the events before the <code>EventQueue</code> is closed.</p>
</div>
<div class="paragraph">
<p>This was the final step needed to get a deployment working reliably on Kubernetes, which is the focus of the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="example-running-on-kubernetes"><a class="anchor" href="#example-running-on-kubernetes"></a>Example: Running on Kubernetes</h3>
<div class="paragraph">
<p>Now let us see how to combine these new components in a real-world scenario. We have created a new Kubernetes example demonstrating how to run a stateful A2A Java application in a Kubernetes cluster. It focuses on the improved implementations of <code>TaskStore</code> and <code>QueueManager</code>, and can be found <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/README.md">here</a>.</p>
</div>
<div class="paragraph">
<p>We will summarise the most important parts here below. We will look at how to set everything up, and run the example, before showing the most important parts of how the A2A Agent server is configured.</p>
</div>
<div class="sect3">
<h4 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h4>
<div class="paragraph">
<p>To run the example, you need to install the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Java</strong>: Version 17 or higher</p>
</li>
<li>
<p><strong>Container runtime</strong>: We have tested with Docker and Podman</p>
</li>
<li>
<p><strong>Maven</strong>: 3.8.x or higher</p>
</li>
<li>
<p><strong>Kind</strong>: For Kubernetes support. Note the example will only work with Kind. Other implementations, such as Minikube, need other tweaks than Kind.</p>
</li>
<li>
<p><strong>kubectl</strong>: Kind does not automatically install a kubectl for you.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deploying-and-running-the-example"><a class="anchor" href="#deploying-and-running-the-example"></a>Deploying and running the example</h4>
<div class="paragraph">
<p>From the <a href="https://github.com/a2aproject/a2a-java/tree/v0.3.1.Final/examples/cloud-deployment/scripts"><code>scripts\</code></a> folder, run either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>./deploy.sh</code>: if you use Docker</p>
</li>
<li>
<p><code>./deploy.sh --container-tool podman</code>: if you use Podman</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/scripts/deploy.sh"><code>deploy.sh</code></a> script will take care of everything for you, and deploy your application. This includes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating the Kind cluster with fully configured local registry support</p>
</li>
<li>
<p>Building the A2A Agent application image and pushing it to the registry</p>
</li>
<li>
<p>Install the Strimzi operator from <a href="https://strimzi.io/install/latest?namespace=kafka" class="bare">https://strimzi.io/install/latest?namespace=kafka</a></p>
</li>
<li>
<p>Deploy the files in the <a href="https://github.com/a2aproject/a2a-java/tree/v0.3.1.Final/examples/cloud-deployment/k8s">k8s/</a> directory ordered by their numerical prefix. These:</p>
<div class="ulist">
<ul>
<li>
<p>Configure the <code>a2a-demo</code> namespace for our application</p>
</li>
<li>
<p>Installs PostgreSQL needed for our <code>JPADatabaseTaskStore</code></p>
</li>
<li>
<p>Installs Kafka, using the Strimzi operator</p>
</li>
<li>
<p>Creates the Kafka topic our A2A Agent applications will use to replicate <code>EventQueue</code> events</p>
</li>
<li>
<p>Creates a <code>ConfigMap</code> containing database connection properties, kafka bootstrap servers and the URL of the Agent</p>
</li>
<li>
<p>Deploys our A2A Agent application</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of these steps take several minutes, so you need to be patient!</p>
</div>
<div class="paragraph">
<p>Once everything is up and running you will see a message like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=========================================
Deployment completed successfully!
=========================================

To verify the deployment, run:
  ./verify.sh

To access the agent (via NodePort):
  curl http://localhost:8080/.well-known/agent-card.json

To run the test client (demonstrating load balancing):
  cd ../server
  mvn test-compile exec:java -Dexec.classpathScope=test \
    -Dexec.mainClass="io.a2a.examples.cloud.A2ACloudExampleClient" \
    -Dagent.url="http://localhost:8080"</pre>
</div>
</div>
<div class="paragraph">
<p>Now that everything is deployed, simply copy the above command and run it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd ../server
$ mvn test-compile exec:java -Dexec.classpathScope=test \
    -Dexec.mainClass="io.a2a.examples.cloud.A2ACloudExampleClient" \
    -Dagent.url="http://localhost:8080"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should now see output like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=============================================
A2A Cloud Deployment Example Client
=============================================

Agent URL: http://localhost:8080
Process messages: 8
Message interval: 1500ms

Fetching agent card...
✓ Agent: Cloud Deployment Demo Agent
✓ Description: Demonstrates A2A multi-pod deployment with Kafka event replication, PostgreSQL persistence, and round-robin load balancing across Kubernetes pods

Client task ID: cloud-test-1761754920509

Creating streaming client for subscription...
Creating non-streaming client for sending messages...
✓ Clients created

Step 1: Sending 'start' to create task...
✓ Task created: 2b525ae8-0b2a-43c9-b2fa-007a8b618240
  State: SUBMITTED

Step 2: Subscribing to task for streaming updates...
✓ Subscribed to task updates

Step 3: Sending 8 'process' messages (interval: 1500ms)...
--------------------------------------------
  Artifact #1: Processed by a2a-agent-cb7fd769-5wr8g
    → Pod: a2a-agent-cb7fd769-5wr8g (Total unique pods: 1)
  Artifact #2: Processed by a2a-agent-cb7fd769-5wr8g
    → Pod: a2a-agent-cb7fd769-5wr8g (Total unique pods: 1)
✓ Process message 1 sent
✓ Process message 2 sent
  Artifact #3: Processed by a2a-agent-cb7fd769-x9tdm
    → Pod: a2a-agent-cb7fd769-x9tdm (Total unique pods: 2)
...
✓ Process message 8 sent
  Artifact #13: Processed by a2a-agent-cb7fd769-5wr8g
    → Pod: a2a-agent-cb7fd769-5wr8g (Total unique pods: 2)

Waiting for process artifacts to arrive...

Step 4: Sending 'complete' to finalize task...
  Artifact #14: Completed by a2a-agent-cb7fd769-5wr8g
    → Pod: a2a-agent-cb7fd769-5wr8g (Total unique pods: 2)
ℹ Subscription stream closed (expected after task completion)
✓ Complete message sent, task state: WORKING

Waiting for task to complete...
⚠ Timeout waiting for task completion

=============================================
Test Results
=============================================
Total artifacts received: 14
Unique pods observed: 2
Pod names and counts: {a2a-agent-cb7fd769-x9tdm=3, a2a-agent-cb7fd769-5wr8g=11}

✓ TEST PASSED - Successfully demonstrated multi-pod processing!
  Messages were handled by 2 different pods.
  This proves that:
    - Load balancing is working (round-robin across pods)
    - Event replication is working (subscriber sees events from all pods)
    - Database persistence is working (task state shared across pods)</pre>
</div>
</div>
<div class="paragraph">
<p>The source code for the client can be found in <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/server/src/test/java/io/a2a/examples/cloud/A2ACloudExampleClient.java"><code>A2ACloudExampleClient</code></a>.</p>
</div>
<div class="paragraph">
<p>We will not show the full source code here, but in a nutshell what the client does is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Fetch the <code>AgentCard</code> of our A2A Agent.</p>
</li>
<li>
<p>Send an initial <code>Message</code> containing a <code>TextPart</code> with the text <code>create</code>. We will see in the next section how the server uses this to create a new <code>Task</code>. This <code>Task</code> is then returned to the client, and on the server side the A2A Java SDK will create an entry in the <code>JPADatabaseTaskStore</code> for the <code>Task</code>, and also <code>ReplicatedQueueManager</code> makes sure that the <code>EventQueue</code> for the <code>Task</code> remains open since the <code>Task</code> is in a non-final state.</p>
</li>
<li>
<p>Calls <code>resubscribe()</code> for events to the <code>Task</code> we just created. The resulting subscription is kept open until the end TODO step. It does not matter if this call is handled on the same, or a different, node as in the previous step since the <code>TaskStore</code> is backed by a database, and <code>QueueManager</code> is replicated.</p>
</li>
<li>
<p>The client then sends several <code>process</code> <code>Message</code> s to the server. It creates a new connection each time. Since there are two pods, it is not deterministic which pod will handle the request. During the course of the full run, both pods should get invoked. Again, updates to the <code>Task</code> should be reflected in the database-backed <code>TaskStore</code> and all <code>Events</code> are replicated to all nodes.  On the server-side, an <code>Artifact</code> is added to the <code>Task</code> containing the name of the pod that processed the <code>Message</code>.</p>
</li>
<li>
<p>The subscriber from 3. outputs the messages as they come in, and keeps track of which nodes have been involved in processing <code>Message</code> s. The information about which node processed the message, is contained in the <code>Task</code> artifacts, as mentioned in the last point.</p>
</li>
<li>
<p>Finally, we send a <code>complete</code> <code>Message</code> to the A2A Agent, which puts the <code>Task</code> in a final state. This causes the <code>EventQueue</code> to be closed, which in turn causes the closure of the stream the client subscriber is subscribed to. Note that we receive the <code>Task</code> with this <code>completed</code> artifact from the server before the stream and subscription end.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The important thing to note, is that it does not matter which node the client subscription happens on, nor which nodes the messages are sent on. Since the <code>TaskStore</code> is persistent, and the <code>Event</code> s replicated, everything is received by the client as if there was only one A2A Agent node involved.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-server-part-of-the-application"><a class="anchor" href="#the-server-part-of-the-application"></a>The Server Part of the Application</h4>
<div class="paragraph">
<p>First let us look briefly at how the application has been written. As usual in an A2A application, you provide implementations of <code>AgentCard</code> and <code>AgentExecutor</code> via CDI.</p>
</div>
<div class="paragraph">
<p>Our <code>AgentCard</code> is provided by <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/server/src/main/java/io/a2a/examples/cloud/CloudAgentCardProducer.java"><code>CloudAgentCardProducer</code></a>. The most important parts are highlighted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class CloudAgentCardProducer {

    @ConfigProperty(name = "agent.url", defaultValue = "http://localhost:8080") <i class="conum" data-value="1"></i><b>(1)</b>
    String agentUrl;

    @Produces
    @PublicAgentCard
    public AgentCard agentCard() {
        return new AgentCard.Builder()
                .name("Cloud Deployment Demo Agent")
                .description("Demonstrates A2A multi-pod deployment with Kafka event replication, " +
                        "PostgreSQL persistence, and round-robin load balancing across Kubernetes pods")
                .url(agentUrl) <i class="conum" data-value="1"></i><b>(1)</b>
                .version("1.0.0")
                .capabilities(new AgentCapabilities.Builder()
                        .streaming(true) <i class="conum" data-value="2"></i><b>(2)</b>
                        .pushNotifications(false)
                        .stateTransitionHistory(false)
                        .build())
                .defaultInputModes(Collections.singletonList("text"))
                .defaultOutputModes(Collections.singletonList("text"))
                .skills(Collections.singletonList(
                        new AgentSkill.Builder()
                                .id("multi_pod_demo")
                                .name("Multi-Pod Replication Demo")
                                .description("Demonstrates cross-pod event replication. " + <i class="conum" data-value="3"></i><b>(3)</b>
                                        "Send 'start' to initialize, 'process' to add artifacts, " +
                                        "'complete' to finalize. Each artifact shows which pod processed it.")
                                .tags(List.of("demo", "cloud", "kubernetes", "replication"))
                                .examples(List.of(
                                        "start",
                                        "process",
                                        "complete"
                                ))
                                .build()
                ))
                .protocolVersion("0.3.0")
                .build();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The agent url is configurable, and is set by <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/k8s/05-agent-deployment.yaml#L53"><code>k8s/05-agent-deployment.yaml</code></a> referencing a value from the ConfigMap configured in <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/k8s/04-agent-configmap.yaml#L11"><code>k8s/04-agent-configmap.yaml</code></a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We have enabled streaming, since this is needed for the <code>resubscribe()</code> call done by the client</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Then we have a brief description of the <code>start</code>, <code>process</code> and <code>complete</code> 'commands' we saw the client send</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>AgentExecutor</code> is provided by <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/server/src/main/java/io/a2a/examples/cloud/CloudAgentExecutorProducer.java"><code>CloudAgentExecutorProducer</code></a> (some code has been removed to keep the example manageable):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class CloudAgentExecutorProducer {
   @Produces
    public AgentExecutor agentExecutor() {
        return new CloudAgentExecutor();
    }

    private static class CloudAgentExecutor implements AgentExecutor {

        @Override
        public void execute(RequestContext context, EventQueue eventQueue) throws JSONRPCError {
            TaskUpdater updater = new TaskUpdater(context, eventQueue); <i class="conum" data-value="1"></i><b>(1)</b>

            try {
                // Extract user message and normalize
                String messageText = extractTextFromMessage(context.getMessage()).trim().toLowerCase();
                // Get pod name from environment (set by Kubernetes Downward API)
                String podName = System.getenv("POD_NAME"); <i class="conum" data-value="2"></i><b>(2)</b>

                // Handle message based on command
                if (context.getTask() == null) { <i class="conum" data-value="3"></i><b>(3)</b>
                    // Initial message - create task in SUBMITTED → WORKING state
                    // This will have the `start` command
                    updater.submit();
                    updater.startWork();
                    String artifactText = "Started by " + podName;
                    List&lt;Part&lt;?&gt;&gt; parts = List.of(new TextPart(artifactText, null));
                    updater.addArtifact(parts);
                } else if ("complete".equals(messageText)) { <i class="conum" data-value="5"></i><b>(5)</b>
                    // Completion trigger - add final artifact and complete
                    String artifactText = "Completed by " + podName;
                    List&lt;Part&lt;?&gt;&gt; parts = List.of(new TextPart(artifactText, null));
                    updater.addArtifact(parts);
                    updater.complete();
                } else { <i class="conum" data-value="4"></i><b>(4)</b>
                    // Subsequent messages - add artifacts (fire-and-forget, stays in WORKING)
                    // This is for the `process` commands
                    String artifactText = "Processed by " + podName;
                    List&lt;Part&lt;?&gt;&gt; parts = List.of(new TextPart(artifactText, null));
                    updater.addArtifact(parts);
                    // No state change - task remains in WORKING
                    LOGGER.info("Artifact added on pod: {}", podName);
                }

            } catch (JSONRPCError e) {
                LOGGER.error("JSONRPC error processing task", e);
                throw e;
            } catch (Exception e) {
                LOGGER.error("Error processing task", e);
                throw new InternalError("Processing failed: " + e.getMessage());
            }
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A TaskUpdater is created with the <code>RequestContext</code> and the <code>EventQueue</code>. Note that even for new <code>Task`s, the framework will have created the `EventQueue</code> for us.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We get the name of the pod, as configured in <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/k8s/05-agent-deployment.yaml#L29"><code>k8s/05-agent-deployment.yaml</code></a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>start</code> command sent by the client ends up in this block. This makes a few calls to update the state of the <code>Task</code> using the <code>TaskUpdater</code>, and adds an <code>Artifact</code> indicating which pod started the <code>Task</code>. The <code>TaskUpdater</code> internally puts <code>Events</code> on the <code>EventQueue</code> after each of the calls on it, and the A2A Java SDK framework 'listens' to the queue, resulting in updates to the <code>Task</code> in the <code>TaskStore</code>, and sending results to any clients subscribed to the <code>Task</code> (or involved in making triggering this request). Since the <code>EventQueue</code> is replicated, the events are also pushed to other nodes in the cluster.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>process</code> messages end up in this block, which again add an <code>Artifact</code> to the <code>Task</code> via the <code>TaskUpdater</code>, which adds an <code>Event</code> to the queue. The <code>Event</code> is handled in the same way as in the above point.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>When a <code>complete</code> message is received, we add an <code>Artifact</code> to the <code>Task</code> using the <code>TaskUpdater</code>, indicating which pod is completing the <code>Task</code>, and finally use the <code>TaskUpdater</code> to set the <code>Task</code> state to <code>completed</code>. This again results in events on the <code>EventQueue</code>, which are handled as before. However, the update to a final state causes the <code>EventQueue</code> to be closed, which is also replicated to the other nodes.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-quarkus-for-a2a-with-replicatedqueuemanager-and-jpadatabasetaskstore"><a class="anchor" href="#configuring-quarkus-for-a2a-with-replicatedqueuemanager-and-jpadatabasetaskstore"></a>Configuring Quarkus for A2A with <code>ReplicatedQueueManager</code> and <code>JPADatabaseTaskStore</code></h4>
<div class="paragraph">
<p>The two main parts involved in configuring our application, are adding dependencies to the POM, and adding configuration via <code>application.properties.</code> We will look at the POM first, and then look at the configuration.</p>
</div>
<div class="sect4">
<h5 id="pom-dependencies"><a class="anchor" href="#pom-dependencies"></a>Pom Dependencies</h5>
<div class="paragraph">
<p>The full POM for the example can be found <a href="https://github.com/a2aproject/a2a-java/blob/v0.3.1.Final/examples/cloud-deployment/server/pom.xml">here</a>. We will talk about the most important dependencies below, step-by-step.</p>
</div>
<div class="paragraph">
<p>Since we are building a Quarkus based server, and for this case we only want the JSONRPC transport, we can include the following dependency which transitively includes everything else we need for our base A2A Agent server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;!-- Core A2A SDK with JSON-RPC transport. This pulls in the rest of the needed a2a-java dependencies --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.github.a2asdk&lt;/groupId&gt;
            &lt;artifactId&gt;a2a-java-sdk-reference-jsonrpc&lt;/artifactId&gt;
            &lt;version&gt;${sdk.version}&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then to override the standard <code>InMemoryTaskStore</code> with the <code>JpaDatabaseTaskStore</code>, and <code>InMemoryQueueManager</code> with <code>ReplicatedQueueManager</code> we include their modules</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;!-- Database-backed task store --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.github.a2asdk&lt;/groupId&gt;
            &lt;artifactId&gt;a2a-java-extras-task-store-database-jpa&lt;/artifactId&gt;
            &lt;version&gt;${sdk.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- Replicated queue manager core --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.github.a2asdk&lt;/groupId&gt;
            &lt;artifactId&gt;a2a-java-queue-manager-replicated-core&lt;/artifactId&gt;
            &lt;version&gt;${sdk.version}&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ReplicatedQueueManager</code> needs a <code>ReplicationStrategy</code>. Our <code>ReactiveMessagingReplicationStrategy</code> is implemented by this module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;!-- Provides the MicroProfile Reactive Messaging ReplicationStrategy for the replicated queue manager--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.github.a2asdk&lt;/groupId&gt;
            &lt;artifactId&gt;a2a-java-queue-manager-replication-mp-reactive&lt;/artifactId&gt;
            &lt;version&gt;${sdk.version}&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will configure the <code>ReactiveMessagingReplicationStrategy</code> to use Kafka later, so we need the dependency to use Kafka with MicroProfile Reactive Messaging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;!--
            MicroProfile Reactive Messaging support including the Kafka connector, used by the MP RM
            ReplicationStrategy
        --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
            &lt;artifactId&gt;quarkus-messaging-kafka&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the <code>JpaDatabaseTaskStore</code>, we need to add Hibernate, which provides the JPA functionality. Since our example uses PostgreSQL, we include its driver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;!-- Quarkus Hibernate ORM --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
            &lt;artifactId&gt;quarkus-hibernate-orm&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- PostgreSQL JDBC driver --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
            &lt;artifactId&gt;quarkus-jdbc-postgresql&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, since we will be deploying our A2A agent in Kubernetes, which uses readiness and liveness probes, we add the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;!-- Quarkus Health checks --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
            &lt;artifactId&gt;quarkus-smallrye-health&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it for the POM dependencies!</p>
</div>
<div class="paragraph">
<p>Additionally, the POM contains the <code>quarkus-maven-plugin</code>, used to build the Quarkus server. This has no special configuration, so see the POM for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="configuration-in-application-properties"><a class="anchor" href="#configuration-in-application-properties"></a>Configuration in application.properties</h5>
<div class="paragraph">
<p>The final piece of the puzzle is configuring the A2A Agent Quarkus application in its <a href="https://github.com/a2aproject/a2a-java/blob/main/examples/cloud-deployment/server/src/main/resources/application.properties"><code>application.properties</code></a>. Again, let&#8217;s discuss the contents in chunks.</p>
</div>
<div class="paragraph">
<p>First we have some simple properties, setting the <code>agent.url</code> to use in the <code>CloudAgentCardProducer</code>. We also define the location of the health endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># Agent Configuration
agent.url=${AGENT_URL:http://localhost:8080} <i class="conum" data-value="1"></i><b>(1)</b>

# Health checks
quarkus.smallrye-health.root-path=/health <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>AGENT_URL</code> comes from <a href="https://github.com/a2aproject/a2a-java/blob/main/examples/cloud-deployment/k8s/05-agent-deployment.yaml#L53"><code>05-agent-deployment.yaml</code></a>, which in turn references the value defined in <a href="https://github.com/a2aproject/a2a-java/blob/main/examples/cloud-deployment/k8s/04-agent-configmap.yaml#L11"><code>04-agent-configmap.yaml</code></a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The endpoint matches what is expected by the readiness and liveness probes in <a href="https://github.com/a2aproject/a2a-java/blob/main/examples/cloud-deployment/k8s/05-agent-deployment.yaml#L65-L80"><code>05-agent-deployment.yaml</code></a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we define the database used by our <code>JpaDatabaseTaskStore</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># Database Configuration (PostgreSQL)
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/a2a} <i class="conum" data-value="1"></i><b>(1)</b>
quarkus.datasource.username=${DATABASE_USER:a2a}
quarkus.datasource.password=${DATABASE_PASSWORD:a2a}
quarkus.datasource.jdbc.max-size=16</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>DATABASE_URL</code>, <code>DATABASE_USER</code> and <code>DATABASE_PASSWORD</code> environment variables used are defined in <code>04-agent-configmap.yaml</code> and exposed to the application via <code>05-agent-deployment.yaml</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next we have the configuration of the <code>a2a-java</code> JPA persistence unit, which is used by <code>JpaDatabaseTaskStore</code> and <code>JpaPushNotificationConfigStore</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># Hibernate ORM - Configure persistence unit "a2a-java"
quarkus.hibernate-orm."a2a-java".datasource=&lt;default&gt;
quarkus.hibernate-orm."a2a-java".database.generation=update
quarkus.hibernate-orm."a2a-java".log.sql=false
quarkus.hibernate-orm."a2a-java".packages=io.a2a.extras.taskstore.database.jpa,io.a2a.extras.pushnotificationconfigstore.database.jpa</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we have the MicroProfile Reactive Messaging configuration, which maps our channels to Kafka. For more information about how MicroProfile Reactive Messaging works in Quarkus, see this <a href="https://quarkus.io/guides/kafka-getting-started">guide</a>.</p>
</div>
<div class="paragraph">
<p>Under the hood, the <code>ReactiveMessagingReplicationStrategy</code> uses MicroProfile Reactive Messaging. It uses an <code>Emitter</code> writing to a channel called <code>replicated-events-out</code>, and has an <code>@Incoming</code> annotated method receiving events from a channel called <code>replicated-events-in</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># Kafka Configuration for Event Replication
kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092} <i class="conum" data-value="1"></i><b>(1)</b>

# MicroProfile Reactive Messaging - Outgoing (Publish to Kafka)
mp.messaging.outgoing.replicated-events-out.connector=smallrye-kafka <i class="conum" data-value="2"></i><b>(2)</b>
mp.messaging.outgoing.replicated-events-out.topic=a2a-replicated-events
mp.messaging.outgoing.replicated-events-out.value.serializer=org.apache.kafka.common.serialization.StringSerializer

# MicroProfile Reactive Messaging - Incoming (Subscribe from Kafka)
mp.messaging.incoming.replicated-events-in.connector=smallrye-kafka <i class="conum" data-value="2"></i><b>(2)</b>
mp.messaging.incoming.replicated-events-in.topic=a2a-replicated-events
# Each pod needs a unique consumer group to receive ALL events (broadcast behavior)
# Using POD_NAME from Kubernetes Downward API ensures each instance gets its own group
mp.messaging.incoming.replicated-events-in.group.id=a2a-cloud-${POD_NAME:local} <i class="conum" data-value="3"></i><b>(3)</b>
mp.messaging.incoming.replicated-events-in.value.deserializer=org.apache.kafka.common.serialization.StringDeserializer
mp.messaging.incoming.replicated-events-in.auto.offset.reset=earliest</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>KAFKA_BOOTSTRAP_SERVERS</code> is defined in <code>04-agent-configmap.yaml</code> and exposed to the application via <code>05-agent-deployment.yaml</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Both the <code>replicated-events-out</code> and <code>replicated-events-in</code> channels use the Kafka connector, send/receive on the same Kafka topic, and (de)serialize <code>String</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>POD_NAME</code> is exposed to the application in <code>05-agent-deployment.yaml</code>, which obtains it from the Kubernetes metadata. This has the effect of setting a unique groupId, so that all pods in the cluster receive the replicated events.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simple in-memory of the components shown are great for getting up and running fast. However, to work in an enterprise, distributed, or cloud environment we need to replace these components to use shared state, in order to survive server reboots and have replication between A2A Agent instances.</p>
</div>
<div class="sect2">
<h3 id="further-reading"><a class="anchor" href="#further-reading"></a>Further Reading</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://quarkus.io/blog/quarkus-a2a-java-0-3-0-alpha-release/">Getting Started with Quarkus and A2A Java SDK 0.3.0</a></p>
</li>
<li>
<p><a href="https://quarkus.io/blog/quarkus-a2a-java-0-3-0-beta-release/">A2A Java SDK: Support for the REST Transport is Now Here</a></p>
</li>
<li>
<p><a href="https://quarkus.io/blog/quarkus-a2a-java-grpc/">Getting Started with A2A Java SDK and gRPC</a></p>
</li>
<li>
<p><a href="https://github.com/a2aproject/a2a-samples/tree/main/samples/java/agents">A2A Java SDK Samples</a></p>
</li>
<li>
<p><a href="https://github.com/a2aproject/a2a-java/blob/main/README.md">A2A Java SDK Documentation</a></p>
</li>
<li>
<p><a href="https://a2a-protocol.org/latest/specification/">A2A Specification</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/quarkus-a2a-cloud-enhancements/&title=How to Use Your A2A Server Agent in a Distributed or Cloud Native Environment" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fa-brands fa-linkedin fa-xl"></i>
  </a>
  <a class="share-x" href="https://x.com/intent/tweet?text=How to Use Your A2A Server Agent in a Distributed or Cloud Native Environment&url=https://quarkus.io/blog/quarkus-a2a-cloud-enhancements/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on X">
    <i class="fa-brands fa-square-x-twitter fa-xl"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/quarkus-a2a-cloud-enhancements/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fa-brands fa-square-facebook fa-xl"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/quarkus-a2a-cloud-enhancements/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fa-brands fa-square-reddit fa-xl"></i>
  </a>
  <a class="share-email" href="mailto:?subject=How to Use Your A2A Server Agent in a Distributed or Cloud Native Environment&amp;body=How to Use Your A2A Server Agent in a Distributed or Cloud Native Environment https://quarkus.io/blog/quarkus-a2a-cloud-enhancements/" title="Share via Email" >
    <i class="fa-solid fa-envelope fa-xl"></i>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
