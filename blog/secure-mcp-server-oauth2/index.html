<!DOCTYPE html>
<html lang="en">







<head>
  <title>Use MCP OAuth2 Flow to access Quarkus MCP Server - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com https://ajax.googleapis.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />

  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/secure-mcp-server-oauth2/" />
  <meta property="og:title" content="Use MCP OAuth2 Flow to access Quarkus MCP Server" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/secure-mcp-server-oauth2/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/blog/secure-mcp-server-oauth2/" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/blog/secure-mcp-server-oauth2/" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/blog/secure-mcp-server-oauth2/" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/blog/secure-mcp-server-oauth2/" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/blog/secure-mcp-server-oauth2/" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="post">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="active">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/blog/secure-mcp-server-oauth2/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/blog/secure-mcp-server-oauth2/">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/blog/secure-mcp-server-oauth2/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/blog/secure-mcp-server-oauth2/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/blog/secure-mcp-server-oauth2/">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> Use MCP OAuth2 Flow to access Quarkus MCP Server</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          September 22, 2025 
          
            <span class="tags"><a href="/blog/tag/ai">#ai</a><a href="/blog/tag/mcp">#mcp</a><a href="/blog/tag/security">#security</a></span>
          
        </div>
        <h1 class="post-title">Use MCP OAuth2 Flow to access Quarkus MCP Server</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            <p class="byline">
              By 
              
              

              
              
              
                
                
                
                  <img class="headshot" src="https://www.gravatar.com/avatar/7941c5788c2e02a4f7f51409afca3090">
                
                  <a href="/author/sberyozkin">Sergey Beryozkin</a>
                  
              
            </p>
          </div>
          <div class="width-12-12">
              <div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Back in April 2025, in the <a href="https://quarkus.io/blog/secure-mcp-sse-server/">Getting ready for secure MCP with Quarkus MCP Server</a> blog post, we explained how to enforce MCP client authentication with the <a href="https://github.com/quarkiverse/quarkus-mcp-server">Quarkus MCP Server</a> by configuring it to verify bearer access tokens.</p>
</div>
<div class="paragraph">
<p>At the time, we worked against the <a href="https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization">old 2025-03-26 version of the MCP Authorization specification</a> that expected compliant MCP servers to manage OAuth2 flows themselves either directly or via the delegation, with that idea being disputed due to its complexity, and with no MCP clients providing the OAuth2 authorization code flow support being available. Therefore, in the <a href="https://quarkus.io/blog/secure-mcp-sse-server/">Getting ready for secure MCP with Quarkus MCP Server</a> blog post, the access tokens were acquired out of band: we used <a href="https://quarkus.io/guides/security-openid-connect-dev-services">Keycloak DevUI</a> to get an access token and copy it to <a href="https://quarkus.io/blog/secure-mcp-sse-server/#mcp-server-devui">MCP Server DevUI</a> to test it in devmode, and did a GitHub login to the Quarkus REST endpoint in order to copy and test a GitHub access token with both <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> and <code>curl</code> in prod mode.</p>
</div>
<div class="paragraph">
<p>The <a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization">latest 2025-03-26 version of the MCP Authorization specification</a> offers a simpler, better version of how OAuth2 must be supported in MCP. The focus has shifted to MCP clients that are now expected to drive the OAuth2 flows, while MCP servers are only required to support automating such flows by providing <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a>, as well as correctly verifying the actual access tokens.</p>
</div>
<div class="paragraph">
<p>In this blog post, we will explain how MCP clients compliant with the <a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization">latest 2025-03-26 version of the MCP Authorization specification</a> can login users using an OAuth2 authorization code flow, acquire access tokens and use them to access secure Quarkus MCP <em>Streamable HTTP</em> servers on behalf of the logged-in users.</p>
</div>
<div class="paragraph">
<p>Currently, <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> offers the most advanced, adaptable, and accessible MCP OAuth2 authorization code flow support, even if somewhat unstable between its different versions, and therefore we will work with it in this post. You are welcome to experiment with other MCP client implementations.</p>
</div>
<div class="paragraph">
<p>We will demonstrate a great <a href="https://docs.quarkiverse.io/quarkus-mcp-server/dev/index.html#_multiple_server_configurations">Quarkus MCP Server capability to support multiple MCP HTTP configurations</a>, each one with their own unique OAuth2 or OpenId Connect security constraints, effectively allowing for a multi-tenant security control of tools, prompts and resources.</p>
</div>
<div class="paragraph">
<p><a href="https://www.keycloak.org/">Keycloak</a> will be used to support two distint security realms, with the security of each of the MCP HTTP configurations controlled by its own Keycloak realm. You are welcome to try to secure Quarkus MCP Server with other preferred OAuth2 or OpenID Connect providers by replacing the Keycloak specific configurations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="demo-flow-diagram"><a class="anchor" href="#demo-flow-diagram"></a>Demo MCP OAuth2 Flow Diagram</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can read all about the MCP OAuth2 Authorization Flow in the <a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization#authorization-flow">Authorization Flow section of the latest specification</a>.</p>
</div>
<div class="paragraph">
<p>In this section, we are going to have a look at a simplified diagram showing how <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> can use OAuth 2.0 Flow to login a user to Keycloak, get an access token and use it to access a secure Quarkus MCP Server endpoint.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/demo_flow_diagram.png" alt="Demo Flow Diagram">
</div>
</div>
<div class="paragraph">
<p>MCP Client such as <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> requires configuring an MCP <em>Streamable HTTP</em> endpoint URL, OAuth2 Client ID, and optional scopes to access the MCP server securely. And as you can see, a lot happens from the moment you press <code>Connect</code> until a valid access token is sent to the MCP server.</p>
</div>
<div class="paragraph">
<p>MCP Client starts by accessing the MCP server without a token and gets back HTTP 401 with a <code>WWW-Authenticate</code> <code>resource_metadata</code> parameter that links to the MCP server&#8217;s <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a> route. The client now fetches a base URL of the Keycloak realm that secures the MCP server as well as the MCP server&#8217;s resource identifier.</p>
</div>
<div class="paragraph">
<p>Next, MCP Client uses the Keycloak realm&#8217;s URL to discover this realm&#8217;s authorization and token endpoint URLs, supported <a href="https://www.rfc-editor.org/rfc/rfc7636">Proof Key for Code Exchange</a> (PKCE) methods, and other metadata properties.</p>
</div>
<div class="paragraph">
<p>The user is now redirected to Keycloak to login into the required realm. The Keycloak redirect URL includes the configured OAuth2 client id, scopes, callback URI which points to the <code><a href="http://localhost:6274/oauth/callback" class="bare">http://localhost:6274/oauth/callback</a></code> endpoint managed by the MCP client, as well as the earlier discovered MCP Server&#8217;s resource identifier as an <a href="https://www.rfc-editor.org/rfc/rfc8707.html">OAuth2 Resource Indicator</a>. Generated PKCE code challenge and state parameters are also included in the redirect.</p>
</div>
<div class="paragraph">
<p>The user logs in, is redirected back to the <code><a href="http://localhost:6274/oauth/callback" class="bare">http://localhost:6274/oauth/callback</a></code> endpoint, MCP client exchanges the returned <code>code</code> to get ID and access tokens, and uses the access token to access the MCP server, allowing the user to select and run the tool.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization">MCP Authorization Specification</a> also recommends that MCP clients support <a href="https://datatracker.ietf.org/doc/html/rfc7591">OAuth2 Dynamic Client Registration</a> and <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> does support it.</p>
</div>
<div class="paragraph">
<p>In this post, we are only going to look at a case where OAuth2 Client ID is already known in advance, which is likely to be a typical case in production where OIDC client applications are created in advance.</p>
</div>
<div class="paragraph">
<p>We will also look at how <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> does <a href="https://datatracker.ietf.org/doc/html/rfc7591">OAuth2 Dynamic Client Registration</a> in the next post in this MCP Security series.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization#authorization-flow">MCP Authorization Flow</a> is rather neatly defined, requiring the use of such OAuth2 specifications as <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a>, <a href="https://www.rfc-editor.org/rfc/rfc8707.html">OAuth2 Resource Indicator</a>, and also recommending the use of <a href="https://datatracker.ietf.org/doc/html/rfc7591">OAuth2 Dynamic Client Registration</a>.</p>
</div>
<div class="paragraph">
<p>Please note though that the actual flow is not that unique to the MCP Authorization. It is a typical Single-page application (SPA) OAuth2 authorization code flow in action:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/typical_spa_oauth2_flow.png" alt="Typical SPA OAuth2 Flow">
</div>
</div>
<div class="paragraph">
<p>SPA uses a provider such as Keycloak to login users and use acquired access tokens to access Quarkus Service on their behalf - typical OAuth2 done at the SPA level. In this diagram, you can replace <code>SPA</code> with <code>MCP Client</code>, <code>Quarkus Service</code> with <code>MCP Server</code> and you&#8217;ll get a close enough match with the demo flow diagram in the previous image.</p>
</div>
<div class="paragraph">
<p>The comparison between the <a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization">MCP Authorization</a> and SPA OAuth2 flows implies that the <a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization">MCP Authorization specification</a> targets generic SPA AI and MCP client applications such as <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a>, Claude AI, Cursor, and others that can plugin MCP servers. It does not currently apply to Quarkus MCP Client which typically runs in scope of the higher-level Quarkus LangChain4j server application with its own authentication requirements, you can read more about it in the <a href="https://quarkus.io/blog/secure-mcp-client/#demo-architecture">Use Quarkus MCP client to access secure MCP HTTP servers</a> blog post.</p>
</div>
<div class="paragraph">
<p>We are now ready to have a look at how it works in the demo.</p>
</div>
<div class="paragraph">
<p>You can find the complete project source in the <a href="https://github.com/quarkiverse/quarkus-mcp-server/tree/main/samples/multiple-secure-mcp-http-servers">Multiple Secure Quarkus MCP HTTP Servers sample</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-mcp-server"><a class="anchor" href="#create-mcp-server"></a>Step 1 - Create and start MCP server with two secure Streamable HTTP endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, let&#8217;s create a secure Quarkus MCP server and configure two <em>Streamable HTTP</em> endpoints with their own unique security authentication controls.</p>
</div>
<div class="sect2">
<h3 id="mcp-server-dependencies"><a class="anchor" href="#mcp-server-dependencies"></a>MCP server maven dependencies</h3>
<div class="paragraph">
<p>Add the following dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkiverse.mcp&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-mcp-server-sse&lt;/artifactId&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;version&gt;1.5.3&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-oidc&lt;/artifactId&gt; <i class="conum" data-value="2"></i><b>(2)</b>
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>quarkus-mcp-server-sse</code> is required to support both MCP Streamable HTTP and SSE transports.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>quarkus-oidc</code> is required to secure access to MCP Server endpoints. Its version is defined in the Quarkus BOM.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="mcp-server-configuration"><a class="anchor" href="#mcp-server-configuration"></a>MCP Server Configuration</h3>
<div class="paragraph">
<p>Let&#8217;s configure the MCP server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># First and default MCP server endpoint that we refer to as `alpha`
# Alternatively, we can have a named `alpha` endpoint, similarly to the second `bravo` endpoint

quarkus.mcp.server.sse.root-path=/mcp <i class="conum" data-value="1"></i><b>(1)</b>

# Second MCP server endpoint that is explicitly named as `bravo`

quarkus.mcp.server.bravo.sse.root-path=/bravo/mcp <i class="conum" data-value="2"></i><b>(2)</b>

# Require an authenticated access to both Streamable HTTP endpoints

quarkus.http.auth.permission.authenticated.paths=/mcp/*,/bravo/mcp/* <i class="conum" data-value="3"></i><b>(3)</b>
quarkus.http.auth.permission.authenticated.policy=authenticated

# Default OIDC tenant that secures the default `alpha` Streamable HTTP endpoint
# Its required `quarkus.oidc.auth-server-url` property is set by Keycloak Dev Service
# and points to the Keycloak `alpha` realm endpoint

quarkus.oidc.tenant-paths=/mcp/* <i class="conum" data-value="4"></i><b>(4)</b>
quarkus.oidc.token.audience=quarkus-mcp-alpha <i class="conum" data-value="5"></i><b>(5)</b>
quarkus.oidc.resource-metadata.enabled=true <i class="conum" data-value="6"></i><b>(6)</b>
quarkus.oidc.resource-metadata.force-https-scheme=false

# `Bravo` OIDC tenant that secures the `bravo` Streamable HTTP endpoint

quarkus.oidc.bravo.auth-server-url=${keycloak.url}/realms/bravo <i class="conum" data-value="7"></i><b>(7)</b>
quarkus.oidc.bravo.tenant-paths=/bravo/mcp/* <i class="conum" data-value="7"></i><b>(7)</b>
quarkus.oidc.bravo.token.audience=quarkus-mcp-bravo <i class="conum" data-value="8"></i><b>(8)</b>
quarkus.oidc.bravo.resource-metadata.enabled=true <i class="conum" data-value="9"></i><b>(9)</b>
quarkus.oidc.bravo.resource-metadata.resource=bravo/mcp <i class="conum" data-value="10"></i><b>(10)</b>
quarkus.oidc.bravo.resource-metadata.force-https-scheme=false

# Keycloak devservice that supports both the default and `bravo` OIDC tenants.

quarkus.keycloak.devservices.realm-path=alpha-realm.json,bravo-realm.json <i class="conum" data-value="11"></i><b>(11)</b>
quarkus.keycloak.devservices.realm-name=alpha <i class="conum" data-value="12"></i><b>(12)</b>
quarkus.keycloak.devservices.create-client=false <i class="conum" data-value="13"></i><b>(13)</b>

# CORS configuration to allow MCP Inspector's SPA script calls

quarkus.http.cors.enabled=true
quarkus.http.cors.origins=http://localhost:6274 <i class="conum" data-value="14"></i><b>(14)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Root path for the default <code>alpha</code> MCP server endpoint, with both <em>Streamable HTTP</em> and SSE endpoints available under this path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Root path for the <code>bravo</code> MCP server endpoint, with both <em>Streamable HTTP</em> and SSE endpoints available under this path.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Require authentication for all requests to the <code>alpha</code> and <code>bravo</code> MCP server endpoints. This authentication policy is enforced by the matching OIDC tenant configurations.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Default OIDC tenant secures the default MCP server <code>alpha</code> endpoint, Keycloak DevService inserts a missing <code>quarkus.oidc.auth-server-url</code> property that links to the Keycloak <code>alpha</code> realm endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Require that tokens that are allowed to access the default MCP server <code>alpha</code> endpoint must have an audience (<code>aud</code>) claim that contains a <code>quarkus-mcp-alpha</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Enable the <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a> route for the default OIDC tenant. It will help <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> to find out about the authorization server that secures the default MCP server <code>alpha</code> endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>OIDC <code>bravo</code> tenant secures the MCP server <code>bravo</code> endpoint. Its <code>quarkus.oidc.bravo.auth-server-url</code> property links to the Keycloak <code>bravo</code> realm endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Require that tokens that are allowed to access the MCP server <code>bravo</code> endpoint must have an audience (<code>aud</code>) claim that contains a <code>quarkus-mcp-bravo</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Enable the <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a> route for the OIDC <code>bravo</code> tenant. It will help <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> to find out about the the authorization server that secures the MCP server <code>bravo</code> endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Customize the relative path for <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a> route for the OIDC <code>bravo</code> tenant. By default, it is <code><a href="http://localhost:8080/bravo" class="bare">http://localhost:8080/bravo</a></code>, however, <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> can not find this route and expects <code><a href="http://localhost:8080/bravo/mcp" class="bare">http://localhost:8080/bravo/mcp</a></code>, so we just tune it a bit to make <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> happy.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Ask Keycloak DevService to upload two realms to the Keycloak container, <code>alpha-realm.json</code> and <code>bravo-realm.json</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Keycloak DevService must set the default OIDC tenant properies, we point to <code>alpha-realm.json</code> for Keycloak DevService to use it to set properties such as <code>quarkus.oidc.auth-server-url</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Ask Keycloak not to add <code>quarkus.oidc.client-id</code>. Using the realm verification keys, the configured audience, expiry checks is sufficient to verify Keycloak JWT access tokens; we also plan to deal with dynamically registered OIDC clients in the next blog post.</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Allow <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> CORS requests.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can read about how <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a> is supported in Quarkus OIDC in the <a href="https://quarkus.io/guides/security-oidc-expanded-configuration#resource-metadata-properties">Expanded OpenId Connect Configuration guide</a>.</p>
</div>
<div class="paragraph">
<p>The Keycloak <code>alpha</code> and <code>bravo</code> realms represent unique, non-intersecting security configurations backed up by Keycloak. Both of these realms are represented by default and <code>bravo</code> OIDC tenants respectively. Quarkus OIDC uses its <a href="https://quarkus.io/guides/security-openid-connect-multitenancy#configure-tenant-paths">path-based tenant resolver</a> to decide which OIDC tenant should handle the current MCP Server request.</p>
</div>
<div class="paragraph">
<p>You are welcome to update the default and <code>bravo</code> OIDC tenant configurations to point to your preferred providers instead of Keycloak, for example, to multiple Entra ID or Auth0 tenants, etc.</p>
</div>
<div class="paragraph">
<p>Please also check the <a href="#keycloak-vs-github">Why was Keycloak preferred to GitHub in the demo ?</a> section about the reasons behind preferring to use Keycloak in this demo, instead of GitHub that was used in the earlier <a href="https://quarkus.io/blog/secure-mcp-sse-server/">Getting ready for secure MCP with Quarkus MCP Server</a> blog post.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization">MCP Authorization specification</a> <a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization#token-audience-binding-and-validation">requires</a> that the token audience is validated. The specification prefers <a href="https://www.rfc-editor.org/rfc/rfc8707.html">OAuth2 Resource Indicators</a> to control the token audience.</p>
</div>
<div class="paragraph">
<p>For example, by default, the resource identifier of the default MCP server <code>alpha</code> endpoint is calculated as <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code> and MCP Inspector includes it as a <a href="https://www.rfc-editor.org/rfc/rfc8707.html">OAuth2 Resource Indicator</a> <code>resource</code> parameter in the Keycloak redirect URL. The providers that already support the <a href="https://www.rfc-editor.org/rfc/rfc8707.html">OAuth2 Resource Indicator</a> specification can add the <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code> resource indicator to the access token&#8217;s audience (<code>aud</code>) claim.</p>
</div>
<div class="paragraph">
<p>Keycloak does not support the <a href="https://www.rfc-editor.org/rfc/rfc8707.html">OAuth2 Resource Indicator</a> specification yet therefore we configure Keycloak to use predefined audience values specific to MCP server <code>alpha</code> and <code>bravo</code> endpoints. For our demo, the use of the custom audience values is non-ambiguous and sufficient.</p>
</div>
<div class="paragraph">
<p>When your OAuth2 provider start supporting the <a href="https://www.rfc-editor.org/rfc/rfc8707.html">OAuth2 Resource Indicator</a> specification, all you need to do to align with the <a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization">MCP Authorization specification</a>'s requirement to use resource indicators is to update the OIDC tenant token audience configuration to contain an audience such as <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>.</p>
</div>
<div class="paragraph">
<p>You can also harden it by requiring a token to have both a custom audience value such as <code>quarkus-mcp-alpha</code> and a resource value such as <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="mcp-server-tools"><a class="anchor" href="#mcp-server-tools"></a>MCP User Name Provider tools</h3>
<div class="paragraph">
<p>MCP Server has two <em>Streamable HTTP</em> endpoints. The MCP and security configuration for each of these endpoints allows to group tools, resources and prompts according to specific deployment requirements.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create two tools that can return a name of the current MCP Client user, one per each endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

import io.quarkiverse.mcp.server.TextContent;
import io.quarkiverse.mcp.server.Tool;
import io.quarkus.oidc.UserInfo;
import io.quarkus.security.identity.SecurityIdentity;
import jakarta.inject.Inject;
import io.quarkiverse.mcp.server.McpServer;

public class ServerFeatures {

    @Inject
    SecurityIdentity identity; <i class="conum" data-value="1"></i><b>(1)</b>

    @Tool(name = "alpha-user-name-provider", description = "Provides a name of the current user in the Alpha realm") <i class="conum" data-value="2"></i><b>(2)</b>
    TextContent provideUserName() {
        return new TextContent(identity.getPrincipal().getName());
    }

    @Tool(name = "bravo-user-name-provider", description = "Provides a name of the current user in the Bravo realm") <i class="conum" data-value="3"></i><b>(3)</b>
    @McpServer("bravo")
    TextContent provideUserName2() {
        return new TextContent(identity.getPrincipal().getName());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Capture a security identity represented by the verified access token</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>alpha-user-name-provider</code> tool is accessible via the default <em>Streamable HTTP</em> <code>alpha</code> endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>bravo-user-name-provider</code> tool is accessible via the <code>bravo</code> <em>Streamable HTTP</em> endpoint.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Both the <code>alpha-user-name-provider</code> and <code>bravo-user-name-provider</code> tools are very simple tools designed to show that the identities of MCP client users on whose behalf these tools are called by MCP clients is available to tools to perform a user identity specific action, an important element for a secure agentic AI system. Of course, the real world tool implementations will be more interesting.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="keycloak-configuration"><a class="anchor" href="#keycloak-configuration"></a>Keycloak Configuration</h3>
<div class="paragraph">
<p>The Keycloak configuration has already been prepared in the <code>alpha-realm.json</code> and <code>bravo-realm.json</code> realm files that Keycloak DevService uploads to Keycloak at the start-up time.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a closer look. Please go to <code><a href="http://localhost:8080/q/dev-ui" class="bare">http://localhost:8080/q/dev-ui</a></code> and select an <code>OpenId Connect</code> card:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/keycloak_admin.png" alt="Keycloak Admin">
</div>
</div>
<div class="paragraph">
<p>Click on <code>Keycloak Admin</code>, login as <code>admin:admin</code> and check the <code>alpha</code> and <code>bravo</code> realm configurations.</p>
</div>
<div class="paragraph">
<p>The <code>alpha-realm.json</code> has a single <code>alpha-client</code> client and a single user, <code>alice</code> with a password <code>alice</code>.</p>
</div>
<div class="paragraph">
<p>The <code>alpha-client</code> is a public client because its <code>Client authentication</code> option is disabled:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/keycloak_public_client_capability.png" alt="Public Keycloak Client">
</div>
</div>
<div class="paragraph">
<p>Typically, public SPA applications work with the public clients, to avoid having to deal with managing the confidential client&#8217;s secret.</p>
</div>
<div class="paragraph">
<p>The <code>alpha-client</code> is configured to support a callback URL provided by <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a>:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/keycloak_alpha_client_general_settings.png" alt="Keycloak Alpha Client settings">
</div>
</div>
<div class="paragraph">
<p>The <code>alpha-realm.json</code> also has a custom <code>quarkus-mcp-alpha</code> client scope with an audience mapping, and it is assigned to the <code>alfa-client</code> client. It was done similarly to how it was done in the <a href="https://quarkus.io/blog/secure-mcp-oidc-client/#keycloak-setup">Use Quarkus MCP client to access secure MCP HTTP server from command line</a> blog post. We start with creating a <code>quarkus-mcp-server</code> client scope:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/keycloak_quarkus_mcp_alpha_scope.png" alt="Keycloak Client quarkus-mcp-alpha scope">
</div>
</div>
<div class="paragraph">
<p>Next, we create an audience mapping for this scope:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/keycloak_quarkus_mcp_alpha_scope_mapping.png" alt="Keycloak Client quarkus-mcp-alpha scope mapping">
</div>
</div>
<div class="paragraph">
<p>Finally, we assign this client scope as an optional scope to the <code>alpha-client</code> client:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/keycloak_alpha_client_scope.png" alt="Keycloak alpha-client scope assignment">
</div>
</div>
<div class="paragraph">
<p>Similarly, the <code>bravo-realm.json</code> has a public <code>bravo-client</code> client, and a single user, <code>jdoe</code> with a password <code>jdoe</code>. It also has a custom <code>quarkus-mcp-bravo</code> client scope with an audience mapping.</p>
</div>
<div class="paragraph">
<p>Both realms have the client scopes with the audience mappings to let users request the correct token audience by configuring a custom scope in the <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a>'s OAuth2 Flow configuration. As implied in the <a href="#mcp-server-configuration">MCP Server Configuration</a>, it will be no longer necessary once the <a href="https://www.rfc-editor.org/rfc/rfc8707.html">OAuth2 Resource Indicator</a> specification is supported by Keycloak and other providers.</p>
</div>
<div class="sect3">
<h4 id="keycloak-vs-github"><a class="anchor" href="#keycloak-vs-github"></a>Why was Keycloak preferred to GitHub in the demo ?</h4>
<div class="paragraph">
<p>You may be wondering, why did we choose <code>Keycloak</code> for this demo, instead of <code>GitHub</code> that we used in the earlier <a href="https://quarkus.io/blog/secure-mcp-sse-server/">Getting ready for secure MCP with Quarkus MCP Server</a> blog post ?</p>
</div>
<div class="paragraph">
<p>The main reason behind this is that the access tokens that are targeting MCP servers are expected to be designed to target MCP servers only. It is a good OAuth2 security recommendation. GitHub access tokens are meant to be used to access GitHub API, on behalf of the logged-in user, at the point where the login has happened, not via an MCP server indirection. For example, Claude AI offers a direct GitHub MCP integration.</p>
</div>
<div class="paragraph">
<p>This consideration applies to other social providers such as Google.</p>
</div>
<div class="paragraph">
<p>It is formally expressed in the <a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization#access-token-privilege-restriction">MCP Authorization Access Token Privilege Restriction section</a>: <code>MCP servers MUST only accept tokens specifically intended for themselves&#8230;&#8203;</code>.</p>
</div>
<div class="paragraph">
<p>We also discussed it in the <a href="https://quarkus.io/blog/secure-mcp-client/#access-token-delegation-considerations">Access Token Delegation Considerations</a> section of the <a href="https://quarkus.io/blog/secure-mcp-client">Use Quarkus MCP client to access secure MCP HTTP servers</a> blog post.</p>
</div>
<div class="paragraph">
<p>If your MCP server really needs to accept a token that it will not use itself, for example, in order to forward it further downstream, then consider an option of exchanging tokens for the audiences to be correct through the whole distributed token call chain. Please check the <a href="https://quarkus.io/blog/secure-mcp-oidc-client/">Use Quarkus MCP client to access secure MCP HTTP server from command line</a> blog post where we use the standard <a href="https://datatracker.ietf.org/doc/html/rfc8693">OAuth2 Token Exchange</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="start-mcp-server"><a class="anchor" href="#start-mcp-server"></a>Start the MCP server in dev mode</h3>
<div class="paragraph">
<p>Now let&#8217;s start the MCP server in dev mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn quarkus:dev</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/quarkus_mcp_server_dev_mode.png" alt="MCP server dev mode">
</div>
</div>
<div class="paragraph">
<p>You can see that default <em>Streamable HTTP</em> and SSE endpoints are available at <code><a href="http://localhost:8080/mcp" class="bare">http://localhost:8080/mcp</a></code> and <code><a href="http://localhost:8080/mcp/sse" class="bare">http://localhost:8080/mcp/sse</a></code> respectively, while the <code>bravo</code> <em>Streamable HTTP</em> and SSE endpoints are available at <code><a href="http://localhost:8080/bravo/mcp" class="bare">http://localhost:8080/bravo/mcp</a></code> and <code><a href="http://localhost:8080/bravo/mcp/sse" class="bare">http://localhost:8080/bravo/mcp/sse</a></code> respectively.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="start-mcp-inspector"><a class="anchor" href="#start-mcp-inspector"></a>Step 2: Use MCP Inspector to access two secure MCP server endpoints</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="start-the-mcp-inspector"><a class="anchor" href="#start-the-mcp-inspector"></a>Start the MCP Inspector</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">npx @modelcontextprotocol/inspector@0.16.7</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> provides a very good OAuth2 Flow support, it is still a very active project and at the moment, you may observe <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> failing to connect to the OAuth2 provider in some versions.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> v0.16.7 has been proven to connect to Keycloak successfully and therefore we recommend you to use this version when working with this blog post.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We are now going to connect to two individual MCP <em>Streamable HTTP</em> endpoints in turn.</p>
</div>
<div class="paragraph">
<p>See the <a href="#demo-flow-diagram">Demo MCP OAuth2 Flow Diagram</a> section for an overview of how <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> performs a <code>Connect</code> request.</p>
</div>
<div class="paragraph">
<p>Please keep your browser&#8217;s <code>Developer Tools Network</code> tab open if you would like to observe how MCP Inspector probes various MCP server and Keycloak endpoints and eventually succeeds in getting a user logged in and acquiring the access token.</p>
</div>
<div class="sect3">
<h4 id="mcp-inspector-connect-to-alpha"><a class="anchor" href="#mcp-inspector-connect-to-alpha"></a>Connect to the default MCP Server <code>alpha</code> endpoint</h4>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/mcp_inspector_alpha_connect.png" alt="MCP Inspector Alpha Connect">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your browser does not show an <code>OAuth 2.0 Flow</code> in the <code>Authentication</code> view in the loaded <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> v0.16.7, try latest Firefox.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Set <code>Transport Type</code> to <code>Streamable HTTP</code>, <code>URL</code> to the <code><a href="http://localhost:8080/mcp" class="bare">http://localhost:8080/mcp</a></code> address of the default MCP server <code>alpha</code> endpoint.</p>
</div>
<div class="paragraph">
<p>In the <code>OAuth 2.0 Flow</code> authentication section, set the <code>Client ID</code> to <code>alpha-client</code>, and <code>Scope</code> to <code>openid quarkus-mcp-alpha</code>.</p>
</div>
<div class="paragraph">
<p>Requesting an <code>openid</code> scope is not strictly necessary in this demo, but OpenId Connect providers will not issue an ID token without it, only the access token, and you&#8217;ll likely need an SPA MCP Client to have access to the ID token in prod.</p>
</div>
<div class="paragraph">
<p>Requesting a <code>quarkus-mcp-alpha</code> scope is necessary for Keycloak to add a <code>quarkus-mcp-alpha</code> audience to the access token, please see how the <code>quarkus-mcp-alpha</code> client scope was created in the <a href="#keycloak-configuration">Keycloak Configuration</a> section.</p>
</div>
<div class="paragraph">
<p>The <code>Redirect URI</code> is preconfigured by <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> and points to the <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a>-managed <code><a href="http://localhost:6274/oauth" class="bare">http://localhost:6274/oauth</a></code> callback endpoint where Keycloak will redirect the user to after the user login is complete.</p>
</div>
<div class="paragraph">
<p>Now press <code>Connect</code>.</p>
</div>
<div class="paragraph">
<p>As explained in the the <a href="#demo-flow-diagram">Demo MCP OAuth2 Flow Diagram</a> section, <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> starts by trying to access the default MCP Server <em>Streamable HTTP</em> <code>alpha</code> endpoint without a valid token and gets a <code>401 WWW-Authenticate</code> challenge, with the <code>resource_metadata</code> parameter pointing to the <code>alpha</code> endpoint&#8217;s <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a> route.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> fetches the <code>alpha</code> endpoint&#8217;s protected resource metadata and finds out that it is secured by the Keycloak&#8217;s <code>alpha</code> realm.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> now discovers the Keycloak <code>alpha</code> realm&#8217;s metadata, and redirects you to Keycloak <code>alpha</code> realm&#8217;s authorization endpoint where you will see a Keycloak <code>Alpha</code> realm login challenge:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/alpha_realm_login.png" alt="Alpha Realm Login">
</div>
</div>
<div class="paragraph">
<p>Login as <code>alice:alice</code>. Keycloak redirects you back to the <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a>'s <code><a href="http://localhost:6274/oauth" class="bare">http://localhost:6274/oauth</a></code> endpoint. <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> exchanges the returned <code>code</code> for tokens and completes the authorization code flow.</p>
</div>
<div class="paragraph">
<p>The access token with a <code>quarkus-mcp-alpha</code> audience is now available, you can capture it using your browser&#8217;s <code>Web Developer Tools</code> and decode in JWT.io:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/alpha_client_jwt.png" alt="Alpha Client JWT">
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> uses this token to let you select and run the <code>alpha-user-name-provider</code> tool:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/alpha_tool_run.png" alt="Alpha Tool Run">
</div>
</div>
<div class="paragraph">
<p>The way <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> was able to acquire the access token, knowing only the OAuth2 Client ID and the MCP server&#8217;s endpoint address was interesting. See the <a href="#demo-flow-diagram">Demo MCP OAuth2 Flow Diagram</a> section for the overview of how the whole OAuth2 flow works.</p>
</div>
<div class="paragraph">
<p>Now disconnect MCP Inspector from the MCP Server <code>alpha</code> endpoint by pressing a <code>Disconnect</code> button.</p>
</div>
</div>
<div class="sect3">
<h4 id="connect-to-the-mcp-server-bravo-endpoint"><a class="anchor" href="#connect-to-the-mcp-server-bravo-endpoint"></a>Connect to the MCP Server <code>bravo</code> endpoint</h4>
<div class="paragraph">
<p>Connecting to the MCP Server <code>bravo</code> endpoint works exactly the same as with the default <code>alpha</code> endpoint, as explained in the <a href="#mcp-inspector-connect-to-alpha">Connect to the default MCP Server <code>alpha</code> endpoint</a> section, we only need to use the MCP Server <code>bravo</code> endpoint related properties.</p>
</div>
<div class="paragraph">
<p>Set <code>Transport Type</code> to <code>Streamable HTTP</code>, <code>URL</code> to the <code><a href="http://localhost:8080/bravo/mcp" class="bare">http://localhost:8080/bravo/mcp</a></code> address of the MCP server <code>bravo</code> endpoint.</p>
</div>
<div class="paragraph">
<p>In the <code>OAuth 2.0 Flow</code> authentication section, set the <code>Client ID</code> to <code>bravo-client</code>, and <code>Scope</code> to <code>openid quarkus-mcp-bravo</code>.</p>
</div>
<div class="paragraph">
<p>Keep <code>Redirect URI</code> set to <code><a href="http://localhost:6274/oauth" class="bare">http://localhost:6274/oauth</a></code>.</p>
</div>
<div class="paragraph">
<p>Now press <code>Connect</code>.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> starts by trying to access the MCP Server <code>bravo</code> endpoint without a valid token and gets a <code>401 WWW-Authenticate</code> challenge, with the <code>resource_metadata</code> parameter pointing to the `bravo&#8217;s  <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a> route.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> fetches the <code>bravo</code> endpoint&#8217;s protected resource metadata and finds out that it is secured by the Keycloak&#8217;s <code>bravo</code> realm.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a>  now discovers the Keycloak <code>bravo</code> realm&#8217;s metadata, and redirects you to Keycloak <code>bravo</code> realm&#8217;s authorization endpoint where you will see a Keycloak <code>Bravo</code> realm login challenge:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/bravo_realm_login.png" alt="Bravo Realm Login">
</div>
</div>
<div class="paragraph">
<p>Login as <code>jdoe:jdoe</code>. Keycloak redirects you back to the <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a>'s <code><a href="http://localhost:6274/oauth" class="bare">http://localhost:6274/oauth</a></code> endpoint. <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> exchanges the returned <code>code</code> for tokens and completes the authorization code flow.</p>
</div>
<div class="paragraph">
<p>The access token with a <code>quarkus-mcp-bravo</code> audience is now available. <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> uses this token to let you select and run the <code>bravo-user-name-provider</code> tool:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/secure_mcp_server_oauth2/bravo_tool_run.png" alt="Bravo Tool Run">
</div>
</div>
<div class="paragraph">
<p>See the <a href="#mcp-inspector-connect-to-alpha">Connect to the default MCP Server <code>alpha</code> endpoint</a> section for more explanations of how <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> manages to connect to the MCP Server endpoint knowing only its URL and the OAuth2 Client ID.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-considerations"><a class="anchor" href="#security-considerations"></a>Security Considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The main security consideration for secure Quarkus MCP server deployments is to ensure that access tokens have a correct audience, for the MCP Server to assert that the current token is meant to access this MCP server only. MCP Servers that propagate tokens further should consider exchanging such tokens, for a new token to target the downstream service correctly.</p>
</div>
<div class="paragraph">
<p>A token audience claim can have several values, and it must contain an <a href="https://www.rfc-editor.org/rfc/rfc8707.html">OAuth2 Resource Indicator</a> that points to a specific HTTP resource location or a custom audience value or both the resource indicator and the custom audience values.</p>
</div>
<div class="paragraph">
<p>One should also consider carefully if an MCP server should enable its <a href="https://datatracker.ietf.org/doc/html/rfc9728">OAuth2 Protected Resource Metadata</a> route which allows a public access to the information about the authorization server that secures this MCP Server.</p>
</div>
<div class="paragraph">
<p>Please keep in mind that it might be considered sensitive information, especially when no SPA MCP Client applications are used, when the provider login themes can be customized to make it less obvious to users what is the actual provider that is used to log them in.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this blog, we used <a href="https://github.com/modelcontextprotocol/inspector">MCP Inspector</a> to demonstrate how MCP Client can use OAuth2 Flow to login users and access secure Quarkus MCP <em>Streamable HTTP</em> servers, when only an MCP Server address and OAuth2 Client ID can provide enough context for the flow to succeed.</p>
</div>
<div class="paragraph">
<p>We also demonstrated how Quarkus MCP Server can <a href="https://docs.quarkiverse.io/quarkus-mcp-server/dev/index.html#_multiple_server_configurations">support multiple MCP HTTP configurations</a> with their own unique security constraints supported with the <a href="https://quarkus.io/guides/security-openid-connect-multitenancy#configure-tenant-paths">Quarkus OIDC multi-tenancy resolver</a>.</p>
</div>
<div class="paragraph">
<p>In the next blog post in this series, we will look at how <a href="https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization#access-token-privilege-restriction">MCP Authorization</a> OAuth2 Flow can use OAuth Dynamic Client Registration and how <a href="https://github.com/quarkiverse/quarkus-oidc-proxy">Quarkus OIDC Proxy</a> can play its part in securing Quarkus MCP Servers.</p>
</div>
<div class="paragraph">
<p>Enjoy, and stay tuned !</p>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/secure-mcp-server-oauth2/&title=Use MCP OAuth2 Flow to access Quarkus MCP Server" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fa-brands fa-linkedin fa-xl"></i>
  </a>
  <a class="share-x" href="https://x.com/intent/tweet?text=Use MCP OAuth2 Flow to access Quarkus MCP Server&url=https://quarkus.io/blog/secure-mcp-server-oauth2/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on X">
    <i class="fa-brands fa-square-x-twitter fa-xl"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/secure-mcp-server-oauth2/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fa-brands fa-square-facebook fa-xl"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/secure-mcp-server-oauth2/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fa-brands fa-square-reddit fa-xl"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Use MCP OAuth2 Flow to access Quarkus MCP Server&amp;body=Use MCP OAuth2 Flow to access Quarkus MCP Server https://quarkus.io/blog/secure-mcp-server-oauth2/" title="Share via Email" >
    <i class="fa-solid fa-envelope fa-xl"></i>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
