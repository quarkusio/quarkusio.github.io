<!DOCTYPE html>
<html lang="en">







<head>
  <title>VCStream: a new messaging platform for DECATHLON’s Value Chain, built on Quarkus. - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/decathlon-user-story/" />
  <meta property="og:title" content="VCStream: a new messaging platform for DECATHLON’s Value Chain, built on Quarkus." />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/decathlon-user-story/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/blog/decathlon-user-story/" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/blog/decathlon-user-story/" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/blog/decathlon-user-story/" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/blog/decathlon-user-story/" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/blog/decathlon-user-story/" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="post">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>          
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="active">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/blog/decathlon-user-story/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/blog/decathlon-user-story/">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/blog/decathlon-user-story/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/blog/decathlon-user-story/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/blog/decathlon-user-story/">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> VCStream: a new messaging platform for DECATHLON’s Value Chain, built on Quarkus.</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          September 13, 2021 
          
            <span class="tags"><a href="/blog/tag/user-story">#user-story</a></span>
          
        </div>
        <h1 class="post-title">VCStream: a new messaging platform for DECATHLON’s Value Chain, built on Quarkus.</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/41b10810ea2a2901531f2ed45986dd7d">
            
            <p class="byline">By <a href="/author/lmathieu">Loïc Mathieu</a></p>
          </div>
          <div class="width-12-12">
              <div class="imageblock">
<div class="content">
<img src="/assets/images/posts/quarkus-user-stories/decathlon/vcTech_logo_vcStream_500h.jpg" alt="vcTech logo vcStream 500h">
</div>
</div>
<div class="paragraph">
<p>DECATHLON is a French retailer, dedicated to sport products, with more than 1800 stores worldwide. At DECATHLON, we are convinced that sport is a source of well-being.</p>
</div>
<div class="paragraph">
<p>VCStream is a new platform for streaming data across the Value Chain of DECATHLON. It allows streaming data in and out of the Value Chain, what we called the inbound (from external systems to the Value Chain) and the outbound (from the Value Chain to external systems) processes.</p>
</div>
<div class="paragraph">
<p>VCStream slogan: <strong><em>“One platform to connect them all”</em></strong>.</p>
</div>
<div class="paragraph">
<p>VCStream offers connectors to easily stream data from incoming Kafka topics to existing Value Chain ERP modules, and from these ERP modules to outgoing Kafka topics and object store.</p>
</div>
<div class="paragraph">
<p>VCStream leverages the Quarkus framework, and Kubernetes, to offer a resilient and performant platform that meets security and reliability requirements of DECATHLON Value Chain.</p>
</div>
<div class="paragraph">
<p>Age Of Access Accelerator (AoAA) is the team behind the VCStream platform. We’re a small team of three Developers, a DevOps, a Product Owner and an Enterprise Architect; let’s not forget our team Leader of course (that also develops when he finds some time to do so).</p>
</div>
<div class="sect1">
<h2 id="the-challenge"><a class="anchor" href="#the-challenge"></a>The Challenge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Value Chain IT department faces a major problem around data exposure and consumption to and from the other departments of DECATHLON.
The business was scaling steadily, driving significantly higher levels of resource consumption, capacity demands, and event data in real time. We realized that our system could not keep up.</p>
</div>
<div class="paragraph">
<p>The current usage of dedicated servers was leading to an increase of resource waste. The department’s reliance on legacy workflows and ERP ecosystems resulted in significant productivity bottlenecks.
Thinking about data as streams is a popular approach nowadays. In many cases, it allows to build a data engineering architecture in a more efficient way than the classic “data as a state” one. But to support the streaming data paradigm, we need to use additional technologies. One of the most popular tools for working with streaming data is Apache Kafka, and DECATHLON decided to invest heavily in it.</p>
</div>
<div class="paragraph">
<p>The quality of data produced to VCStream is extremely important to us, especially because we are running VCStream at scale. Data produced by one team can and will be consumed by many different applications within DECATHLON. The lack of data quality can have a huge impact on downstream consumers.</p>
</div>
<div class="paragraph">
<p>Prior to the <strong>VCStream platform</strong>, the Value Chain was challenged with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data standardization</strong>: data was exposed in a non-uniform manner and without standards.</p>
</li>
<li>
<p><strong>Time to market</strong>: exposing new data would take time as we relied on manual scheduling via legacy tools.</p>
</li>
<li>
<p><strong>Consuming data in real time</strong>: as opposed to the current batch mode usage.</p>
</li>
<li>
<p><strong>Scalability and Resilience</strong>: huge volumes of data are processed, and the legacy system is fragile.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We knew our Value Chain needed a platform to modernize our data exchange: a product that could enable data access, efficient data integration, container adoption, and developer velocity at scale.</p>
</div>
<div class="paragraph">
<p><em>"Almost every weekend is the biggest weekend we&#8217;ve ever had in the Value Chain! our system has just become unstable. We can not deal with application deployment in the old way.”</em> - is the observation from many of us.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="why-quarkus"><a class="anchor" href="#why-quarkus"></a>Why Quarkus?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To implement VCStream, our team evaluated Spring Boot, Micronaut and Quarkus. As none has real experience with Micronaut, we quickly leave it out.</p>
</div>
<div class="paragraph">
<p>We selected Quarkus based on the followings criterias:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The team was interested to learn a new framework</p>
</li>
<li>
<p>Microprofile reactive messaging seems very interesting and a neat API to implement messaging only microservices which is what we needed primarily.</p>
</li>
<li>
<p>Performance is at the heart of Quarkus, and more importantly, low resource consumption (both CPU and memory) which is important as we plan to deploy to the cloud, and have some ecological sensitivity on the team.</p>
</li>
<li>
<p>All the containers, Kubernetes and cloud ready functionalities that we need to properly implement a resilient application on GKE are there.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lastly, we have a Quarkus contributor on the team which allows us to have a deep understanding of the framework, and a unique contact within the community.</p>
</div>
<div class="paragraph">
<p>Speaking of the community, the Quarkus one is very active and welcoming. This was one of the most important criteria for us.</p>
</div>
<div class="paragraph">
<p>Of course, we performed some proof of concepts with all the team members, compared implementations, and decided together what the best choice would be in our context.</p>
</div>
<div class="paragraph">
<p>During these proof of concepts, we particularly enjoyed the fact that the Quarkus learning curve was very rapid and easier than what we first thought. Newcomers have become comfortable with Quarkus in less than a week, and all the developer oriented functionalities (live reload FTW!) have really empowered them to be more productive on their day to day tasks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="our-commitment"><a class="anchor" href="#our-commitment"></a>Our commitment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Within DECATHLON, there weren&#8217;t many projects that used Quarkus, unlike Spring Boot, which has already been proven, and there were several developers who are familiar with it.</p>
</div>
<div class="paragraph">
<p>Quarkus' position in our current TechRadar (trial) has not necessarily helped us to weigh our usage of it. The few developers with whom we had discussions on the use of Quarkus had expressed some reservations about the notion of performance that was put forward by the framework.</p>
</div>
<div class="paragraph">
<p>Making objective choices (for the company and for developers who have a passion for the framework), on a new framework for our company was very difficult! We cannot rely solely on the advice of the Quarkus expert on our team to make the choice. This is the reason why we started with a POC, with the objective that if we would face some impossible situation, we would go back to Spring Boot without hesitation! Knowing this POC would still cost us in a difficult economic context that everyone knows.</p>
</div>
<div class="paragraph">
<p>Fortunately, the project went well, and we now have successfully deployed it in production and connected many ERP modules with external IT systems thanks to VCStream.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vcstream-architecture"><a class="anchor" href="#vcstream-architecture"></a>VCStream architecture</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/quarkus-user-stories/decathlon/VCStream_Event_Inbound.png" alt="VCStream Event Inbound">
</div>
</div>
<div class="paragraph">
<p>This is a simplified view of the VCStream inbound process architecture: the extractor connects to multiple Kafka brokers and consumes messages from multiple topics in real time. These messages are then converted to JSON, routed and sent to multiple ERP modules (one message can go to one or more ERP modules). There is one sender instance per ERP module.</p>
</div>
<div class="paragraph">
<p>Currently, we extract from 6 topics and send to 3 ERP modules but we foresee to consume from up to 25 different topics at the end of 2022.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/quarkus-user-stories/decathlon/VCStream_Event_Outbound.png" alt="VCStream Event Outbound">
</div>
</div>
<div class="paragraph">
<p>This is a simplified view of the VCStream outbound process architecture: the listener watches for JSON messages from an ERP module. These messages are routed, then sent to the validator that validates them, converted to AVRO format, and exposed in dedicated topics. There is one listener instance per ERP module.</p>
</div>
<div class="paragraph">
<p>Currently we receive messages from 4 ERP modules and expose 6 topics but we foresee to expose up to 25 topics at the end of 2022.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="embracing-quarkus"><a class="anchor" href="#embracing-quarkus"></a>Embracing Quarkus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here are testimonials of the usage of Quarkus from the members of the VCStream platform development team.</p>
</div>
<div class="sect2">
<h3 id="fawaz-paraïso-team-leader"><a class="anchor" href="#fawaz-paraïso-team-leader"></a><em>Fawaz Paraïso - Team Leader</em></h3>
<div class="paragraph">
<p>As a developer and the team leader, I had to make my own beliefs about choosing to use Quarkus for our platform implementation. Our technological choice must be consistent with DECATHLON&#8217;s development strategies.</p>
</div>
<div class="paragraph">
<p>In comparison with Spring Boot which has already established itself, Quarkus is a new framework in the Java ecosystem. Beyond these considerations (new), our team should give a concrete opinion of what Quarkus could offer. Getting started with Quarkus was easy for me, it may be related to my experience as a senior developer. After a week of development with Quarkus, I was able to regain the same level of productivity as when I was developing with Spring Boot. For the implementation of our platform, SmallRye Reactive Messaging was newer to me and met the architectural constraints of our platform. Our POC was successful with results (simplicity, performance, resilience) above our expectations. Despite the positive results obtained, I did not want to stop there. I wanted to get another perspective from a junior developer who, like me, had never used Quarkus.</p>
</div>
<div class="paragraph">
<p>The arrival of a new collaborator with a junior profile in our team who does not know our project, neither Quarkus, provided me with other elements of answers on how to get started with Quarkus. He made his first contributions to our repositories in the first week. This collaborator&#8217;s experience with using Quarkus has definitely assured me of how easily a junior developer can get started with Quarkus.</p>
</div>
</div>
<div class="sect2">
<h3 id="thomas-dangleterre-junior-developer"><a class="anchor" href="#thomas-dangleterre-junior-developer"></a><em>Thomas Dangleterre - Junior Developer</em></h3>
<div class="paragraph">
<p>I joined the team 4 months after the project started. I have been recruited to step in as a junior Java Software Developer. It was the first time I had to deal with microservices architecture and I just had a small experience of the cloud.
I really enjoy the hot reload feature on Quarkus it is something that I was not used to from my previous missions on legacy applications.
I like how it is easy to interact with Kafka thanks to the abstraction offered by SmallRye Reactive Messaging.</p>
</div>
<div class="paragraph">
<p>It was pretty easy to adapt myself to Quarkus as I knowed Spring Boot a bit, and there are a lot of similarities. I also found Quarkus' documentation very clear and I’m really looking forward to keep learning more about Quarkus.</p>
</div>
</div>
<div class="sect2">
<h3 id="victor-gallet-senior-developer-and-kafka-expert"><a class="anchor" href="#victor-gallet-senior-developer-and-kafka-expert"></a><em>Victor Gallet - Senior Developer and Kafka Expert</em></h3>
<div class="paragraph">
<p>When I joined the team, around ten microservices had already been deployed with Quarkus.
I had not yet had the opportunity to play with Quarkus, I had just seen presentations at a meetup and the framework interested me. Having worked since the beginning of my career with the Spring framework, I wanted to discover the big differences compared to Quarkus.
Despite utility classes and different CDI annotations, I was able to get up and running with Quarkus very quickly. The Quarkus Guides have been a huge help as they focus on one topic and get straight to the point. For example, since our microservices communicate exclusively with Apache Kafka, the Quarkus integration guide with Apache Kafka allowed me to immediately understand the concepts and our different components.</p>
</div>
<div class="paragraph">
<p>Compared to the dependency injection and the implementation provided by Quarkus (ArC), I had no problem navigating it. The concepts are standard and I only had to discover some new annotations like <code>@ApplicationScoped</code> and <code>@Singleton</code> to name just the most used ones.</p>
</div>
<div class="paragraph">
<p>To sum up, here are the points that I really enjoyed working with Quarkus:</p>
</div>
<div class="sect3">
<h4 id="the-live-reload"><a class="anchor" href="#the-live-reload"></a>The live reload</h4>
<div class="paragraph">
<p>One feature that I really liked is the live reload. Starting my day in the morning, I would launch the application I needed to work on, and no longer have to worry about restarting it during the day. A very practical feature coupled with a very short start-up time!</p>
</div>
</div>
<div class="sect3">
<h4 id="unified-configuration-and-profile-management"><a class="anchor" href="#unified-configuration-and-profile-management"></a>Unified configuration and profile management</h4>
<div class="paragraph">
<p>With this simple little bit of configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre>greeting.message=hello
%dev.greeting.message=hey
%test.greeting.message=hi</pre>
</div>
</div>
<div class="paragraph">
<p>It allows the <code>greeting.message</code> property to be overridden when launching the application locally with the value <em>“hey”</em> and for tests with the value <em>”hi”</em>. This is very convenient and greatly simplifies configuration management for testing.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-support"><a class="anchor" href="#the-support"></a>The support</h4>
<div class="paragraph">
<p>I already mentioned it above, but the documentation is very clear, and the guides allow you to discover a functionality, a use of Quarkus in a simple and fast way.
I was also pleasantly surprised at the responsiveness and support of the Quarkus community within their Zulip chat. A big thank you to Clément Escoffier who helped us improve our applications, and personally helped me to do my first open source contribution to the SmallRye Reactive Messaging project.</p>
</div>
<div class="paragraph">
<p>One point of attention that I have come up against with my liability as a Spring developer is that Quarkus takes a number of actions during build to reduce startup time and its memory footprint. Having wanted to have a dynamic behavior in my application, I used the annotation <code>@IfBuildProperty</code> to select the appropriate bean but, as its name suggests, the bean will be selected during the build and the alternatives will not be available at runtime.</p>
</div>
<div class="paragraph">
<p>Finally, to end my feedback, I regret not having faced the construction of a native image. But our project has opted for the deployment of containers within a Kubernetes cluster, which is what Quarkus is designed for.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="loïc-mathieu-senior-developer"><a class="anchor" href="#loïc-mathieu-senior-developer"></a><em>Loïc Mathieu - Senior Developer</em></h3>
<div class="paragraph">
<p>I’m a regular Quarkus committer and knows very well Quarkus before I joined the team. So I will give a very narrow testimonial, on a very specific feature we used and that I very love.</p>
</div>
<div class="paragraph">
<p>Reactive programming is at the heart of Quarkus, and reactive messaging, as its name implies, is a reactive framework.</p>
</div>
<div class="paragraph">
<p>When you need to consume or produce a message, you can simply use the payload as method parameter or return type. But when you need to implement asynchronous processing or complex logic on a stream of messages, you’ll need to use Mutiny instead of directly using your payload type.
Mutiny is a set of reactive types and operators. It allows to express a set of transformations on a stream of items and  follows the reactive stream standard.</p>
</div>
<div class="paragraph">
<p>One of our needs was to group incoming messages into batches, as sending a message to an ERP module has a cost, and they fear receiving millions of messages per day. So we need to group them by type, then by batch of 50, and emit at least one batch per minute to avoid adding too much delay to the message delivery.</p>
</div>
<div class="paragraph">
<p>To implement this, we prototype the usage of Kafka Stream, but it adds some complexity to our current technical stack as we didn’t use it already, and it has some grouping limitations (grouping by size is not provided out of the box by the framework).</p>
</div>
<div class="paragraph">
<p>So we decided to simply use what we already have in our toolbox, Mutiny, and the code we implement is really readable for such a complex task, and we have been very happy with it since.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Incoming("in")
@Outgoing("group-out")
public Multi&lt;Message&lt;List&lt;ErpMessage&gt;&gt;&gt; group(Multi&lt;KafkaRecord&lt;String, RawMessage&gt;&gt; events) { <i class="conum" data-value="1"></i><b>(1)</b>
    return events
            .group().by(record -&gt; record.getPayload().type) <i class="conum" data-value="2"></i><b>(2)</b>
            .flatMap(group -&gt; group.group().intoLists().of(size, duration)) <i class="conum" data-value="3"></i><b>(3)</b>
            .filter(group -&gt; !group.isEmpty()) <i class="conum" data-value="4"></i><b>(4)</b>
            .flatMap(groupedMultis -&gt; {
                List&lt;ErpMessage&gt; erpMsg = groupedMultis.stream() <i class="conum" data-value="5"></i><b>(5)</b>
                        .map(record -&gt; toErpMessage(record))
                        .collect(Collectors.toList());
                return Multi.createFrom().item(KafkaRecord.of((String) null, erpMsg)); <i class="conum" data-value="6"></i><b>(6)</b>
            });
}</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The method takes a stream of Kafka messages.</p>
</li>
<li>
<p>First, we group by payload type.</p>
</li>
<li>
<p>Then, we group by batch of size messages with a max duration of duration.</p>
</li>
<li>
<p>Then, we remove empty batches.</p>
</li>
<li>
<p>Then, we map each batch of message to a new format.</p>
</li>
<li>
<p>Then we return a Kafka message with the batch in it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Pretty straightforward, right?</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="looking-forward"><a class="anchor" href="#looking-forward"></a>Looking forward</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Performance was at the heart of the design and implementation of VCStream, we perform regular load tests and run regular crisis scenarios (we simulate keeping up with a high number of messages waiting in the broker by manipulating topics offset).</p>
</div>
<div class="paragraph">
<p>Each time we encounter performance bottlenecks or regressions, we discuss them with the Quarkus community and have very prompt feedback. All issues were resolved quickly and the performance and resilience of our platform kept improving over time.</p>
</div>
<div class="paragraph">
<p>We deployed on the cloud, which implies direct cost we can measure easily. Even if today our platform is not yet used a lot in production (only half of the currently deployed topics are really used), we foreseen a need to scale to up to 1.5 million messages per minute at the end of 2022, and to connect to more than twice the current number of ERP
 modules. So the level of performance and the resources needed to achieve it is very important.</p>
</div>
<div class="paragraph">
<p>The good news is: we are not afraid of this as the platform in its current state can already sustain a high number of messages per minute. We benchmark our platform on our crisis scenario to <strong>up to 500 thousand messages per minute per instance</strong> even with Kafka clients favoring consistency</p>
</div>
<div class="paragraph">
<p>And thanks to Quarkus, a single instance of a component uses <strong>as less as 0.5 CPU and 512MB or memory</strong> (heap size is around 120MB), we could go less as all the CPU and memory is not used, but it’s already very little so we prefer to be conservative on this. Oh, yes, and this is on Java 16 and using the JVM.</p>
</div>
<div class="paragraph">
<p>To put it in another words, we achieve a <strong>1 millions messages per minutes throughput per CPU per GB of memory</strong> on a real world streaming application thanks to Quarkus and MicroProfile reactive messaging. This is quite an impressive throughput density, and we are very happy with it.</p>
</div>
<div class="paragraph">
<p>A few last words, we would like to especially thank the Quarkus community for helping us, answering our questions again and again, improving Quarkus on each release and for the really good job they made with Quarkus and the fabulous MicroProfile Reactive Messaging framework! Thank you all, you’re amazing!</p>
</div>
<div class="paragraph">
<p><em>This article has been written and proofread by all the members of the Age of Access Accelerator team.</em></p>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/decathlon-user-story/&title=VCStream: a new messaging platform for DECATHLON’s Value Chain, built on Quarkus." rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fa-brands fa-linkedin fa-xl"></i>
  </a>
  <a class="share-x" href="https://x.com/intent/tweet?text=VCStream: a new messaging platform for DECATHLON’s Value Chain, built on Quarkus.&url=https://quarkus.io/blog/decathlon-user-story/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on X">
    <i class="fa-brands fa-square-x-twitter fa-xl"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/decathlon-user-story/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fa-brands fa-square-facebook fa-xl"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/decathlon-user-story/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fa-brands fa-square-reddit fa-xl"></i>
  </a>
  <a class="share-email" href="mailto:?subject=VCStream: a new messaging platform for DECATHLON’s Value Chain, built on Quarkus.&amp;body=VCStream: a new messaging platform for DECATHLON’s Value Chain, built on Quarkus. https://quarkus.io/blog/decathlon-user-story/" title="Share via Email" >
    <i class="fa-solid fa-envelope fa-xl"></i>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
