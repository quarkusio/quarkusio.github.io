<!DOCTYPE html>
<html lang="en">







<head>
  <title>Riding Camel Quarkus: effortless APIs - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://embed.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/camel-quarkus-effortless-apis/" />
  <meta property="og:title" content="Riding Camel Quarkus: effortless APIs" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/camel-quarkus-effortless-apis/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/blog/camel-quarkus-effortless-apis/" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/blog/camel-quarkus-effortless-apis/" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/blog/camel-quarkus-effortless-apis/" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/blog/camel-quarkus-effortless-apis/" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/blog/camel-quarkus-effortless-apis/" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="post">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/continuum" class="">VERSATILITY</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="">DOCUMENTATION</a></li>
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="active">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/blog/camel-quarkus-effortless-apis/" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/blog/camel-quarkus-effortless-apis/">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/blog/camel-quarkus-effortless-apis/">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/blog/camel-quarkus-effortless-apis/">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/blog/camel-quarkus-effortless-apis/">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> Riding Camel Quarkus: effortless APIs</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          April 05, 2022 
          
            <span class="tags"><a href="/blog/tag/camel">#camel</a><a href="/blog/tag/openapi">#openapi</a><a href="/blog/tag/api">#api</a><a href="/blog/tag/integration">#integration</a><a href="/blog/tag/atlasmap">#atlasmap</a><a href="/blog/tag/rest">#rest</a><a href="/blog/tag/swagger-ui">#swagger-ui</a><a href="/blog/tag/data-mapping">#data-mapping</a><a href="/blog/tag/web">#web</a></span>
          
        </div>
        <h1 class="post-title">Riding Camel Quarkus: effortless APIs</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/0e19e93342463a0e6b438efed26fae5e">
            
            <p class="byline">By <a href="/author/bmeseguer">Bruno Meseguer</a></p>
          </div>
          <div class="width-12-12">
              <div id="preamble">
<div class="sectionbody">
<div class="imageblock text-left">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/camel-quarkus.png" alt="Camel Quarkus" width="80%">
</div>
</div>
<div class="paragraph">
<p>Discover Camel, the swiss-knife of integration brought to Quarkus. The example encourages API best practices, with effortless coding effort showcasing AtlasMap for data transformation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus offers an extensive collection of extensions to connect to web, data and messaging systems, providing the developer fantastic functionality at his disposal. However, in many cases, the problem at hand already belongs to one (or more) of the well-known <a href="https://www.enterpriseintegrationpatterns.com/toc.html" target="_blank" rel="noopener">enterprise integration patterns</a>.</p>
</div>
<div class="paragraph">
<p>Developers often kickstart their projects unaware that Apache Camel has perfected how to best address integration patterns. Camel Quarkus provides <a href="https://camel.apache.org/camel-quarkus/2.7.x/reference/index.html" target="_blank" rel="noopener">hundreds of connectors</a> and rich functionality for data mediation: data formats, transformers, templating, custom processors, etc.</p>
</div>
<div class="paragraph">
<p><a href="https://camel.apache.org/camel-quarkus/" target="_blank" rel="noopener">Camel Quarkus</a> is a subproject in the <a href="https://camel.apache.org/" target="_blank" rel="noopener">Apache Camel</a> community that enables Camel to run on <a href="https://developers.redhat.com/products/quarkus/overview" target="_blank" rel="noopener">Quarkus</a>. Apache Camel, often called the swiss-knife of integration, is the most popular open source community project aimed at solving all things integration.</p>
</div>
<br>
</div>
</div>
<div class="sect1">
<h2 id="an-openapi-example"><a class="anchor" href="#an-openapi-example"></a>An OpenAPI example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let’s pick a helpful example that highlights the benefits of using Camel Quarkus in contrast with other development approaches. Implementing and evolving API services sounds like a use case almost every reader can relate to. We’ll use the broadly adopted OpenApi specification.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/openapi.png" alt="Putting together APIs" width="50%">
</div>
<div class="title">Figure 1. Piecing together an OpenAPI service</div>
</div>
<div class="paragraph">
<p>Of course, the example illustrated in this article plays in the context of integration, where you’re enabling access or integrating source systems, performing data processing of some sort, and connecting and sending data to back endpoints.</p>
</div>
<div class="paragraph">
<p>By all means, Camel Quarkus is not a “one to rule them all” solution. It will not be a good fit if your scenario deviates from the above context, for instance, a data access layer with heavy datastore interaction,  a web server, a media application, etc.</p>
</div>
<div class="paragraph">
<p>We find many Quarkus (non-Quarkus too) examples showing how to define and implement APIs. They all try to be as helpful as possible and propose the way forward. I realise this article is no different. However, I’m certain Camel Quarkus brings an elegant and effortless approach worth considering.</p>
</div>
<div class="sect2">
<h3 id="code-first-vs-contract-first"><a class="anchor" href="#code-first-vs-contract-first"></a>Code-first vs Contract-first</h3>
<div class="paragraph">
<p>Although these are two different strategies to implement APIs, with their pros and cons, we are sticking to the contract-first approach, that is, when the API specification (the contract) is provided before the code implementation begins.</p>
</div>
<div class="paragraph">
<p>In our example, the development team does not own the API. Their task is to implement the services to expose and comply with the given API specification. A different team in the organisation is responsible for designing, releasing, and delivering API governance. The picture below illustrates a contract-first approach.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/dev-contract-first.png" alt="Contract-first approach" width="70%">
</div>
<div class="title">Figure 2. Contract-first approach</div>
</div>
<div class="paragraph">
<p>A code-first strategy implies the API specification derives from the implemented code. You can use libraries to auto-generate the specification based on the code the developer has crafted. Code-first would be more appropriate for fast prototyping or simply when you have complete control over the API with a very open, relaxed and flexible approach to your development with little or no impact on others.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/dev-code-first.png" alt="Code-first approach" width="85%">
</div>
<div class="title">Figure 3. Code-first approach</div>
</div>
<br>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basics-about-camel-and-rest"><a class="anchor" href="#basics-about-camel-and-rest"></a>Basics about Camel and REST</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here&#8217;s a speedy summary for those unfamiliar with Camel and how to implement REST APIs.</p>
</div>
<div class="paragraph">
<p>Camel has its domain-specific language (DSL) to define processing flows, known as the Camel DSL. You use Camel components (aka. connectors) in the DSL to move data from sources to targets. Camel Quarkus has <a href="https://camel.apache.org/camel-quarkus/2.7.x/reference/index.html" target="_blank" rel="noopener">300+ available extensions</a>.</p>
</div>
<div class="paragraph">
<p>Camel provides an additional domain-specific language for specific REST implementations: the REST DSL. When implementing REST services with Camel, you chain both DSLs to define the service’s end-to-end behaviour.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/camel-basics-dsl.png" alt="Camel DSLs chained to process incoming requests" width="80%">
</div>
<div class="title">Figure 4. Camel DSLs chained to process incoming requests.</div>
</div>
<div class="paragraph">
<p>Camel forwards incoming REST requests from the REST DSL to the main DSL via the Camel ‘direct’ component, which is essentially a connector used for internal invocations, as if calling a Java method from a line of Java code.</p>
</div>
<br>
</div>
</div>
<div class="sect1">
<h2 id="easy-ride-preparations"><a class="anchor" href="#easy-ride-preparations"></a>Easy ride preparations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ultimate goal is to relieve the developer from dealing with API related preparations and configurations and allow him to concentrate on the business logic.</p>
</div>
<div class="paragraph">
<p>To be more specific, in the previous diagram, the REST DSL comes handy when developers adopt a code-first approach. However, its definition feels redundant in a contract-first world since the provided OpenAPI specification already defines all the API details.</p>
</div>
<div class="paragraph">
<p>Camel allows you to auto-generate the REST DSL out of an OpenAPI specification. This automation simplifies the work by letting the developer just focus on the processing flow implementation.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/camel-easy-ride.png" alt="Automated REST DSL" width="85%">
</div>
<div class="title">Figure 5. Automated REST DSL, hand coded Main DSL.</div>
</div>
<div class="paragraph">
<p>The automated code generation shown above is enabled via the configuration of the following Maven plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-restdsl-openapi-plugin&lt;/artifactId&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;simple&lt;/id&gt;
            &lt;goals&gt;
                &lt;goal&gt;generate-xml&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;specificationUri&gt;src/main/resources/META-INF/openapi.json&lt;/specificationUri&gt;
                &lt;restConfiguration&gt;false&lt;/restConfiguration&gt;
                &lt;outputDirectory&gt;${project.build.directory}/classes/routes&lt;/outputDirectory&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the <code>&lt;outputDirectory&gt;</code> parameter set to a destination inside the target directory. The setting allows Quarkus to load the Camel REST resource at start-up time and prevents the source directory from being polluted with unnecessary code.</p>
</div>
<div class="paragraph">
<p>Also, you’ll observe we’re picking the OpenApi specification from the project’s source directory. The best practice would be to fetch, via another Maven plugin, the OpenAPI from a remote Service Registry representing the source of truth.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The OpenApi definition used in our example has been created with <a href="https://www.apicur.io/" target="_blank" rel="noopener">Apicurio Studio</a>, a beautiful and intuitive design time visual tool.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let’s pretend we do fetch the OpenApi definition from a remote server. Under that assumption, the diagram below shows how the project is kept simple and clean. Maven injects both the OpenApi and REST definition into the target directory at compilation time. When packaging the solution, it includes all necessary artefacts to run.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/maven-automation.png" alt="Source is clean. Essential artefacts are generated and injected">
</div>
<div class="title">Figure 6. Source is clean. Essential artefacts are generated and injected</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The best practice is to fetch the OpenAPI specification from a remote <a href="https://www.apicur.io/registry/" target="_blank" rel="noopener">Service Registry</a> (the source of truth). For simplicity, our project already includes the specification.</p>
</div>
</td>
</tr>
</table>
</div>
<br>
</div>
</div>
<div class="sect1">
<h2 id="application-version-1-0"><a class="anchor" href="#application-version-1-0"></a>Application version 1.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let’s look at our chosen (example) API service and see how to drive its implementation in its first iteration. The API Design team has released an OpenApi specification v1.0 for a service called ‘Individual’, and we, the developers, need to implement the service in compliance with its definition.</p>
</div>
<div class="paragraph">
<p>This first version of the service has a single operation to retrieve the details of an individual. By setting up our project to parse and auto-generate the REST DSL as described in the previous section, we just need to implement a single Camel Route to process incoming service calls, as illustrated below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/service-version-1.png" alt="First version of the service to implement">
</div>
<div class="title">Figure 7. First version of the service to implement.</div>
</div>
<div class="paragraph">
<p>We’ll keep the use case relatively thin; our focus stays at “Easy APIs with Camel Quarkus”.  But still, we want the scenario to be within an integration context to showcase some Camel Quarkus capabilities.</p>
</div>
<div class="paragraph">
<p>Our Camel route connects with a legacy backend that enables access to ‘individual’ data. The processing logic requires adapting the incoming OpenApi call to the legacy backend system’s interface. This data adaptation requires data transformation both during the request and response flows.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/service-e2e.png" alt="End to end processing flow">
</div>
<div class="title">Figure 8. End to end processing flow.</div>
</div>
<div class="paragraph">
<p>In a classic development approach, the developer needs to incorporate a Java data model to operate and handle incoming and outgoing data, for example, by defining Java classes and data structures to represent the data the service needs to manipulate.</p>
</div>
<div class="paragraph">
<p>In our example, the OpenApi contract already predefined the data model describing the inputs and outputs of each operation. Likewise, the backend also defines a contract (or interface) to comply with when triggering calls.</p>
</div>
<div class="paragraph">
<p>With Apache Camel, we can keep the implementation very clean by using Camel functionality dedicated explicitly to data transformation. In our example, we’ll use the AtlasMap component for various reasons:</p>
</div>
<ul>
  <li>It provides intuitive visual tooling to map source data to target data</li>
  <li>It performs structural and data transformation (JSON ⇄ XML) in a single action </li>
  <li>It does not require predefined Java data models</li>
</ul>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/map-json-xml.png" alt="AtlasMap combines 2 actions in 1: structural and format transformations" width="80%">
</div>
<div class="title">Figure 9. AtlasMap combines 2 actions in 1: structural and format transformations.</div>
</div>
<div class="paragraph">
<p>Let’s start looking at the route definition the developer needs to produce and how Camel links the OpenAPI operation to its code implementation:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/openapi-camel-link.png" alt="Camel uses the operationId as a link to invoke the Camel route" width="90%">
</div>
<div class="title">Figure 10. Camel uses the <code>operationId</code> as a link to invoke the Camel route.</div>
</div>
<div class="paragraph">
<p>Camel Quarkus uses the <code>operationId</code> from the OpenAPI specification to trigger an internal call (using the <code>direct</code> component) and expects a Camel consumer (<code>from</code> tag) with a matching <code>operationId</code> value to process the client request.</p>
</div>
<div class="paragraph">
<p>The Camel route couldn’t be simpler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:getDetails")
.to("atlasmap:map/request.adm")
.to("direct:call-backend")
.to("atlasmap:map/response.adm");</code></pre>
</div>
</div>
<ol>
  <li>The first line declares the route (and matches the `+operationId+`).</li>
  <li>The second line applies a data adaptation (or mapping) to prepare the back-end call's payload.</li>
  <li>The third line invokes a Camel route that calls the backend and collects the response.</li>
  <li>The fourth line maps the response XML into JSON data in compliance with the OpenApi definition.</li>
</ol>
<div class="paragraph">
<p>You can easily create the data mapping definitions using AtlasMap’s VSCode extension.
When editing the Camel route in VSCode, you’ll find a contextual and actionable hint you can click (over the ‘atlasmap’ code line) that launches the AtlasMap editor with the data mapping definition loaded.</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/vscode-codelens.png" alt="VSCode prepends an action link to open the visual mapping editor" width="45%">
</div>
<div class="title">Figure 11. VSCode prepends an action link to open the visual mapping editor.</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following <a href="https://camel.apache.org/blog/2021/11/vscode-atlasmap-release-0.1.0/" target="_blank" rel="noopener">blog in the Apache Camel</a> community describes how to use the tooling.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The picture below shows the data mapping definition in AtlasMap for the request flow:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/atlasmap-mapping-request.png" alt="Mapping definition for the request flow">
</div>
</div>
<div class="paragraph">
<p>The property <code>id</code> (left) represents the <code>{id}</code> path parameter from the HTTP URL. It maps  to the target XML data structure, connected to the <code>id</code> node (right). You define mappings with drag and drop actions from left to the right.</p>
</div>
<div class="paragraph">
<p>Following the data transformation action, the flow invokes the backend. The snippet below shows the developer&#8217;s Camel route definition to trigger the HTTP request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:call-backend")
.removeHeaders("*")
.setHeader(Exchange.HTTP_METHOD,  constant("POST"))
.setHeader(Exchange.CONTENT_TYPE, constant("application/xml"))
.to("http:{{api.backend1.host}}/camel/individual/details");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two main actions in this route are:</p>
</div>
<ol>
  <li>Set headers (ensuring we clean up incoming ones)</li>
  <li>Trigger the call using Camel’s HTTP component. </li>
</ol>
<div class="paragraph">
<p>The expected XML interaction with the legacy backend system is as follows:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/camel-backend-call.png" alt="Call from Camel to the backend">
</div>
<div class="title">Figure 12. Call from Camel to the backend.</div>
</div>
<div class="paragraph">
<p>The response data mapping definition would be defined in AtlasMap as shown below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/atlasmap-mapping-response.png" alt="Mapping definition for the response flow">
</div>
</div>
<div class="paragraph">
<p>The data structure on the left represents the source XML to map (backend response), and the data structure on the right represents the target JSON data to compose and send back to the client.</p>
</div>
<div class="sect2">
<h3 id="summary"><a class="anchor" href="#summary"></a>Summary</h3>
<div class="paragraph">
<p>Let’s review the implementation effort the developer needs to undergo in this first iteration of the Individual API:</p>
</div>
<ol>
    <li>Setup the project (include dependencies, plugins, etc.)</li>
    <br>
    <li>Define the Camel routes:</li>
    <ol type="a">
        <li><span>The main Camel route<br/>(4 lines of code)</span></li>
        <li><span>The backend invocation route <br/>(5 lines of code)</span></li>
    </ol>
    <br>
    <li>Define the data transformations:</li>
    <ol type="a">
        <li>Request mapping</li>
        <li>Response mapping</li>
    </ol>
</ol>
<br>
<div class="paragraph">
<p>That’s looks neat to me.</p>
</div>
<br>
</div>
</div>
</div>
<div class="sect1">
<h2 id="application-version-2-0"><a class="anchor" href="#application-version-2-0"></a>Application version 2.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The real benefit of this development approach, and its simplicity using Camel Quarkus, becomes more evident when the DEV team receives a new version 2.0 of the Individual API, released by the Design team, with a new operation to be implemented.</p>
</div>
<div class="paragraph">
<p>Version 1.0 was only intended for internal consumption. Now there is a demand to expose the service externally, which requires introducing a level of data protection to ensure the customer’s data is kept confidential.</p>
</div>
<div class="paragraph">
<p>Version 2.0 defines a new operation the developer needs to implement. Hopefully, the impact on the current code will not be too significant.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/service-version-2.png" alt="Second version of the service with a new operation">
</div>
<div class="title">Figure 13. Second version of the service with a new operation.</div>
</div>
<div class="paragraph">
<p>The main goal of the new operation is to anonymise sensitive data in the JSON response payload to send back. Other than that, the same logic applies, we prepare and invoke the backend in the same manner to obtain the individual data.</p>
</div>
<div class="paragraph">
<p>In version 1.0, we saw the routes implemented using the Java DSL. In version 2.0, we will use the XML DSL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of one DSL over the other is more of a user preference. The XML DSL helps in keeping Camel routes definitions well organised. In contrast, the Java DSL is placed inside Java classes, at times challenging to locate, along with other regular Java code. Your code can get a bit messy and disorganised. Also, the Java DSL doesn’t enjoy the support of graphical tooling, while XML and YAML are DSLs that allow visual helpers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let’s look at the new Camel route definition the developer has coded in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;route&gt;
    &lt;from uri="direct:getAnonymousDetails"/&gt;
    &lt;to uri="atlasmap:map/request.adm"/&gt;
    &lt;to uri="direct:call-backend"/&gt;
    &lt;to uri="atlasmap:map/response-anonymous.adm"/&gt;
&lt;/route&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The new route is almost identical to the first one. You will observe only two differences:</p>
</div>
<ol>
    <li>The <code>‘direct’</code> component matches the new <code>‘operationId’</code> in version 2.0</li>
    <li>The response data mapping is new</li>
</ol>
<div class="paragraph">
<p>The data mapping definition from 2) looks as follows in the AtlasMap editor:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/atlasmap-mapping-response-anonymous.png" alt="Mapping definition anonymised for the response flow">
</div>
</div>
<div class="paragraph">
<p>The main highlight from above is the definition of an <code>‘anonymous’</code> constant that maps to the <code>‘fullName’</code> and <code>‘passportId’</code> target fields:</p>
</div>
<ul>
    <li><code>Name:  anonymous</code></li>
    <li><code>Value: *********</code></li>
</ul>
<div class="paragraph">
<p>The new Camel route and the new mapping definition completes the implementation of the new operation in v2.0. At this stage, the developer is sweating from the enormous effort and the long hours it took to deliver the new version.</p>
</div>
<div class="sect2">
<h3 id="summary-2"><a class="anchor" href="#summary-2"></a>Summary</h3>
<div class="paragraph">
<p>Let’s quickly review the actions required to complete the second iteration of the service:</p>
</div>
<ol>
    <li>Replace the OpenApi v1.0 with the new specification v2.0</li>
    <br/>
    <li><span>Create the new Camel route<br/>(1-line if you copy/paste)</span></li>
    <br/>
    <li><span>Create the new data mapping<br/>(2 drag and drop actions if you copy/paste)</span></li>
</ol>
<br>
<div class="paragraph">
<p>Again, not bad at all. The effort was truly minimal.</p>
</div>
<br>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trying-out-the-operations"><a class="anchor" href="#trying-out-the-operations"></a>Trying out the operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To discover and explore services in code-first developments, you need to ensure the project auto-generates the specification from the implemented code.</p>
</div>
<div class="paragraph">
<p>In our case (contract-first) the specification is already provided. We can easily expose it and embed a Swagger-UI client using the Smallrye OpenApi extension that Quarkus provides. Ensure your POM file includes the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-smallrye-openapi&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more detailed information on how to expose OpenApi definitions, you can read the following section in the Quarkus documentation. There are different settings we can configure to our liking. We’ve configured some of them. If you feel curious, we encourage you to look at the source code provided with the article.</p>
</div>
<div class="paragraph">
<p>We can compile and run our application locally with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw clean quarkus:dev</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Remember, our Camel integration invokes a legacy backend. We’ve provided one included in the GitHub project. Ensure you read and follow the ‘Readme.md’ instructions to prepare the stub (legacy backend).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the application is up and running, open a browser and discover the service by entering the following URL on your address bar:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080/camel/openapi.json</pre>
</div>
</div>
<div class="paragraph">
<p>Click and try out the v1.0 operation:</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/swagger-op1.png" alt="First operation in Swagger client" width="60%">
</div>
</div>
<div class="paragraph">
<p>Enter a dummy value for the <code>{id}</code> parameter, for example, <code>‘123’</code>. If your legacy system (stub) is up and running, you should obtain the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "passportId": "123456789-A",
  "fullName": "Some One",
  "addressLine1": "1 Some Street",
  "addressLine2": "Somewhere SOME C0D3",
  "addressLine3": "UK"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, give a go to our v.2.0 operation:</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="/assets/images/posts/camel-quarkus-effortless-apis/swagger-op2.png" alt="Second operation in Swagger client" width="60%">
</div>
</div>
<div class="paragraph">
<p>You should obtain the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "addressLine1": "1 Some Street",
  "addressLine2": "Somewhere SOME C0D3",
  "addressLine3": "UK",
  "passportId": "**********",
  "fullName": "**********"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will observe some of the fields now anonymised as per the mapping settings in AtlasMap.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="last-words"><a class="anchor" href="#last-words"></a>Last words</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This article shows you how choosing Camel Quarkus, and a contract-first implementation approach provides great simplicity and low maintenance cost. It allows rapid functionality growth.</p>
</div>
<div class="paragraph">
<p>When your processes move data from sources to targets, use Camel Quarkus, probably the best fit for the job when building integration services.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources"><a class="anchor" href="#resources"></a>Resources:</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is a list of related resources you may be interested to explore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/brunoNetId/camel-quarkus-api-first">Github project</a> where the blog&#8217;s source code lives.</p>
</li>
<li>
<p><a href="https://developers.redhat.com/articles/2022/03/14/choose-best-camel-your-integration-ride-part-1">Article</a> covering Camel Quarkus and Camel K, also based in Quarkus.</p>
</li>
<li>
<p><a href="https://camel.apache.org/camel-quarkus/next/index.html">Camel Quarkus</a> home page in Apache Camel.</p>
</li>
<li>
<p><a href="https://www.atlasmap.io/">AtlasMap</a> home page, the visual data mapping tool that accelerates your implementation.</p>
</li>
<li>
<p><a href="https://www.apicur.io/">Apicurio</a> home page, the Design time tool to create your OpenAPI contracts.</p>
</li>
</ul>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/camel-quarkus-effortless-apis/&title=Riding Camel Quarkus: effortless APIs" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fa-brands fa-linkedin fa-xl"></i>
  </a>
  <a class="share-x" href="https://x.com/intent/tweet?text=Riding Camel Quarkus: effortless APIs&url=https://quarkus.io/blog/camel-quarkus-effortless-apis/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on X">
    <i class="fa-brands fa-square-x-twitter fa-xl"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/camel-quarkus-effortless-apis/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fa-brands fa-square-facebook fa-xl"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/camel-quarkus-effortless-apis/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fa-brands fa-square-reddit fa-xl"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Riding Camel Quarkus: effortless APIs&amp;body=Riding Camel Quarkus: effortless APIs https://quarkus.io/blog/camel-quarkus-effortless-apis/" title="Share via Email" >
    <i class="fa-solid fa-envelope fa-xl"></i>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
