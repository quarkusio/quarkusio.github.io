<!DOCTYPE html>
<html lang="en">







<head>
  <title>Quarkus OpenId Connect (OIDC) Expanded Configuration Reference - 3.27 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com https://ajax.googleapis.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />

  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/3.27/guides/security-oidc-expanded-configuration" />
  <meta property="og:title" content="Quarkus OpenId Connect (OIDC) Expanded Configuration Reference - 3.27" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/security-oidc-expanded-configuration">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/3.27/guides/security-oidc-expanded-configuration" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/3.27/guides/security-oidc-expanded-configuration" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/3.27/guides/security-oidc-expanded-configuration" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/3.27/guides/security-oidc-expanded-configuration" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/3.27/guides/security-oidc-expanded-configuration" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/3.27/guides/security-oidc-expanded-configuration" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/3.27/guides/security-oidc-expanded-configuration">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/3.27/guides/security-oidc-expanded-configuration">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/3.27/guides/security-oidc-expanded-configuration">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/3.27/guides/security-oidc-expanded-configuration">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/3.27/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.31.2 - Latest</option>
        
        
        
        <option value="3.27" selected>3.27</option>
        
        
        
        
        
        
        
        
        
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">Quarkus OpenId Connect (OIDC) Expanded Configuration Reference </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus OIDC <code>quarkus-oidc</code> extension provides a comprehensive, highly adaptable and configurable OIDC and OAuth2 adapter implementation.
It supports many OIDC and OAuth2 providers, bearer access token and authorization code flows, various provider client authentication mechanisms, token verification and introspection requirements, and much more.</p>
</div>
<div class="paragraph">
<p><code>quarkus-oidc</code> prioritizes on letting users meet most of requirements without having to write custom code, while also letting users customize and filter different parts of the OIDC flows. But the OIDC and OAuth2 space is huge and supporting many of required combinations with configuration propertes has its cost.</p>
</div>
<div class="paragraph">
<p>As you can see from the <a href="security-oidc-configuration-properties-reference">OIDC Configuration properties reference</a> document which contains OIDC properties generated from JavaDocs, a number of properties in the <code>quarkus.oidc.*</code> namespace is large. Even though only a very minimum number of properties may be required to cover most typical requirements, users may find it difficult to find the right combination.</p>
</div>
<div class="paragraph">
<p>Many properties, which may look unusual or redundant in one specific deployment, have been added to address concrete requirements to support other deployments. Some important properties may have weaker default values to avoid breaking deployments whose providers do not support such properties by default, or provide limited or non-standard support.</p>
</div>
<div class="paragraph">
<p>This document provides an expanded description of the <a href="security-oidc-configuration-properties-reference">OIDC Configuration properties</a>, explains why some properties have been introduced, why they have current default values, and suggests typical property combinations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="core-properties"><a class="anchor" href="#core-properties"></a>Core properties</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="oidc-enablement-properties"><a class="anchor" href="#oidc-enablement-properties"></a>Enablement</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. OIDC enablement property</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the OIDC extension is enabled</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This build-time property is about controlling if the whole OIDC extension should be enabled. If it is disabled at build-time then the OIDC extension is unavailable at runtime.</p>
</div>
</div>
<div class="sect2">
<h3 id="tenant-properties"><a class="anchor" href="#tenant-properties"></a>Tenant</h3>
<div class="paragraph">
<p>Quarkus OIDC tenant configuration represents specific requirements associated with a single OIDC provider, an individual tenant or realm among multiple OIDC provider tenants or realms.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. OIDC tenant properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.tenant-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the tenant is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.tenant-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tenant id</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These two properties allow to specify if the OIDC tenant configuration should be enabled and the OIDC tenant name.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.tenant-enabled</code> property can be useful even if you work with a single default OIDC tenant, for example, when the OIDC integration in the container should be activated only on the container startup.</p>
</div>
<div class="paragraph">
<p>In most cases, you do not need to deal with the <code>quarkus.oidc.tenant-id</code> property unless you have multiple OIDC tenant configuration requirements and create an OIDC tenant configuration <code>programmatically</code>. If you configure OIDC tenants in <code>application.properties</code>, then, as you can see from the <a href="security-oidc-configuration-properties-reference">OIDC Configuration properties reference</a> document, the tenant id is declared as a 3rd token in the tenant-specific group of properties.</p>
</div>
<div class="paragraph">
<p>For example, the following configuration sets the OIDC <code>tenant-1</code> configuration requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.tenant-1.auth-server-url=${tenant-1-auth-server-url}
quarkus.oidc.tenant-1.discovery-enabled=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure or create as many tenant configurations as you need and have them resolved at the request time.</p>
</div>
<div class="paragraph">
<p>See the <a href="#multi-tenancy">Multi-tenancy</a> section for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="oidc-metadata-properties"><a class="anchor" href="#oidc-metadata-properties"></a>Metadata</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. OIDC Metadata properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.auth-server-url</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDC base URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.discovery-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable discovery</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authorization-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.jwks-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON Web Key Set (JWKS) path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.introspection-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token introspection path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.user-info-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UserInfo path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.end-session-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">End session (logout) path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.revoke-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token revocation path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.registration-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDC client registration path</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.auth-server-url</code> is a key base OIDC URL property. By default, Quarkus OIDC adds a <code>.well-known/openid-configuration</code> path segment to this URL and discovers the OIDC provider metadata.</p>
</div>
<div class="paragraph">
<p>You can disable metadata discovery with <code>quarkus.oidc.discovery-enabled=false</code> when the provider does not support it (most OAuth2 providers do not), when you would like to optimize start up time by skipping a remote discovery call and configure individual OIDC provider endpoint URLs instead.</p>
</div>
<div class="paragraph">
<p>Individual OIDC endpoint URLs such as <code>quarkus.oidc.authorization-path</code> can also be set when you need to override one of the discovered OIDC endpoint URLs or when the discovered OIDC metadata does not include a required endpoint URL.</p>
</div>
<div class="paragraph">
<p>These URLs can be either relative to the base <code>quarkus.oidc.auth-server-url</code> URL or absolute.</p>
</div>
<div class="paragraph">
<p>For example, usually you need to disable the discovery and specify individual endpoint URLs when working with OAuth2 providers, see the <a href="security-oidc-code-flow-authentication#oauth2">OAuth2 providers</a> section for more details.</p>
</div>
<div class="paragraph">
<p>The individual OIDC endpoint URLs that you may need to configure depends on the OIDC <a href="#application-type">Application type</a> and expected token formats.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authorization-path</code>, <code>quarkus.oidc.token-path</code> and <code>quarkus.oidc.end-session-path</code> are only relevant when the &lt;&lt;authorization-code-flow&gt; authentication is enabled with <code>quarkus.oidc.application-type=web-app</code>.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.jwks-path</code> is needed to fetch JSON Web Key Set (JWKS) but only if the tokens are JSON Web Tokens (JWT). When it is <code>quarkus.oidc.application-type=web-app</code>, ID tokens representing the user authentication are always in JWT format, and in most cases JWK keys are needed to verify them. The JWKS path is not needed if you work with opaque (binary) bearer access tokens which are usually remotely introspected instead.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.introspection-path</code> is required in most cases when an opaque (binary) access token must be introspected remotely because such tokens can not have attached signatures that can be verified. It is worth setting <code>quarkus.oidc.introspection-path</code> even if you work with JWT tokens and your provider supports the remote token introspection. In such cases, JWT tokens can be introspected remotely as a fallback, when no matching JWK verification key has been found to verify JWT locally.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.user-info-path</code> is usually required after the &lt;&lt;authorization-code-flow&gt; completion, when <code>UserInfo</code> must be requested to get more information about the user, in addition to what is already available in the ID token.
Requesting <code>UserInfo</code> is also possible for the bearer access token flow.</p>
</div>
<div class="paragraph">
<p>When you work with OAuth2 providers which issue binary access tokens but do not support the remote introspection, and do not have standard <code>UserInfo</code> support, <code>quarkus.oidc.user-info-path</code> must point to the OAuth2 provider specific endpoint returning information about the current user, in order to support an indirect access token verification. See the <a href="security-oidc-code-flow-authentication#oauth2">OAuth2 providers</a> section for more details.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.revoke-path</code> and <code>quarkus.oidc.registration-path</code> are currently not used directly by Quarkus OIDC.
Applications <a href="security-openid-connect-client-reference#revoke-access-tokens">can revoke tokens</a> on logout, and other security events.
Applications that already work with <code>quarkus-oidc</code> can use <code>quarkus.oidc.registration-path</code> to <a href="security-openid-connect-client-registration">dynamically register OIDC clients</a>.</p>
</div>
<div class="paragraph">
<p>But please remember, all or some of these OIDC endpoint specific URLs may be discoverable when your provider supports the metadata discovery.</p>
</div>
<div class="paragraph">
<p>See also the <a href="#resource-metadata-properties">Protected Resource Metadata</a> section about accessing the protected resource metadata.</p>
</div>
</div>
<div class="sect2">
<h3 id="application-type"><a class="anchor" href="#application-type"></a>Application type</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Application type property</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.application-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application type</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>OIDC application type determines how the the current request is authenticated.</p>
</div>
<div class="paragraph">
<p>The default <code>service</code> application type is used when a <code>bearer</code> access token is sent with an HTTP <code>Authorization: Bearer &lt;token&gt;</code> header to access the Quarkus application. For example, a <code>Single-page application</code> (SPA) can use access tokens to access Quarkus on behalf of the currently logged-in SPA user.</p>
</div>
<div class="paragraph">
<p>The <code>web-app</code> application type is used when the <code>quarkus-oidc</code> extension uses an &lt;&lt;authorization-code-flow&gt; to authenticate users to Quarkus and create session cookies.</p>
</div>
<div class="paragraph">
<p>The <code>hybrid</code> application type can be used to support both bearer access token and authorization code flows at the same time.
If the current request has an HTTP <code>Authorization: Bearer &lt;token&gt;</code> header then the bearer access token is verified, otherwise, if no session cookie is available, the user is redirected to the OIDC provider to authenticate.</p>
</div>
</div>
<div class="sect2">
<h3 id="client-id-secret"><a class="anchor" href="#client-id-secret"></a>Client</h3>
<div class="paragraph">
<p>The <code>quarkus-oidc</code> extension represents a registered OIDC application client.
This client needs to authenticate to the OIDC provider when acquiring, introspecting or revoking tokens.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Client id and secret properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.client-id</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.client-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.secret</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client secret</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Registered OIDC client has a client id and usually, a client secret.</p>
</div>
<div class="paragraph">
<p>Both <code>quarkus.oidc.client-id</code> and <code>quarkus.oidc.credentials.secret</code> are optional when JWT bearer access tokens are accepted since they can be verified locally with the JWK verification keys available from a public OIDC JWKS key set endpoint. However, configuring <code>quarkus.oidc.client-id</code> is RECOMMENDED in this case anyway to make the OIDC log messages more informative.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.client-name</code> is a user-friendly client name and is currently only used  to make the log messages more informative.</p>
</div>
<div class="paragraph">
<p>If you enable an <a href="#authorization-code-flow">Authorization code flow</a> authentication with <code>quarkus.oidc.application-type=web-app</code>, then configuring <code>quarkus.oidc.client-id</code> and <code>quarkus.oidc.credentials.secret</code> (or other type of client credentials) is required in order to complete the current authorization code flow, because the OIDC token endpoint requires the client authentication.</p>
</div>
<div class="paragraph">
<p>Both of these properties are also usually required if the tokens must be introspected, both for the bearer access token and authorization code flows.</p>
</div>
<div class="paragraph">
<p>See also the <a href="#client-credentials">Client authentication options</a> section for a complete description of supported OIDC provider client authentication options.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client-credentials"><a class="anchor" href="#client-credentials"></a>Client authentication options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>quarkus.oidc.credentials.secret</code> client secret property was already introduced in the previous <a href="#client-id-secret">Client</a> section and using this property alone maybe sufficient to authenticate to many OIDC and OAuth2 compliant providers.</p>
</div>
<div class="paragraph">
<p>However, even this single OIDC client secret property may be treated in four different ways, depending on how a specific provider expects it be used: be sent alongside <code>quarkus.oidc.client-id</code> as an HTTP <code>Authorization: Basic</code> credentials pair (default), as an HTTP POST form parameter, or even as a query parameter (as expected by the <a href="security-openid-connect-providers#strava">Strava OAuth2 provider</a>), or is used as a placeholder for a generated JWT token for the <a href="security-oidc-code-flow-authentication#apple-post-jwt">Apple client authentication</a>.</p>
</div>
<div class="paragraph">
<p>Have a look at the complete overview of the authentication properties below and check the <a href="security-oidc-code-flow-authentication#oidc-provider-client-authentication">OIDC provider client authentication</a> section for more details.</p>
</div>
<div class="sect2">
<h3 id="client-secret"><a class="anchor" href="#client-secret"></a>Client secret</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Client secret credentials</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.secret</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client secret - use it if the HTTP <code>Authorization: Basic</code> client id and secret pair is expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.client-secret.value</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client secret value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.client-secret.method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How client secret should be submitted or used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.client-secret.provider.name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CredentialsProvider bean name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.client-secret.provider.keyring-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keyring name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.client-secret.provider.key</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The client secret key</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a client secret is configured with <code>quarkus.oidc.credentials.secret</code>, it is sent alongside <code>quarkus.oidc.client-id</code> as an HTTP <code>Authorization: Basic</code> credentials pair. However, some providers can only accept the client id and secret if they are sent as POST form parameters, when you need to use the <code>quarkus.oidc.credentials.client-secret.method=post</code> configuration.</p>
</div>
<div class="paragraph">
<p>The remaining three properties in the <code>quarkus.oidc.credentials.client-secret.provider.*</code> namespace allow to customize how a custom <a href="credentials-provider">CredentialsProvider</a> can be used to provide secrets stored in secure locations. Alternatively, you can use Quarkus Configuration system to manage secrets, see the <a href="config-secrets">Secrets in Configuration</a> guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="jwt-client-credentials"><a class="anchor" href="#jwt-client-credentials"></a>JWT client credentials</h3>
<div class="paragraph">
<p>Instead of sending a client secret, Quarkus OIDC can authenticate to OIDC providers by sending a generated JWT authentication token signed with either a client secret or private key.</p>
</div>
<div class="sect3">
<h4 id="client-secret-jwt"><a class="anchor" href="#client-secret-jwt"></a>Client Secret JWT</h4>
<div class="paragraph">
<p>JWT <a href="https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication">client_secret_jwt client authentication option</a> requires creating a JWT token signed with a symmetric key also known to the OIDC provider.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. JWT client_secret_jwt method properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.secret</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If provided, indicates that JWT is signed using a secret key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.signature-algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HS256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature algorithm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.provider.name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CredentialsProvider bean name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.provider.keyring-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keyring name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.provider.key</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The client secret key</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By default, the OIDC client secret acts as the shared symmetric key, and can be configured with <code>quarkus.oidc.credentials.jwt.secret</code>. This is the same secret one can declare, for example, with the <code>quarkus.oidc.credentials.secret</code> property but having an option to define it in the <code>quarkus.oidc.credentials.jwt.<strong></code> namespace is better for the JWT <code>client_secret_jwt</code> authentication, as one may also need to customize the headers and claims added to JWT with setting more properties in the <code>quarkus.oidc.credentials.jwt.</strong></code> namespace, see the <a href="#jwt-authentication-headers-claims">JWT authentication headers and claims</a> section below for more details.</p>
</div>
<div class="paragraph">
<p>The remaining three properties in the <code>quarkus.oidc.credentials.jwt.provider.*</code> namespace allow to customize how a custom <a href="credentials-provider">CredentialsProvider</a> can be used to provide <code>quarkus.oidc.credentials.jwt.secret</code> secrets stored in secure locations. Alternatively, you can use Quarkus Configuration system to manage secrets, see the <a href="config-secrets">Secrets in Configuration</a> guide.</p>
</div>
<div class="paragraph">
<p>By default, <code>HS256</code> algorithm requiring a 32 characters long secret is used to sign generated authentication tokens but it can be strengthened with an algorithm such as <code>HS512</code> using the <code>quarkus.oidc.credentials.jwt.signature-algorithm</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="private-key-jwt"><a class="anchor" href="#private-key-jwt"></a>Private Key JWT</h4>
<div class="paragraph">
<p>JWT <a href="https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication">private_key_jwt client authentication option</a> requires creating a JWT token signed with the client private key, with the client public key registered in the OIDC provider.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. JWT private_key_jwt method properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.key</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The inlined key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.key-file</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.key-store-file</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key store file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.key-store-password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key store file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.key-id</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.key-password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.signature-algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RS256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature algorithm</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.credentials.jwt.key</code> contains an inlined Base64-encoded private key representation, and is especially useful when you need to supply it as an environment property.
<code>quarkus.oidc.credentials.jwt.key-file</code> point to a PEM file containing the private key.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.credentials.jwt.key-store-file</code>, <code>quarkus.oidc.credentials.jwt.key-store-password</code>, <code>quarkus.oidc.credentials.jwt.key-id</code> and <code>quarkus.oidc.credentials.jwt.key-password</code> can be used to extract the private key from a keystore.</p>
</div>
<div class="paragraph">
<p>By default, RSA <code>RS256</code> algorithm is used to sign a JWT authentication token but it can be changed with <code>quarkus.oidc.credentials.jwt.signature-algorithm</code>, for example, to Elliptic Curve <code>ES256</code>.</p>
</div>
<div class="paragraph">
<p>See also the <a href="#jwt-authentication-headers-claims">JWT authentication headers and claims</a> section below for details about customizing the generated JWT token.</p>
</div>
</div>
<div class="sect3">
<h4 id="jwt-authentication-headers-claims"><a class="anchor" href="#jwt-authentication-headers-claims"></a>JWT authentication headers and claims</h4>
<div class="paragraph">
<p><a href="https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication">Standard OIDC client authentication text</a> describes the claims that the generated token must contain but the values of these claims may have to be overridden.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. JWT header and claim properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.token-key-id</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token key id (<code>kid</code>) header value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.audience</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDC token endpoint address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Audience (<code>aud</code>) claim value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.issuer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDC client id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issuer (<code>iss</code>) claim value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.subject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDC client id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject (<code>sub</code>) cliam value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.lifespan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan added to the <code>issued at</code> (<code>iat</code>) claim value to calculate the expiry (<code>exp</code>) claim value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.claims</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of extra string claims that must be added to the token</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.credentials.jwt.token-key-id</code> can be used to set a key identifier (<code>kid</code>) header value to help the OIDC provider with fidning a token verification key.
All other properties listed in the table above can be used to customize JWT claim values.</p>
</div>
</div>
<div class="sect3">
<h4 id="jwt-bearer"><a class="anchor" href="#jwt-bearer"></a>JWT Bearer</h4>
<div class="paragraph">
<p>By default, when a client JWT authentication token must be produced, it is generated by Quarkus OIDC. In some cases, the JWT bearer token may be provided and periodically updated by Kubernetes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. JWT source properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generated by quarkus-oidc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How the authentication JWT token is produced</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.credentials.jwt.token-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the token source is BEARER then this path must point to a JWT bearer token in the file system</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Set <code>quarkus.oidc.credentials.jwt.source=bearer</code> if the client authentication token is provided by Kubernetes, and use <code>quarkus.oidc.credentials.jwt.token-path</code> to point to the file resource containing this token.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mutual-tls"><a class="anchor" href="#mutual-tls"></a>Mutual TLS</h3>
<div class="paragraph">
<p>See the <a href="#tls-properties">TLS properties</a> section if the MTLS authentication is required.</p>
</div>
</div>
<div class="sect2">
<h3 id="introspection-credentials"><a class="anchor" href="#introspection-credentials"></a>Introspection credentials</h3>
<div class="paragraph">
<p>When the tokens must be introspected, some providers may require the introspection specific authentication credentials, as opposed to the already configured OIDC client id and one of the OIDC client authentication credentials:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Introspection credentials properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.introspection-credentials.name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Introspection name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.introspection-credentials.secret</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Introspection secret</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.introspection-credentials.include-client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include client id</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.introspection-credentials.name</code> and <code>quarkus.oidc.introspection-credentials.secret</code> must be used only if your provider requires the introspection specific authentication credentials. In this case, the introspection endpoint may also require a <code>quarkus.oidc.client-id</code>  property sent as a <code>client_id</code> parameter.</p>
</div>
<div class="paragraph">
<p>Currently, introspection credentials, if configured, can only be sent as HTTP POST form parameters.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connection-properties"><a class="anchor" href="#connection-properties"></a>Connection properties</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Connection properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.use-blocking-dns-lookup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Blocking DNS lookup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.connection-delay</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection delay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.connection-retry-count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection retry count</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.connection-time-out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection time out</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.proxy-host</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.proxy-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.proxy-username</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.proxy-password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy password</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.use-blocking-dns-lookup</code> should be set to <code>true</code> to avoid a Vert&#8217;x thread getting blocked when an OIDC provider connection is established on the slow network.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.connection-retry-count</code> sets a number of connection retries and <code>quarkus.oidc.connection-time-out</code> sets a duration after which the current OIDC connection request times out. <code>quarkus.oidc.connection-delay</code> establishes a delay for an initial connection request only.</p>
</div>
<div class="paragraph">
<p>Four properties in the <code>quarkus.oidc.proxy.*</code> namespace can be used to control access to HTTP proxies.</p>
</div>
<div class="paragraph">
<p>In some cases, OIDC provider, after accepting HTTP GET requests to either discovery or UserInfo endpoints, initiates a redirect exactly to the same endpoint address while also supplying some additional cookies.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Redirect control properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.follow-redirects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Follow OIDC provider redirects</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Quarkus OIDC supports such redirects by default but you are RECOMMENDED to disable it with <code>quarkus.oidc.follow-redirects=false</code> if you do not expect HTTP redirects during Quarkus OIDC communicating with the OIDC provider.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tls-properties"><a class="anchor" href="#tls-properties"></a>TLS properties</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. TLS properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.tls-configuration-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS Registry name</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use <code>quarkus.oidc.tls-configuration-name</code> to reference a <a href="tls-registry-reference">TLS Registry</a> configuration that can be required when the OIDC provider requires an HTTPS connection or Quarkus OIDC provider client must use MTLS authentication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authorization-code-flow"><a class="anchor" href="#authorization-code-flow"></a>Authorization code flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authorization code flow is a complex, multi-step process which may work with a few properties only but require a lot of tuning to deal with the specific OIDC or OAuth2 provider&#8217;s implementation and deployment constraints.</p>
</div>
<div class="paragraph">
<p>The authorization code flow is enabled with the <code>quarkus.oidc.application-type=web-app</code> application type.</p>
</div>
<div class="sect2">
<h3 id="authorization-code-flow-initiation"><a class="anchor" href="#authorization-code-flow-initiation"></a>Authorization code flow initiation</h3>
<div class="paragraph">
<p>An initial stage (first leg) of the authorization code flow requires Quarkus OIDC to build a correct redirect URL and redirect the user to the OIDC provider to authenticate.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Authorization code flow initiation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.redirect-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDC callback URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.response-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDC response mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required OIDC scopes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.add-openid-scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add <code>openid</code> scope</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.scope-separator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">' '</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope separator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.extra-params</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extra parameters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.forward-params</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward parameters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.force-redirect-https-scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Force redirect HTTPS scheme</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.allow-multiple-code-flows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-tab support</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.redirect-path</code> relative path points to the Quarkus endpoint where the user is redirected to by OIDC provider, after the user completed the authentication challenge. The absolute address of this endpoint is the one you set during the OIDC application registration as a callback URL. For example, if the Quarkus endpoint is running at <code><a href="https://myservice.com" class="bare">https://myservice.com</a></code> and you have the <code>quarkus.oidc.authentication.redirect-path=service</code> redirect path then <code><a href="https://myservice.com/service" class="bare">https://myservice.com/service</a></code> is an absolute callback URL.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.response-mode</code> defines how the OIDC provider returns the authorization code flow properties such as <code>code</code>. Usually, these parameters are returned as query parameters, for example, <code><a href="https://myservice.com/service?code=somecode&amp;state=somestate" class="bare">https://myservice.com/service?code=somecode&amp;state=somestate</a></code>. It is a <code>query</code> response mode which is supported by default.</p>
</div>
<div class="paragraph">
<p>However, such parameters may also be returned to Quarkus with the POST form payload directly in the request body. It is achieved by the provider returning an HTML page to the user and this page auto-submitting the form payload to Quarkus. Some providers such as <a href="security-openid-connect-providers#apple">Apple</a> can enforce this response mode.
Set <code>quarkus.oidc.authentication.response-mode=form</code> if supporting this mode is required. Also note that in this case, setting <code>quarkus.oidc.authentication.remove-redirect-parameters=true</code> is not necessary, since the <code>code</code> and other parameters are submitted in the request body.</p>
</div>
<div class="paragraph">
<p>Most OIDC providers expect a <code>scope=openid</code> parameter in the initial redirect URL, and Quarkus always adds it itself by default, there is no need to do <code>quarkus.oidc.authentication.scopes=openid</code>, but quite often you may have to provide an additional scope or a comma separated list of scopes to request additional permissions for the access token that will be issued (alongside ID and refresh tokens) once the authorization code flow is completed.
For example, if you need Quarkus application to read your Google Calendar on your behalf, you can do <code>quarkus.oidc.authentication.scopes=https://www.googleapis.com/auth/calendar.readonly</code>.</p>
</div>
<div class="paragraph">
<p>If more than one scope has to be submitted to the OIDC provider, then a ` ` space character (URL encoded as <code>%20</code>) is used to separate multiple scope values, for example, <code>scope=openid%20scope=read</code>. Some OAuth2 providers, notably <a href="security-openid-connect-providers#strava">Strava OAuth2</a> expect a comma <code>,</code> separator, thus you can do <code>quarkus.oidc.authentication.scope-separator=,</code>, etc.</p>
</div>
<div class="paragraph">
<p>Most OAuth2 providers fail if they see an <code>openid</code> scope but this scope is expected by default by most OIDC providers. This is when <code>quarkus.oidc.authentication.add-openid-scope=false</code> may have to be set.</p>
</div>
<div class="paragraph">
<p>Apart from the usual <code>scope</code>, <code>redirect_uri</code> and <code>state</code> query initial redirect parameters, other parameters may have to be included, and the map <code>quarkus.oidc.authentication.extra-params</code> property can help, for example, <code>quarkus.oidc.authentication.extra-params.prompt=consent</code>, etc.</p>
</div>
<div class="paragraph">
<p>The <code>quarkus.oidc.authentication.forward-params</code> map parameter can be used to choose which of the original user request URL&#8217;s query parameters are included in the redirect URI that Quarkus creates before redirecting the user to authenticate. Use this property with care.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.force-redirect-https-scheme</code> can be used to build a correct redirect URI when the original user request is made over HTTPS but the firewall terminates it and Quarkus sees the <code>http://</code> scheme.
By setting <code>quarkus.oidc.authentication.force-redirect-https-scheme=true</code>, you tell Quarkus to use the <code>https://</code> scheme, even when Quarkus OIDC sees the <code>http://</code> scheme in the current request URL, to ensure the user is correctly redirected to the HTTPS based OIDC authorization endpoint. Setting this property may not be necessary if you already enabled Quarkus to recognize adoc:http-reference#reverse-proxy[Forwarded or X-Forwarded headers].</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.allow-multiple-code-flows</code> allows multi-tab authentication by default. For example, a user starts an authorization code flow in one tab, is about to enter the requested credentials, does not complete it because of some interruption, later opens another tab and starts and completes another authorization code flow, with the original one still pending in the first tab. Now, the already authenticated user returns to the first tab and completes it as well. If this kind of authentication flow flexibility is considered too much for the stricter authentication policies you may have, set <code>quarkus.oidc.authentication.allow-multiple-code-flows=false</code>. See also the <code>quarkus.oidc.authentication.fail-on-missing-kid</code> property description below.</p>
</div>
</div>
<div class="sect2">
<h3 id="authorization-code-flow-completion"><a class="anchor" href="#authorization-code-flow-completion"></a>Authorization code flow completion</h3>
<div class="paragraph">
<p>A completion stage (second leg) of the authorization code flow requires Quarkus OIDC to exchange the authorizaion code for ID, access and refresh tokens.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Authorization code flow completion properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.code-grant.extra-params</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extra parameters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.code-grant.headers</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extra headers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.restore-path-after-redirect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restore path after redirect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.remove-redirect-parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove redirect parameters after redirect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.nonce-required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If nonce is required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.pkce-required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If Proof Key for Code Exchange (PKCE) is required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.user-info-required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If UserInfo is required</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.code-grant.extra-params</code> is a map property which can be used to set additional parameters that must be sent to the OIDC token endpoint to complete the authorization code flow, after the user authenticated and got redirected to Quarkus with the authorization <code>code</code>. Often, this <code>code</code> and the <code>redirect_uri</code> which must match the one included in the initial authorization code flow redirect are sent as form parameters, in addition to the client authentication credentials.</p>
</div>
<div class="paragraph">
<p>Sometimes, additional HTTP headers must also be provided to complete the authorization code flow. Use the <code>quarkus.oidc.code-grant.headers</code> map property in such cases.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.restore-path-after-redirect</code> can be used to restore the original request path which was used to initiate the authorization code flow.
For example, let&#8217;s assume your application provides a lot of endpoints that require a secured access, and registering all possible initial secure Quarkus endpoint URLs as OIDC callback URLs is not possible. In such cases, <code>quarkus.oidc.authentication.restore-path-after-redirect=true</code> can be set to get Quarkus OIDC redirect the authenticated user to the original request URL after this user was returned to the callback URL configured with <code>quarkus.oidc.authenticaion.redirect-path</code>. In this case, the callback URL is expected to be virtual, there is no need to allocate a JAX-RS callback endpoint to support it.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.remove-redirect-parameters</code> forces an additional redirect after the authenticated user got redirected to Quarkus and the authorization code got exchanged for tokens and a session was established. This is done to drop the authorization code flow specific properties such as <code>code</code> and <code>state</code> from the URL, which, if the application does not follow with its own redirects, may remain visible in the browser as URL query parameters.
Note though that the <code>code</code> is a one time token that can only be exchanged by Quarkus OIDC which knows the client credentials required to complete the authorization code flow. However, in general, dropping these is RECOMMENDED and should be done by default.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.nonce-required</code> is an authorization code flow security hardening property that can prevent replay attacks. If Quarkus is asked to generate it and include a <code>nonce=&lt;generated_nonce&gt;</code> query parameter during an initial authentication redirect, the OIDC provider must return an ID token which includes a <code>nonce</code> claim with a matching <code>nonce</code> value. It is set to <code>false</code> by default because it is not guaranteed to be supported by default by all OIDC and especially OAuth2 providers. Setting this property to <code>true</code> is <code>RECOMMENDED</code> if your provider supports this feature.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.pkce-required</code> can be used to enable <a href="https://www.rfc-editor.org/rfc/rfc7636">Proof Key for Code Exchange (PKCE)</a>. PKCE is of primary interest to public SPA OIDC clients running in a browser. Typically, Quarkus OIDC acts as a confidential OIDC client which can prove to the OIDC provider that it knows the client secret, when PKCE is not strictly necessary. However you may have to enable it when your provider enforces PKCE for all authorization code flow clients.</p>
</div>
<div class="paragraph">
<p>When the authorization code flow is completed, Quarkus gets access to the <code>ID token</code> which can provide sufficient information about the currently authenticated user. However, quite often, an additional remote request to the OIDC provider&#8217;s <a href="https://openid.net/specs/openid-connect-core-1_0.html#UserInfo">UserInfo</a> endpoint is required to get more details about the user.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.user-info-required</code> can be used to enable an additional remote <code>UserInfo</code> request.</p>
</div>
<div class="paragraph">
<p>When you work with pure OAuth2 providers such as GitHub, setting <code>quarkus.oidc.authentication.user-info-required=true</code> is always required. The reason is that <code>OAuth2</code> does not provide <code>ID token</code>, but only an <code>access token</code>. In the OAuth2-only world alone, the access token is not even meant for the current client, which is the Quarkus endpoint which acquired it, but for this endpoint to access some downstream service on behalf of the current user.
But Quarkus needs to have an access to the current user identity, therefore this property must be set in such cases.
But since OAuth2 providers do not have a standard OIDC <code>UserInfo</code> endpoint, <code>quarkus.oidc.user-info-path</code> must be configured to point to the OAuth2 provider specific endpoint returning information about the current user, for example, in case of GitHub, it is <code><a href="https://api.github.com/user" class="bare">https://api.github.com/user</a></code>.
See the <a href="security-oidc-code-flow-authentication#oauth2">OAuth2 providers</a> section for more informatiom.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.user-info-required</code> is enabled automatically if it is detected that the Quarkus endpoint has <code>quarkus.oidc.UserInfo</code> injected - you <code>do not have to enable</code> this property in this case.</p>
</div>
<div class="paragraph">
<p>This property is also enabled automatically if you have to <a href="#verify-access-token-with-user-info">Verify access token with UserInfo</a> or work with OAuth2 providers that do not return an ID token but a binary access token only that must be indirectly verified with <code>UserInfo</code>, see the <a href="#id-token-availability">ID token availability</a> section for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="authorization-code-flow-errors"><a class="anchor" href="#authorization-code-flow-errors"></a>Authorization code flow errors</h3>
<div class="paragraph">
<p>Authorization code flow is not always completed successfully. The user may cancel the authentication challenge or fail to provide the correct credentials. In such cases, instead of the <code>code</code> parameter, the <code>error</code> and <code>error_description</code> parameters are returned to Quarkus.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Authorization code flow error properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.error-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.fail-on-missing-state-param</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail on missing state parameter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.fail-on-missing-kid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail on missing key</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the authorization code flow fails, the user gets HTTP 401 status error by default, but a better user experience can be provided by returning a formatted page explaining to the user what happened. You can use <code>quarkus.oidc.authentication.error-path</code> to point to the endpoint resource which can access the <code>error</code> and <code>error_description</code> parameters forwarded to it by Quarkus OIDC to create such a page.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.fail-on-missing-state-param</code> is about controlling what should happen when the state cookie is detected, thus indicating that the first leg of the authorization code flow is about to be completed, but no matching <code>state</code> query parameter is found in what is expected a return redirect from the OIDC provider to Quarkus OIDC.
This property is set to <code>false</code> by default because it is the case with a multi-tab authentication, where a state cookie related to one tab is available but the current request represents a new tab authentication request (see also the <code>quarkus.oidc.authentication.allow-multiple-code-flows</code> property description in the <a href="#authorization-code-flow-initiation">Authorization code flow initiation</a> section above).
It also makes it much easier to develop and test OIDC secured endpoints, since otherwise, trying to access Quarkus again after the failed or abandoned authentication attempts at the OIDC provider site can cause difficult to explain HTTP 401 status errors due to the loose state cookies, requiring cleaning the browser cache.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.fail-on-missing-state-param=true</code> does not relax the security, it is primarily about the user experience: if, for whatever reasons, the authorization code flow can not be completed due to a misssing <code>state</code> query parameter, the user is redirected to the OIDC provider to re-authenticate, rather than returning a blank HTTP 401 response to the user.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.fail-on-missing-kid</code> property is related to the mult-tab authentication. It can happen that the session&#8217;s ID token signature can no longer be verified because the authentication in another tab caused a verification key refresh, and the key identifier for the current ID token can no longer be found, causing HTTP <code>401</code>. To request the user re-authentication instead, you may want to set this property to <code>false</code>. It is set to <code>true</code> by default to stress that a situation where a token&#8217;s signature can not be verified should be treated with care.</p>
</div>
</div>
<div class="sect2">
<h3 id="authorization-code-flow-spa"><a class="anchor" href="#authorization-code-flow-spa"></a>SPA integration</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. SPA integration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.java-script-auto-redirect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if Java Script auto redirect is required</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When you use SPA to delegate to Quarkus OIDC to manage the authorization code flow, <code>quarkus.oidc.authentication.java-script-auto-redirect</code> can be used to work around the fact that many OIDC providers do not support CORS for their authorization endpoints which challenge the user with the authentication screen. By setting`quarkus.oidc.authentication.java-script-auto-redirect=true`, you request Quarkus to return HTTP  <code>499</code> status, instead of the <code>302</code> redirect that would be blocked due to the lack of CORS support for such redirects on the OIDC provider&#8217;s side, when this redirect is managed by the SPA XHR. The SPA can catch the <code>499</code> error and use the <code>window</code> API to bypass the browser script restrictions.</p>
</div>
<div class="paragraph">
<p>See the <a href="#custom-java-script-request-checker">JavaScript request checker</a> section for details about customizing Java Script request checks.</p>
</div>
</div>
<div class="sect2">
<h3 id="id-token-availability"><a class="anchor" href="#id-token-availability"></a>ID token availability</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. ID token availability</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.id-token-required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if ID token is required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.internal-id-token-lifespan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access token <code>expires_in</code> property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">internal ID token lifespan</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>OIDC is different from OAuth2 because it adds a new type of token representing the user authentication, <code>ID token</code>.
<code>quarkus-oidc</code> works with compliant OIDC providers which return an ID token but also has to support OAuth2 providers which do not return it. Use <code>quarkus.oidc.authentication.id-token-required=false</code> to tell Quarkus that your provider can not provide a required ID token.
In this case, Quarkus generates an internal ID token to represent a session.
Quarkus OIDC also expects that the OAuth2 provider specific <code>UserInfo</code> endpoint path is configured with <code>quarkus.oidc.user-info-path</code> to fetch information about the current user.</p>
</div>
<div class="paragraph">
<p>Since the session has to be created but the OAuth2 provider does not return an ID token which can be used to calculate the session age, an <code>quarkus.oidc.authentication.internal-id-token-lifespan</code> duration property can be used to set the session lifespan. When the OAuth2 server returns an access token <code>expires_in</code> property then this property is used as a session age property, if <code>quarkus.oidc.authentication.internal-id-token-lifespan</code> is not configured.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cookie-properties"><a class="anchor" href="#cookie-properties"></a>Authorization code flow cookies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus OIDC creates a <code>state</code> cookie when an authorization code flow is started and a <code>session</code> cookie when it is completed.</p>
</div>
<div class="sect2">
<h3 id="common-cookie-properties"><a class="anchor" href="#common-cookie-properties"></a>Common cookie properties</h3>
<div class="paragraph">
<p>The common cookie properties impact both the authorization code flow session and state cookies.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Common cookie properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.cookie-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'/'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cookie path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.cookie-domain</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cookie domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.cookie-path-header</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cookie path header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.cookie-same-site</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cookie SameSite status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.cookie-suffix</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cookie suffix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.cookie-force-secure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cookie force secure</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.cookie-path</code> and <code>quarkus.oidc.authentication.cookie-domain</code> properties control which application paths the state and session cookies will be available at. The wider the cookie-path is ("/"), the wider the application secured space can be. You may want to restrict it to more specific paths such as <code>/secured</code>, to make it easier to handle the public space available at paths such as <code>/public</code>.
You may also want to restrict it when the specific endpoint paths should only be accessible by users who authenticated with specific providers only. For example, <code>/keycloak</code> path can only accessible by users authenticated with Keycloak, <code>/google</code> - with Google, etc. See also the <a href="#multi-tenancy">Multi-tenancy</a> section for more information.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.cookie-path-header</code> can be used to dynamically set the required cookie path - this property should be used with care and only when it fits your deployment requirements.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.cookie-same-site</code> defines a <code>Same-Site</code> attribute as <code>lax</code> by default, since setting it to <code>strict</code> proved to be breaking some deployments. However, setting it to <code>strict</code> is RECOMMENDED when it is known to work in your deployment, for example, when the OIDC provider is hosted in the same domain as the application, etc.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.cookie-suffix</code> can be used to customize the state and session cookie names. For example, by setting <code>%test.quarkus.oidc.authentication.cookie-suffix=test</code> you can have the session cookie name qualified with the <code>_test</code> suffix in the test profile only.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.cookie-force-secure</code> may only be relevant in some deployments if Quarkus is listening on non-secure HTTP protocol but running behind HTTPS terminating reverse proxy. This property has no impact if Quarkus is listening on HTTPS, when cookies are always secure.</p>
</div>
</div>
<div class="sect2">
<h3 id="state-cookie-properties"><a class="anchor" href="#state-cookie-properties"></a>State cookie</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. State cookie properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.state-secret</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State cookie encryption secret</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.state-cookie-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State cookie age</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Quarkus OIDC creates a state cookie whose value must match the <code>state</code> query parameter passed between Quarkus and the OIDC provider during two redirects.
In addition to the actual state value, the state cookie may need to keep the <code>nonce</code> value if an ID token is required to contain a <code>nonce</code> claim with <code>quarkus.oidc.authentication.nonce-required=true</code> and a Proof Key for Code Exchange (PKCE) <code>code-verifier</code> if PKCE is required with <code>quarkus.oidc.authentication.pkce-required=true</code>. Both of these values must be encrypted. In such cases, the state cookie is encrypted with a generated secret key but you can provide your own, typically a 32 characters long, state cookie encryption secret with <code>quarkus.oidc.authentication.state-secret</code>.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.state-cookie-age</code> defines a state cookie lifespan.</p>
</div>
</div>
<div class="sect2">
<h3 id="session-cookie-properties"><a class="anchor" href="#session-cookie-properties"></a>Session cookie and refresh</h3>
<div class="paragraph">
<p>Session cookie is created after an authorizaion code flow is completed. An expired session cookie can be refreshed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Session properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.refresh-expired</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow refreshing token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.refresh-token-time-skew</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refresh token time skew</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.session-age-extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session age extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.session-expired-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session expired path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.cache-control</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of Cache-Control header directives</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.token.refresh-expired</code> can be used to enable automatic user session renewal when the user session has expired and the refresh token is available. This property is not enabled by default because with the automatic renewal, the user, after authenticating once, may not be asked to re-authenticate for a very long time. Therefore an admin level decision may be required to enable an automatic session renewal.</p>
</div>
<div class="paragraph">
<p>If you prefer the users to re-authenticate after some rather long idle period of time, consider configuring <code>quarkus.oidc.authentication.session-expired-path</code> instead, see below for more details.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.refresh-token-time-skew</code> can be used to force the refresh when it is allowed with <code>quarkus.oidc.token.refresh-expired</code> and the ID token in the session cookie is still valid.
You can use this property to request the refresh if a still valid ID token is due to expire within the next hour. If you would like to auto-refresh user sessions, then having this property minimizes the risk of the user missing out on the session refresh if the session cookie itself got expired and removed by the browser. When you use SPA, you can have a background thread pinging Quarkus periodically, leading to a session refresh once Quarkus determines the ID token will expire soon within a configured <code>quarkus.oidc.token.refresh-token-time-skew</code> period of time.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s assume the ID token age is 6 hours and therefore the session cookie age is also 6 hours. If the user accessed Quarkus 1 hour before it was about to expire, and then stayed idle for 2 hours, then, after the user accesses Quarkus again, 7 hours after the session cookie was created and 1 hour after it and the ID token got expired and removed by the browser, Quarkus OIDC can only request the user re-authentication since it can no longer see the session cookie. To minimize a number of re-authentication attempts, consider extending the session age, for example, by 3 hours. Now, given the last example, Quarkus OIDC may still get access to the expired ID token and do somethnig useful with it if required - refresh it or offer a user a session expired page, instead of immediately requesting a new authentication.</p>
</div>
<div class="paragraph">
<p>The <code>quarkus.oidc.token.refresh-token</code> property is automatically enabled if the <code>quarkus.oidc.token.refresh-token-time-skew</code> property is configured.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.authentication.session-expired-path</code> can be used to present the user whose session has expired with the page explaining that the session has expired and letting user follow a link to re-authenticate. It improves the user experience, since otherwise, the authenticated user, whose session has expired, may get surprised after getting an unexpected OIDC provider&#8217;s authentication challenge screen, when accessing the Quarkus application, following some delay after successfully authenticating earlier.</p>
</div>
<div class="paragraph">
<p>See also the <a href="#token-state-manager">Store authorization code flow tokens</a> section for more information about managing session cookies.</p>
</div>
<div class="paragraph">
<p>When a new session cookie is created, either after a successful authorization code flow completion or a token refresh, it may be necessary to control how the session cookie is managed by HTTP cache intermediaries and the browser cache.
Currently, only a <code>Cache-Control</code> <code>no-store</code> directive that prohibits caching the session cookie anywhere in the client request chain can be configured.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="token-state-manager"><a class="anchor" href="#token-state-manager"></a>Store authorization code flow tokens</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After the authorization code flow is finished, ID token, access token, and refresh token must be retained to support the user session.</p>
</div>
<div class="paragraph">
<p>By defaut, Quarkus OIDC stores all three tokens in an encrypted session cookie, making Quarkus OIDC stateless.
Quarkus OIDC also provides the stateful <a href="security-oidc-code-flow-authentication#db-token-state-manager">Database TokenStateManager</a> to store tokens in your database of choice and the <a href="security-oidc-code-flow-authentication#redis-token-state-manager">Redis TokenStateManager</a> to store them in the Redis cache. Users can also register custom <code>quarkus.oidc.TokenStateManager</code> to store these tokens as required.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Default TokenStateManager</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token-state-manager.encryption-required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encrypt session cookie by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token-state-manager.encryption-secret</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption secret, with falling back to the client secret and finally a generated secret key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token-state-manager.encryption-algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A256GCMKW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption algorithm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token-state-manager.split-tokens</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cookie per token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token-state-manager.strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keep ID, access and refresh tokens</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keep all or some of ID, access and refresh tokens</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Default <code>TokenStateManager</code> keeps tokens in an encrypted session cookie by default. Encrypting the tokens increases the session cookie size - you might want to consider disabling the session cookie encryption when the Quarkus application and its clients all operate within an internal, secure network.</p>
</div>
<div class="paragraph">
<p>A session cookie encryption secret can be configured with <code>quarkus.oidc.token-state-manager.encryption-secret</code>. Quarkus OIDC fallbacks to the configured client secret if the encryption secret is not configured, and, if the client secret is also not available (for example, when the JWT <code>private_key_jwt</code> or MTLS client authentication method is used) -  generates a secure random secret itself. Be aware that generating an encryption secret can cause re-authentication failures in a multi-pod container deployment where one pod may not be able to decrypt a session cookie encrypted by the secret known to another pod only.</p>
</div>
<div class="paragraph">
<p>JWE encryption is used to encrypt the session cookie, using the <code>A256GCMKW</code> algorithm to wrap the generated content encryption key by default. You can try to use the JWE <code>dir</code> encryption with <code>quarkus.oidc.token-state-manager.encryption-algorithm=dir</code> which can produce shorter JWE sequences as the encryption and decryption is done with the same session cookie encryption key directly, avoiding the need to generate and wrap a content encryption key.</p>
</div>
<div class="paragraph">
<p>The encrypted session cookie with up to three tokens may exceed a 4096 bytes cookie size limit, causing the browser to drop it. If it happens, Quarkus OIDC attempts to split the large session cookie into individual session cookie chunks by default and re-assemble them into a single session cookie when the user returns, before decrypting it. But you can try the <code>quarkus.oidc.token-state-manager.split-tokens=true</code> option in order to have one session cookie per token - where the main session cookie keeps an ID token, and two more session cookies - access and refresh tokens.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token-state-manager.strategy</code> can be used to optimize the token storage by not storing the tokens your application does not intend to use.</p>
</div>
<div class="paragraph">
<p>For example, you can do <code>quarkus.oidc.token-state-manager.strategy=id-refresh-tokens</code> which means that your application is not intending to use an access token directly or propagate it to downstream services, all it wants is to use ID token to interact with the user and keep refreshing the session.</p>
</div>
<div class="paragraph">
<p>If your application does not need to use access tokens but only interact with the authenticated user who must always re-authenticate when the session expires, consider <code>quarkus.oidc.token-state-manager.strategy=idtoken</code> - which retains ID token only, ignoring both access and refresh tokens.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="logout-properties"><a class="anchor" href="#logout-properties"></a>Logout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus OIDC supports three standard OIDC logout options: <a href="#rp-initiated-logout">RP-initiated Logout</a>, <a href="#back-channel-logout">Back-channel Logout</a>, and <a href="#front-channel-logout">Front-channel logout</a>, as well as a local logout option. See the <a href="security-oidc-code-flow-authentication#logout-and-expiration">OIDC logout</a> section for more information.</p>
</div>
<div class="sect2">
<h3 id="rp-initiated-logout"><a class="anchor" href="#rp-initiated-logout"></a>RP-initiated Logout</h3>
<div class="paragraph">
<p><code>RP-initiated</code> logout involves the logged-in user initiating a logout request by calling an application logout endpoint. Quarkus OIDC intercepts this request, clears the session cookie and redirects the user to the OIDC provider&#8217;s logout endpoint.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. RP-initiated logout properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.post-logout-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Post logout path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.post-logout-uri-param</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Post logout uri param</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.extra-params</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout extra params</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.logout-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout mode</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.logout.path</code> is a relative path where a user logout request should be sent to. For example, given <code>quarkus.oidc.logout.path=/logout</code>, a <code>Logout</code> link in the SPA page can point to <code><a href="http://localhost:8080/logout" class="bare">http://localhost:8080/logout</a></code>. This path can be virtual, you do not have to create a JAX-RS endpoint or route handler listening on <code>/logout</code>. But for the <code>quarkus.oidc.logout.path</code> be effective, it must be secured, see the <a href="https://quarkus.io/guides/security-oidc-code-flow-authentication#user-initiated-logout">User-initiated logout</a> section for more details.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.logout.post-logout-path</code> points to a public endpoint where you would like the provider redirect the looged-out user to.
For example, the logged out user can be returned to the application&#8217;s welcome page with <code>quarkus.oidc.logout.post-logout-path=/welcome.html</code> where this user can choose to login again.
For the post logout redirect to work, OIDC providers usually require registering absolute post logout URLs such as <code><a href="http://localhost:8080/welcome.html" class="bare">http://localhost:8080/welcome.html</a></code>. Please do not forget, it must be a public endpoint, otherwise the user will be requested to login immediately after choosing to logout.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.logout.post-logout-uri-param</code> and <code>quarkus.oidc.logout.extra-params</code> can be used to customize the RP-initiated logout query parameters, for example, Auth0 might expect Auth0-specific logout query parameters, see the <a href="https://quarkus.io/guides/security-oidc-code-flow-authentication#user-initiated-logout">User-initiated logout</a> section for more details.</p>
</div>
<div class="paragraph">
<p>By default, all the logout parameters are serialized as logout URL query parameters.
Some OIDC providers may require that logout parameters are encoded as HTML form values and auto-submitted in the browser with the HTTP POST method and the <code>application/x-www-form-urlencoded</code> content type: set <code>quarkus.oidc.logout.logout-mode=form-post</code> in this case.</p>
</div>
</div>
<div class="sect2">
<h3 id="back-channel-logout"><a class="anchor" href="#back-channel-logout"></a>Back-channel Logout</h3>
<div class="paragraph">
<p>Back-channel logout should be used for complex Quarkus applications involving several services, possibly on different hosts or ports, when supporting a global logout is required. The user, by choosing to logout from one of the services, also gets logged out from all other services.
The OIDC provider detects the logout request (for example, an RP-initiated one) from one of the services and sends back-channel notifications to all other Quarkus OIDC applications. See the <a href="security-oidc-code-flow-authentication#back-channel-logout">OIDC Back-channel logout</a> section for more details.</p>
</div>
<div class="paragraph">
<p>PLease be aware that supporting the back-channel logout option requires managing a cache of pending back-channel notifications. It may take awhile to clear them as it requires a user whose back-channel logout is pending to access Quarkus. The more users your application deals with, the larger the cache size can be.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. Back-channel logout properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.backchannel.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Back-channel logout path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.backchannel.logout-token-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sub</code> claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Back-channel logout token key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.backchannel.token-cache-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Back-channel logout token cache size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.backchannel.token-cache-time-to-live</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Back-channel logout token cache time to live</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.backchannel.clean-up-timer-interval</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Back-channel logout token cache clean up interval</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.logout.backchannel.path</code> is a relative path the OIDC provider must send the back-channel logout notifications to.</p>
</div>
<div class="paragraph">
<p>The back-channel notification contains a logout token. It must be cached so that when one of the authenticated users tries to access Quarkus, this user&#8217;s ID token can be matched against this logout token. The subject (<code>sub</code>) claim value is used by default to match the ID and logout tokens, but the session id (<code>sid</code>) claim can be used instead.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.logout.backchannel.token-cache-size</code>, <code>quarkus.oidc.logout.backchannel.token-cache-time-to-live</code> and <code>quarkus.oidc.logout.backchannel.clean-up-timer-interval</code> are properties for managing the back-channel notification cache.</p>
</div>
</div>
<div class="sect2">
<h3 id="front-channel-logout"><a class="anchor" href="#front-channel-logout"></a>Front-channel logout</h3>
<div class="paragraph">
<p>Front-channel logout is conceptually similar to the <a href="#back-channel-logout">Back-channel Logout</a> but the notifications are forwarded to Quarkus via the browser. See the <a href="security-oidc-code-flow-authentication#front-channel-logout">OIDC Front-channel logout</a> section for more details.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Front-channel logout properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.frontchannel.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Front-channel logout path</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.logout.frontchannel.path</code> is a secure path where the browser will send the front-channel logout request to.</p>
</div>
</div>
<div class="sect2">
<h3 id="clear-site-data"><a class="anchor" href="#clear-site-data"></a>Clear site data</h3>
<div class="paragraph">
<p>After the logout, you can request Quarkus OIDC to send a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Clear-Site-Data">Clear-Site-Data</a> response header with one or more directives instructing the browser how to clear the browser cache.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Clear-Site-Data header directives</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.logout.clear-site-data</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of Clear-Site-Data header directives</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>cache</code>, <code>client-hints</code>, <code>cookies</code>, <code>execution-contexts</code> and wildcard <code>*</code> directives can be configured.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="token-verification"><a class="anchor" href="#token-verification"></a>Token verification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Token properties cover a lot of requirements related to the token verification, introspection, key verification management, etc.</p>
</div>
<div class="sect2">
<h3 id="token-preprocessing"><a class="anchor" href="#token-preprocessing"></a>Token preprocessing</h3>
<div class="paragraph">
<p>ID and access tokens may have to be decrypted or their headers preprocessed for the verification process to start and succeed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. Token preprocessing properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.decryption-key-location</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decryption key location</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.decrypt-id-token</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decrypt ID token if this property is <code>true</code> or if <code>quarkus.oidc.token.decryption-key-location</code> is set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.decrypt-access-token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decrypt access token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.customizer-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customizer name</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>OIDC providers usually issue signed ID and access tokens but may also additionally encrypt these tokens which Quarkus needs to decrypt to verify them. Choose which token types must be decrypted: the ID token with <code>quarkus.oidc.token.decrypt-id-token</code>, or the access token with <code>quarkus.oidc.token.decrypt-access-token</code>.</p>
</div>
<div class="paragraph">
<p>Both ID and access tokens are considered encrypted if they contain 5 parts separated by the dot character, indicating that the JWE encryption was used.</p>
</div>
<div class="paragraph">
<p>For backward compatibility reasons, ID token decryption is attempted if  <code>quarkus.oidc.token.decryption-key-location</code> is configured, but using an optional <code>quarkus.oidc.token.decrypt-id-token</code> boolean property is RECOMMENDED instead, to allow for more flexibility in selecting decryption keys.</p>
</div>
<div class="paragraph">
<p>When either ID or access token must be decrypted, <code>quarkus.oidc.token.decryption-key-location</code> is checked first. If this property is not configured, then the <a href="#jwt-client-credentials">JWT client credentials</a> key, if available, is used. Finally, if the decryption key is still not initialized, the configured client secret is used as a decryption key.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.customizer-name</code> is an advanced property that may be used to select a specific <code>io.quarkus.oidc.TokenCustomizer</code> implementation which can pre-process JWT token headers before its signature can be verified. The main use-case is to support verifying legacy Azure JWT tokens which must have their <code>nonce</code> header recalculated for the signature verification to succeed.</p>
</div>
</div>
<div class="sect2">
<h3 id="token-claims"><a class="anchor" href="#token-claims"></a>Token claims</h3>
<div class="paragraph">
<p>Token verification claim properties impact the core token verification process, where the token claims or introspection properties must meet specific issuer, audience, age and other restrictions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. Token claims properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.issuer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovered value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token issuer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.audience</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of audiences</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.subject-required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if the subject ('sub') claim is required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.issued-at-required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if the issued at ('iat') claim is required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.age</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token age</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.lifespan-grace</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan grace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.token-type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.principal-claim</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal claim</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.required-claims</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of required string claims</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.signature-algorithm</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required signature algorithm</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Enforcing that a token has been issued by the specific issuer is RECOMMENDED. The token issuer is discovered when the provider supports the discovery, otherwise <code>quarkus.oidc.token.issuer</code> can be set to a specific value.</p>
</div>
<div class="paragraph">
<p>Enforcing that a token is intended for a specific audience is RECOMMENDED. ID tokens are required to have an audience value matching the <code>quarkus.oidc.client-id</code> property by default. For bearer access tokens, the audiences are not standardized, for example, they can be URLs representing a target endpoint. When possible, bearer access tokens should also be restricted to have specific audience values.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.subject-required</code> can be used to enforce that a token has a unique subject value. If your provider allocates a subject to the token then requiring it is RECOMMENDED, especially when you deal with multiple OIDC and OAuth2 providers and would like to get a unique user identifier. This property is not set by defaul since some providers may not always set it. For example, a Keycloak lightweight access token may not have a subject (<code>sub</code>) claim set.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.issued-at-required</code> can be set to <code>false</code> when you have to deal with the providers which do not set a token <code>issued at time</code> (<code>iat</code>) claim.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.age</code> property can be used to enforce how long an otherwise valid token can be used for. For example, some providers may issue tokens that are valid for several months - what if you do not want your users be able to access Quarkus with access tokens valid for a very long time ? In this case you can set a token age to some reasonable value such as 1 day, etc.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.lifespan-grace</code> property should only be used to avoid token verification failures due to the possible clock skews.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.token-type</code> can be used to enforce the token type when you know the provider sets a type (<code>typ</code>) claim. For example, Keycloak issues the ID token, access token and refresh token in JWT format, how how can you prevent SPA sending an ID token to Quarkus as if it were a bearer access token ? Setting <code>quarkus.oidc.token.token-type=bearer</code> enforces that only a JWT access token that contains a type (<code>typ</code>) claim with the <code>bearer</code> value can be accepted.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.principal-claim</code> can be used to customize which token claim should be used to support Java Security <code>Principal</code> and MicroProfile JWT  <code>JsonWebToken</code> APIs for getting the principal name. The <code>upn</code>, <code>preferred_username</code>, <code>sub</code> are some of the claims that are used to find the principal name by default, but some tokens may have it in the <code>name</code> or some other claim, which is when you can set <code>quarkus.oidc.token.principal-claim=name</code>, etc.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.required-claims</code> map property can be used to provide an additional simple check that the token contains specific string claim values.</p>
</div>
<div class="paragraph">
<p>See also the <a href="#custom-jose4j-validator">Jose4 Validator</a> section for details about customizing the JWT token verification.</p>
</div>
<div class="paragraph">
<p>By default, Quarkus uses available verification keys to verify JWT token signatures with whatever assymetric algorithm is supported by the OIDC provider and the available key set. For example, a token signed with either <code>RS256</code> or <code>PS256</code> algorithm can be accepted if the JWK set constains a public key that can verify the RSA signature created with either of these two algorithms. However, you may have a policy that requires that only a specific algorithm such as <code>RS512</code> must be used - use <code>quarkus.oidc.token.signature-algorithm=RS512</code> to enforce it.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-flow-access-token"><a class="anchor" href="#code-flow-access-token"></a>Code flow access token</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. Code flow access token verification</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.authentication.verify-access-token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify code flow access token</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Quarkus OIDC has a concept of a <code>primary</code> token. The bearer access token is a primary token because it is the only token which is used in the bearer access token flow and it is used by the external client to access Quarkus. Bearer access token <code>is always verified</code>.
ID token is a <code>primary</code> token in the authorizaion code flow - it represents the current authenticated user. ID token is <code>always verified</code>.</p>
</div>
<div class="paragraph">
<p>Code flow access token is not a primary token because it is not meant to be used to access the current Quarkus application which has completed the authorization code flow. Be it OIDC or OAuth2, the code flow access token is meant to be used to access another service on behalf of the currently authenticated user. For example, sending an <code>openid</code> scope during the authentication redirect to the provider leads to it issuing an access token that Quarkus application can use to fetch UserInfo from this provider on behalf of the user.</p>
</div>
<div class="paragraph">
<p>It is the job of the OIDC provider or one of the downstream Quarkus services that this Quarkus application needs to access with the code flow access token to verify it. This is one of the reasons the code flow access tokens are often provided as binary tokens.</p>
</div>
<div class="paragraph">
<p>However, if you have designed your application with an expectation that the code flow access token, typically in JWT format, can be used as a source of roles or other information relevant to your application then do <code>quarkus.oidc.authentication.verify-access-token=true</code>. Quarkus enables this property automatically if it can detect that <code>JsonWebToken</code> without an <code>@IdToken</code> qualifier is injected in the application code, indicating that the application intends to access a code flow access token.</p>
</div>
</div>
<div class="sect2">
<h3 id="verify-access-token-with-user-info"><a class="anchor" href="#verify-access-token-with-user-info"></a>Verify access token with UserInfo</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. Verify access token with UserInfo</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.verify-access-token-with-user-info</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verify access token indirectly by requesting UserInfo</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the incoming bearer access token is in binary format or when you login users with OAuth2 providers which give Quarkus only a binary access token, with no remote introspection endpoint available in both cases, how to verify this binary token ?</p>
</div>
<div class="paragraph">
<p>The only option is an indirect access token verification by attempting to use this binary token to access an OIDC standard or OAuth2 provider specific UserInfo endpoint, when a valid access token must be forwarded to the UserInfo endpoint. Set <code>quarkus.oidc.token.verify-access-token-with-user-info=true</code> if it is what is necessary in your case.</p>
</div>
<div class="paragraph">
<p>See also the <a href="security-oidc-code-flow-authentication#oauth2">OAuth2 providers</a> section for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="token-verification-key-refresh"><a class="anchor" href="#token-verification-key-refresh"></a>Verification key refresh</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. Token verification key refresh properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.forced-jwk-refresh-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWK refresh interval</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the JWT token&#8217;s signature must be verified, this token&#8217;s key identifier (<code>kid</code>) header value is used to find a matching JWK key from the local verification public key set. However, since providers tend to periodically recycle signing key pairs and start signing newly issued tokens with new private keys, at some point the local key set may not have the matching public key to verify the current JWT.
In this case, Quarkus attempts to refresh the verification key set, but blocks additional JWK key set refresh attempts for the <code>quarkus.oidc.token.forced-jwk-refresh-interval</code> period of time, to minimize the risk of many random tokens causing too many remote JWK set refresh attempts.</p>
</div>
</div>
<div class="sect2">
<h3 id="token-introspection"><a class="anchor" href="#token-introspection"></a>Token introspection</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. Token introspection properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.allow-jwt-introspection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow JWT introspection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.require-jwt-introspection-only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require JWT introspection only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.allow-opaque-token-introspection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow JWT introspection</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some OIDC providers support remote token introspecion endpoints and Quarkus fallbacks to introspecting JWT tokens if it can not find a matching JWK verification key even after refreshing the key set. However, just because the provider supports the introspection endpoint, your deployment policy may forbid the remote JWT token introspection: because the token may have sensitive claims, or for performance reasons, especially if you know that, for example, ID tokens can not be introspected remotely, but only verified locally with the JWK keys. Set <code>quarkus.oidc.token.allow-jwt-introspection=false</code> if you do not want JWT tokens sent for the remote introspection.</p>
</div>
<div class="paragraph">
<p>On the other hand, <code>quarkus.oidc.token.require-jwt-introspection-only</code> enforces that a decision as to whether the current JWT token is valid or not can only be taken by the OIDC provider itself, for example, in order to immediately recognize that the current token has already been revoked, etc. In this case you would also likely disable the discovery with <code>quarkus.oidc.discovery-enabled=false</code> to prevent Quarkus discovering the JWKs endpoint and fetching the verification keys which are not going to be used anyway.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token.allow-opaque-token-introspection</code> is a hardening type of property. Quarkus OIDC attempts to verify any access token which comes its way by default. But if you deal with JWT tokens, especially if you prefer to verify them only locally with <code>quarkus.oidc.token.allow-jwt-introspection=false</code>, then what if someone sends a binary (opaque) access token which your application does not really expect ? Setting <code>quarkus.oidc.token.allow-opaque-token-introspection=false</code> prevents possibly disruptive remote introspection calls and causes an immediate verification error when an opaque token is received.</p>
</div>
</div>
<div class="sect2">
<h3 id="token-roles"><a class="anchor" href="#token-roles"></a>Token roles</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. Token roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.roles.role-claim-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role claim path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.roles.role-claim-separator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">' '</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role claim separator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.roles.source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source of roles</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By default, a token <code>groups</code> array claim is expected to contain roles. The <code>realm_access/roles</code> and <code>realm_access/&lt;client-id&gt;/roles</code> claims are also checked in case the token was issued by Keycloak. But if the token has another custom claim containing roles, you can point to it with <code>quarkus.oidc.roles.role-claim-path</code>. It can be used to select a top-level array claim or a nested claim using a <code>/</code> path separator.
Make sure to use double quotes for namespace qualified claim names, for example, <code>quarkus.oidc.roles.role-claim-path="http://auth0.customroles/roles"</code>.</p>
</div>
<div class="paragraph">
<p>If you would like to treat a <code>scope</code> claim as a source of roles, then each space separated value in the <code>scope</code> claim is a role name. But string claims containing multiple role values can also be separated by the comma <code>,</code> or other characters. Use <code>quarkus.oidc.roles.role-claim-separator=,</code>, etc, in such cases.</p>
</div>
<div class="paragraph">
<p>Primary token is a source of roles by default: ID token is checked for roles in the authorization code flow and the access token is checked for roles in the bearer token flow.
If the application uses the authorization code flow, and you need to check the access token, as opposed to the primary ID token, then you can do <code>quarkus.oidc.roles.source=access_token</code> - you do not need to set this property if you deal with bearer access tokens.</p>
</div>
<div class="paragraph">
<p>Sometimes the roles are contained in the UserInfo response - do <code>quarkus.oidc.roles.source=userinfo</code> in this case.</p>
</div>
</div>
<div class="sect2">
<h3 id="token-binding"><a class="anchor" href="#token-binding"></a>Token binding</h3>
<div class="paragraph">
<p>Token bindings are tools for sender-constraining access tokens.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. MTLS token binding</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.binding.certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTLS token binding</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.token.binding.certificate=true</code> can be used to constrain the bearer access token to the MTLS client which is sending it as described in the <a href="https://datatracker.ietf.org/doc/html/rfc8705">RFC 8705: Mutual TLS token binding</a> specification.</p>
</div>
<div class="paragraph">
<p>Please see the <a href="security-oidc-bearer-token-authentication#mutual-tls-token-binding">Mutual TLS token binding</a> section for more information.</p>
</div>
<div class="paragraph">
<p>See also the <a href="#bearer-token-source-properties">Bearer token header</a> section for details about enabling a Demonstrating Proof of Posession (DPoP) binding.</p>
</div>
</div>
<div class="sect2">
<h3 id="bearer-token-source-properties"><a class="anchor" href="#bearer-token-source-properties"></a>Bearer token header</h3>
<div class="paragraph">
<p>HTTP <code>Authorization</code> header with the <code>Bearer</code> scheme is typically used to send the bearer access token.
For example: <code>Authorization: Bearer &lt;token&gt;</code>.</p>
</div>
<div class="paragraph">
<p>In some cases, both the header and the scheme may have to customized.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. Bearer token header properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token.authorization-scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bearer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token authorization scheme</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.token.header</code> and <code>quarkus.oidc.token.authorization-scheme</code> can be used to customize which HTTP header contains a bearer access token. You can customize the header and, when the HTTP <code>Authorization</code> is used - the scheme.</p>
</div>
<div class="paragraph">
<p>For example, you can set <code>quarkus.oidc.token.authorization-scheme=DPoP</code> to accept the DPoP access tokens sent as <code>Authorization: DPoP &lt;token&gt;</code>.
See the <a href="security-oidc-bearer-token-authentication#demonstrating-proof-of-possession-dpop">Demonstrating Proof of Posession</a> section for more information.</p>
</div>
<div class="paragraph">
<p>See also the <a href="#token-binding">Token binding</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="caching-verification-results"><a class="anchor" href="#caching-verification-results"></a>Token introspection and UserInfo cache</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. Caching verification and Userinfo results</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.default-token-cache-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable default token introspection and userinfo cache</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token-cache.max-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default token cache size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token-cache.time-to-live</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default token cache time-to-live</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.token-cache.clean-up-timer-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default token cache clean up time interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.allow-token-introspection-cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow token introspection cache</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.allow-user-info-cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow UserInfo cache</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.cache-user-info-in-idtoken</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow caching UserInfo in the internal ID token</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Remote token introspection and UserInfo results can be shared across multiple requests to avoid doing remote introspection and/or UserInfo calls for every token all the time.
By doing so the application may miss out on the immediate token status changes, for example, the token could have been revoked or de-activated, or the current user may not be actually working for the organization which issued this token any longer, making the cached token introspection or <code>UserInfo</code> information stale. Therefore, the properties related to caching token introspection and UserInfo results must be enabled by users after carefully evaluating the risks.</p>
</div>
<div class="paragraph">
<p>Quarkus OIDC provides a default token introspection and <code>UserInfo</code> cache for <code>all</code> OIDC tenants. For example, if you support GitHub and Strava OAuth2 authentication, the GitHib and Strava UserInfo responses can be stored in the same default cache, keyed by either GitHib or Strava access tokens.
This cache is enabled by default with the <code>quarkus.oidc.default-token-cache-enabled</code> build-time property, but no entries are added to it unless you choose to cache either the token introspection or UserInfo or both in this cache.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.allow-token-introspection-cache</code> and <code>quarkus.oidc.allow-user-info-cache</code> can be used to enable caching token introspection and UserInfo results respectively on a <code>per OIDC tenant</code> basis.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.token-cache.max-size</code>, <code>quarkus.oidc.token-cache.time-to-live</code> and <code>quarkus.oidc.token-cache.clean-up-timer-interval</code> are properties for managing the default token introspection and <code>UserInfo</code> cache.</p>
</div>
<div class="paragraph">
<p>See also the <a href="#custom-token-introspection-cache">Token introspection cache</a> and <a href="#custom-user-info-cache">UserInfo cache</a> sections for details about customizing both the token introspection and <code>UserInfo</code> result caches.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.cache-user-info-in-idtoken</code> is a possible cache optimization option when you work with OAuth2 providers, when an internal ID token is generated and encrypted in the session cookie. In this case, the UserInfo JSON can be saved directly in the generated ID token, before it is encrypted, avoiding the need for keeping the server-side <code>UserInfo</code> cache.</p>
</div>
</div>
<div class="sect2">
<h3 id="tokens-with-certificate-chains"><a class="anchor" href="#tokens-with-certificate-chains"></a>Tokens with certificate chain</h3>
<div class="paragraph">
<p>In some cases, incoming JWT tokens have no matching verification keys at all, and they can not be introspected.
These tokens only have an <code>x5c</code> claim which contains a certificate chain with a public key that can be used to verify this token&#8217;s signature.
For example, SCIM provisioning agents, WebAuthn systems might produce such tokens.</p>
</div>
<div class="paragraph">
<p>Quarkus OIDC can not use the public key inlined in the token until it proves that the applications trusts the token certificate chain which contains this public key.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. Tokens with certificate chains</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.certificate-chain.trust-store-file</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.certificate-chain.trust-store-file-type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store file type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.certificate-chain.trust-store-password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.certificate-chain.trust-store-cert-alias</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store certificate alias</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.certificate-chain.leaf-certificate-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leaf certificate name</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.certificate-chain.trust-store-file</code> must be available and point to the file containing <code>at least</code> a root certificate. <code>quarkus.oidc.certificate-chain.trust-store-password</code> and <code>quarkus.oidc.certificate-chain.trust-store-file-type</code> can be used to facilitate access to this truststore.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.certificate-chain.trust-store-cert-alias</code> can be used to select a specific certificate to match the token&#8217;s certificate chain root certificate.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.certificate-chain.leaf-certificate-name</code> can also require that the trustore contains a leaf chain certificate.</p>
</div>
<div class="paragraph">
<p>Quarkus OIDC enforces the root certificate match, and also runs other certificate chain checks to confirm that each certificate in the chain is not expired, and correctly signed by the next certificate in the chain (except the root certificate).</p>
</div>
<div class="paragraph">
<p>See also the <a href="#custom-certificate-validator">Certificate chain validation</a> section for details about providing additional certificate chain checks.</p>
</div>
</div>
<div class="sect2">
<h3 id="local-verification-properties"><a class="anchor" href="#local-verification-properties"></a>Local verification</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. Local verification properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.public-key</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public verification key</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.public-key</code> can contain an inlined public verification key and used for OIDC tests.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing-jwks"><a class="anchor" href="#managing-jwks"></a>Managing JWK keys</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. Managing JWK keys</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.jwks.resolve-early</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolve verification keys on start-up</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.jwks.cache-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWK cache size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.jwks.cache-time-to-live</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWK cache time to live</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.jwks.clean-up-timer-interval</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWK clean-up timer interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.jwks.try-all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check all JWKS if no ley matching the token key id ('kid') is found</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Token JWK verification keys are resolved at the application start-up by default and perodically refreshed when no matching key is available to verify the current token.</p>
</div>
<div class="paragraph">
<p>However, some applications require access to the current JWT token in order to formulate a correct JWK key request.
<code>quarkus.oidc.jwks.resolve-early=false</code> delays the JWK key retrieval until the moment the first JWT token arrives.
And since the token content determines which JWK keys should be used to verify it, a number of verification keys can be potentially large, therefore, when the JWKs have to be retrieved at the request time,  <code>quarkus.oidc.jwks.cache-size</code>, <code>quarkus.oidc.jwks.cache-time-to-live</code> and <code>quarkus.oidc.jwks.clean-up-timer-interval</code> properties can be used to control the JWK cache.</p>
</div>
<div class="paragraph">
<p>In most cases, when the token arrives, its key identifier <code>kid</code> header value is used to find a matching JWK verification key. However, some providers do not set a token <code>kid</code> header but provide a JWK key set which may contain more than one verification key. Set <code>quarkus.oidc.jwks.try-all=true</code> only to support such cases, letting Quarkus OIDC iterate over all the keys in the JWK set and find the key that can be used to verify the current token&#8217;s signature.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="composite-provider-properties"><a class="anchor" href="#composite-provider-properties"></a>Composite provider properties</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Provider properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.provider</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provider</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Quarkus OIDC simplifies working with many <a href="security-openid-connect-providers">well known OIDC and OAuth2 providers</a> by offering a <code>quarkus.oidc.provider</code> configuration option.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.provider</code> is a composite property. For example, when you do <code>quarkus.oidc.provider=github</code>, it is expanded into many more properties that are required to have Quarkus OIDC successfully working with the GitHub OAuth2 provider.</p>
</div>
<div class="paragraph">
<p>Everything that can be covered by a provider declaration such as <code>quarkus.oidc.provider=github</code> can be directly supported by individual configuration properties. Each property set internally by the <code>quarkus.oidc.provider</code> declarations can be overridden, for example, see the <a href="security-openid-connect-providers#provider-scope">Provider scopes</a> section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multi-tenancy"><a class="anchor" href="#multi-tenancy"></a>Multi-tenancy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned in the <a href="#tenant-properties">Tenant</a> section, when you configure OIDC tenants in <code>application.properties</code>, the tenant name is declared directly in the property name, for example, a <code>keycloak-realm-a</code> tenant is a 3rd token in the property name: <code>quarkus.oidc.keycloak-realm-a.auth-server-url=${keycloak-realm-a.url}</code>, etc.</p>
</div>
<div class="paragraph">
<p>Each OIDC tenant configuration represents specific requirements associated with a single OIDC provider, an individual tenant or realm among multiple OIDC provider tenants or realms.
For example, you may have one tenant for Keycloak, another tenant for Azure. Or you can have many tenants representing individual Keycloak realms or clients in a single Keycloak realm, or multiple Azure tenants.</p>
</div>
<div class="paragraph">
<p>Quarkus OIDC must decide which tenant configuration can support the current request and it provides many security-openid-connect-multitenancy.adoc#tenant-resolution[tenant resolution options]. Some of these resilution options must be enabled through the configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. Tenant resolution properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.resolve-tenants-with-issuer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issuer based tenant resolution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.tenant-paths</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tenant-paths</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.resolve-tenants-with-issuer</code> tenant resolution property allows Quarkus to iterate over all tenants configured in <code>application.properties</code> until it finds the one with a discovered or configured <code>issuer</code> property which matches the current token&#8217;s issuer (<code>iss</code>) claim.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.tenant-paths</code> tenant resolution property can be used to restrict a given tenant to specific request paths only. Quarkus OIDC will know which tenant configuration to choose if the current request is made to one of the paths listed in the <code>quarkus.oidc.tenant-paths</code> property.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-tenants-programmatically"><a class="anchor" href="#creating-tenants-programmatically"></a>Creating configuration programmatically</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Would you rather create OIDC tenants programmatically, instead of having to deal with all the required configuration properties in <code>application.properties</code> ? Quarkus OIDC offers two options if it is what you prefer to do.</p>
</div>
<div class="sect2">
<h3 id="create-oidc-configuration-at-start-up"><a class="anchor" href="#create-oidc-configuration-at-start-up"></a>Create OIDC configuration at start-up</h3>
<div class="paragraph">
<p>You can observe an <a href="https://quarkus.io/guides/security-openid-connect-multitenancy#programmatic-startup">Oidc startup event</a> and register one or more OIDC tenants using <code>OicTenantConfig</code> builder API.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-oidc-configuration-at-request-time"><a class="anchor" href="#create-oidc-configuration-at-request-time"></a>Create OIDC configuration at request time</h3>
<div class="paragraph">
<p>You can register <a href="security-openid-connect-multitenancy#tenant-config-resolver">TenantConfigResolver</a> and build the configuration dynamically, using <code>OicTenantConfig</code> builder API, using the request properties such as request path and headers for additional hints or retrieve the matching configuration from the external sources.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 43. OIDC Health Check</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.health.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the OIDC Health Readiness Check must be registered.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This build-time property can be used to register an <code>OIDC Provider Health Readiness Check</code> when the <code>quarkus-smallrye-health</code> dependency is included. When the health check is registered, it uses HTTP HEAD to ping the well-known OIDC provider configuration endpoint for every configured OIDC tenant.</p>
</div>
<div class="paragraph">
<p>Individual OIDC tenant statuses are <code>OK</code>, <code>Not Ready</code>, <code>Disabled</code>, <code>Unknown</code> and <code>Error</code>.</p>
</div>
<div class="paragraph">
<p>The OIDC Health check status is <code>UP</code> if at least one of the OIDC tenants has an <code>OK</code> status and <code>DOWN</code> otherwise.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="typical-property-combinations"><a class="anchor" href="#typical-property-combinations"></a>Typical property combinations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A number of OIDC property combinations required to address various OIDC and OAuth2 requirements can be very large.</p>
</div>
<div class="paragraph">
<p>Here are four options which you may want to consider, and we will continue expanding this list.</p>
</div>
<div class="sect2">
<h3 id="simple-bearer-access-token-support"><a class="anchor" href="#simple-bearer-access-token-support"></a>Simple bearer access token support</h3>
<div class="paragraph">
<p>You only need one property to get started with supporting bearer access tokens:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.auth-server-url=${oidc.provider.url}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This single property combination works if your OIDC provider supports the metadata discovery and the incoming bearer access tokens are in JWT format which can be verified by the keys fetched from the provider&#8217;s JWK endpoint.</p>
</div>
<div class="paragraph">
<p>You do not have to configure anything at all to get started with bearer access tokens <a href="security-openid-connect-dev-services">in the dev mode</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="simple-authorizaion-code-flow-support"><a class="anchor" href="#simple-authorizaion-code-flow-support"></a>Simple authorizaion code flow support</h3>
<div class="paragraph">
<p>You need four properties to get started with the authorization code flow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.auth-server-url=${oidc.provider.url}
quarkus.oidc.application-type=web-app
quarkus.oidc.client-id=${oidc.client-id}
quarkus.oidc.credentials.secret=${oidc.client-secret}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This property combination works if your OIDC provider supports the metadata discovery.</p>
</div>
<div class="paragraph">
<p>Very often, when your application secure space is wider than a single URL, you have to add a redirect-path property to support OIDC providers requiring that only specific callback URLs can be registered, for example: <code>quarkus.oidc.authentication.redirect-path=/callback</code>.</p>
</div>
<div class="paragraph">
<p>You only have to configure <code>quarkus.oidc.application-type=web-app</code> to get started with the authorization code flow <a href="security-openid-connect-dev-services">in the dev mode</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="strict-bearer-access-token-support"><a class="anchor" href="#strict-bearer-access-token-support"></a>Strict bearer access token support</h3>
<div class="paragraph">
<p>Strict bearer access token support implies enforcing that the claims such as issuer, audience and other key claims are set to specific values or available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.auth-server-url=${oidc.provider.url}

# set the required issuer if the provider does not return it in its discovered metadata
quarkus.oidc.token.issuer=${oidc.provider.issuer}

quarkus.oidc.token.audience=${this.endpoint.audience}

# require the subject claim if the provider is known to set it
quarkus.oidc.token.subject-required=true

# require that the otherwise valid token can not be accepted if it has been used for too long, for example, for more than 24 hours
quarkus.oidc.token.age=24H</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="strict-authorization-code-flow-support"><a class="anchor" href="#strict-authorization-code-flow-support"></a>Strict authorization code flow support</h3>
<div class="paragraph">
<p>Strict authorization code flow support implies enforcing that the claims such as issuer, audience and other key claims are set to specific values or available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.oidc.auth-server-url=${oidc.provider.url}
quarkus.oidc.application-type=web-app
quarkus.oidc.client-id=${oidc.client-id}
quarkus.oidc.credentials.secret=${oidc.client-secret}
quarkus.oidc.authentication.redirect-path=/callback

# require ID token to contain nonce claim matching the generated nonce parameter
quarkus.oidc.authentication.nonce-required=true

# set the required issuer if the provider does not return it in its discovered metadata
quarkus.oidc.token.issuer=${oidc.provider.issuer}

# No need to configure the audience, it is enforced for ID tokens
# quarkus.oidc.token.audience=${this.endpoint.audience}

# require the subject claim if the provider is known to set it
quarkus.oidc.token.subject-required=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="even-stricter-configuration-setup"><a class="anchor" href="#even-stricter-configuration-setup"></a>Even stricter configuration setup</h3>
<div class="paragraph">
<p>What constitues a strict bearer access token or authorization code flow support can vary significantly between deployments. For example, one OIDC provider may require MTLS client authentication, another one - DPoP binding or PKCE support. There are too many combinations for us to cover in this document.</p>
</div>
<div class="paragraph">
<p>We are here to help should you require further guidance with creating stricter, tighter OIDC configurations.
Do open issues, and reach out to the team on Quarkus Discussions, Zulip users channel.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customizations"><a class="anchor" href="#customizations"></a>When the configuration is not enough</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This expanded configuration reference document demonstrates that Quarkus OIDC supports a lot of OIDC requirements with properties alone. But it is impossible to cover all the possible requirements only with the properties.</p>
</div>
<div class="paragraph">
<p>In this section we will look at how your real world OIDC requirements can be supported by complementing the configuration with the custom code.</p>
</div>
<div class="sect2">
<h3 id="token-validation"><a class="anchor" href="#token-validation"></a>Token validation</h3>
<div class="sect3">
<h4 id="custom-jose4j-validator"><a class="anchor" href="#custom-jose4j-validator"></a>Jose4 Validator</h4>
<div class="paragraph">
<p>You can register a custom <a href="security-oidc-bearer-token-authentication#jose4j-validator-bearer">Jose4j Validator</a> to verify the JWT token content, in addition to the checks described in the <a href="#token-verification">Token verification</a> section above.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-certificate-validator"><a class="anchor" href="#custom-certificate-validator"></a>Certificate chain validation</h4>
<div class="paragraph">
<p>You can register a custom <a href="security-oidc-bearer-token-authentication#jwt-token-certificate-chain">TokenCertificateValidator</a> to provide inlined  certificate chain checks, in addition to the checks described in the <a href="#tokens-with-certificate-chains">Tokens with certificate chain</a> section above.</p>
</div>
<div class="paragraph">
<p>For example, you may want to enforce that the token is bound to the inlined certificate chain with one of its claims.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-token-header-customizer"><a class="anchor" href="#custom-token-header-customizer"></a>Token header customizer</h4>
<div class="paragraph">
<p>Custom <code>quarkus.oidc.TokenCustomizer</code> can be used in advanced cases requiring JWT token header pre-processing for the token signature verification to succeed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="token-authorization"><a class="anchor" href="#token-authorization"></a>Token authorization</h3>
<div class="paragraph">
<p>As discussed in the <a href="#token-roles">Token roles</a> section above, a token <code>groups</code> claims is used by default to check the identity roles, and custom claims containing the roles can also be selected with the configuration.
However, additional customization and checks may be required in order to correctly determine the roles and permissions associated with the current token identity.</p>
</div>
<div class="paragraph">
<p>Use <a href="security-customization#security-identity-customization">io.quarkus.security.identity.SecurityIdentityAugmentor</a> to augment the identity created from the primary ID or access token.</p>
</div>
<div class="paragraph">
<p>See also the <a href="security-authorize-web-endpoints-reference#custom-http-security-policy">HttpSecurityPolicy</a> and <a href="security-authorize-web-endpoints-reference#permission-checker">PermissionChecker</a> sections for more authorization control options.</p>
</div>
</div>
<div class="sect2">
<h3 id="custom-token-introspection-cache"><a class="anchor" href="#custom-token-introspection-cache"></a>Token introspection cache</h3>
<div class="paragraph">
<p>You can register a <code>quarkus.oidc.TokenIntrospectionCache</code> provider to support a custom token introspection cache implementation, as an alternative to the default cache implementation described in the <a href="#caching-verification-results">Token introspection and UserInfo cache</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="custom-user-info-cache"><a class="anchor" href="#custom-user-info-cache"></a>UserInfo cache</h3>
<div class="paragraph">
<p>You can register a <code>quarkus.oidc.UserInfoCache</code> provider to support a custom <code>UserInfo</code> cache implementation, as an alternative to the default cache implementation described in the <a href="#caching-verification-results">Token introspection and UserInfo cache</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="tokenstatemanager"><a class="anchor" href="#tokenstatemanager"></a>TokenStateManager</h3>
<div class="paragraph">
<p>As discussed in the <a href="#token-state-manager">Store authorization code flow tokens</a> section above, Quarkus OIDC already provides stateless (default) and stateful options for storing  authorization code flow tokens.
You can also provide your own custom <code>quarkus.oidc.TokenStateManager</code> implementation.</p>
</div>
</div>
<div class="sect2">
<h3 id="request-response-and-redirect-filters"><a class="anchor" href="#request-response-and-redirect-filters"></a>Request, response and redirect filters</h3>
<div class="paragraph">
<p>You can use OIDC filters to observe requests and responses to all OIDC endpoints.</p>
</div>
<div class="paragraph">
<p>You can also intercept OIDC redirect requests.</p>
</div>
<div class="sect3">
<h4 id="oidc-requests"><a class="anchor" href="#oidc-requests"></a>OIDC requests</h4>
<div class="paragraph">
<p>You can use OIDC request filters to observe requests, add additional headers, customize a request body, and set context properties for coordinating with OIDC response filters.</p>
</div>
<div class="paragraph">
<p>Use <a href="security-oidc-code-flow-authentication#code-flow-oidc-request-filters">quarkus.oidc.common.OidcRequestFilter</a> to implement a request filter and if necessary, restrict it to the specific OIDC endpoint or endpoints only with the <code>quarkus.oidc.common.OidcEndpoint</code> annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="oidc-responses"><a class="anchor" href="#oidc-responses"></a>OIDC responses</h4>
<div class="paragraph">
<p>You can use OIDC response filters to observe responses, customize a response body, and use the context properties for coordinating with OIDC request filters.</p>
</div>
<div class="paragraph">
<p>Use <a href="security-oidc-code-flow-authentication#code-flow-oidc-response-filters">quarkus.oidc.common.OidcResponseFilter</a> to implement a response filter and if necessary, restrict it to the specific OIDC endpoint or endpoints only with the <code>quarkus.oidc.common.OidcEndpoint</code> annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="oidc-redirects"><a class="anchor" href="#oidc-redirects"></a>OIDC redirects</h4>
<div class="paragraph">
<p>You can use OIDC redirect filters to observe redirect requests to both OIDC authorization and logout endpoints.</p>
</div>
<div class="paragraph">
<p>Use <a href="security-oidc-code-flow-authentication#oidc-redirect-filters">quarkus.oidc.OidcRedirectFilter</a> to implement a redirect filter and if necessary, restrict it to the specific OIDC endpoint only with the <code>quarkus.oidc.Redirect</code> annotation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-java-script-request-checker"><a class="anchor" href="#custom-java-script-request-checker"></a>JavaScript request checker</h3>
<div class="paragraph">
<p>As described in the <a href="#authorization-code-flow-spa">SPA integration</a> section, Quarkus OIDC can return an error to initiate an authorization code flow for SPA
to intercept it and work around the fact that some OIDC providers do not support CORS for the authorization endpoint.</p>
</div>
<div class="paragraph">
<p>For Quarkus OIDC to do it, it needs to know if the request came from SPA. By default. it checks if the <code>X-Requested-With</code> request header with its value set to either <code>JavaScript</code> or <code>XMLHttpRequest</code> is available.</p>
</div>
<div class="paragraph">
<p>See the <a href="security-oidc-code-flow-authentication#single-page-applications">Integrating with SPA</a> documentation for more information about customizing JavaScript request checks with custom <code>quarkus.oidc.JavaScriptRequestChecker</code> request checkers.</p>
</div>
</div>
<div class="sect2">
<h3 id="local-logout"><a class="anchor" href="#local-logout"></a>Local logout</h3>
<div class="paragraph">
<p>The logout configuration described in the <a href="#logout-properties">Logout</a> section supports standard OIDC logout mechanism, with the Quarkus endpoint coordinating the logout process with the OIDC provider.
Sometimes, you may want to do the <a href="security-oidc-code-flow-authentication#local-logout">local logout</a> only to clear the local session cookie.</p>
</div>
</div>
<div class="sect2">
<h3 id="listen-to-oidc-events"><a class="anchor" href="#listen-to-oidc-events"></a>Listen to OIDC events</h3>
<div class="paragraph">
<p>You can observe OIDC events related to the authentication, logout, etc.
See the <a href="security-oidc-code-flow-authentication#listen-to-authentication-events">Listento OIDC events</a> section for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="token-propagation-and-exchange"><a class="anchor" href="#token-propagation-and-exchange"></a>Token propagation and exchange</h3>
<div class="paragraph">
<p>Use <a href="security-openid-connect-client-reference#token-propagation-rest">Quarkus OIDC token propagation feature</a> if you need to propagate the current bearer or authorization code flow access token to the downstream service. The tokens which must be propagated can be exchanged.</p>
</div>
</div>
<div class="sect2">
<h3 id="revoke-oidc-tokens"><a class="anchor" href="#revoke-oidc-tokens"></a>Revoke OIDC tokens</h3>
<div class="paragraph">
<p>You may need to revoke access tokens, for example, in case of the local logout.
See the <a href="security-oidc-code-flow-authentication#oidc-token-revocation">Token revocation</a> section for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="resource-metadata-properties"><a class="anchor" href="#resource-metadata-properties"></a>Protected Resource Metadata</h3>
<div class="paragraph">
<p><a href="https://datatracker.ietf.org/doc/rfc9728/">OAuth2 Protected Resource Metadata</a> specification defines a metadata format enabling OAuth 2.0 clients to obtain information needed to interact with an OAuth 2.0 protected resource.</p>
</div>
<div class="paragraph">
<p>Quarkus OIDC provides an initial <a href="https://datatracker.ietf.org/doc/rfc9728/">Protected Resource Metadata</a> support allowing a Quarkus endpoint to return a URL of the OIDC or OAuth2 provider that secures this endpoint.
In turn, a client that requested the protected resource metadata can use its properties, such as an authorization server URL, to discover the provider&#8217;s metadata and bootstrap itself to work with this provider, for example, to login SPA users and access Quarkus on their behalf with bearer access tokens.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 44. Resource Metadata properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.resource-metadata.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable resource metadata properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.resource-metadata.resource</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.resource-metadata.authorization-server</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization server URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quarkus.oidc.resource-metadata.force-https-scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Force that a resource identifier URL has an HTTPS scheme</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>quarkus.oidc.resource-metadata.enabled</code> property allows Quarkus OIDC to return the protected resource metadata and it is disabled by default. The reason behind it is that letting public clients see a list of authorization server(s) that the endpoint is secured with can be considered a security information leak, therefore it should only be enabled when publishing such information is considered to be safe.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.resource-metadata.resource</code> represents a protected resource identifier.
According to the <a href="https://datatracker.ietf.org/doc/rfc9728/">OAuth2 Protected Resource Metadata</a> specification, it must be presented as an HTTPS-based URL in the published metadata and the structure of this URL must be aligned with the well-known URL that the client used to access the protected resource metadata.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.resource-metadata.resource</code> can be configured as an absolute URL.</p>
</div>
<div class="paragraph">
<p>If it is configured as a relative path then it is added to the current request URL&#8217;s host and port to build a resource identifier URL. If it is not configured at all then, unless it is a default tenant id, the tenand id is added to the current request URL&#8217;s host and port to build a resource identifier URL.</p>
</div>
<div class="paragraph">
<p>By default, when no <code>quarkus.oidc.resource-metadata.resource</code> is configured, a protected resource metadata route is available at a <code>/.well-known/oauth-protected-resource</code> relative address.</p>
</div>
<div class="paragraph">
<p>Setting <code>quarkus.oidc.resource-metadata.resource</code> to a relative value impacts the protected resource metadata route&#8217;s address. For example, setting <code>quarkus.oidc.resource-metadata.resource=resource</code> for a default OIDC tenant makes its protected resource metadata route available at <code>/.well-known/oauth-protected-resource/resource</code>.</p>
</div>
<div class="paragraph">
<p>The resource identifier URL scheme is set to <code>HTTPS</code> by default. You can enable an <code>HTTP</code> URL scheme with <code>quarkus.oidc.resource-metadata.force-https-scheme=false</code>, it can be particularly useful in simple demos and tests.</p>
</div>
<div class="paragraph">
<p><code>quarkus.oidc.resource-metadata.authorization-server</code> allows to customize an authorization server URL that will be included in the resource metadata. The <code>quarkus.oidc.auth-server-url</code> URL is included by default, however, for some cases where an OIDC proxy interposes over the actual OIDC provider, returning the OIDC proxy&#8217;s URL is required instead.</p>
</div>
<div class="paragraph">
<p>See also the <a href="#oidc-metadata-properties">Metadata</a> for details about the OIDC provider metadata that Quarkus OIDC uses for its work.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references"><a class="anchor" href="#references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="security-oidc-bearer-token-authentication">OIDC Bearer token authentication</a></p>
</li>
<li>
<p><a href="security-oidc-code-flow-authentication">OIDC Authorization code flow authentication</a></p>
</li>
<li>
<p><a href="security-oidc-configuration-properties-reference">Generated OIDC Configuration</a></p>
</li>
</ul>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#core-properties">Core properties</a>
<ul class="sectlevel2">
<li><a href="#oidc-enablement-properties">Enablement</a></li>
<li><a href="#tenant-properties">Tenant</a></li>
<li><a href="#oidc-metadata-properties">Metadata</a></li>
<li><a href="#application-type">Application type</a></li>
<li><a href="#client-id-secret">Client</a></li>
</ul>
</li>
<li><a href="#client-credentials">Client authentication options</a>
<ul class="sectlevel2">
<li><a href="#client-secret">Client secret</a></li>
<li><a href="#jwt-client-credentials">JWT client credentials</a></li>
<li><a href="#mutual-tls">Mutual TLS</a></li>
<li><a href="#introspection-credentials">Introspection credentials</a></li>
</ul>
</li>
<li><a href="#connection-properties">Connection properties</a></li>
<li><a href="#tls-properties">TLS properties</a></li>
<li><a href="#authorization-code-flow">Authorization code flow</a>
<ul class="sectlevel2">
<li><a href="#authorization-code-flow-initiation">Authorization code flow initiation</a></li>
<li><a href="#authorization-code-flow-completion">Authorization code flow completion</a></li>
<li><a href="#authorization-code-flow-errors">Authorization code flow errors</a></li>
<li><a href="#authorization-code-flow-spa">SPA integration</a></li>
<li><a href="#id-token-availability">ID token availability</a></li>
</ul>
</li>
<li><a href="#cookie-properties">Authorization code flow cookies</a>
<ul class="sectlevel2">
<li><a href="#common-cookie-properties">Common cookie properties</a></li>
<li><a href="#state-cookie-properties">State cookie</a></li>
<li><a href="#session-cookie-properties">Session cookie and refresh</a></li>
</ul>
</li>
<li><a href="#token-state-manager">Store authorization code flow tokens</a></li>
<li><a href="#logout-properties">Logout</a>
<ul class="sectlevel2">
<li><a href="#rp-initiated-logout">RP-initiated Logout</a></li>
<li><a href="#back-channel-logout">Back-channel Logout</a></li>
<li><a href="#front-channel-logout">Front-channel logout</a></li>
<li><a href="#clear-site-data">Clear site data</a></li>
</ul>
</li>
<li><a href="#token-verification">Token verification</a>
<ul class="sectlevel2">
<li><a href="#token-preprocessing">Token preprocessing</a></li>
<li><a href="#token-claims">Token claims</a></li>
<li><a href="#code-flow-access-token">Code flow access token</a></li>
<li><a href="#verify-access-token-with-user-info">Verify access token with UserInfo</a></li>
<li><a href="#token-verification-key-refresh">Verification key refresh</a></li>
<li><a href="#token-introspection">Token introspection</a></li>
<li><a href="#token-roles">Token roles</a></li>
<li><a href="#token-binding">Token binding</a></li>
<li><a href="#bearer-token-source-properties">Bearer token header</a></li>
<li><a href="#caching-verification-results">Token introspection and UserInfo cache</a></li>
<li><a href="#tokens-with-certificate-chains">Tokens with certificate chain</a></li>
<li><a href="#local-verification-properties">Local verification</a></li>
</ul>
</li>
<li><a href="#managing-jwks">Managing JWK keys</a></li>
<li><a href="#composite-provider-properties">Composite provider properties</a></li>
<li><a href="#multi-tenancy">Multi-tenancy</a></li>
<li><a href="#creating-tenants-programmatically">Creating configuration programmatically</a>
<ul class="sectlevel2">
<li><a href="#create-oidc-configuration-at-start-up">Create OIDC configuration at start-up</a></li>
<li><a href="#create-oidc-configuration-at-request-time">Create OIDC configuration at request time</a></li>
</ul>
</li>
<li><a href="#typical-property-combinations">Typical property combinations</a>
<ul class="sectlevel2">
<li><a href="#simple-bearer-access-token-support">Simple bearer access token support</a></li>
<li><a href="#simple-authorizaion-code-flow-support">Simple authorizaion code flow support</a></li>
<li><a href="#strict-bearer-access-token-support">Strict bearer access token support</a></li>
<li><a href="#strict-authorization-code-flow-support">Strict authorization code flow support</a></li>
<li><a href="#even-stricter-configuration-setup">Even stricter configuration setup</a></li>
</ul>
</li>
<li><a href="#customizations">When the configuration is not enough</a>
<ul class="sectlevel2">
<li><a href="#token-validation">Token validation</a></li>
<li><a href="#token-authorization">Token authorization</a></li>
<li><a href="#custom-token-introspection-cache">Token introspection cache</a></li>
<li><a href="#custom-user-info-cache">UserInfo cache</a></li>
<li><a href="#tokenstatemanager">TokenStateManager</a></li>
<li><a href="#request-response-and-redirect-filters">Request, response and redirect filters</a></li>
<li><a href="#custom-java-script-request-checker">JavaScript request checker</a></li>
<li><a href="#local-logout">Local logout</a></li>
<li><a href="#listen-to-oidc-events">Listen to OIDC events</a></li>
<li><a href="#token-propagation-and-exchange">Token propagation and exchange</a></li>
<li><a href="#revoke-oidc-tokens">Revoke OIDC tokens</a></li>
<li><a href="#resource-metadata-properties">Protected Resource Metadata</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul></div>
    </div>
  </div>
  <h2>Related content</h2>
  <div class="grid-wrapper relations">
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same topics</h3>
      <ul class="related-content">
      
        
        <li class="concepts"><a href="/version/3.27/guides/security-authentication-mechanisms">Authentication mechanisms in Quarkus</a></li>
      
        
        <li class="reference"><a href="/version/3.27/guides/security-authorize-web-endpoints-reference">Authorization of web endpoints</a></li>
      
        
        <li class="concepts"><a href="/version/3.27/guides/security-basic-authentication">Basic authentication</a></li>
      
        
        <li class="guide"><a href="/version/3.27/guides/security-jwt-build">Build, sign, and encrypt JSON Web Tokens</a></li>
      
        
        <li class="concepts"><a href="/version/3.27/guides/security-openid-connect-providers">Configuring Well-Known OpenID Connect Providers</a></li>
      
        
        <li class="guide"><a href="/version/3.27/guides/security-csrf-prevention">Cross-Site Request Forgery Prevention</a></li>
      
        
        <li class="howto"><a href="/version/3.27/guides/security-openid-connect-dev-services">Dev Services and Dev UI for OpenID Connect (OIDC)</a></li>
      
        
        <li class="howto"><a href="/version/3.27/guides/security-basic-authentication-howto">Enable Basic authentication</a></li>
      
        
        <li class="tutorial"><a href="/version/3.27/guides/security-getting-started-tutorial">Getting started with security by using Basic authentication and Jakarta Persistence</a></li>
      
        
        <li class="concepts"><a href="/version/3.27/guides/security-identity-providers">Identity providers</a></li>
      
        
        <li class="tutorial"><a href="/version/3.27/guides/security-vertx-oidc-to-quarkus-oidc-migration">Migrate from Vert.x OIDC to Quarkus OIDC</a></li>
      
        
        <li class="reference"><a href="/version/3.27/guides/security-openid-connect-client-reference">OpenID Connect (OIDC) and OAuth2 client and filters</a></li>
      
        
        <li class="reference"><a href="/version/3.27/guides/security-openid-connect-client-registration">OpenID Connect (OIDC) and OAuth2 dynamic client registration</a></li>
      
        
        <li class="concepts"><a href="/version/3.27/guides/security-oidc-bearer-token-authentication">OpenID Connect (OIDC) Bearer token authentication</a></li>
      
        
        <li class="reference"><a href="/version/3.27/guides/security-oidc-configuration-properties-reference">OpenID Connect (OIDC) configuration properties</a></li>
      
        
        <li class="concepts"><a href="/version/3.27/guides/security-oidc-code-flow-authentication">OpenID Connect authorization code flow mechanism for protecting web applications</a></li>
      
        
        <li class="tutorial"><a href="/version/3.27/guides/security-openid-connect-client">OpenID Connect client and token propagation quickstart</a></li>
      
        
        <li class="concepts"><a href="/version/3.27/guides/security-proactive-authentication">Proactive authentication</a></li>
      
        
        <li class="tutorial"><a href="/version/3.27/guides/security-oidc-bearer-token-authentication-tutorial">Protect a service application by using OpenID Connect (OIDC) Bearer token authentication</a></li>
      
        
        <li class="tutorial"><a href="/version/3.27/guides/security-oidc-code-flow-authentication-tutorial">Protect a web application by using OpenID Connect (OIDC) authorization code flow</a></li>
      </ul>
    </div>
    </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="https://github.com/commonhaus/artwork/tree/main/projects/quarkus" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
