<!DOCTYPE html>
<html lang="en">







<head>
  <title>Quarkus Messaging Extensions - 3.20 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/3.20/guides/messaging" />
  <meta property="og:title" content="Quarkus Messaging Extensions - 3.20" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/messaging">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/3.20/guides/messaging" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/3.20/guides/messaging" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/3.20/guides/messaging" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/3.20/guides/messaging" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/3.20/guides/messaging" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>          
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/3.20/guides/messaging" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/3.20/guides/messaging">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/3.20/guides/messaging">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/3.20/guides/messaging">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/3.20/guides/messaging">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/3.20/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.23.4 - Latest</option>
        
        
        
        <option value="3.20" selected>3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        
        
        
        
        
        
        
        
        
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">Quarkus Messaging Extensions </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Event-driven messaging systems have become the backbone of most modern applications,
enabling the building of message-driven microservices or complex data streaming pipelines.</p>
</div>
<div class="paragraph">
<p>Quarkus offers a comprehensive suite of messaging extensions designed to synchronize with leading messaging technologies effortlessly.
This empowers developers to concentrate on crafting the core application logic, liberating them from the necessity to delve into the complexities of individual APIs and messaging infrastructures.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/messaging-quarkus.png" alt="Quarkus Messaging">
</div>
</div>
<div class="paragraph">
<p>This page focuses on common features and the development model for all messaging extensions.</p>
</div>
<div class="paragraph">
<p>Some of these extensions are maintained in the core Quarkus repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Messaging</strong>: The core extension defines the basic concepts and APIs to develop messaging applications</p>
</li>
<li>
<p><a href="kafka"><strong>Messaging - Kafka Connector</strong></a></p>
</li>
<li>
<p><a href="pulsar"><strong>Messaging - Pulsar Connector</strong></a></p>
</li>
<li>
<p><a href="rabbitmq-reference"><strong>Messaging - RabbitMQ Connector</strong></a></p>
</li>
<li>
<p><a href="amqp-reference"><strong>Messaging - AMQP 1.0 Connector</strong></a></p>
</li>
<li>
<p><strong>Messaging - MQTT Connector</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some extensions are contributed and maintained by the community:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://camel.apache.org/camel-quarkus/3.8.x/reference/extensions/smallrye-reactive-messaging.html">Camel SmallRye Reactive Messaging</a></p>
</li>
<li>
<p><a href="https://docs.quarkiverse.io/quarkus-reactive-messsaging-nats-jetstream/dev/index.html">Nats Jetstream Connector</a></p>
</li>
<li>
<p><a href="https://solacelabs.github.io/solace-quarkus/">Solace Messaging Connector</a></p>
</li>
<li>
<p><a href="https://quarkus.io/extensions/io.quarkiverse.reactivemessaging.http/quarkus-reactive-messaging-http/">Reactive HTTP and WebSocket Connector</a></p>
</li>
<li>
<p>AWS SQS Connector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other connectors, such as the <strong>JMS Connector</strong> or the <strong>Google PubSub Connector</strong>, do not benefit from the same level of integration and require more manual configuration to set up.</p>
</div>
<div class="paragraph">
<p>On the other hand, some messaging-related extensions propose low-level provider-specific integrations.
The level of support covered on this page DOES NOT involve these low-level extensions.
A non-exhaustive list of this kind of extension are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://quarkus.io/guides/kafka-streams">Kafka Streams Extension</a></p>
</li>
<li>
<p><a href="https://docs.quarkiverse.io/quarkus-rabbitmq-client/dev/index.html">RabbitMQ Client</a></p>
</li>
<li>
<p><a href="https://docs.quarkiverse.io/quarkus-hivemq-client/dev/index.html">HiveMQ Client</a></p>
</li>
<li>
<p><a href="https://docs.quarkiverse.io/quarkus-artemis/dev/quarkus-artemis-jms.html">Artemis Core &amp; JMS</a></p>
</li>
<li>
<p><a href="https://docs.quarkiverse.io/quarkus-google-cloud-services/main/pubsub.html">Google Cloud Pubsub</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quarkus-messaging-development-model"><a class="anchor" href="#quarkus-messaging-development-model"></a>Quarkus Messaging Development Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus simplifies message-driven application development by establishing a uniform model for publishing, consuming, and processing messages, regardless of whether the underlying broker technology uses message queuing or event streaming.
Built upon the MicroProfile Reactive Messaging specification, Quarkus Messaging extensions ensure seamless integration with these technologies.
Importantly, proficiency in reactive programming is NOT a prerequisite for leveraging these capabilities.</p>
</div>
<div class="paragraph">
<p>The Reactive Messaging specification defines a CDI-based programming model for implementing event-driven and message-driven applications.
Using a small set of annotations, CDI beans become building blocks for implementing interactions with message brokers.
These interactions happen through <em>channels</em> where application components read and write messages.</p>
</div>
<div class="paragraph">
<p><em>Channels</em> are identified by a unique name and declared using a set of annotations.</p>
</div>
<div class="sect2">
<h3 id="incoming-and-outgoing-annotations"><a class="anchor" href="#incoming-and-outgoing-annotations"></a><code>@Incoming</code> and <code>@Outgoing</code> annotations</h3>
<div class="paragraph">
<p><code>@Incoming</code> and <code>@Outgoing</code> method annotations define <em>channels</em> allowing to consume messages from and produce messages to the message broker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.enterprise.context.ApplicationScoped;

import org.eclipse.microprofile.reactive.messaging.Incoming;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

@ApplicationScoped
public class MessageProcessingBean {

   @Incoming("source")
   @Outgoing("sink")
   public String process(String consumedPayload) {
       // Process the incoming message payload and return an updated payload
       return consumedPayload.toUpperCase();
   }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Outgoing</code> can be used by itself on a method to generate messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.enterprise.context.ApplicationScoped;

import org.eclipse.microprofile.reactive.messaging.Incoming;
import org.eclipse.microprofile.reactive.messaging.Message;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

@ApplicationScoped
public class MessageGeneratorBean {

   @Outgoing("sink")
   public Multi&lt;String&gt; generate() {
       return Multi.createFrom().items("a", "b", "c");
   }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Incoming</code> can be used by itself to consume messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.enterprise.context.ApplicationScoped;

import org.eclipse.microprofile.reactive.messaging.Incoming;
import org.eclipse.microprofile.reactive.messaging.Message;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

@ApplicationScoped
public class MessageProcessingBean {

   @Incoming("source")
   public void process(String consumedPayload) {
       // process the payload
       consumedPayload.toUpperCase();
   }

}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that you should not call methods annotated with <code>@Incoming</code> and/or <code>@Outgoing</code> directly from your code.
They are invoked by the framework.
Having user code invoking them would not have the expected outcome.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can read more on supported method signatures in the <a href="https://smallrye.io/smallrye-reactive-messaging/latest/concepts/signatures/">SmallRye Reactive Messaging – Supported signatures</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="emitters-and-channel-annotation"><a class="anchor" href="#emitters-and-channel-annotation"></a>Emitters and <code>@Channel</code> annotation</h3>
<div class="paragraph">
<p>An application often needs to combine messaging with other parts of the application, ex. produce messages from HTTP endpoints, or stream consumed messages as a response.</p>
</div>
<div class="paragraph">
<p>To send messages from imperative code to a specific channel, you need to inject an <code>Emitter</code> object identified by the <code>@Channel</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.eclipse.microprofile.reactive.messaging.Channel;
import org.eclipse.microprofile.reactive.messaging.Emitter;

@ApplicationScoped
@Path("/")
public class MyImperativeBean {

   @Channel("prices")
   Emitter&lt;Double&gt; emitter;

   @GET
   @Path("/send")
   public CompletionStage&lt;Void&gt; send(double d) {
       return emitter.send(d);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Channel</code> annotation lets you indicate to which channel you will send your payloads or messages.
The <code>Emitter</code> allows buffering messages sent to the channel.</p>
</div>
<div class="paragraph">
<p>For more control, using <a href="https://smallrye.io/smallrye-mutiny/latest/">Mutiny</a> APIs, you can use the <code>MutinyEmitter</code> emitter interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.mutiny.Multi;
import org.eclipse.microprofile.reactive.messaging.Channel;
import org.eclipse.microprofile.reactive.messaging.MutinyEmitter;

@ApplicationScoped
@Path("/")
public class MyImperativeBean {

   @Channel("prices")
   MutinyEmitter&lt;Double&gt; emitter;

   @GET
   @Path("/send")
   public void send(double d) {
       emitter.sendAndAwait(d);
   }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Channel</code> annotation can also be used to inject the stream of messages from an incoming channel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.eclipse.microprofile.reactive.messaging.Channel;

@ApplicationScoped
@Path("/")
public class SseResource {

    @Channel("prices")
    Multi&lt;Double&gt; prices;

    @GET
    @Path("/prices")
    @RestStreamElementType(MediaType.TEXT_PLAIN)
    public Multi&lt;Double&gt; stream() {
        return prices;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When consuming messages with <code>@Channel</code>, the application code is responsible for subscribing to the stream.
In the example above, the Quarkus REST (formerly RESTEasy Reactive) endpoint handles that for you.</p>
</div>
<div class="paragraph">
<p>You can read more on the emitters and channels in the <a href="https://smallrye.io/smallrye-reactive-messaging/latest/concepts/emitter/">SmallRye Reactive Messaging – Emitter and Channels</a> documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="messages-and-metadata"><a class="anchor" href="#messages-and-metadata"></a>Messages and Metadata</h3>
<div class="paragraph">
<p>A <code>Message</code> is an envelope around a payload.
In the examples above only payloads were used, but every payload is wrapped around a <code>Message</code> internally in Quarkus Messaging.</p>
</div>
<div class="paragraph">
<p>The <code>Message&lt;T&gt;</code> interface associates a payload of type <code>&lt;T&gt;</code> with <code>Metadata</code>,
a set of arbitrary objects and asynchronous actions for acknowledgement (ack) and negative acknowledgement (nack).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.eclipse.microprofile.reactive.messaging.Message;

@Incoming("source")
@Outgoing("sink")
public Message&lt;String&gt; process(Message&lt;String&gt; consumed) {
    // Access the metadata
    MyMetadata my = consumed.getMetadata(MyMetadata.class).get();
    // Process the incoming message and return an updated message
    return consumed.withPayload(consumed.getPayload().toUpperCase());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A message is acknowledged back to the broker when its processing or reception has been successful.
Acknowledgements between messages are chained, meaning that when processing a message,
the acknowledgement of an outgoing message triggers the acknowledgement of incoming message(s).
In most cases, acks and nacks are managed for you and connectors allow you to configure different strategies per channel.
So, you usually don&#8217;t need to interact with the <code>Message</code> interface directly.
Only advanced use cases require dealing with the Message directly.</p>
</div>
<div class="paragraph">
<p>Accessing the <code>Metadata</code>, on the other hand, can be practical in many cases.
Connectors add specific metadata objects to the message to give access to the message headers, properties, and other connector-specific information.
You do not need to interact with the <code>Message</code> interface to access connector-specific metadata.
You can simply inject the metadata object as a method parameter after the payload parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.eclipse.microprofile.reactive.messaging.Metadata;
@Incoming("source")
@Outgoing("sink")
public String process(String payload, MyMetadata my) {
    // Access the metadata
    Map&lt;String, Object&gt; props = my.getProperties();
    // Process the payload and return an updated payload
    return payload.toUpperCase();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on the connector, payload types available to consume in processing methods differ.
You can implement a custom <code>MessageConverter</code> to transform the payload to a type that is accepted by your application.</p>
</div>
</div>
<div class="sect2">
<h3 id="channel-configuration"><a class="anchor" href="#channel-configuration"></a>Channel configuration</h3>
<div class="paragraph">
<p>Channel attributes can be configured using the <code>mp.messaging.incoming.&lt;channel-name&gt;</code> and <code>mp.messaging.outgoing.&lt;channel-name&gt;</code> configuration properties.</p>
</div>
<div class="paragraph">
<p>For example, to configure the Kafka connector to consume messages from the <code>my-topic</code> topic with a custom deserializer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.incoming.source.connector=smallrye-kafka
mp.messaging.incoming.source.topic=my-topic
mp.messaging.incoming.source.value.deserializer=org.apache.kafka.common.serialization.StringDeserializer
mp.messaging.incoming.source.auto.offset.reset=earliest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>connector</code> attribute is required for all channels and specifies the connector to use.
You can omit this configuration if you have a single connector on your classpath, as Quarkus will automatically select the connector.</p>
</div>
<div class="paragraph">
<p>Global channel attributes can be configured using the connector name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.connector.smallrye-kafka.bootstrap.servers=localhost:9092</code></pre>
</div>
</div>
<div class="paragraph">
<p>Connector-specific attributes are listed in connector documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="channel-wiring-and-messaging-patterns"><a class="anchor" href="#channel-wiring-and-messaging-patterns"></a>Channel wiring and Messaging patterns</h3>
<div class="paragraph">
<p>At startup time, Quarkus analyzes declared channels to wire them together and verify that all channels are connected.
Concretely, each channel creates a <em>reactive stream</em> of messages connected to another channel&#8217;s <em>reactive stream</em> of messages.
Adhering to the reactive stream protocol, the back-pressure mechanism is enforced between channels, allowing to control application resource usage and not over-commit and overloading part of the system.</p>
</div>
<div class="paragraph">
<p>On the flip side it is NOT possible to create new channels programmatically at runtime.
There are, however, many patterns that let you implement most, if not all, messaging and integration use cases:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some messaging technologies allow consumers to subscribe to a set of topics or queues, and producers to send messages to a specific topic on message basis.
If you are sure you need to configure and create clients dynamically at runtime, you should consider using the low-level clients directly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="internal-channels"><a class="anchor" href="#internal-channels"></a>Internal Channels</h4>
<div class="paragraph">
<p>In some use cases, it is convenient to use messaging patterns to transfer messages inside the same application.
When you don&#8217;t connect a channel to a messaging backend, i.e. a connector, everything happens internally to the application,
and the streams are created by chaining methods together.
Each chain is still a reactive stream and enforces the back-pressure protocol.</p>
</div>
<div class="paragraph">
<p>The framework verifies that the producer/consumer chain is complete,
meaning that if the application writes messages into an internal channel (using a method with only <code>@Outgoing</code>, or an <code>Emitter</code>),
it must also consume the messages from within the application (using a method with only <code>@Incoming</code> or using an unmanaged stream).</p>
</div>
</div>
<div class="sect3">
<h4 id="enabledisable-channels"><a class="anchor" href="#enabledisable-channels"></a>Enable/Disable channels</h4>
<div class="paragraph">
<p>All defined channels are enabled by default, but it is possible to disable a channel with the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.incoming.my-channel.enabled=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be used alongside Quarkus build profiles to enable/disable channels based on some build-time condition, such as the the target environment.
You need to make sure of two things when disabling a channel:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the disabled channel usage is located in a bean that can be filtered out at build time,</p>
</li>
<li>
<p>that without the channel, the remaining channels still work correctly.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
@IfBuildProfile("my-profile")
public class MyProfileBean {

    @Outgoing("my-channel")
    public Multi&lt;String&gt; generate() {
        return Multi.createFrom().items("a", "b", "c");
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pausable-channels"><a class="anchor" href="#pausable-channels"></a>Pausable Channels</h4>
<div class="paragraph">
<p>Injected <code>@Channel</code> streams are not subscribed to by default, so the flow of messages is controlled by the application code using reactive streams and Mutiny APIs.
But for <code>@Incoming</code> methods, the flow of messages is controlled by the runtime.</p>
</div>
<div class="paragraph">
<p>Pausable channels provide a mechanism to control message flow programmatically.
This is useful in scenarios where producers or consumers need to stop temporarily due to managing the lifecycle or performing maintenance operations.</p>
</div>
<div class="paragraph">
<p>To use pausable channels, you need to activate it with the configuration property <code>pausable</code> set to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.incoming.my-channel.pausable=true
# optional, by default the channel is NOT paused initially
mp.messaging.outgoing.my-channel.initially-paused=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a channel is configured to be pausable, you can get the <code>PausableChannel</code> by channel name from the <code>ChannelRegistry</code> programmatically, and pause or resume the channel as needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.annotation.PostConstruct;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.inject.Inject;

import org.eclipse.microprofile.reactive.messaging.Incoming;

import io.smallrye.reactive.messaging.ChannelRegistry;
import io.smallrye.reactive.messaging.PausableChannel;

@ApplicationScoped
public class PausableController {

    @Inject
    ChannelRegistry registry;

    @PostConstruct
    public void resume() {
        // Wait for the application to be ready
        // Retrieve the pausable channel
        PausableChannel pausable = registry.getPausable("my-channel");
        // Pause the processing of the messages
        pausable.resume();
    }

    public void pause() {
        // Retrieve the pausable channel
        PausableChannel pausable = registry.getPausable("my-channel");
        // Pause the processing of the messages
        pausable.pause();
    }

    @Incoming("my-channel")
    void process(String message) {
        // Process the message
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This feature is independent of connectors and can be in theory used with channels backed by any connector.
Note that pausing message consumption applies back-pressure on the underlying consumer which receives messages from the remote broker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Kafka consumers provide a similar feature to pause and resume the consumption of messages from topic-partitions.
The Quarkus Kafka connector allows <a href="kafka#kafka-bare-clients">access to the underlying client</a> to pause/resume the consumption.</p>
</div>
<div class="paragraph">
<p>However, by default, with the <code>pause-if-no-requests=true</code> configuration,
the connector handles automatically the back-pressure,
by the pausing and resuming the Kafka consumer based on downstream requests.
It is therefore recommended to use pausable channels with the default <code>pause-if-no-requests=true</code> configuration.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="multiple-outgoings-and-broadcast"><a class="anchor" href="#multiple-outgoings-and-broadcast"></a>Multiple Outgoings and <code>@Broadcast</code></h4>
<div class="paragraph">
<p>By default, messages transmitted in a channel are only dispatched to a single consumer.
Having multiple consumers is considered an error and is reported at deployment time.</p>
</div>
<div class="paragraph">
<p>The <code>@Broadcast</code> annotation changes this behavior and indicates that messages transiting in the channel are dispatched to all the consumers.
<code>@Broadcast</code> must be used with the <code>@Outgoing</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.eclipse.microprofile.reactive.messaging.Broadcast;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

@Incoming("in")
@Outgoing("out")
@Broadcast
public int increment(int i) {
    return i + 1;
}

@Incoming("out")
public void consume1(int i) {
    //...
}

@Incoming("out")
public void consume2(int i) {
    //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly to <code>@Broadcast</code>, you can use <code>@Outgoing</code> annotation multiple times on the same method to indicate that the method produces messages to multiple channels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.eclipse.microprofile.reactive.messaging.Incoming;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

@Incoming("in")
@Outgoing("out1")
@Outgoing("out2")
public String process(String s) {
    // send messages from channel in to both channels out1 and out2
    return s.toUpperCase();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Multiple Outgoings can be useful for implementing fan-out patterns, in which a single message is processed by multiple target channels.</p>
</div>
<div class="paragraph">
<p>You can selectively dispatch messages to multiple outgoings by returning <code>Targeted</code> from the processing method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Incoming("in")
@Outgoing("out1")
@Outgoing("out2")
@Outgoing("out3")
public Targeted process(double price) {
    // send messages from channel-in to both channel-out1 and channel-out2
    Targeted targeted = Targeted.of("out1", "Price: " + price, "out2", "Quote: " + price);
    if (price &gt; 90.0) {
        return targeted.with("out3", price);
    }
    return targeted;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multiple-incomings-and-merge"><a class="anchor" href="#multiple-incomings-and-merge"></a>Multiple Incomings and <code>@Merge</code></h4>
<div class="paragraph">
<p>By default, a single producer can transmit messages in a channel.
Having multiple producers is considered erroneous and is reported at deployment time.
The <code>@Merge</code> annotation changes this behavior and indicates that a channel can have multiple producers.
<code>@Merge</code> must be used with the <code>@Incoming</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Incoming("in1")
@Outgoing("out")
public int increment(int i) {
    return i + 1;
}

@Incoming("in2")
@Outgoing("out")
public int multiply(int i) {
    return i * 2;
}

@Incoming("out")
@Merge
public void getAll(int i) {
    //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly to <code>@Merge</code>, you can use <code>@Incoming</code> annotation multiple times on the same method to indicate that the method consumes messages from multiple channels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Incoming("in1")
@Incoming("in2")
public String process(String s) {
    // get messages from channel-1 and channel-2
    return s.toUpperCase();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="stream-processing"><a class="anchor" href="#stream-processing"></a>Stream Processing</h4>
<div class="paragraph">
<p>In some advanced scenarios, you can manipulate directly the stream of messages instead of each individual message.</p>
</div>
<div class="paragraph">
<p>Using <a href="https://smallrye.io/smallrye-mutiny/latest/">Mutiny APIs</a> in incoming and outgoing signatures allow you to process the stream of messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.mutiny.Multi;
import org.eclipse.microprofile.reactive.messaging.Incoming;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

@ApplicationScoped
public class StreamProcessor {

    @Incoming("source")
    @Outgoing("sink")
    public Multi&lt;String&gt; process(Multi&lt;String&gt; in) {
        return in.map(String::toUpperCase);
    }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="execution-model"><a class="anchor" href="#execution-model"></a>Execution Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus Messaging sits on top of the <a href="quarkus-reactive-architecture#engine">reactive engine</a> of Quarkus and leverages <a href="https://vertx.io/">Eclipse Vert.x</a> to dispatch messages for processing.
It supports three execution modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Event-loop</strong>, where messages are dispatched on the Vert.x I/O thread.
Remember that you should not perform blocking operations on the event loop.</p>
</li>
<li>
<p><strong>Worker-threads</strong>, where messages are dispatched on a worker thread pool.</p>
</li>
<li>
<p><strong>Virtual-threads</strong>, where messages are dispatched on a virtual thread (requires Java 21+).
As virtual threads are not pooled, a new virtual thread is created for each message.
Please refer to the dedicated <a href="messaging-virtual-threads">Quarkus Virtual Thread support</a> guide for more information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quarkus chooses the default execution mode based on the method signature.
If the method signature is <em>synchronous</em>, messages are dispatched on <strong>worker threads</strong> otherwise it defaults to <strong>event-loop</strong>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method signature</th>
<th class="tableblock halign-left valign-top">Default execution mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Incoming("source")
void process(String payload)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker-threads</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Incoming("source")
Uni&lt;Void&gt; process(String payload)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event-loop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Incoming("source")
CompletionStage&lt;Void&gt; process(Message&lt;String&gt; message)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event-loop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Incoming("source")
@Outgoing("sink")
Multi&lt;R&gt; process(Multi&lt;T&gt; in)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream-processing methods are executed at startup, then each message is dispatched on event loop.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Fine-grained control over the execution model is possible using annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://javadoc.io/doc/io.smallrye.reactive/smallrye-reactive-messaging-api/latest/io/smallrye/reactive/messaging/annotations/Blocking.html"><code>@Blocking</code></a> will force the method to be executed on a worker thread pool.
The default pool of worker threads is shared between all channels.
Using <code>@Blocking("my-custom-pool")</code> you can configure channels with a custom thread pool.
The configuration property <code>smallrye.messaging.worker.my-custom-pool.max-concurrency</code> specifies the maximum number of threads in the pool.
You can read more on the blocking processing in <a href="http://smallrye.io/smallrye-reactive-messaging/4.8.0/concepts/blocking/">SmallRye Reactive Messaging documentation</a>.</p>
</li>
<li>
<p><code>@NonBlocking</code> will force the method to be executed on the event-loop thread.</p>
</li>
<li>
<p><code>@RunOnVirtualThread</code> will force the method to be executed on a virtual thread.
To leverage the lightweight nature of virtual threads, the default maximum concurrency for methods annotated with <code>@RunOnVirtualThread</code> is 1024.
This can be changed by setting the <code>smallrye.messaging.worker.&lt;virtual-thread&gt;.max-concurrency</code> configuration property
or using together with the <code>@Blocking("my-custom-pool")</code> annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The presence of <code>@Transactional</code> annotation implies blocking execution.</p>
</div>
<div class="paragraph">
<p>In messaging applications, produced and consumed messages constitute an ordered stream of events,
either enforced by the broker (inside a topic or a queue)
or by the order of reception and emission in the application.
To preserve this order, Quarkus Messaging dispatches messages sequentially by default.
You can override this behavior by using <code>@Blocking(ordered = false)</code> or <code>@RunOnVirtualThread</code> annotation.</p>
</div>
<div class="sect2">
<h3 id="incoming-channel-concurrency"><a class="anchor" href="#incoming-channel-concurrency"></a>Incoming Channel Concurrency</h3>
<div class="paragraph">
<p>Some connectors support configuring the concurrency level of incoming channels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.incoming.my-channel.concurrency=4</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates four copies of the incoming channel under the hood, wiring them to the same processing method.
Depending on the broker technology, this can be useful to increase the application&#8217;s throughput by processing multiple messages concurrently
while still preserving the partial order of messages received in different copies.
This is the case, for example, for Kafka, where multiple consumers can consume different topic partitions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="health-checks"><a class="anchor" href="#health-checks"></a>Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Together with the SmallRye Health extension, Quarkus Messaging extensions provide health check support per channel.
The implementation of <em>startup</em>, <em>readiness</em> and <em>liveness</em> checks depends on the connector.
Some connectors allow configuring the health check behavior or disabling them completely or per channel.</p>
</div>
<div class="paragraph">
<p>Channel health checks can be disabled using <code>quarkus.messaging.health.&lt;channel-name&gt;.enabled</code> or per health check type,
ex. <code>quarkus.messaging.health.&lt;channel-name&gt;.liveness.enabled</code>.</p>
</div>
<div class="paragraph">
<p>Setting the <code>quarkus.messaging.health.enabled</code> configuration property to <code>false</code> completely disables the messaging health checks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="observability"><a class="anchor" href="#observability"></a>Observability</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="micrometer-metrics"><a class="anchor" href="#micrometer-metrics"></a>Micrometer Metrics</h3>
<div class="paragraph">
<p>Quarkus Messaging extensions provide simple but useful metrics to monitor the health of the messaging system.
The <a href="telemetry-micrometer">Micrometer extension</a> exposes these metrics.</p>
</div>
<div class="paragraph">
<p>The following metrics can be gathered per channel, identified with the <code>channel</code> tag:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus.messaging.message.count</code> : The number of messages produced or received</p>
</li>
<li>
<p><code>quarkus.messaging.message.acks</code> : The number of messages processed successfully</p>
</li>
<li>
<p><code>quarkus.messaging.message.failures</code> : The number of messages processed with failures</p>
</li>
<li>
<p><code>quarkus.messaging.message.duration</code> : The duration of the message processing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For backwards compatibility reasons, channel metrics are not enabled by default and can be enabled with: <code>smallrye.messaging.observation.enabled=true</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="opentelemetry-tracing"><a class="anchor" href="#opentelemetry-tracing"></a>OpenTelemetry Tracing</h3>
<div class="paragraph">
<p>Some Quarkus Messaging connectors integrate out-of-the-box with OpenTelemetry Tracing.
When the <a href="opentelemetry">OpenTelemetry extension</a> is present, outgoing messages propagate the current tracing span.
On incoming channels, if a received message contains tracing information, the message processing inherits the message span as parent.</p>
</div>
<div class="paragraph">
<p>You can disable tracing for a specific channel using the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.incoming.data.tracing-enabled=false</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tls-configuration"><a class="anchor" href="#tls-configuration"></a>TLS Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some messaging extensions integrate with the <a href="./tls-registry-reference">Quarkus TLS Registry</a> to configure the underlying client.
To configure the TLS on a channel, you need to provide the named TLS configuration to the <code>tls-configuration-name</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.tls.my-tls-config.trust-store=truststore.jks
quarkus.tls.my-tls-config.trust-store-password=secret
mp.messaging.incoming.my-channel.tls-configuration-name=my-tls-config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can configure it globally on all channels of a connector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.connector.smallrye-pulsar.tls-configuration-name=my-tls-config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently, the following messaging extensions support configuration through the Quarkus TLS Registry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka: Provides the <code>ssl.engine.factory.class</code> property for the Kafka client.</p>
</li>
<li>
<p>Pulsar: Only mTLS authentication is supported.</p>
</li>
<li>
<p>RabbitMQ</p>
</li>
<li>
<p>AMQP 1.0</p>
</li>
<li>
<p>MQTT</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing"><a class="anchor" href="#testing"></a>Testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="testing-with-dev-services"><a class="anchor" href="#testing-with-dev-services"></a>Testing with Dev Services</h3>
<div class="paragraph">
<p>Most Quarkus Messaging extensions provide a Dev Service to simplify the development and testing of applications.
The Dev Service creates a broker instance configured to work out-of-the-box with the Quarkus Messaging extension.</p>
</div>
<div class="paragraph">
<p>During testing Quarkus creates a separate broker instance to run the tests against it.</p>
</div>
<div class="paragraph">
<p>You can read more about Dev Services in the <a href="dev-services">Dev Services</a> guide, including a list of Dev Services provided by platform extensions.</p>
</div>
</div>
<div class="sect2">
<h3 id="testing-with-inmemoryconnector"><a class="anchor" href="#testing-with-inmemoryconnector"></a>Testing with InMemoryConnector</h3>
<div class="paragraph">
<p>It can be useful to test the application without starting a broker.
To achieve this, you can <em>switch</em> the channels managed by a connector to <em>in-memory</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This approach only works for JVM tests. It cannot be used for native tests (because they do not support injection).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s say we want to test the following sample application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.eclipse.microprofile.reactive.messaging.Channel;
import org.eclipse.microprofile.reactive.messaging.Emitter;
import org.eclipse.microprofile.reactive.messaging.Incoming;
import org.eclipse.microprofile.reactive.messaging.Message;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

import jakarta.enterprise.context.ApplicationScoped;
import jakarta.inject.Inject;

@ApplicationScoped
public class MyMessagingApplication {

    @Inject
    @Channel("words-out")
    Emitter&lt;String&gt; emitter;

    public void sendMessage(String out) {
        emitter.send(out);
    }

    @Incoming("words-in")
    @Outgoing("uppercase")
    public Message&lt;String&gt; toUpperCase(Message&lt;String&gt; message) {
        return message.withPayload(message.getPayload().toUpperCase());
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, add the following test dependency to your application:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
    &lt;artifactId&gt;smallrye-reactive-messaging-in-memory&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">testImplementation("io.smallrye.reactive:smallrye-reactive-messaging-in-memory")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, create a Quarkus Test Resource as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class InMemoryConnectorLifecycleManager implements QuarkusTestResourceLifecycleManager {

    @Override
    public Map&lt;String, String&gt; start() {
        Map&lt;String, String&gt; env = new HashMap&lt;&gt;();
        Map&lt;String, String&gt; props1 = InMemoryConnector.switchIncomingChannelsToInMemory("words-in");   <i class="conum" data-value="1"></i><b>(1)</b>
        Map&lt;String, String&gt; props2 = InMemoryConnector.switchOutgoingChannelsToInMemory("uppercase");  <i class="conum" data-value="2"></i><b>(2)</b>
        Map&lt;String, String&gt; props3 = InMemoryConnector.switchOutgoingChannelsToInMemory("words-out");  <i class="conum" data-value="3"></i><b>(3)</b>
        env.putAll(props1);
        env.putAll(props2);
        env.putAll(props3);
        return env;  <i class="conum" data-value="4"></i><b>(4)</b>
    }

    @Override
    public void stop() {
        InMemoryConnector.clear();  <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Switch the incoming channel <code>words-in</code> (consumed messages) to in-memory.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Switch the outgoing channel <code>words-out</code> (produced messages) to in-memory.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Switch the outgoing channel <code>uppercase</code> (processed messages) to in-memory.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Builds and returns a <code>Map</code> containing all the properties required to configure the application to use in-memory channels.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>When the test stops, clear the <code>InMemoryConnector</code> (discard all the received and sent messages)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a <code>@QuarkusTest</code> using the test resource created above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.test.common.QuarkusTestResource;
import io.quarkus.test.junit.QuarkusTest;
import io.smallrye.reactive.messaging.memory.InMemoryConnector;
import io.smallrye.reactive.messaging.memory.InMemorySink;
import io.smallrye.reactive.messaging.memory.InMemorySource;

import org.eclipse.microprofile.reactive.messaging.spi.Connector;
import org.junit.jupiter.api.Test;

import jakarta.inject.Inject;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.awaitility.Awaitility.await;

@QuarkusTest
@QuarkusTestResource(InMemoryConnectorLifecycleManager.class)
class MyMessagingApplicationTest {

    @Inject
    @Connector("smallrye-in-memory")
    InMemoryConnector connector; <i class="conum" data-value="1"></i><b>(1)</b>

    @Inject
    MyMessagingApplication app;

    @Test
    void test() {
        InMemorySink&lt;String&gt; wordsOut = connector.sink("words-out"); <i class="conum" data-value="2"></i><b>(2)</b>
        InMemorySource&lt;String&gt; wordsIn = connector.source("words-in"); <i class="conum" data-value="3"></i><b>(3)</b>
        InMemorySink&lt;String&gt; uppercaseOut = connector.sink("uppercase"); <i class="conum" data-value="4"></i><b>(4)</b>

        app.sendMessage("Hello"); <i class="conum" data-value="5"></i><b>(5)</b>
        assertEquals("Hello", wordsOut.received().get(0).getPayload()); <i class="conum" data-value="6"></i><b>(6)</b>

        wordsIn.send("Bonjour"); <i class="conum" data-value="7"></i><b>(7)</b>
        await().untilAsserted(() -&gt; assertEquals("BONJOUR", uppercaseOut.received().get(0).getPayload())); <i class="conum" data-value="8"></i><b>(8)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the in-memory connector in your test class, using the <code>@Connector</code> or <code>@Any</code> qualifier.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve the outgoing channel (<code>words-out</code>) - the channel must have been switched to in-memory in the test resource.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Retrieve the incoming channel (<code>words-in</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Retrieve the outgoing channel (<code>uppercase</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use the injected application bean to call <code>sendMessage</code> method to send a message using the emitter with the channel <code>words-out</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use the <code>received</code> method on <code>words-out</code> in-memory channel to check the message produced by the application.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Use the <code>send</code> mwthod on <code>words-in</code> in-memory channel to send a message.
The application will process this message and send a message to <code>uppercase</code> channel.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Use the <code>received</code> method on <code>uppercase</code> channel to check the messages produced by the application.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In-memory connector is solely intended for testing purposes.
There are some caveats to consider when using the in-memory connector:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The in-memory connector only transmits objects (payloads or configured messages) sent using the <code>InMemorySource#send</code> method.
Messages received by the application methods won&#8217;t contain connector-specific metadata.</p>
</li>
<li>
<p>By default, in-memory channels dispatch messages on the caller thread of the <code>InMemorySource#send</code> method, which would be the main thread in unit tests.
However, most of the other connectors handle context propagation dispatching messages on separate duplicated Vert.x contexts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>quarkus-test-vertx</code> dependency provides the <code>@io.quarkus.test.vertx.RunOnVertxContext</code> annotation, which when used on a test method, executes the test on a Vert.x context.</p>
</div>
<div class="paragraph">
<p>If your tests are dependent on context propagation, you can configure the in-memory connector channels with <code>run-on-vertx-context</code> attribute to dispatch events, including messages and acknowledgements, on a Vert.x context.
Alternatively you can switch this behaviour using the <code>InMemorySource#runOnVertxContext</code> method.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="going-further"><a class="anchor" href="#going-further"></a>Going further</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide shows the general principles of Quarkus Messaging extensions.</p>
</div>
<div class="paragraph">
<p>If you want to go further, you can check the <a href="http://smallrye.io/smallrye-reactive-messaging/">SmallRye Reactive Messaging</a> documentation,
which has in-depth documentation for each of these concepts and more.</p>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#quarkus-messaging-development-model">Quarkus Messaging Development Model</a>
<ul class="sectlevel2">
<li><a href="#incoming-and-outgoing-annotations"><code>@Incoming</code> and <code>@Outgoing</code> annotations</a></li>
<li><a href="#emitters-and-channel-annotation">Emitters and <code>@Channel</code> annotation</a></li>
<li><a href="#messages-and-metadata">Messages and Metadata</a></li>
<li><a href="#channel-configuration">Channel configuration</a></li>
<li><a href="#channel-wiring-and-messaging-patterns">Channel wiring and Messaging patterns</a></li>
</ul>
</li>
<li><a href="#execution-model">Execution Model</a>
<ul class="sectlevel2">
<li><a href="#incoming-channel-concurrency">Incoming Channel Concurrency</a></li>
</ul>
</li>
<li><a href="#health-checks">Health Checks</a></li>
<li><a href="#observability">Observability</a>
<ul class="sectlevel2">
<li><a href="#micrometer-metrics">Micrometer Metrics</a></li>
<li><a href="#opentelemetry-tracing">OpenTelemetry Tracing</a></li>
</ul>
</li>
<li><a href="#tls-configuration">TLS Configuration</a></li>
<li><a href="#testing">Testing</a>
<ul class="sectlevel2">
<li><a href="#testing-with-dev-services">Testing with Dev Services</a></li>
<li><a href="#testing-with-inmemoryconnector">Testing with InMemoryConnector</a></li>
</ul>
</li>
<li><a href="#going-further">Going further</a></li>
</ul></div>
    </div>
  </div>
  <h2>Related content</h2>
  <div class="grid-wrapper relations">
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same topics</h3>
      <ul class="related-content">
      
        
        <li class="guide"><a href="/version/3.20/guides/kafka">Apache Kafka Reference Guide</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/pulsar">Apache Pulsar Reference Guide</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/pulsar-dev-services">Dev Services for Pulsar</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/rabbitmq-dev-services">Dev Services for RabbitMQ</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/kafka-getting-started">Getting Started to Quarkus Messaging with Apache Kafka</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/pulsar-getting-started">Getting Started to Quarkus Messaging with Apache Pulsar</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/rabbitmq">Getting Started to Quarkus Messaging with RabbitMQ</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/messaging-virtual-threads">Quarkus Virtual Thread support with Reactive Messaging</a></li>
      
        
        <li class="reference"><a href="/version/3.20/guides/rabbitmq-reference">Reactive Messaging RabbitMQ Connector Reference Documentation</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/amqp-dev-services">Dev Services for AMQP</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/apicurio-registry-dev-services">Dev Services for Apicurio Registry</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/kafka-dev-services">Dev Services for Kafka</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/amqp">Getting Started to Quarkus Messaging with AMQP 1.0</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/kafka-dev-ui">Kafka Dev UI</a></li>
      
        
        <li class="reference"><a href="/version/3.20/guides/amqp-reference">Reactive Messaging AMQP 1.0 Connector Reference Documentation</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/kafka-streams">Using Apache Kafka Streams</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/kafka-schema-registry-avro">Using Apache Kafka with Schema Registry and Avro</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/kafka-schema-registry-json-schema">Using Apache Kafka with Schema Registry and JSON Schema</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/jms">Using JMS</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/reactive-event-bus">Using the event bus</a></li>
      </ul>
    </div>
    </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
