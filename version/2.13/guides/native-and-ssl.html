<!DOCTYPE html>
<html lang="en">







<head>
  <title>Using SSL With Native Executables - 2.13 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://embed.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.13/guides/native-and-ssl" />
  <meta property="og:title" content="Using SSL With Native Executables - 2.13" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/native-and-ssl">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/2.13/guides/native-and-ssl" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/2.13/guides/native-and-ssl" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/2.13/guides/native-and-ssl" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/2.13/guides/native-and-ssl" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/2.13/guides/native-and-ssl" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/continuum" class="">VERSATILITY</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/2.13/guides/native-and-ssl" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/2.13/guides/native-and-ssl">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/2.13/guides/native-and-ssl">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/2.13/guides/native-and-ssl">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/2.13/guides/native-and-ssl">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/2.13/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.16.2 - Latest</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        
        
        
        <option value="3.2" >3.2</option>
        
        
        
        <option value="2.16" >2.16</option>
        
        
        
        <option value="2.13" selected>2.13</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">Using SSL With Native Executables </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>We are quickly moving to an SSL-everywhere world so being able to use SSL is crucial.</p>
</div>
<div class="paragraph">
<p>In this guide, we will discuss how you can get your native executables to support SSL,
as native executables don&#8217;t support it out of the box.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t plan on using native executables, you can pass your way as in JDK mode, SSL is supported without further manipulations.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>less than 20 minutes</p>
</li>
<li>
<p>an IDE</p>
</li>
<li>
<p>GraalVM installed with <code>JAVA_HOME</code> and <code>GRAALVM_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.8.6</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This guide is based on the REST client guide, so you should get this Maven project first.</p>
</div>
<div class="paragraph">
<p>Clone the Git repository: <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code>, or download an <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>The project is located in the <code>rest-client-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/rest-client-quickstart">directory</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="looks-like-it-works-out-of-the-box"><a class="anchor" href="#looks-like-it-works-out-of-the-box"></a>Looks like it works out of the box?!?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you open the application&#8217;s configuration file (<code>src/main/resources/application.properties</code>), you can see the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.rest-client."org.acme.rest.client.ExtensionsService".url=https://stage.code.quarkus.io/api</code></pre>
</div>
</div>
<div class="paragraph">
<p>which configures our REST client to connect to an SSL REST service.</p>
</div>
<div class="paragraph">
<p>For the purposes of this guide, we also need to remove the configuration that starts the embedded WireMock server that stubs REST client responses so the tests actually propagate calls to the <a href="https://stage.code.quarkus.io/api" class="bare">https://stage.code.quarkus.io/api</a>. Update the test file <code>src/test/java/org/acme/rest/client/ExtensionsResourceTest.java</code> and remove the line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTestResource(WireMockExtensions.class)</code></pre>
</div>
</div>
<div class="paragraph">
<p>from the <code>ExtensionsResourceTest</code> class.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s build the application as a native executable and run the tests:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we obtain the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, yes, it appears it works out of the box and this guide is pretty useless.</p>
</div>
<div class="paragraph">
<p>It&#8217;s not. The magic happens when building the native executable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[INFO] [io.quarkus.creator.phase.nativeimage.NativeImagePhase] /opt/graalvm/bin/native-image -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=3 -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Duser.language=en -J-Duser.country=IE -J-Dfile.encoding=UTF-8 --features=io.quarkus.runner.Feature,io.quarkus.runtime.graal.ResourcesFeature,io.quarkus.runtime.graal.DisableLoggingFeature -J--add-exports=java.security.jgss/sun.security.krb5=ALL-UNNAMED -J--add-opens=java.base/java.text=ALL-UNNAMED -J--add-opens=java.base/java.io=ALL-UNNAMED -J--add-opens=java.base/java.lang.invoke=ALL-UNNAMED -J--add-opens=java.base/java.util=ALL-UNNAMED -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy\$BySpaceAndTime -H:+AllowFoldMethods -J-Djava.awt.headless=true -H:FallbackThreshold=0 --link-at-build-time -H:+ReportExceptionStackTraces -H:-AddAllCharsets -H:EnableURLProtocols=http,https -H:NativeLinkerOption=-no-pie -H:-UseServiceLoaderFeature -H:+StackTrace -J--add-exports=org.graalvm.sdk/org.graalvm.nativeimage.impl=ALL-UNNAMED -J--add-exports=org.graalvm.nativeimage.builder/com.oracle.svm.core.jdk=ALL-UNNAMED -J--add-exports=org.graalvm.nativeimage.builder/com.oracle.svm.core.configure=ALL-UNNAMED -J--add-exports=org.graalvm.nativeimage.builder/com.oracle.svm.core.jdk.proxy=ALL-UNNAMED -J--add-exports=org.graalvm.nativeimage.builder/com.oracle.svm.core.jdk.localization=ALL-UNNAMED rest-client-quickstart-1.0.0-SNAPSHOT-runner -jar rest-client-quickstart-1.0.0-SNAPSHOT-runner.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The important part is the following option that was automatically added by Quarkus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-H:EnableURLProtocols=http,https</code></pre>
</div>
</div>
<div class="paragraph">
<p>It enables the native SSL support for your native executable.
But you should not set it manually, we have a nice configuration property for this purpose as described below.</p>
</div>
<div class="paragraph">
<p>As SSL is de facto the standard nowadays, we decided to enable its support automatically for some of our extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the Agroal connection pooling extension (<code>quarkus-agroal</code>),</p>
</li>
<li>
<p>the Amazon Services extension (<code>quarkus-amazon-*</code>),</p>
</li>
<li>
<p>the Consul Config extension (<code>quarkus-config-consul</code>),</p>
</li>
<li>
<p>the Elasticsearch client extensions (<code>quarkus-elasticsearch-rest-client</code> and <code>quarkus-elasticsearch-rest-high-level-client</code>) and thus the Hibernate Search Elasticsearch extension (<code>quarkus-hibernate-search-orm-elasticsearch</code>),</p>
</li>
<li>
<p>the Elytron Security OAuth2 extension (<code>quarkus-elytron-security-oauth2</code>),</p>
</li>
<li>
<p>the gRPC extension (<code>quarkus-grpc</code>),</p>
</li>
<li>
<p>the Infinispan Client extension (<code>quarkus-infinispan-client</code>).</p>
</li>
<li>
<p>the Jaeger extension (<code>quarkus-jaeger</code>),</p>
</li>
<li>
<p>the JGit extension (<code>quarkus-jgit</code>),</p>
</li>
<li>
<p>the JSch extension (<code>quarkus-jsch</code>),</p>
</li>
<li>
<p>the Kafka Client extension (<code>quarkus-kafka-client</code>), if Apicurio Registry 2.x Avro library is used</p>
</li>
<li>
<p>the Keycloak Authorization extension (<code>quarkus-keycloak-authorization</code>),</p>
</li>
<li>
<p>the Kubernetes client extension (<code>quarkus-kubernetes-client</code>),</p>
</li>
<li>
<p>the Logging Sentry extension (<code>quarkus-logging-sentry</code>),</p>
</li>
<li>
<p>the Mailer extension (<code>quarkus-mailer</code>),</p>
</li>
<li>
<p>the MongoDB client extension (<code>quarkus-mongodb-client</code>),</p>
</li>
<li>
<p>the Neo4j extension (<code>quarkus-neo4j</code>),</p>
</li>
<li>
<p>the OIDC and OIDC client extensions (<code>quarkus-oidc</code> and <code>quarkus-oidc-client</code>),</p>
</li>
<li>
<p>the Reactive client for IBM DB2 extension (<code>quarkus-reactive-db2-client</code>),</p>
</li>
<li>
<p>the Reactive client for PostgreSQL extension (<code>quarkus-reactive-pg-client</code>),</p>
</li>
<li>
<p>the Reactive client for MySQL extension (<code>quarkus-reactive-mysql-client</code>),</p>
</li>
<li>
<p>the Reactive client for Microsoft SQL Server extension (<code>quarkus-reactive-mssql-client</code>),</p>
</li>
<li>
<p>the Redis client extension (<code>quarkus-redis-client</code>),</p>
</li>
<li>
<p>the REST Client extension (<code>quarkus-rest-client</code>),</p>
</li>
<li>
<p>the REST Client Reactive extension (<code>quarkus-rest-client-reactive</code>),</p>
</li>
<li>
<p>the SmallRye GraphQL Client extension (<code>quarkus-smallrye-graphql-client</code>),</p>
</li>
<li>
<p>the Spring Cloud Config client extension (<code>quarkus-spring-cloud-config-client</code>),</p>
</li>
<li>
<p>the Vault extension (<code>quarkus-vault</code>),</p>
</li>
<li>
<p>the Cassandra client extensions (<code>cassandra-quarkus-client</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As long as you have one of these extensions in your project, the SSL support will be enabled by default.</p>
</div>
<div class="paragraph">
<p>If you are not using any of them and you want to enable SSL support anyway, please add the following to your configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.ssl.native=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s just check the size of our native executable as it will be useful later:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ ls -lh target/rest-client-quickstart-1.0.0-SNAPSHOT-runner
-rwxrwxr-x. 1 gandrian gandrian 46M Jun 11 13:01 target/rest-client-quickstart-1.0.0-SNAPSHOT-runner</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lets-disable-ssl-and-see-how-it-goes"><a class="anchor" href="#lets-disable-ssl-and-see-how-it-goes"></a>Let&#8217;s disable SSL and see how it goes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus has an option to disable the SSL support entirely.
Why? Because it comes at a certain cost.
So if you are sure you don&#8217;t need it, you can disable it entirely.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s disable it without changing the REST service URL and see how it goes.</p>
</div>
<div class="paragraph">
<p>Open <code>src/main/resources/application.properties</code> and add the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.ssl.native=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>And let&#8217;s try to build again:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native executable tests will fail with the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Caused by: java.lang.IllegalArgumentException: https://stage.code.quarkus.io/api requires SSL support but it is disabled. You probably have set quarkus.ssl.native to false.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This error is the one you obtain when trying to use SSL while it was not explicitly enabled in your native executable.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s change the REST service URL to <strong>not</strong> use SSL in <code>src/main/resources/application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.rest-client."org.acme.rest.client.ExtensionsService".url=http://stage.code.quarkus.io/api</code></pre>
</div>
</div>
<div class="paragraph">
<p>and since <a href="http://stage.code.quarkus.io/api" class="bare">http://stage.code.quarkus.io/api</a> responds with 302 status code we need to also skip the tests with <code>-DskipTests</code>.</p>
</div>
<div class="paragraph">
<p>Now we can build again:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native -DskipTests</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative -DskipTests</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you check carefully the native executable build options, you can see that the SSL related options are gone:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[INFO] [io.quarkus.creator.phase.nativeimage.NativeImagePhase] /opt/graalvm/bin/native-image -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dcom.sun.xml.internal.bind.v2.bytecode.ClassTailor.noOptimize=true -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy$BySpaceAndTime -jar rest-client-1.0.0-SNAPSHOT-runner.jar -J-Djava.util.concurrent.ForkJoinPool.common.parallelism=1 -H:+PrintAnalysisCallTree -H:EnableURLProtocols=http -H:-SpawnIsolates -H:+JNI --no-server -H:-UseServiceLoaderFeature -H:+StackTrace</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we end up with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>You remember we checked the size of the native executable with SSL enabled?
Let&#8217;s check again with SSL support entirely disabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ ls -lh target/rest-client-quickstart-1.0.0-SNAPSHOT-runner
-rwxrwxr-x. 1 gandrian gandrian 35M Jun 11 13:06 target/rest-client-quickstart-1.0.0-SNAPSHOT-runner</code></pre>
</div>
</div>
<div class="paragraph">
<p>Yes, it is now <strong>35 MB</strong> whereas it used to be <strong>46 MB</strong>. SSL comes with an 11 MB overhead in native executable size.</p>
</div>
<div class="paragraph">
<p>And there&#8217;s more to it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lets-start-again-with-a-clean-slate"><a class="anchor" href="#lets-start-again-with-a-clean-slate"></a>Let&#8217;s start again with a clean slate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s revert the changes we made to the configuration file and go back to SSL with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout -- src/main/resources/application.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>And let&#8217;s build the native executable again:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-truststore-path"><a class="anchor" href="#the-truststore-path"></a>The TrustStore path</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This behavior is new to GraalVM 21.3+.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>GraalVM supports both build time and runtime certificate configuration.</p>
</div>
<div class="sect2">
<h3 id="build-time-configuration"><a class="anchor" href="#build-time-configuration"></a>Build time configuration</h3>
<div class="paragraph">
<p>The build time approach favors the principle of "immutable security" where the appropriate certificates are added at build time, and can never be changed afterward.
This guarantees that the list of valid certificates cannot be tampered with when the application gets deployed in production.</p>
</div>
<div class="paragraph">
<p>However, this comes with a few drawbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use the same executable in all environments, and a certificate expires, the application needs to be rebuilt, and redeployed into production with the new certificate, which is an inconvenience.</p>
</li>
<li>
<p>Even worse, if a certificate gets revoked because of a security breach, all applications that embed this certificate need to be rebuilt and redeployed in a timely manner.</p>
</li>
<li>
<p>This requires also to add into the application all certificates for all environments (e.g. DEV, TEST, PROD), which means that a certificate that is required for DEV but should not be used elsewhere, will make its way anyway in production.</p>
</li>
<li>
<p>Providing all certificates at build time complicates the CI, specifically in dynamic environments such as Kubernetes where valid certificates are provided by the platform in the <code>/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</code> PEM file.</p>
</li>
<li>
<p>Lastly, this does not play well with third party software that do not provide a dedicated build for each customer environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Creating a native executable using build time certificates essentially means that the root certificates are fixed at image build time, based on the certificate configuration used at build time (which for Quarkus means when you perform a build having <code>quarkus.package.type=native</code> set).
This avoids shipping a <code>cacerts</code> file or requiring a system property be set in order to set up root certificates that are provided by the OS where the binary runs.</p>
</div>
<div class="paragraph">
<p>In this situation, system properties such as <code>javax.net.ssl.trustStore</code> do not have an effect at
run time, so when the defaults need to be changed, these system properties must be provided at image build time.
The easiest way to do so is by setting <code>quarkus.native.additional-build-args</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus.native.additional-build-args=-J-Djavax.net.ssl.trustStore=/tmp/mycerts,-J-Djavax.net.ssl.trustStorePassword=changeit</code></pre>
</div>
</div>
<div class="paragraph">
<p>will ensure that the certificates of <code>/tmp/mycerts</code> are baked into the native binary and used <strong>instead</strong> of the default <code>cacerts</code>.
The file containing the custom TrustStore does <strong>not</strong> (and probably should not) have to be present at runtime as its content has been baked into the native binary.</p>
</div>
</div>
<div class="sect2">
<h3 id="run-time-configuration"><a class="anchor" href="#run-time-configuration"></a>Run time configuration</h3>
<div class="paragraph">
<p>Using the runtime certificate configuration, supported by GraalVM since 21.3 does not require any special or additional configuration compared to regular java programs or Quarkus in jvm mode. See the <a href="https://www.graalvm.org/22.3/reference-manual/native-image/CertificateManagement/#run-time-options">GraalVM documentation</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="working-with-containers"><a class="anchor" href="#working-with-containers"></a>Working with containers</h3>
<div class="paragraph">
<p>No special action needs to be taken when running the native binary in a container. If the native binary was properly built with the custom TrustStore
as described in the previous section, it will work properly in container as well.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We make building native executable using SSL easy, and provide several options to cope well with different types of security requirements.</p>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#looks-like-it-works-out-of-the-box">Looks like it works out of the box?!?</a></li>
<li><a href="#lets-disable-ssl-and-see-how-it-goes">Let&#8217;s disable SSL and see how it goes</a></li>
<li><a href="#lets-start-again-with-a-clean-slate">Let&#8217;s start again with a clean slate</a></li>
<li><a href="#the-truststore-path">The TrustStore path</a>
<ul class="sectlevel2">
<li><a href="#build-time-configuration">Build time configuration</a></li>
<li><a href="#run-time-configuration">Run time configuration</a></li>
<li><a href="#working-with-containers">Working with containers</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></div>
    </div>
  </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
