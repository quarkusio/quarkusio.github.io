<!DOCTYPE html>
<html lang="en">







<head>
  <title>CDI Integration Guide - 2.13 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.13/guides/cdi-integration" />
  <meta property="og:title" content="CDI Integration Guide - 2.13" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/cdi-integration">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/2.13/guides/cdi-integration" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/2.13/guides/cdi-integration" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/2.13/guides/cdi-integration" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/2.13/guides/cdi-integration" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/2.13/guides/cdi-integration" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>          
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/2.13/guides/cdi-integration" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/2.13/guides/cdi-integration">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/2.13/guides/cdi-integration">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/2.13/guides/cdi-integration">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/2.13/guides/cdi-integration">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/2.13/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.23.4 - Latest</option>
        
        
        
        <option value="3.20" >3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        
        
        
        <option value="3.2" >3.2</option>
        
        
        
        <option value="2.16" >2.16</option>
        
        
        
        <option value="2.13" selected>2.13</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">CDI Integration Guide </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>ArC, the CDI container, is bootstrapped at build time.
The downside of this approach is that CDI Portable Extensions cannot be supported.
Nevertheless, the functionality can be achieved using the Quarkus-specific extensions API.</p>
</div>
<div class="paragraph">
<p>The container is bootstrapped in multiple phases.
From a high level perspective these phases go as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialization</p>
</li>
<li>
<p>Bean discovery</p>
</li>
<li>
<p>Registration of synthetic components</p>
</li>
<li>
<p>Validation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the <em>initialization</em> phase the preparatory work is being carried out and custom contexts are registered.
<em>Bean discovery</em> is then the process where the container analyzes all application classes, identifies beans and wires them all together based on the provided metadata.
Subsequently, the extensions can register <em>synthetic components</em>.
Attributes of these components are fully controlled by the extensions, i.e. are not derived from an existing class.
Finally, the <em>deployment is validated</em>.
For example, the container validates every injection point in the application and fails the build if there is no bean that satisfies the given required type and qualifiers.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can see more information about the bootstrap by enabling additional logging. Simply run the Maven build with <code>-X</code> or <code>--debug</code> and grep the lines that contain <code>io.quarkus.arc</code>. In the <a href="cdi-reference#dev-mode">development mode</a>, you can use <code>quarkus.log.category."io.quarkus.arc.processor".level=DEBUG</code> and two special endpoints are also registered automatically to provide some basic debug info in the JSON format.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Quarkus build steps can produce and consume various build items and hook into each phase.
In the following sections we will describe all the relevant build items and common scenarios.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metadata-sources"><a class="anchor" href="#metadata-sources"></a>1. Metadata Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Classes and annotations are the primary source of bean-level metadata.
The initial metadata are read from the <em>bean archive index</em>, an immutable <a href="https://github.com/wildfly/jandex" target="_blank" rel="noopener">Jandex index</a> which is built from various sources during <a href="cdi-reference#bean_discovery">bean discovery</a>.
However, extensions can add, remove or transform the metadata at certain stages of the bootstrap.
Moreover, extensions can also register <a href="#synthetic_beans">synthetic components</a>.
This is an important aspect to realize when integrating CDI components in Quarkus.</p>
</div>
<div class="paragraph">
<p>This way, extensions can turn classes, that would be otherwise ignored, into beans and vice versa.
For example, a class that declares a <code>@Scheduled</code> method is always registered as a bean even if it is not annotated with a bean defining annotation and would be normally ignored.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-my-class-is-not-recognized-as-a-bean"><a class="anchor" href="#use-case-my-class-is-not-recognized-as-a-bean"></a>2. Use Case - My Class Is Not Recognized as a Bean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An <code>UnsatisfiedResolutionException</code> indicates a problem during <a href="cdi#typesafe_resolution">typesafe resolution</a>.
Sometimes an injection point cannot be satisfied even if there is a class on the classpath that appears to be eligible for injection.
There are several reasons why a class is not recognized and also several ways to fix it.
In the first step we should identify the <em>reason</em>.</p>
</div>
<div class="sect2">
<h3 id="additional_bean_build_item"><a class="anchor" href="#additional_bean_build_item"></a>2.1. <em>Reason 1</em>: Class Is Not discovered</h3>
<div class="paragraph">
<p>Quarkus has a <a href="cdi-reference#bean_discovery">simplified discovery</a>.
It might happen that the class is not part of the application index.
For example, classes from the <em>runtime module</em> of a Quarkus extension are not indexed automatically.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: Use the <code>AdditionalBeanBuildItem</code>.
This build item can be used to specify one or more additional classes to be analyzed during the discovery.
Additional bean classes are transparently added to the application index processed by the container.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is not possible to conditionally enable/disable additional beans via the <code>@IfBuildProfile</code>, <code>@UnlessBuildProfile</code>, <code>@IfBuildProperty</code> and <code>@UnlessBuildProperty</code> annotations as described in <a href="cdi-reference#enable_build_profile">cdi-reference</a> and <a href="cdi-reference#enable_build_properties">cdi-reference</a>. Extensions should inspect the configuration or the current profile and only produce an <code>AdditionalBeanBuildItem</code> if really needed.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>AdditionalBeanBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
AdditionalBeanBuildItem additionalBeans() {
     return new AdditionalBeanBuildItem(SmallRyeHealthReporter.class, HealthServlet.class)); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>AdditionalBeanBuildItem.Builder</code> can be used for more complex use cases.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Bean classes added via <code>AdditionalBeanBuildItem</code> are <em>removable</em> by default.
If the container considers them <a href="cdi-reference#remove_unused_beans">unused</a>, they are just ignored.
However, you can use <code>AdditionalBeanBuildItem.Builder.setUnremovable()</code> method to instruct the container to never remove bean classes registered via this build item.
See also <a href="cdi-reference#remove_unused_beans">Removing Unused Beans</a> and <a href="#unremovable_builditem"><em>Reason 3</em>: Class Was Discovered and Has a Bean Defining Annotation but Was Removed</a> for more details.</p>
</div>
<div class="paragraph">
<p>It is aso possible to set the default scope via <code>AdditionalBeanBuildItem.Builder#setDefaultScope()</code>.
The default scope is only used if there is no scope declared on the bean class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no default scope is specified the <code>@Dependent</code> pseudo-scope is used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="reason-2-class-is-discovered-but-has-no-bean-defining-annotation"><a class="anchor" href="#reason-2-class-is-discovered-but-has-no-bean-defining-annotation"></a>2.2. <em>Reason 2</em>: Class Is Discovered but Has No Bean Defining Annotation</h3>
<div class="paragraph">
<p>In Quarkus, the application is represented by a single bean archive with the <a href="https://jakarta.ee/specifications/cdi/2.0/cdi-spec-2.0.html#default_bean_discovery" target="_blank" rel="noopener">bean discovery mode <code>annotated</code></a>.
Therefore, bean classes that don&#8217;t have a <a href="https://jakarta.ee/specifications/cdi/2.0/cdi-spec-2.0.html#bean_defining_annotations" target="_blank" rel="noopener">bean defining annotation</a> are ignored.
Bean defining annotations are declared on the class-level and include scopes, stereotypes and <code>@Interceptor</code>.</p>
</div>
<div class="paragraph">
<p><em>Solution 1</em>: Use the <code>AutoAddScopeBuildItem</code>. This build item can be used to add a scope to a class that meets certain conditions.</p>
</div>
<div class="listingblock">
<div class="title"><code>AutoAddScopeBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
AutoAddScopeBuildItem autoAddScope() {
   return AutoAddScopeBuildItem.builder().containsAnnotations(SCHEDULED_NAME, SCHEDULES_NAME) <i class="conum" data-value="1"></i><b>(1)</b>
      .defaultScope(BuiltinScope.SINGLETON) <i class="conum" data-value="2"></i><b>(2)</b>
      .build();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Find all classes annotated with <code>@Scheduled</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>@Singleton</code> as default scope. Classes already annotated with a scope are skipped automatically.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Solution 2</em>: If you need to process classes annotated with a specific annotation then it&#8217;s possible to extend the set of bean defining annotations via the <code>BeanDefiningAnnotationBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>BeanDefiningAnnotationBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
BeanDefiningAnnotationBuildItem additionalBeanDefiningAnnotation() {
   return new BeanDefiningAnnotationBuildItem(Annotations.GRAPHQL_API); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add <code>org.eclipse.microprofile.graphql.GraphQLApi</code> to the set of bean defining annotations.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Bean classes added via <code>BeanDefiningAnnotationBuildItem</code> are <em>not removable</em> by default, i.e. the resulting beans must not be removed even if they are considered unused.
However, you can change the default behavior.
See also <a href="cdi-reference#remove_unused_beans">Removing Unused Beans</a> and <a href="#unremovable_builditem"><em>Reason 3</em>: Class Was Discovered and Has a Bean Defining Annotation but Was Removed</a> for more details.</p>
</div>
<div class="paragraph">
<p>It is also possible to specify the default scope.
The default scope is only used if there is no scope declared on the bean class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no default scope is specified the <code>@Dependent</code> pseudo-scope is used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="unremovable_builditem"><a class="anchor" href="#unremovable_builditem"></a>2.3. <em>Reason 3</em>: Class Was Discovered and Has a Bean Defining Annotation but Was Removed</h3>
<div class="paragraph">
<p>The container attempts to <a href="cdi-reference#remove_unused_beans">remove all unused beans</a> during the build by default.
This optimization allows for <em>framework-level dead code elimination</em>.
In few special cases, it&#8217;s not possible to correctly identify an unused bean.
In particular, Quarkus is not able to detect the usage of the <code>CDI.current()</code> static method yet.
Extensions can eliminate possible false positives by producing an <code>UnremovableBeanBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>UnremovableBeanBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
UnremovableBeanBuildItem unremovableBeans() {
   return UnremovableBeanBuildItem.targetWithAnnotation(STARTUP_NAME); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make all classes annotated with <code>@Startup</code> unremovable.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-my-annotation-is-not-recognized-as-a-qualifier-or-an-interceptor-binding"><a class="anchor" href="#use-case-my-annotation-is-not-recognized-as-a-qualifier-or-an-interceptor-binding"></a>3. Use Case - My Annotation Is Not Recognized as a Qualifier or an Interceptor Binding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is likely that the annotation class is not part of the application index.
For example, classes from the <em>runtime module</em> of a Quarkus extension are not indexed automatically.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: Use the <code>AdditionalBeanBuildItem</code> as described in <a href="#additional_bean_build_item"><em>Reason 1</em>: Class Is Not discovered</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="annotations_transformer_build_item"><a class="anchor" href="#annotations_transformer_build_item"></a>4. Use Case - I Need To Transform Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases, it&#8217;s useful to be able to modify the metadata.
Quarkus provides a powerful alternative to <a href="https://jakarta.ee/specifications/cdi/2.0/cdi-spec-2.0.html#process_annotated_type" target="_blank" rel="noopener"><code>javax.enterprise.inject.spi.ProcessAnnotatedType</code></a>.
With an <code>AnnotationsTransformerBuildItem</code> it&#8217;s possible to override the annotations that exist on bean classes.</p>
</div>
<div class="paragraph">
<p>For example, you might want to add an interceptor binding to a specific bean class.
Here is how to do it:</p>
</div>
<div class="listingblock">
<div class="title"><code>AnnotationsTransformerBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
AnnotationsTransformerBuildItem transform() {
   return new AnnotationsTransformerBuildItem(new AnnotationsTransformer() {

      public boolean appliesTo(org.jboss.jandex.AnnotationTarget.Kind kind) {
         return kind == org.jboss.jandex.AnnotationTarget.Kind.CLASS; <i class="conum" data-value="1"></i><b>(1)</b>
      }

      public void transform(TransformationContext context) {
         if (context.getTarget().asClass().name().toString().equals("org.acme.Bar")) {
            context.transform().add(MyInterceptorBinding.class).done(); <i class="conum" data-value="2"></i><b>(2)</b>
         }
      }
    });
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The transformer is only applied to classes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the class name equals to <code>org.acme.Bar</code> then add <code>@MyInterceptorBinding</code>. Don&#8217;t forget to invoke <code>Transformation#done()</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Keep in mind that annotation transformers must be produced <em>before</em> the bean discovery starts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Build steps can query the transformed annotations for a given annotation target via the <code>TransformedAnnotationsBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>TransformedAnnotationsBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
void queryAnnotations(TransformedAnnotationsBuildItem transformedAnnotations, BuildProducer&lt;MyBuildItem&gt; myBuildItem) {
   ClassInfo myClazz = ...;
   if (transformedAnnotations.getAnnotations(myClazz).isEmpty()) { <i class="conum" data-value="1"></i><b>(1)</b>
     myBuildItem.produce(new MyBuildItem());
   }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>TransformedAnnotationsBuildItem.getAnnotations()</code> will return a possibly transformed set of annotations.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are other build items specialized in transformation: <a href="#additional_interceptor_bindings">Use Case - Additional Interceptor Bindings</a> and <a href="#injection_point_transformation">Use Case - Injection Point Transformation</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="inspect_beans"><a class="anchor" href="#inspect_beans"></a>5. Use Case - Inspect Beans, Observers and Injection Points</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="solution-1-beandiscoveryfinishedbuilditem"><a class="anchor" href="#solution-1-beandiscoveryfinishedbuilditem"></a>5.1. <em>Solution 1</em>: <code>BeanDiscoveryFinishedBuildItem</code></h3>
<div class="paragraph">
<p>Consumers of <code>BeanDiscoveryFinishedBuildItem</code> can easily inspect all class-based beans, observers and injection points registered in the application.
However, synthetic beans and observers are <em>not included</em> because this build item is produced <em>before</em> the synthetic components are registered.</p>
</div>
<div class="paragraph">
<p>Additionally, the bean resolver returned from <code>BeanDiscoveryFinishedBuildItem#getBeanResolver()</code> can be used to apply the type-safe resolution rules, e.g. to find out whether there is a bean that would satisfy certain combination of required type and qualifiers.</p>
</div>
<div class="listingblock">
<div class="title"><code>BeanDiscoveryFinishedBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
void doSomethingWithNamedBeans(BeanDiscoveryFinishedBuildItem beanDiscovery, BuildProducer&lt;NamedBeansBuildItem&gt; namedBeans) {
   List&lt;BeanInfo&gt; namedBeans = beanDiscovery.beanStream().withName().collect(toList())); <i class="conum" data-value="1"></i><b>(1)</b>
   namedBeans.produce(new NamedBeansBuildItem(namedBeans));
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The resulting list will not contain <code>@Named</code> synthetic beans.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="solution-2-synthesisfinishedbuilditem"><a class="anchor" href="#solution-2-synthesisfinishedbuilditem"></a>5.2. <em>Solution 2</em>: <code>SynthesisFinishedBuildItem</code></h3>
<div class="paragraph">
<p>Consumers of <code>SynthesisFinishedBuildItem</code> can easily inspect all beans, observers and injection points registered in the application. Synthetic beans and observers are included because this build item is produced <em>after</em> the synthetic components are registered.</p>
</div>
<div class="paragraph">
<p>Additionally, the bean resolver returned from <code>SynthesisFinishedBuildItem#getBeanResolver()</code> can be used to apply the type-safe resolution rules, e.g. to find out whether there is a bean that would satisfy certain combination of required type and qualifiers.</p>
</div>
<div class="listingblock">
<div class="title"><code>SynthesisFinishedBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
void doSomethingWithNamedBeans(SynthesisFinishedBuildItem synthesisFinished, BuildProducer&lt;NamedBeansBuildItem&gt; namedBeans) {
   List&lt;BeanInfo&gt; namedBeans = synthesisFinished.beanStream().withName().collect(toList())); <i class="conum" data-value="1"></i><b>(1)</b>
   namedBeans.produce(new NamedBeansBuildItem(namedBeans));
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The resulting list will contain <code>@Named</code> synthetic beans.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="synthetic_beans"><a class="anchor" href="#synthetic_beans"></a>6. Use Case - The Need for Synthetic Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes it is practical to be able to register a <em>synthetic bean</em>.
Bean attributes of a synthetic bean are not derived from a Java class, method or field.
Instead, all the attributes are defined by an extension.
In regular CDI, this could be achieved using the <a href="https://jakarta.ee/specifications/cdi/2.0/cdi-spec-2.0.html#after_bean_discovery" target="_blank" rel="noopener"><code>AfterBeanDiscovery.addBean()</code></a> methods.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: If you need to register a synthetic bean then use the <code>SyntheticBeanBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>SyntheticBeanBuildItem</code> Example 1</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
SyntheticBeanBuildItem syntheticBean() {
   return SyntheticBeanBuildItem.configure(String.class)
             .qualifiers(new MyQualifierLiteral())
             .creator(mc -&gt; mc.returnValue(mc.load("foo"))) <i class="conum" data-value="1"></i><b>(1)</b>
             .done();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generate the bytecode of the <code>javax.enterprise.context.spi.Contextual#create(CreationalContext&lt;T&gt;)</code> implementation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The output of a bean configurator is recorded as bytecode.
Therefore, there are some limitations in how a synthetic bean instance is created at runtime.
You can:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate the bytecode of the <code>Contextual#create(CreationalContext&lt;T&gt;)</code> method directly via <code>ExtendedBeanConfigurator.creator(Consumer&lt;MethodCreator&gt;)</code>.</p>
</li>
<li>
<p>Pass a <code>io.quarkus.arc.BeanCreator</code> implementation class via <code>ExtendedBeanConfigurator#creator(Class&lt;? extends BeanCreator&lt;U&gt;&gt;)</code>, and possibly specify some parameters via <code>ExtendedBeanConfigurator#param()</code>.</p>
</li>
<li>
<p>Produce the runtime instance through a proxy returned from a <a href="writing-extensions#bytecode-recording"><code>@Recorder</code> method</a> and set it via <code>ExtendedBeanConfigurator#runtimeValue(RuntimeValue&lt;?&gt;)</code> or <code>ExtendedBeanConfigurator#supplier(Supplier&lt;?&gt;)</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title"><code>SyntheticBeanBuildItem</code> Example 2</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
@Record(STATIC_INIT) <i class="conum" data-value="1"></i><b>(1)</b>
SyntheticBeanBuildItem syntheticBean(TestRecorder recorder) {
   return SyntheticBeanBuildItem.configure(Foo.class).scope(Singleton.class)
                .runtimeValue(recorder.createFoo()) <i class="conum" data-value="2"></i><b>(2)</b>
                .done();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By default, a synthetic bean is initialized during <code>STATIC_INIT</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bean instance is supplied by a value returned from a recorder method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to mark a synthetic bean to be initialized during <code>RUNTIME_INIT</code>.
See the <a href="writing-extensions#bootstrap-three-phases">Three Phases of Bootstrap and Quarkus Philosophy</a> for more information about the difference between <code>STATIC_INIT</code> and <code>RUNTIME_INIT</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>RUNTIME_INIT</code> <code>SyntheticBeanBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
@Record(RUNTIME_INIT) <i class="conum" data-value="1"></i><b>(1)</b>
SyntheticBeanBuildItem syntheticBean(TestRecorder recorder) {
   return SyntheticBeanBuildItem.configure(Foo.class).scope(Singleton.class)
                .setRuntimeInit() <i class="conum" data-value="2"></i><b>(2)</b>
                .runtimeValue(recorder.createFoo())
                .done();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The recorder must be executed in the <code>ExecutionTime.RUNTIME_INIT</code> phase.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bean instance is initialized during <code>RUNTIME_INIT</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Synthetic beans initialized during <code>RUNTIME_INIT</code> must not be accessed during <code>STATIC_INIT</code>. <code>RUNTIME_INIT</code> build steps that access a runtime-init synthetic bean should consume the <code>SyntheticBeansRuntimeInitBuildItem</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
@Record(RUNTIME_INIT)
@Consume(SyntheticBeansRuntimeInitBuildItem.class) <i class="conum" data-value="1"></i><b>(1)</b>
void accessFoo(TestRecorder recorder) {
   recorder.foo(); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This build step must be executed after <code>syntheticBean()</code> completes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This recorder method results in an invocation upon the <code>Foo</code> bean instance and thus we need to make sure that the build step is executed after all synthetic beans are initialized.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is also possible to use the <code>BeanRegistrationPhaseBuildItem</code> to register a synthetic bean. However, we recommend extension authors to stick with <code>SyntheticBeanBuildItem</code> which is more idiomatic for Quarkus.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="synthetic_observers"><a class="anchor" href="#synthetic_observers"></a>7. Use Case - Synthetic Observers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similar to <a href="#synthetic_beans">synthetic beans</a>, the attributes of a synthetic observer method are not derived from a Java method. Instead, all the attributes are defined by an extension.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: If you need to register a synthetic observer, use the <code>ObserverRegistrationPhaseBuildItem</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A build step that consumes the <code>ObserverRegistrationPhaseBuildItem</code> should always produce an <code>ObserverConfiguratorBuildItem</code> or at least inject a <code>BuildProducer</code> for this build item, otherwise it could be ignored or processed at the wrong time (e.g. after the correct CDI bootstrap phase).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>ObserverRegistrationPhaseBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
void syntheticObserver(ObserverRegistrationPhaseBuildItem observerRegistrationPhase,
            BuildProducer&lt;MyBuildItem&gt; myBuildItem,
            BuildProducer&lt;ObserverConfiguratorBuildItem&gt; observerConfigurationRegistry) {
   observerConfigurationRegistry.produce(new ObserverConfiguratorBuildItem(observerRegistrationPhase.getContext()
       .configure()
       .beanClass(DotName.createSimple(MyBuildStep.class.getName()))
       .observedType(String.class)
       .notify(mc -&gt; {
           // do some gizmo bytecode generation...
       })));
   myBuildItem.produce(new MyBuildItem());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of a <code>ObserverConfigurator</code> is recorded as bytecode.
Therefore, there are some limitations in how a synthetic observer is invoked at runtime.
Currently, you must generate the bytecode of the method body directly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generated_beans"><a class="anchor" href="#generated_beans"></a>8. Use Case - I Have a Generated Bean Class</h2>
<div class="sectionbody">
<div class="paragraph">
<p>No problem.
You can generate the bytecode of a bean class manually and then all you need to do is to produce a <code>GeneratedBeanBuildItem</code> instead of <code>GeneratedClassBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>GeneratedBeanBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
void generatedBean(BuildProducer&lt;GeneratedBeanBuildItem&gt; generatedBeans) {
    ClassOutput beansClassOutput = new GeneratedBeanGizmoAdaptor(generatedBeans); <i class="conum" data-value="1"></i><b>(1)</b>
    ClassCreator beanClassCreator = ClassCreator.builder().classOutput(beansClassOutput)
                .className("org.acme.MyBean")
                .build();
    beanClassCreator.addAnnotation(Singleton.class);
    beanClassCreator.close(); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>io.quarkus.arc.deployment.GeneratedBeanGizmoAdaptor</code> makes it easy to produce <code>GeneratedBeanBuildItem</code>s from Gizmo constructs.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The resulting bean class is something like <code>public class @Singleton MyBean { }</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-i-need-to-validate-the-deployment"><a class="anchor" href="#use-case-i-need-to-validate-the-deployment"></a>9. Use Case - I Need to Validate the Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes extensions need to inspect the beans, observers and injection points, then perform additional validations and fail the build if something is wrong.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: If an extension needs to validate the deployment it should use the <code>ValidationPhaseBuildItem</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A build step that consumes the <code>ValidationPhaseBuildItem</code> should always produce a <code>ValidationErrorBuildItem</code> or at least inject a <code>BuildProducer</code> for this build item, otherwise it could be ignored or processed at the wrong time (e.g. after the correct CDI bootstrap phase).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
void validate(ValidationPhaseBuildItem validationPhase,
            BuildProducer&lt;MyBuildItem&gt; myBuildItem,
            BuildProducer&lt;ValidationErrorBuildItem&gt; errors) {
   if (someCondition) {
     errors.produce(new ValidationErrorBuildItem(new IllegalStateException()));
     myBuildItem.produce(new MyBuildItem());
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can easily filter all registered beans via the convenient <code>BeanStream</code> returned from the <code>ValidationPhaseBuildItem.getContext().beans()</code> method.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom_context"><a class="anchor" href="#custom_context"></a>10. Use Case - Register a Custom CDI Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes extensions need to extend the set of built-in CDI contexts.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: If you need to register a custom context, use the <code>ContextRegistrationPhaseBuildItem</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A build step that consumes the <code>ContextRegistrationPhaseBuildItem</code> should always produce a <code>ContextConfiguratorBuildItem</code> or at least inject a <code>BuildProducer</code> for this build item, otherwise it could be ignored or processed at the wrong time (e.g. after the correct CDI bootstrap phase).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>ContextRegistrationPhaseBuildItem</code> Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
ContextConfiguratorBuildItem registerContext(ContextRegistrationPhaseBuildItem phase) {
      return new ContextConfiguratorBuildItem(phase.getContext().configure(TransactionScoped.class).normal().contextClass(TransactionContext.class));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, each extension that registers a custom CDI context via <code>ContextRegistrationPhaseBuildItem</code> should also produce the <code>CustomScopeBuildItem</code> in order to contribute the custom scope annotation name to the set of bean defining annotations.</p>
</div>
<div class="paragraph">
<p><code>CustomScopeBuildItem</code> Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
CustomScopeBuildItem customScope() {
   return new CustomScopeBuildItem(DotName.createSimple(TransactionScoped.class.getName()));
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="what-if-i-need-to-know-all-the-scopes-used-in-the-application"><a class="anchor" href="#what-if-i-need-to-know-all-the-scopes-used-in-the-application"></a>10.1. What if I Need to Know All the Scopes Used in the Application?</h3>
<div class="paragraph">
<p><em>Solution</em>: You can inject the <code>CustomScopeAnnotationsBuildItem</code> in a build step and use the convenient methods such as <code>CustomScopeAnnotationsBuildItem.isScopeDeclaredOn()</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional_interceptor_bindings"><a class="anchor" href="#additional_interceptor_bindings"></a>11. Use Case - Additional Interceptor Bindings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In rare cases it might be handy to programmatically register an existing annotation that is not annotated with <code>@javax.interceptor.InterceptorBinding</code> as an interceptor binding.
This is similar to what CDI achieves through <code>BeforeBeanDiscovery#addInterceptorBinding()</code>.
We are going to use <code>InterceptorBindingRegistrarBuildItem</code> to get it done.</p>
</div>
<div class="listingblock">
<div class="title"><code>InterceptorBindingRegistrarBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
InterceptorBindingRegistrarBuildItem addInterceptorBindings() {
    return new InterceptorBindingRegistrarBuildItem(new InterceptorBindingRegistrar() {
        @Override
        public List&lt;InterceptorBinding&gt; getAdditionalBindings() {
            return List.of(InterceptorBinding.of(NotAnInterceptorBinding.class));
        }
    });
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-additional-qualifiers"><a class="anchor" href="#use-case-additional-qualifiers"></a>12. Use Case - Additional Qualifiers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes it might be useful to register an existing annotation that is not annotated with <code>@javax.inject.Qualifier</code> as a CDI qualifier.
This is similar to what CDI achieves through <code>BeforeBeanDiscovery#addQualifier()</code>.
We are going to use <code>QualifierRegistrarBuildItem</code> to get it done.</p>
</div>
<div class="listingblock">
<div class="title"><code>QualifierRegistrarBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
QualifierRegistrarBuildItem addQualifiers() {
    return new QualifierRegistrarBuildItem(new QualifierRegistrar() {
        @Override
        public Map&lt;DotName, Set&lt;String&gt;&gt; getAdditionalQualifiers() {
            return Collections.singletonMap(DotName.createSimple(NotAQualifier.class.getName()),
                                        Collections.emptySet());
        }
    });
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-additional-stereotypes"><a class="anchor" href="#use-case-additional-stereotypes"></a>13. Use Case - Additional Stereotypes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is sometimes useful to register an existing annotation that is not annotated with <code>@javax.enterprise.inject.Stereotype</code> as a CDI stereotype.
This is similar to what CDI achieves through <code>BeforeBeanDiscovery#addStereotype()</code>.
We are going to use <code>StereotypeRegistrarBuildItem</code> to get it done.</p>
</div>
<div class="listingblock">
<div class="title"><code>StereotypeRegistrarBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
StereotypeRegistrarBuildItem addStereotypes() {
    return new StereotypeRegistrarBuildItem(new StereotypeRegistrar() {
        @Override
        public Set&lt;DotName&gt; getAdditionalStereotypes() {
            return Collections.singleton(DotName.createSimple(NotAStereotype.class.getName()));
        }
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the newly registered stereotype annotation doesn&#8217;t have the appropriate meta-annotations, such as scope or interceptor bindings, use an <a href="#annotations_transformer_build_item">annotation transformation</a> to add them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="injection_point_transformation"><a class="anchor" href="#injection_point_transformation"></a>14. Use Case - Injection Point Transformation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every now and then it is handy to be able to change the qualifiers of an injection point programmatically.
You can do just that with <code>InjectionPointTransformerBuildItem</code>.
The following sample shows how to apply transformation to injection points with type <code>Foo</code> that contain qualifier <code>MyQualifier</code>:</p>
</div>
<div class="listingblock">
<div class="title"><code>InjectionPointTransformerBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
InjectionPointTransformerBuildItem transformer() {
    return new InjectionPointTransformerBuildItem(new InjectionPointsTransformer() {

        public boolean appliesTo(Type requiredType) {
            return requiredType.name().equals(DotName.createSimple(Foo.class.getName()));
        }

        public void transform(TransformationContext context) {
            if (context.getQualifiers().stream()
                    .anyMatch(a -&gt; a.name().equals(DotName.createSimple(MyQualifier.class.getName())))) {
                context.transform()
                        .removeAll()
                        .add(DotName.createSimple(MyOtherQualifier.class.getName()))
                        .done();
            }
        }
    });
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In theory, you can use <a href="#annotations_transformer_build_item">an <code>AnnotationsTransformer</code></a> to achieve the same goal. However, there are few differences that make <code>InjectionPointsTransformer</code> more suitable for this particular task: (1) annotation transformers are applied to all classes during bean discovery, whereas <code>InjectionPointsTransformer</code> is only applied to discovered injection points after bean discovery; (2) with <code>InjectionPointsTransformer</code> you don&#8217;t need to handle various types of injection points (field, parameters of initializer methods, etc.).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-resource-annotations-and-injection"><a class="anchor" href="#use-case-resource-annotations-and-injection"></a>15. Use Case - Resource Annotations and Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>ResourceAnnotationBuildItem</code> can be used to specify resource annotations that make it possible to resolve non-CDI injection points, such as Jakarta EE resources.
An integrator must also provide a corresponding <code>io.quarkus.arc.ResourceReferenceProvider</code> service provider implementation.</p>
</div>
<div class="listingblock">
<div class="title"><code>ResourceAnnotationBuildItem</code> Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BuildStep
void setupResourceInjection(BuildProducer&lt;ResourceAnnotationBuildItem&gt; resourceAnnotations, BuildProducer&lt;GeneratedResourceBuildItem&gt; resources) {
    resources.produce(new GeneratedResourceBuildItem("META-INF/services/io.quarkus.arc.ResourceReferenceProvider",
        MyResourceReferenceProvider.class.getName().getBytes()));
    resourceAnnotations.produce(new ResourceAnnotationBuildItem(DotName.createSimple(MyAnnotation.class.getName())));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build_metadata"><a class="anchor" href="#build_metadata"></a>16. Available Build Time Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any of the above extensions that operates with <code>BuildExtension.BuildContext</code> can leverage certain build time metadata that are generated during build.
The built-in keys located in <code>io.quarkus.arc.processor.BuildExtension.Key</code> are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ANNOTATION_STORE</dt>
<dd>
<p>Contains an <code>AnnotationStore</code> that keeps information about all <code>AnnotationTarget</code> annotations after application of annotation transformers</p>
</dd>
<dt class="hdlist1">INJECTION_POINTS</dt>
<dd>
<p><code>Collection&lt;InjectionPointInfo&gt;</code> containing all injection points</p>
</dd>
<dt class="hdlist1">BEANS</dt>
<dd>
<p><code>Collection&lt;BeanInfo&gt;</code> containing all beans</p>
</dd>
<dt class="hdlist1">REMOVED_BEANS</dt>
<dd>
<p><code>Collection&lt;BeanInfo&gt;</code> containing all the removed beans; see <a href="cdi-reference#remove_unused_beans">Removing unused beans</a> for more information</p>
</dd>
<dt class="hdlist1">OBSERVERS</dt>
<dd>
<p><code>Collection&lt;ObserverInfo&gt;</code> containing all observers</p>
</dd>
<dt class="hdlist1">SCOPES</dt>
<dd>
<p><code>Collection&lt;ScopeInfo&gt;</code> containing all scopes, including custom ones</p>
</dd>
<dt class="hdlist1">QUALIFIERS</dt>
<dd>
<p><code>Map&lt;DotName, ClassInfo&gt;</code> containing all qualifiers</p>
</dd>
<dt class="hdlist1">INTERCEPTOR_BINDINGS</dt>
<dd>
<p><code>Map&lt;DotName, ClassInfo&gt;</code> containing all interceptor bindings</p>
</dd>
<dt class="hdlist1">STEREOTYPES</dt>
<dd>
<p><code>Map&lt;DotName, StereotypeInfo&gt;</code> containing all stereotypes</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To get hold of these, simply query the extension context object for given key.
Note that these metadata are made available as build proceeds which means that extensions can only leverage metadata that were built before the extensions are invoked.
If your extension attempts to retrieve metadata that wasn&#8217;t yet produced, <code>null</code> will be returned.
Here is a summary of which extensions can access which metadata:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AnnotationsTransformer</dt>
<dd>
<p>Shouldn&#8217;t rely on any metadata as it could be used at any time in any phase of the bootstrap</p>
</dd>
<dt class="hdlist1">ContextRegistrar</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code></p>
</dd>
<dt class="hdlist1">InjectionPointsTransformer</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code></p>
</dd>
<dt class="hdlist1">ObserverTransformer</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code></p>
</dd>
<dt class="hdlist1">BeanRegistrar</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code>, <code>BEANS</code> (class-based beans only), <code>OBSERVERS</code> (class-based observers only), <code>INJECTION_POINTS</code></p>
</dd>
<dt class="hdlist1">ObserverRegistrar</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code>, <code>BEANS</code>, <code>OBSERVERS</code> (class-based observers only), <code>INJECTION_POINTS</code></p>
</dd>
<dt class="hdlist1">BeanDeploymentValidator</dt>
<dd>
<p>Has access to all build metadata</p>
</dd>
</dl>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#metadata-sources">1. Metadata Sources</a></li>
<li><a href="#use-case-my-class-is-not-recognized-as-a-bean">2. Use Case - My Class Is Not Recognized as a Bean</a>
<ul class="sectlevel2">
<li><a href="#additional_bean_build_item">2.1. <em>Reason 1</em>: Class Is Not discovered</a></li>
<li><a href="#reason-2-class-is-discovered-but-has-no-bean-defining-annotation">2.2. <em>Reason 2</em>: Class Is Discovered but Has No Bean Defining Annotation</a></li>
<li><a href="#unremovable_builditem">2.3. <em>Reason 3</em>: Class Was Discovered and Has a Bean Defining Annotation but Was Removed</a></li>
</ul>
</li>
<li><a href="#use-case-my-annotation-is-not-recognized-as-a-qualifier-or-an-interceptor-binding">3. Use Case - My Annotation Is Not Recognized as a Qualifier or an Interceptor Binding</a></li>
<li><a href="#annotations_transformer_build_item">4. Use Case - I Need To Transform Metadata</a></li>
<li><a href="#inspect_beans">5. Use Case - Inspect Beans, Observers and Injection Points</a>
<ul class="sectlevel2">
<li><a href="#solution-1-beandiscoveryfinishedbuilditem">5.1. <em>Solution 1</em>: <code>BeanDiscoveryFinishedBuildItem</code></a></li>
<li><a href="#solution-2-synthesisfinishedbuilditem">5.2. <em>Solution 2</em>: <code>SynthesisFinishedBuildItem</code></a></li>
</ul>
</li>
<li><a href="#synthetic_beans">6. Use Case - The Need for Synthetic Beans</a></li>
<li><a href="#synthetic_observers">7. Use Case - Synthetic Observers</a></li>
<li><a href="#generated_beans">8. Use Case - I Have a Generated Bean Class</a></li>
<li><a href="#use-case-i-need-to-validate-the-deployment">9. Use Case - I Need to Validate the Deployment</a></li>
<li><a href="#custom_context">10. Use Case - Register a Custom CDI Context</a>
<ul class="sectlevel2">
<li><a href="#what-if-i-need-to-know-all-the-scopes-used-in-the-application">10.1. What if I Need to Know All the Scopes Used in the Application?</a></li>
</ul>
</li>
<li><a href="#additional_interceptor_bindings">11. Use Case - Additional Interceptor Bindings</a></li>
<li><a href="#use-case-additional-qualifiers">12. Use Case - Additional Qualifiers</a></li>
<li><a href="#use-case-additional-stereotypes">13. Use Case - Additional Stereotypes</a></li>
<li><a href="#injection_point_transformation">14. Use Case - Injection Point Transformation</a></li>
<li><a href="#use-case-resource-annotations-and-injection">15. Use Case - Resource Annotations and Injection</a></li>
<li><a href="#build_metadata">16. Available Build Time Metadata</a></li>
</ul></div>
    </div>
  </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
