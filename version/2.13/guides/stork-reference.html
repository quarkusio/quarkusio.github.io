<!DOCTYPE html>
<html lang="en">







<head>
  <title>Stork Reference Guide - 2.13 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://route-default-test-mscherer-matamo.apps.ospo-osci.z3b1.p1.openshiftapps.com/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://embed.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.13/guides/stork-reference" />
  <meta property="og:title" content="Stork Reference Guide - 2.13" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/stork-reference">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/2.13/guides/stork-reference" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/2.13/guides/stork-reference" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/2.13/guides/stork-reference" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/2.13/guides/stork-reference" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/2.13/guides/stork-reference" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/continuum" class="">VERSATILITY</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/2.13/guides/stork-reference" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/2.13/guides/stork-reference">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/2.13/guides/stork-reference">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/2.13/guides/stork-reference">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/2.13/guides/stork-reference">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/2.13/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.16.2 - Latest</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        
        
        
        <option value="3.2" >3.2</option>
        
        
        
        <option value="2.16" >2.16</option>
        
        
        
        <option value="2.13" selected>2.13</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">Stork Reference Guide </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide is the companion from the <a href="stork">Stork Getting Started Guide</a>.
It explains the configuration and usage of SmallRye Stork integration in Quarkus.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This technology is considered preview.</p>
</div>
<div class="paragraph">
<p>In <em>preview</em>, backward compatibility and presence in the ecosystem is not guaranteed.
Specific improvements might require changing configuration or APIs, and plans to become <em>stable</em> are under way.
Feedback is welcome on our <a href="https://groups.google.com/d/forum/quarkus-dev">mailing list</a> or as issues in our <a href="https://github.com/quarkusio/quarkus/issues">GitHub issue tracker</a>.</p>
</div>
<div class="paragraph">
<p>For a full list of possible statuses, check our <a href="https://quarkus.io/faq/#what-are-the-extension-statuses">FAQ entry</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="supported-clients"><a class="anchor" href="#supported-clients"></a>Supported clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The current integration of Stork supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the Reactive REST Client</p>
</li>
<li>
<p>the gRPC clients</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Warning: The gRPC client integration does not support statistic-based load balancers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="available-service-discovery-and-selection"><a class="anchor" href="#available-service-discovery-and-selection"></a>Available service discovery and selection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Check the <a href="https://smallrye.io/smallrye-stork">SmallRye Stork website</a> to find more about the provided service discovery and selection.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-stork-in-kubernetes"><a class="anchor" href="#using-stork-in-kubernetes"></a>Using Stork in Kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stork provides a service discovery support for Kubernetes, which goes beyond what Kubernetes provides by default.
It looks for all the pods backing up a Kubernetes service, but instead of applying a round-robin (as Kubernetes would do), it gives you the option to select the pod using a Stork load-balancer.</p>
</div>
<div class="paragraph">
<p>To use this feature, add the following dependency to your project:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.stork&lt;/groupId&gt;
    &lt;artifactId&gt;stork-service-discovery-kubernetes&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.smallrye.stork:stork-service-discovery-kubernetes")</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each service expected to be exposed as a Kubernetes Service, configure the lookup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.stork.my-service.service-discovery.type=kubernetes
quarkus.stork.my-service.service-discovery.k8s-namespace=my-namespace</code></pre>
</div>
</div>
<div class="paragraph">
<p>Stork looks for the Kubernetes Service with the given name (<code>my-service</code> in the previous example) in the specified namespace.
Instead of using the Kubernetes Service IP directly and let Kubernetes handle the selection and balancing, Stork inspects the service and retrieves the list of pods providing the service. Then, it can select the instance.</p>
</div>
<div class="paragraph">
<p>For a full example of using Stork with Kubernetes, please read the <a href="stork-kubernetes">Using Stork with Kubernetes guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-a-custom-service-discovery"><a class="anchor" href="#implementing-a-custom-service-discovery"></a>Implementing a custom service discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stork is extensible, and you can implement your own service discovery mechanism.</p>
</div>
<div class="sect2">
<h3 id="dependency"><a class="anchor" href="#dependency"></a>Dependency</h3>
<div class="paragraph">
<p>To implement your Service Discovery Provider, make sure your project depends on Core and Configuration Generator. The former brings classes necessary to implement custom discovery, the latter contains an annotation processor that generates classes needed by Stork.</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.stork&lt;/groupId&gt;
    &lt;artifactId&gt;stork-core&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.stork&lt;/groupId&gt;
    &lt;artifactId&gt;stork-configuration-generator&lt;/artifactId&gt;
    &lt;!-- provided scope is sufficient for the annotation processor --&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.smallrye.stork:stork-core")
compileOnly("io.smallrye.stork:stork-configuration-generator")</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the provider is located in an extension, the configuration generator should be declared in the
<code>annotationProcessorPaths</code> section of the runtime module using the default scope:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;annotationProcessorPaths&gt;
  ...
  &lt;path&gt;
    &lt;groupId&gt;io.smallrye.stork&lt;/groupId&gt;
    &lt;artifactId&gt;stork-configuration-generator&lt;/artifactId&gt;
  &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="implementing-a-service-discovery-provider"><a class="anchor" href="#implementing-a-service-discovery-provider"></a>Implementing a service discovery provider</h3>
<div class="paragraph">
<p>The custom provider is a factory that creates an <code>io.smallrye.stork.ServiceDiscovery</code> instance for each configured service using this service discovery provider.
A type, for example, <code>acme</code> identifies each provider.
This type is used in the configuration to reference the provider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.stork.my-service.service-discovery.type=acme</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step consists of implementing the <code>io.smallrye.stork.spi.ServiceDiscoveryProvider</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package examples;

import io.smallrye.stork.api.ServiceDiscovery;
import io.smallrye.stork.api.config.ServiceConfig;
import io.smallrye.stork.api.config.ServiceDiscoveryAttribute;
import io.smallrye.stork.api.config.ServiceDiscoveryType;
import io.smallrye.stork.spi.StorkInfrastructure;
import io.smallrye.stork.spi.ServiceDiscoveryProvider;

@ServiceDiscoveryType("acme") <i class="conum" data-value="1"></i><b>(1)</b>
@ServiceDiscoveryAttribute(name = "host",
        description = "Host name of the service discovery server.", required = true) <i class="conum" data-value="2"></i><b>(2)</b>
@ServiceDiscoveryAttribute(name = "port",
        description = "Port of the service discovery server.", required = false)
public class AcmeServiceDiscoveryProvider <i class="conum" data-value="3"></i><b>(3)</b>
        implements ServiceDiscoveryProvider&lt;AcmeConfiguration&gt; {

    <i class="conum" data-value="4"></i><b>(4)</b>
    @Override
    public ServiceDiscovery createServiceDiscovery(AcmeConfiguration config,
                                                   String serviceName,
                                                   ServiceConfig serviceConfig,
                                                   StorkInfrastructure storkInfrastructure) {
        return new AcmeServiceDiscovery(config);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This implementation is straightforward.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@ServiceDiscoveryType</code> annotation defines the type of the service discovery provider. For each <code>ServiceDiscoveryProvider</code> annotated with this annotation, a configuration class will be generated. The name of the configuration class is constructed by appending <code>Configuration</code> to the name of the provider.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@ServiceDiscoveryAttribute</code> to define configuration properties for services configured with this service discovery provider. Configuration properties are gathered from all properties of a form: <code>quarkus.stork.my-service.service-discovery.attr=value</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The provider needs to implement <code>ServiceDiscoveryType</code> typed by the configuration class. This configuration class is generated automatically by the Configuration Generator. Its name is created by appending <code>Configuration</code> to the service discovery type, such as <code>AcmeConfiguration</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>createServiceDiscovery</code> method is the factory method. It receives the configuration and access to the name of the service and available infrastructure.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, we need to implement the <code>ServiceDiscovery</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package examples;

import java.util.Collections;
import java.util.List;

import io.smallrye.mutiny.Uni;
import io.smallrye.stork.api.ServiceDiscovery;
import io.smallrye.stork.api.ServiceInstance;
import io.smallrye.stork.impl.DefaultServiceInstance;
import io.smallrye.stork.utils.ServiceInstanceIds;

public class AcmeServiceDiscovery implements ServiceDiscovery {

    private final String host;
    private final int port;

    public AcmeServiceDiscovery(AcmeConfiguration configuration) {
        this.host = configuration.getHost();
        this.port = Integer.parseInt(configuration.getPort());
    }

    @Override
    public Uni&lt;List&lt;ServiceInstance&gt;&gt; getServiceInstances() {
        // Proceed to the lookup...
        // Here, we just return a DefaultServiceInstance with the configured host and port
        // The last parameter specifies whether the communication with the instance should happen over a secure connection
        DefaultServiceInstance instance =
                new DefaultServiceInstance(ServiceInstanceIds.next(), host, port, false);
        return Uni.createFrom().item(() -&gt; Collections.singletonList(instance));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, this implementation is simplistic.
Typically, instead of creating a service instance with values from the configuration, you would connect to a service discovery backend, look for the service and build the list of service instances accordingly.
That&#8217;s why the method returns a <code>Uni</code>.
Most of the time, the lookup is a remote operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-your-service-discovery"><a class="anchor" href="#using-your-service-discovery"></a>Using your service discovery</h3>
<div class="paragraph">
<p>In the project using it, don&#8217;t forget to add the dependency on the module providing your implementation.
Then, in the configuration, just add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.stork.my-service.service-discovery.type=acme
quarkus.stork.my-service.service-discovery.host=localhost
quarkus.stork.my-service.service-discovery.port=1234</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, Stork will use your implementation to locate the <code>my-service</code> service.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-a-custom-service-selection-load-balancer"><a class="anchor" href="#implementing-a-custom-service-selection-load-balancer"></a>Implementing a custom service selection / load-balancer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stork is extensible, and you can implement your own service selection (load-balancer) mechanism.</p>
</div>
<div class="sect2">
<h3 id="dependency-2"><a class="anchor" href="#dependency-2"></a>Dependency</h3>
<div class="paragraph">
<p>To implement your Load Balancer Provider, make sure your project depends on Core and Configuration Generator. The former brings classes necessary to implement custom load balancer, the latter contains an annotation processor that generates classes needed by Stork.</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.stork&lt;/groupId&gt;
    &lt;artifactId&gt;stork-core&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.smallrye.stork&lt;/groupId&gt;
    &lt;artifactId&gt;stork-configuration-generator&lt;/artifactId&gt;
    &lt;!-- provided scope is sufficient for the annotation processor --&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.smallrye.stork:stork-core")
compileOnly("io.smallrye.stork:stork-configuration-generator")</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Similar to custom discovery providers, if the provider is located in an extension, the configuration generator should be declared in the <code>annotationProcessorPaths</code> section of the runtime module using the default scope.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="implementing-a-load-balancer-provider"><a class="anchor" href="#implementing-a-load-balancer-provider"></a>Implementing a load balancer provider</h3>
<div class="paragraph">
<p>Load balancer implementation consists of three elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LoadBalancer</code> which is responsible for selecting service instances for a single Stork service</p>
</li>
<li>
<p><code>LoadBalancerProvider</code> which creates instances of <code>LoadBalancer</code> for a given load balancer <em>type</em></p>
</li>
<li>
<p><code>LoadBalancerProviderConfiguration</code> which is a configuration for the load balancer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <em>type</em>, for example, <code>acme</code>, identifies each provider.
This <em>type</em> is used in the configuration to reference the provider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.stork.my-service.load-balancer.type=acme</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly to <code>ServiceDiscoveryProvider, a `LoadBalancerProvider</code> implementation needs to be annotated with <code>@LoadBalancerType</code> that defines the <em>type</em>.
Any configuration properties that the provider expects should be defined with <code>@LoadBalancerAttribute</code> annotations placed on the provider.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package examples;

import io.smallrye.stork.api.LoadBalancer;
import io.smallrye.stork.api.ServiceDiscovery;
import io.smallrye.stork.api.config.LoadBalancerAttribute;
import io.smallrye.stork.api.config.LoadBalancerType;
import io.smallrye.stork.spi.LoadBalancerProvider;

@LoadBalancerType("acme")
@LoadBalancerAttribute(name = "my-attribute",
        description = "Attribute that alters the behavior of the LoadBalancer")
public class AcmeLoadBalancerProvider implements
        LoadBalancerProvider&lt;AcmeLoadBalancerProviderConfiguration&gt; {

    @Override
    public LoadBalancer createLoadBalancer(AcmeLoadBalancerProviderConfiguration config,
                                           ServiceDiscovery serviceDiscovery) {
        return new AcmeLoadBalancer(config);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note, that similarly to the <code>ServiceDiscoveryProvider</code>, the <code>LoadBalancerProvider</code> interface takes a configuration class as a parameter. This configuration class is generated automatically by the <em>Configuration Generator</em>.
Its name is created by appending <code>Configuration</code> to the name of the provider class.</p>
</div>
<div class="paragraph">
<p>The next step is to implement the <code>LoadBalancer</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package examples;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Random;

import io.smallrye.stork.api.LoadBalancer;
import io.smallrye.stork.api.NoServiceInstanceFoundException;
import io.smallrye.stork.api.ServiceInstance;

public class AcmeLoadBalancer implements LoadBalancer {

    private final Random random;

    public AcmeLoadBalancer(AcmeLoadBalancerProviderConfiguration config) {
        random = new Random();
    }

    @Override
    public ServiceInstance selectServiceInstance(Collection&lt;ServiceInstance&gt; serviceInstances) {
        if (serviceInstances.isEmpty()) {
            throw new NoServiceInstanceFoundException("No services found.");
        }
        int index = random.nextInt(serviceInstances.size());
        return new ArrayList&lt;&gt;(serviceInstances).get(index);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, this implementation is simplistic and just picks a random instance from the received list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">examples.AcmeLoadBalancerProvider</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-your-load-balancer"><a class="anchor" href="#using-your-load-balancer"></a>Using your load balancer</h3>
<div class="paragraph">
<p>In the project using it, don&#8217;t forget to add the dependency on the module providing your implementation.
Then, in the configuration, just add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.stork.my-service.service-discovery.type=...
quarkus.stork.my-service.load-balancer.type=acme</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, Stork will use your implementation to select the <code>my-service</code> service instance.</p>
</div>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#supported-clients">Supported clients</a></li>
<li><a href="#available-service-discovery-and-selection">Available service discovery and selection</a></li>
<li><a href="#using-stork-in-kubernetes">Using Stork in Kubernetes</a></li>
<li><a href="#implementing-a-custom-service-discovery">Implementing a custom service discovery</a>
<ul class="sectlevel2">
<li><a href="#dependency">Dependency</a></li>
<li><a href="#implementing-a-service-discovery-provider">Implementing a service discovery provider</a></li>
<li><a href="#using-your-service-discovery">Using your service discovery</a></li>
</ul>
</li>
<li><a href="#implementing-a-custom-service-selection-load-balancer">Implementing a custom service selection / load-balancer</a>
<ul class="sectlevel2">
<li><a href="#dependency-2">Dependency</a></li>
<li><a href="#implementing-a-load-balancer-provider">Implementing a load balancer provider</a></li>
<li><a href="#using-your-load-balancer">Using your load balancer</a></li>
</ul>
</li>
</ul></div>
    </div>
  </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
