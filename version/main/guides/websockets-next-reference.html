<!DOCTYPE html>
<html>







<head>
  <title>WebSockets Next extension reference guide - main - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net https://analytics.ossupstream.org https://search.quarkus.io; script-src 'self' 'unsafe-eval'  'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app https://analytics.ossupstream.org; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self'
  https://analytics.ossupstream.org * data:; media-src 'self'; frame-src  https://www.youtube.com https://embed.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/main/guides/websockets-next-reference" />
  <meta property="og:title" content="WebSockets Next extension reference guide - main" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/websockets-next-reference">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  <script src="https://analytics.ossupstream.org/matomo.js" async defer></script>
  
</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Why<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/continuum" class="">REACTIVE</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">Learn<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="https://quarkus.io/extensions/">Extensions<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">Community<i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/main/guides/websockets-next-reference" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/main/guides/websockets-next-reference">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/main/guides/websockets-next-reference">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/main/guides/websockets-next-reference">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/main/guides/websockets-next-reference">日本語</a></li>
          </ul>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    





<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/main/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" selected>Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.9.3 - Latest</option>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      <h1 class="text-caps">WebSockets Next extension reference guide </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <code>websockets-next</code> extension provides an experimental API to define  <em>WebSocket</em> endpoints declaratively.
The proposed API may change in future releases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-websocket-protocol"><a class="anchor" href="#the-websocket-protocol"></a>1. The WebSocket protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>WebSocket</em> protocol, documented in the <a href="https://datatracker.ietf.org/doc/html/rfc6455">RFC6455</a>, establishes a standardized method for creating a bidirectional communication channel between a client and a server through a single TCP connection.
Unlike HTTP, WebSocket operates as a distinct TCP protocol but is designed to function seamlessly alongside HTTP.
For example, it reuses the same ports and is compatible with the same security mechanisms.</p>
</div>
<div class="paragraph">
<p>The interaction using WebSocket initiates with an HTTP request employing the 'Upgrade' header to transition to the WebSocket protocol.
Instead of a <code>200 OK</code> response, the server replies with a <code>101 Switching Protocols</code> response to upgrade the HTTP connection to a WebSocket connection.
Following this successful handshake, the TCP socket utilized in the initial HTTP upgrade request remains open, allowing both client and server to exchange messages in both direction continually.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-and-websocket-architecture-styles"><a class="anchor" href="#http-and-websocket-architecture-styles"></a>2. HTTP and WebSocket architecture styles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Despite WebSocket&#8217;s compatibility with HTTP and its initiation through an HTTP request, it&#8217;s crucial to recognize that the two protocols lead to distinctly different architectures and programming models.</p>
</div>
<div class="paragraph">
<p>With HTTP/REST, applications are structured around resources/endpoints that handle various HTTP methods and paths.
Client interaction occurs through emitting HTTP requests with appropriate methods and paths, following a request-response pattern.
The server routes incoming requests to corresponding handlers based on path, method, and headers and then replies with a well-defined response.</p>
</div>
<div class="paragraph">
<p>Conversely, WebSocket typically involves a single endpoint for the initial HTTP connection, after which all messages utilize the same TCP connection.
It introduces an entirely different interaction model: asynchronous and message-driven.</p>
</div>
<div class="paragraph">
<p>WebSocket is a low-level transport protocol, in contrast to HTTP.
Message formats, routing, or processing require prior agreement between the client and server regarding message semantics.</p>
</div>
<div class="paragraph">
<p>For WebSocket clients and servers, the <code>Sec-WebSocket-Protocol</code> header in the HTTP handshake request allows negotiation of a higher-level messaging protocol. In its absence, the server and client must establish their own conventions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quarkus-websockets-vs-quarkus-websockets-next"><a class="anchor" href="#quarkus-websockets-vs-quarkus-websockets-next"></a>3. Quarkus WebSockets vs. Quarkus WebSockets Next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide utilizes the <code>quarkus-websockets-next</code> extension, an implementation of the WebSocket API boasting enhanced efficiency and usability compared to the legacy <code>quarkus-websockets</code> extension.
The original <code>quarkus-websockets</code> extension remains accessible, will receive ongoing support, but it&#8217;s unlikely to receive to feature development.</p>
</div>
<div class="paragraph">
<p>Unlike <code>quarkus-websockets</code>, the <code>quarkus-websockets-next</code> extension does <strong>not</strong> implement the Jakarta WebSocket specification.
Instead, it introduces a modern API, prioritizing simplicity of use.
Additionally, it&#8217;s tailored to integrate with Quarkus' reactive architecture and networking layer seamlessly.</p>
</div>
<div class="paragraph">
<p>The annotations utilized by the Quarkus WebSockets next extension differ from those in JSR 356 despite, sometimes, sharing the same name.
The JSR annotations carry a semantic that the Quarkus WebSockets Next extension does not follow.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-the-websockets-next-extension"><a class="anchor" href="#use-the-websockets-next-extension"></a>4. Use the WebSockets Next extension</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use the <code>websockets-next</code> extension, you need to add the <code>io.quarkus.quarkus-websockets-next</code> extension to your project.
In your <code>pom.xml</code> file, add:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-websockets-next&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-websockets-next")</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-the-websocket-server"><a class="anchor" href="#configure-the-websocket-server"></a>5. Configure the WebSocket server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WebSocket handling reuses the <em>main</em> HTTP server.</p>
</div>
<div class="paragraph">
<p>Thus, the configuration of the WebSocket server is done in the <code>quarkus.http.</code> configuration section.</p>
</div>
<div class="paragraph">
<p>WebSocket paths configured within the application are concatenated with the root path defined by <code>quarkus.http.root</code> (which defaults to /).
This concatenation ensures that WebSocket endpoints are appropriately positioned within the application&#8217;s URL structure.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="http-reference">HTTP guide</a> for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="declare-websocket-endpoints"><a class="anchor" href="#declare-websocket-endpoints"></a>6. Declare WebSocket endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To declare web socket endpoints, you need to create a class annotated with <code>@io.quarkus.websockets.next.WebSocket</code> and define the path of the WebSocket endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.websockets;

import io.quarkus.websockets.next.WebSocket;
import jakarta.inject.Inject;

@WebSocket(path = "/chat/{username}")
public class ChatWebSocket {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, client can connect to this web socket endpoint using <code>ws://localhost:8080/chat/your-name</code>.
If TLS is used, the URL is <code>wss://localhost:8443/chat/your-name</code>.</p>
</div>
<div class="sect2">
<h3 id="path-parameters"><a class="anchor" href="#path-parameters"></a>6.1. Path parameters</h3>
<div class="paragraph">
<p>The path of the WebSocket endpoint can contain path parameters.
The syntax is the same as for JAX-RS resources: <code>{parameterName}</code>.</p>
</div>
<div class="paragraph">
<p>Access to the path parameter values is done through the <code>io.quarkus.websockets.next.WebSocketConnection</code> <em>session</em> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject io.quarkus.websockets.next.WebSocketConnection session;
// ...
String value = session.pathParam("parameterName");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Path parameter values are always strings.
If the path parameter is not present in the path, the <code>pathParam</code> method returns <code>null</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Query parameters are not supported. However, you can access the query using <code>session.handshakeRequest().query()</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sub-websockets-endpoints"><a class="anchor" href="#sub-websockets-endpoints"></a>6.2. Sub-websockets endpoints</h3>
<div class="paragraph">
<p>A class annotated with <code>@WebSocket</code> can encapsulate static nested classes, which are also annotated with <code>@WebSocket</code> and represent <em>sub-web</em> sockets.
The resulting path of these sub-web sockets concatenates the path from the enclosing class and the nested class.
The resulting path is normalized, following the HTTP URL rules.</p>
</div>
<div class="paragraph">
<p>Sub-web sockets inherit access to the path parameters declared in the <code>@WebSocket</code> annotation of both the enclosing and nested classes.
The <code>consumePrimary</code> method within the enclosing class can access the <code>version</code> parameter in the following example.
Meanwhile, the <code>consumeNested</code> method within the nested class can access both <code>version</code> and <code>id</code> parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebSocket("/ws/v{version}")
public class MyPrimaryWebSocket {

    @OnTextMessage
    void consumePrimary(String s)    { ... }

    @WebSocket("/products/{id}")
    public static class MyNestedWebSocket {

      @OnTextMessage
      void consumeNested(String s)    { ... }

    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cdi-scopes-for-websocket-endpoints"><a class="anchor" href="#cdi-scopes-for-websocket-endpoints"></a>6.3. CDI Scopes for WebSocket Endpoints</h3>
<div class="paragraph">
<p>Classes annotated with <code>@WebSocket</code> are managed as CDI beans, allowing for flexible scope management within the application.
By default, WebSocket endpoints are considered in the singleton pseudo-scope.
However, developers can specify alternative scopes to suit their specific requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebSocket("/ws")
public class MyWebSocket {
    // Singleton scoped bean
}

@WebSocket("/ws")
@ApplicationScoped
public class MyRequestScopedWebSocket {
  // Application scoped.
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Furthermore, each WebSocket connection is associated with its own <em>session</em> scope.
When the <code>@OnOpen</code> method is invoked, a session scope corresponding to the WebSocket connection is established.
Subsequent calls to <code>@On[Text|Binary]Message</code> or <code>@OnClose</code> methods utilize this same session scope.
The session scope remains active until the <code>@OnClose</code> method completes execution, at which point it is terminated.</p>
</div>
<div class="paragraph">
<p>The <code>WebSocketConnection</code> object, which represents the connection itself, is also a session-scoped bean, allowing developers to access and manage WebSocket-specific data within the context of the session.</p>
</div>
<div class="paragraph">
<p>In cases where a WebSocket endpoint does not declare an <code>@OnOpen</code> method, the session scope is still created.
It remains active until the connection terminates, regardless of the presence of an <code>@OnClose</code> method.</p>
</div>
<div class="paragraph">
<p>Methods annotated with <code>@OnTextMessage,</code> <code>@OnBinaryMessage,</code> <code>@OnOpen</code>, and <code>@OnClose</code> also have the request scoped activated for the duration of the method execution (until it produced its result).</p>
</div>
</div>
<div class="sect2">
<h3 id="websocket-endpoint-methods"><a class="anchor" href="#websocket-endpoint-methods"></a>6.4. WebSocket endpoint methods</h3>
<div class="paragraph">
<p>A WebSocket endpoint comprises the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Path: This is the URL path where the WebSocket connection is established (e.g., ws://localhost:8080/).</p>
</li>
<li>
<p>At most one <code>@OnTextMessage</code> method: Handles the connected client&#8217;s text messages.</p>
</li>
<li>
<p>At most one <code>@OnBinaryMessage</code> method: Handles the binary messages the connected client sends.</p>
</li>
<li>
<p>At most one <code>@OnOpen</code> method: Invoked when a client connects to the WebSocket.</p>
</li>
<li>
<p>At most one <code>@OnClose</code> method: Executed upon the client disconnecting from the WebSocket.</p>
</li>
<li>
<p>Any number of <code>@OnError</code> methods: Invoked when an error occurs; that is when an endpoint callback throws a runtime error, or when a conversion errors occurs, or when a returned <code>io.smallrye.mutiny.Uni</code>/<code>io.smallrye.mutiny.Multi</code> receives a failure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only some endpoints need to include all methods.
However, it must contain at least <code>@On[Text|Binary]Message</code> or <code>@OnOpen</code>.</p>
</div>
<div class="paragraph">
<p>An error is thrown at build time if any endpoint violates these rules.
The static nested classes representing sub-websockets adhere to the same guidelines.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Any methods annotated with <code>@OnTextMessage</code>, <code>@OnBinaryMessage</code>, <code>@OnOpen</code>, and <code>@OnClose</code> outside a WebSocket endpoint are considered erroneous and will result in the build failing with an appropriate error message.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="processing-messages"><a class="anchor" href="#processing-messages"></a>7. Processing messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Method receiving messages from the client are annotated with <code>@OnTextMessage</code> or <code>@OnBinaryMessage</code>.</p>
</div>
<div class="paragraph">
<p><code>OnTextMessage</code> are invoked for every <em>text</em> message received from the client.
<code>OnBinaryMessage</code> are invoked for every <em>binary</em> message the client receives.</p>
</div>
<div class="sect2">
<h3 id="invocation-rules"><a class="anchor" href="#invocation-rules"></a>7.1. Invocation Rules</h3>
<div class="paragraph">
<p>When invoking these annotated methods, the <em>session</em> scope linked to the WebSocket connection remains active.
In addition, the request scope is active until the completion of the method (or until it produces its result for async and reactive methods).</p>
</div>
<div class="paragraph">
<p>Quarkus WebSocket Next supports <em>blocking</em> and <em>non-blocking</em> logic, akin to Quarkus REST, determined by the method signature and additional annotations such as <code>@Blocking</code> and <code>@NonBlocking</code>.</p>
</div>
<div class="paragraph">
<p>Here are the rules governing execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-blocking methods must execute on the connection&#8217;s event loop.</p>
</li>
<li>
<p>Methods annotated with <code>@RunOnVirtualThread</code> are considered blocking and should execute on a virtual thread.</p>
</li>
<li>
<p>Blocking methods must execute on a worker thread if not annotated with <code>@RunOnVirtualThread</code>.</p>
</li>
<li>
<p>When <code>@RunOnVirtualThread</code> is employed, each invocation spawns a new virtual thread.</p>
</li>
<li>
<p>Methods returning <code>CompletionStage</code>, <code>Uni</code> and <code>Multi</code> are considered non-blocking.</p>
</li>
<li>
<p>Methods returning <code>void</code> or plain objects are considered blocking.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="method-parameters"><a class="anchor" href="#method-parameters"></a>7.2. Method Parameters</h3>
<div class="paragraph">
<p>The method must accept exactly one message parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The message object (of any type).</p>
</li>
<li>
<p>A <code>Multi&lt;X&gt;</code> with X as the message type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, it may also accept the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WebSocketConnection</code></p>
</li>
<li>
<p><code>HandshakeRequest</code></p>
</li>
<li>
<p><code>String</code> parameters annotated with <code>@PathParam</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The message object represents the data sent and can be accessed as either raw content (<code>String</code>, <code>JsonObject</code>, <code>JsonArray</code>, <code>Buffer</code> or <code>byte[]</code>) or deserialized high-level objects, which is the recommended approach.</p>
</div>
<div class="paragraph">
<p>When receiving a <code>Multi</code>, the method is invoked once per connection, and the provided <code>Multi</code> receives the items transmitted by this connection.
The method must subscribe to the <code>Multi</code> to receive these items (or return a Multi).</p>
</div>
</div>
<div class="sect2">
<h3 id="allowed-returned-types"><a class="anchor" href="#allowed-returned-types"></a>7.3. Allowed Returned Types</h3>
<div class="paragraph">
<p>Methods annotated with <code>@OnTextMessage</code> or <code>@OnBinaryMessage</code> can return various types to handle WebSocket communication efficiently:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code>: Indicates a blocking method where no explicit response is sent back to the client.</p>
</li>
<li>
<p><code>Uni&lt;Void&gt;</code>: Denotes a non-blocking method where the completion of the returned Uni signifies the end of processing. No explicit response is sent back to the client.</p>
</li>
<li>
<p>An object of type <code>X</code> represents a blocking method in which the returned object is serialized and sent back to the client as a response.</p>
</li>
<li>
<p><code>Uni&lt;X&gt;</code>: Specifies a non-blocking method where the item emitted by the non-null <code>Uni</code> is sent to the client as a response.</p>
</li>
<li>
<p><code>Multi&lt;X&gt;</code>: Indicates a non-blocking method where the items emitted by the non-null <code>Multi</code> are sequentially sent to the client until completion or cancellation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here are some examples of these methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage
void consume(Message m) {
// Process the incoming message. The method is called on an executor thread for each incoming message.
}

@OnTextMessage
Uni&lt;Void&gt; consumeAsync(Message m) {
// Process the incoming message. The method is called on an event loop thread for each incoming message.
// The method completes when the returned Uni emits its item.
}

@OnTextMessage
ReponseMessage process(Message m) {
// Process the incoming message and send a response to the client.
// The method is called for each incoming message.
// Note that if the method returns `null`, no response will be sent to the client.
}

@OnTextMessage
Uni&lt;ResponseMessage&gt; processAsync(Message m) {
// Process the incoming message and send a response to the client.
// The method is called for each incoming message.
// Note that if the method returns `null`, no response will be sent to the client. The method completes when the returned Uni emits its item.
}

OnTextMessage
Multi&lt;ResponseMessage&gt; stream(Message m) {
// Process the incoming message and send multiple responses to the client.
// The method is called for each incoming message.
// The method completes when the returned Multi emits its completion signal.
// The method cannot return `null` (but an empty multi if no response must be sent)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When returning a Multi, Quarkus subscribes to the returned Multi automatically and writes the emitted items until completion, failure, or cancellation. Failure or cancellation terminates the connection.</p>
</div>
</div>
<div class="sect2">
<h3 id="streams"><a class="anchor" href="#streams"></a>7.4. Streams</h3>
<div class="paragraph">
<p>In addition to individual messages, WebSocket endpoints can handle streams of messages.
In this case, the method receives a <code>Multi&lt;X&gt;</code> as a parameter.
Each instance of <code>X</code> is deserialized using the same rules listed above.</p>
</div>
<div class="paragraph">
<p>The method receiving the <code>Multi</code> can either return another <code>Multi</code> or <code>void</code>.
If the method returns a <code>Multi</code>, it does not have to subscribe to the incoming <code>multi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage
public Multi&lt;ChatMessage&gt; stream(Multi&lt;ChatMessage&gt; incoming) {
    return incoming.log();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach allows bi-directional streaming.</p>
</div>
<div class="paragraph">
<p>When the method returns <code>void</code>, it must subscribe to the incoming <code>Multi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage
public void stream(Multi&lt;ChatMessage&gt; incoming) {
    incoming.subscribe().with(item -&gt; log(item));
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="skipping-reply"><a class="anchor" href="#skipping-reply"></a>7.5. Skipping reply</h3>
<div class="paragraph">
<p>When a method is intended to produce a message written to the client, it can emit <code>null</code>.
Emitting <code>null</code> signifies no response to be sent to the client, allowing for skipping a response when needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="jsonobject-and-jsonarray"><a class="anchor" href="#jsonobject-and-jsonarray"></a>7.6. JsonObject and JsonArray</h3>
<div class="paragraph">
<p>Vert.x <code>JsonObject</code> and <code>JsonArray</code> instances bypass the serialization and deserialization mechanisms.
Messages are sent as text messages.</p>
</div>
</div>
<div class="sect2">
<h3 id="broadcasting"><a class="anchor" href="#broadcasting"></a>7.7. Broadcasting</h3>
<div class="paragraph">
<p>By default, responses produced by <code>@On[Text|Binary]Message</code> methods are sent back to the connected client.
However, using the <code>broadcast</code> parameter, responses can be broadcasted to all connected clients.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage(broadcast=true)
String emitToAll(String message) {
    // Send the response to all connected clients.
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same principle applies to methods returning instances of <code>Multi</code> or <code>Uni</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you need to select the connected clients that should receive the message, you can use <code>WebSocketConnection.broadcast().filter().sendText()</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="onopen-and-onclose-methods"><a class="anchor" href="#onopen-and-onclose-methods"></a>8. OnOpen and OnClose methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WebSocket endpoint can also be notified when a client connects or disconnects.</p>
</div>
<div class="paragraph">
<p>This is done by annotating a method with <code>@OnOpen</code> or <code>@OnClose</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnOpen(broadcast = true)
public ChatMessage onOpen() {
    return new ChatMessage(MessageType.USER_JOINED, connection.pathParam("username"), null);
}

@Inject WebSocketConnection connection;

@OnClose
public void onClose() {
    ChatMessage departure = new ChatMessage(MessageType.USER_LEFT, connection.pathParam("username"), null);
    connection.broadcast().sendTextAndAwait(departure);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@OnOpen</code> is triggered upon client connection, while <code>@OnClose</code> is invoked upon disconnection.</p>
</div>
<div class="paragraph">
<p>These methods have access to the <em>session-scoped</em> <code>WebSocketConnection</code> bean.</p>
</div>
<div class="sect2">
<h3 id="parameters"><a class="anchor" href="#parameters"></a>8.1. Parameters</h3>
<div class="paragraph">
<p>Methods annotated with <code>@OnOpen</code> and <code>@OnClose</code> may accept the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WebSocketConnection</code></p>
</li>
<li>
<p><code>HandshakeRequest</code></p>
</li>
<li>
<p><code>String</code> parameters annotated with <code>@PathParam</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="allowed-returned-types-2"><a class="anchor" href="#allowed-returned-types-2"></a>8.2. Allowed Returned Types</h3>
<div class="paragraph">
<p><code>@OnOpen</code> and <code>@OnClose</code> methods support different returned types.</p>
</div>
<div class="paragraph">
<p>For <code>@OnOpen</code> methods, the same rules as <code>@On[Text|Binary]Message</code> apply.
Thus, a method annotated with <code>@OnOpen</code> can send messages to the client immediately after connecting.
The supported return types for <code>@OnOpen</code> methods are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code>: Indicates a blocking method where no explicit message is sent back to the connected client.</p>
</li>
<li>
<p><code>Uni&lt;Void&gt;</code>: Denotes a non-blocking method where the completion of the returned <code>Uni</code> signifies the end of processing. No message is sent back to the client.</p>
</li>
<li>
<p>An object of type <code>X</code>: Represents a blocking method where the returned object is serialized and sent back to the client.</p>
</li>
<li>
<p><code>Uni&lt;X&gt;</code>: Specifies a non-blocking method where the item emitted by the non-null <code>Uni</code> is sent to the client.</p>
</li>
<li>
<p><code>Multi&lt;X&gt;</code>: Indicates a non-blocking method where the items emitted by the non-null <code>Multi</code> are sequentially sent to the client until completion or cancellation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Items sent to the client are serialized except for the <code>String</code>, <code>JsonObject</code>, <code>JsonArray</code>, <code>Buffer</code>, and <code>byte[]</code> types.
In the case of <code>Multi</code>, Quarkus subscribes to the returned <code>Multi</code> and writes the items to the <code>WebSocket</code> as they are emitted.
<code>String</code>, <code>JsonObject</code> and <code>JsonArray</code> are sent as text messages.
<code>Buffers</code> and byte arrays are sent as binary messages.</p>
</div>
<div class="paragraph">
<p>For <code>@OnClose</code> methods, the allowed return types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code>: The method is considered blocking.</p>
</li>
<li>
<p><code>Uni&lt;Void&gt;</code>: The method is considered non-blocking.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>@OnClose</code> methods cannot send items to the connection client by returning objects.
They can only send messages to the other client by using the <code>WebSocketConnection</code> object.</p>
</div>
</div>
<div class="sect2">
<h3 id="server-side-streaming"><a class="anchor" href="#server-side-streaming"></a>8.3. Server-side Streaming</h3>
<div class="paragraph">
<p>Methods annotated with <code>@OnOpen</code> can utilize server-side streaming by returning a <code>Multi&lt;X&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebSocket("/foo")
@OnOpen
public Multi&lt;Integer&gt; streaming() {
    return Multi.createFrom().ticks().every(Duration.ofSecond(1))
        .onOverflow().ignore();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="broadcasting-with-onopen"><a class="anchor" href="#broadcasting-with-onopen"></a>8.4. Broadcasting with @OnOpen</h3>
<div class="paragraph">
<p>Similar to <code>@On[Text|Binary]Message</code>, items sent to the client from a method annotated with <code>@OnOpen</code> can be broadcasted to all clients instead of just the connecting client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnOpen(broadcast=true)
String onOpen() {
    return "We have a new member!";
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="error-handling"><a class="anchor" href="#error-handling"></a>9. Error Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WebSocket endpoint can also be notified when an error occurs.
A WebSocket endpoint method annotated with <code>@io.quarkus.websockets.next.OnError</code> is invoked when an endpoint callback throws a runtime error, or when a conversion errors occurs,
or when a returned <code>io.smallrye.mutiny.Uni</code>/<code>io.smallrye.mutiny.Multi</code> receives a failure.</p>
</div>
<div class="paragraph">
<p>The method must accept exactly one "error" parameter, i.e. a parameter that is assignable from <code>java.lang.Throwable</code>.
The method may also accept the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WebSocketConnection</code></p>
</li>
<li>
<p><code>HandshakeRequest</code></p>
</li>
<li>
<p><code>String</code> parameters annotated with <code>@PathParam</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An endpoint may declare multiple methods annotated with <code>@io.quarkus.websockets.next.OnError</code>.
However, each method must declare a different error parameter.
The method that declares a most-specific supertype of the actual exception is selected.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>@io.quarkus.websockets.next.OnError</code> annotation can be also used to declare a global error handler, i.e. a method that is not declared on a WebSocket endpoint. Such a method may not accept <code>@PathParam</code> paremeters. Error handlers declared on an endpoint take precedence over the global error handlers.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="access-to-the-websocketconnection"><a class="anchor" href="#access-to-the-websocketconnection"></a>10. Access to the WebSocketConnection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>io.quarkus.websockets.next.WebSocketConnection</code> object represents the WebSocket connection.
It&#8217;s <em>session-scoped</em>  and is valid for the whole duration of the connection.</p>
</div>
<div class="paragraph">
<p>Methods annotated with <code>@OnOpen</code>, <code>@OnTextMessage</code>, <code>@OnBinaryMessage</code>, and <code>@OnClose</code> can access the <code>WebSocketConnection</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject WebSocketConnection connection;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that outside of these methos, the <code>WebSocketConnection</code> object is not available.</p>
</div>
<div class="paragraph">
<p>The connection can be used to send messages to the client, access the path parameters, and broadcast messages to all connected clients.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Send a message:
connection.sendTextAndAwait("Hello!");

// Broadcast messages:
connection.broadcast().sendTextAndAwait(departure);

// Access path parameters:
String param = connection.pathParam("foo");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>WebSocketConnection</code> provides both a blocking and a non-blocking method to send messages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sendTextAndAwait(String message)</code>: Sends a text message to the client and waits for the message to be sent. It&#8217;s blocking and should only be called from an executor thread.</p>
</li>
<li>
<p><code>sendText(String message)</code>: Sends a text message to the client. It returns a <code>Uni</code>. It&#8217;s non-blocking, but you must subscribe to it.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serialization-and-deserialization"><a class="anchor" href="#serialization-and-deserialization"></a>11. Serialization and Deserialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WebSocket Next extension supports automatic serialization and deserialization of messages.</p>
</div>
<div class="paragraph">
<p>Objects of type <code>String</code>, <code>JsonObject</code>, <code>JsonArray</code>, <code>Buffer</code>, and <code>byte[]</code> are sent as-is and by-pass the serialization and deserialization.
When no codec is provided, the serialization and deserialization uses JSON (Jackson) automatically.</p>
</div>
<div class="paragraph">
<p>When you need to customize the serialization and deserialization, you can provide a custom codec.</p>
</div>
<div class="sect2">
<h3 id="custom-codec"><a class="anchor" href="#custom-codec"></a>11.1. Custom codec</h3>
<div class="paragraph">
<p>To implement a custom codec, you must provides a CDI bean implementing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.quarkus.websockets.next.BinaryMessageCodec</code>  for binary messages</p>
</li>
<li>
<p><code>io.quarkus.websockets.next.TextMessageCodec</code>  for text messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how to implement a custom codec for a <code>Item</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
    public static class ItemBinaryMessageCodec implements BinaryMessageCodec&lt;Item&gt; {

        @Override
        public boolean supports(Type type) {
            // Allows selecting the right codec for the right type
            return type.equals(Item.class);
        }

        @Override
        public Buffer encode(Item value) {
            // Serialization
            return Buffer.buffer(value.toString());
        }

        @Override
        public Item decode(Type type, Buffer value) {
            return new Item(value.toString());
        }

    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>OnTextMessage</code> and <code>OnBinaryMessage</code> methods can also specify which codec need to be used explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage(codec = MyInputCodec.class) <i class="conum" data-value="1"></i><b>(1)</b>
Item find(Item item) {
        //....
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Specify the codec to use for both the deserialization and serialization of the message</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the serialization and deserialization must use a different codec, you can specify the codec to use for the serialization and deserialization separately:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage(
        codec = MyInputCodec.class, <i class="conum" data-value="1"></i><b>(1)</b>
        outputCodec = MyOutputCodec.class <i class="conum" data-value="2"></i><b>(2)</b>
Item find(Item item) {
        //....
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Specify the codec to use for both the deserialization of the incoming message</p>
</li>
<li>
<p>Specify the codec to use for the serialization of the outgoing message</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handle-pong-message"><a class="anchor" href="#handle-pong-message"></a>12. Handle Pong message</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>@OnPongMessage</code> annotation is used to consume pong messages.
A websocket endpoint must declare at most one method annotated with <code>@OnPongMessage</code>.</p>
</div>
<div class="paragraph">
<p>The method must accept a single parameter of type <code>Buffer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnPongMessage
void pong(Buffer data) {
    // ....
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="websocket-next-configuration-reference"><a class="anchor" href="#websocket-next-configuration-reference"></a>13. Configuration reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> Configuration property fixed at build time - All other configuration properties are overridable at runtime <input type="search" id="config-search-0" placeholder="FILTER CONFIGURATION" disabled></p>
</div>
<table class="tableblock frame-all grid-all stretch configuration-reference searchable configuration-reference-all-rows">
<colgroup>
<col style="width: 80%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a id="quarkus-websockets-next_configuration"></a><a href="#quarkus-websockets-next_configuration">Configuration property</a></p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">Type</p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">Default</p></th>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-supported-subprotocols"></a><code><a href="#quarkus-websockets-next_quarkus-websockets-next-supported-subprotocols">quarkus.websockets-next.supported-subprotocols</a></code></p>
</div>
<div id="conf-collapsible-desc-1" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>See <a href="https://datatracker.ietf.org/doc/html/rfc6455#page-12">The WebSocket Protocol</a></p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-46533">QUARKUS_WEBSOCKETS_NEXT_SUPPORTED_SUBPROTOCOLS</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-46533" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-timeout"></a><code><a href="#quarkus-websockets-next_quarkus-websockets-next-timeout">quarkus.websockets-next.timeout</a></code></p>
</div>
<div id="conf-collapsible-desc-2" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>TODO Not implemented yet. The default timeout to complete processing of a message.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-46534">QUARKUS_WEBSOCKETS_NEXT_TIMEOUT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-46534" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html">Duration</a>
  <a href="#duration-note-anchor-{summaryTableId}"><span class="icon"><i class="fa fa-question-circle" title="More information about the Duration format"></i></span></a></p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
</tbody>
</table>
<div id="duration-note-anchor-quarkus-websockets-next" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">About the Duration format</div>
<div class="paragraph">
<p>To write duration values, use the standard <code>java.time.Duration</code> format.
See the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Duration.html#parse(java.lang.CharSequence)">Duration#parse() Java API documentation</a> for more information.</p>
</div>
<div class="paragraph">
<p>You can also use a simplified format, starting with a number:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the value is only a number, it represents time in seconds.</p>
</li>
<li>
<p>If the value is a number followed by <code>ms</code>, it represents time in milliseconds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other cases, the simplified format is translated to the <code>java.time.Duration</code> format for parsing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the value is a number followed by <code>h</code>, <code>m</code>, or <code>s</code>, it is prefixed with <code>PT</code>.</p>
</li>
<li>
<p>If the value is a number followed by <code>d</code>, it is prefixed with <code>P</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#the-websocket-protocol">1. The WebSocket protocol</a></li>
<li><a href="#http-and-websocket-architecture-styles">2. HTTP and WebSocket architecture styles</a></li>
<li><a href="#quarkus-websockets-vs-quarkus-websockets-next">3. Quarkus WebSockets vs. Quarkus WebSockets Next</a></li>
<li><a href="#use-the-websockets-next-extension">4. Use the WebSockets Next extension</a></li>
<li><a href="#configure-the-websocket-server">5. Configure the WebSocket server</a></li>
<li><a href="#declare-websocket-endpoints">6. Declare WebSocket endpoints</a>
<ul class="sectlevel2">
<li><a href="#path-parameters">6.1. Path parameters</a></li>
<li><a href="#sub-websockets-endpoints">6.2. Sub-websockets endpoints</a></li>
<li><a href="#cdi-scopes-for-websocket-endpoints">6.3. CDI Scopes for WebSocket Endpoints</a></li>
<li><a href="#websocket-endpoint-methods">6.4. WebSocket endpoint methods</a></li>
</ul>
</li>
<li><a href="#processing-messages">7. Processing messages</a>
<ul class="sectlevel2">
<li><a href="#invocation-rules">7.1. Invocation Rules</a></li>
<li><a href="#method-parameters">7.2. Method Parameters</a></li>
<li><a href="#allowed-returned-types">7.3. Allowed Returned Types</a></li>
<li><a href="#streams">7.4. Streams</a></li>
<li><a href="#skipping-reply">7.5. Skipping reply</a></li>
<li><a href="#jsonobject-and-jsonarray">7.6. JsonObject and JsonArray</a></li>
<li><a href="#broadcasting">7.7. Broadcasting</a></li>
</ul>
</li>
<li><a href="#onopen-and-onclose-methods">8. OnOpen and OnClose methods</a>
<ul class="sectlevel2">
<li><a href="#parameters">8.1. Parameters</a></li>
<li><a href="#allowed-returned-types-2">8.2. Allowed Returned Types</a></li>
<li><a href="#server-side-streaming">8.3. Server-side Streaming</a></li>
<li><a href="#broadcasting-with-onopen">8.4. Broadcasting with @OnOpen</a></li>
</ul>
</li>
<li><a href="#error-handling">9. Error Handling</a></li>
<li><a href="#access-to-the-websocketconnection">10. Access to the WebSocketConnection</a></li>
<li><a href="#serialization-and-deserialization">11. Serialization and Deserialization</a>
<ul class="sectlevel2">
<li><a href="#custom-codec">11.1. Custom codec</a></li>
</ul>
</li>
<li><a href="#handle-pong-message">12. Handle Pong message</a></li>
<li><a href="#websocket-next-configuration-reference">13. Configuration reference</a></li>
</ul></div>
    </div>
  </div>
  <h2>Related content</h2>
  <div class="grid-wrapper relations">
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same extensions</h3>
      <ul class="related-content">
      
        
        <li class="tutorial"><a href="/version/main/guides/websockets-next-tutorial">Getting started with WebSockets-Next</a></li>
      </ul>
    </div>
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same topics</h3>
      <ul class="related-content">
      
        
        <li class="tutorial"><a href="/version/main/guides/websockets-next-tutorial">Getting started with WebSockets-Next</a></li>
      
        
        <li class="guide"><a href="/version/main/guides/websockets">Using WebSockets</a></li>
      
        
        <li class="reference"><a href="/version/main/guides/http-reference">HTTP Reference</a></li>
      
        
        <li class="guide"><a href="/version/main/guides/reactive-routes">Using Reactive Routes</a></li>
      </ul>
    </div>
    </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://twitter.com/quarkusio" target="_blank">Twitter</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
</body>

</html>
