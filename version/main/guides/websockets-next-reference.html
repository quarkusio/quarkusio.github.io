<!DOCTYPE html>
<html lang="en">







<head>
  <title>WebSockets Next reference guide - main - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/main/guides/websockets-next-reference" />
  <meta property="og:title" content="WebSockets Next reference guide - main" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/websockets-next-reference">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/main/guides/websockets-next-reference" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/main/guides/websockets-next-reference" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/main/guides/websockets-next-reference">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/main/guides/websockets-next-reference">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/main/guides/websockets-next-reference">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/main/guides/websockets-next-reference">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/main/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" selected>Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.30.2 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        <option value="3.20" >3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <a class="editlink" href="https://github.com/quarkusio/quarkus/edit/main/docs/src/main/asciidoc/websockets-next-reference.adoc">Edit this Page</a>
      
      <h1 class="text-caps">WebSockets Next reference guide </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <code>quarkus-websockets-next</code> extension provides a modern declarative API to define WebSocket server and client endpoints.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-websocket-protocol"><a class="anchor" href="#the-websocket-protocol"></a>1. The WebSocket protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>WebSocket</em> protocol, documented in the <a href="https://datatracker.ietf.org/doc/html/rfc6455">RFC6455</a>, establishes a standardized method for creating a bidirectional communication channel between a client and a server through a single TCP connection.
Unlike HTTP, WebSocket operates as a distinct TCP protocol but is designed to function seamlessly alongside HTTP.
For example, it reuses the same ports and is compatible with the same security mechanisms.</p>
</div>
<div class="paragraph">
<p>The interaction using WebSocket initiates with an HTTP request employing the 'Upgrade' header to transition to the WebSocket protocol.
Instead of a <code>200 OK</code> response, the server replies with a <code>101 Switching Protocols</code> response to upgrade the HTTP connection to a WebSocket connection.
Following this successful handshake, the TCP socket utilized in the initial HTTP upgrade request remains open, allowing both client and server to exchange messages in both direction continually.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-and-websocket-architecture-styles"><a class="anchor" href="#http-and-websocket-architecture-styles"></a>2. HTTP and WebSocket architecture styles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Despite WebSocket&#8217;s compatibility with HTTP and its initiation through an HTTP request, it&#8217;s crucial to recognize that the two protocols lead to distinctly different architectures and programming models.</p>
</div>
<div class="paragraph">
<p>With HTTP/REST, applications are structured around resources/endpoints that handle various HTTP methods and paths.
Client interaction occurs through emitting HTTP requests with appropriate methods and paths, following a request-response pattern.
The server routes incoming requests to corresponding handlers based on path, method, and headers and then replies with a well-defined response.</p>
</div>
<div class="paragraph">
<p>Conversely, WebSocket typically involves a single endpoint for the initial HTTP connection, after which all messages utilize the same TCP connection.
It introduces an entirely different interaction model: asynchronous and message-driven.</p>
</div>
<div class="paragraph">
<p>WebSocket is a low-level transport protocol, in contrast to HTTP.
Message formats, routing, or processing require prior agreement between the client and server regarding message semantics.</p>
</div>
<div class="paragraph">
<p>For WebSocket clients and servers, the <code>Sec-WebSocket-Protocol</code> header in the HTTP handshake request allows negotiation of a higher-level messaging protocol. In its absence, the server and client must establish their own conventions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quarkus-websockets-vs-quarkus-websockets-next"><a class="anchor" href="#quarkus-websockets-vs-quarkus-websockets-next"></a>3. Quarkus WebSockets vs. Quarkus WebSockets Next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide utilizes the <code>quarkus-websockets-next</code> extension, an implementation of the WebSocket API boasting enhanced efficiency and usability compared to the legacy <code>quarkus-websockets</code> extension.
The original <code>quarkus-websockets</code> extension remains accessible, will receive ongoing support, but it&#8217;s unlikely to receive to feature development.</p>
</div>
<div class="paragraph">
<p>Unlike <code>quarkus-websockets</code>, the <code>quarkus-websockets-next</code> extension does <strong>not</strong> implement the Jakarta WebSocket specification.
Instead, it introduces a modern API, prioritizing simplicity of use.
Additionally, it&#8217;s tailored to integrate with Quarkus' reactive architecture and networking layer seamlessly.</p>
</div>
<div class="paragraph">
<p>The annotations utilized by the Quarkus WebSockets next extension differ from those in JSR 356 despite, sometimes, sharing the same name.
The JSR annotations carry a semantic that the Quarkus WebSockets Next extension does not follow.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="project-setup"><a class="anchor" href="#project-setup"></a>4. Project setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use the <code>websockets-next</code> extension, you need to add the <code>io.quarkus:quarkus-websockets-next</code> depencency to your project.</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-websockets-next&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-websockets-next")</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="endpoints"><a class="anchor" href="#endpoints"></a>5. Endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both the <a href="#server-api">Server API</a> and <a href="#client-api">Client API</a> define <em>endpoints</em> that are used to consume and send messages.
The endpoints are implemented as CDI beans and support injection.
Endpoints declare <a href="#callback-methods"><em>callback methods</em></a> annotated with <code>@OnTextMessage</code>, <code>@OnBinaryMessage</code>, <code>@OnPingMessage</code>, <code>@OnPongMessage</code>, <code>@OnOpen</code>, <code>@OnClose</code> and <code>@OnError</code>.
These methods are used to handle various WebSocket events.
Typically, a method annotated with <code>@OnTextMessage</code> is called when the connected client sends a message to the server and vice versa.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The client API also includes <a href="#client-connectors">connectors</a> that are used to configure and create new WebSocket connections.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="server-endpoints"><a class="anchor" href="#server-endpoints"></a>5.1. Server endpoints</h3>
<div class="paragraph">
<p>Server endpoints are classes annotated with <code>@io.quarkus.websockets.next.WebSocket</code>.
The value of <code>WebSocket#path()</code> is used to define the path of the endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.websockets;

import io.quarkus.websockets.next.WebSocket;
import jakarta.inject.Inject;

@WebSocket(path = "/chat/{username}") <i class="conum" data-value="1"></i><b>(1)</b>
public class ChatWebSocket {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, client can connect to this web socket endpoint using <code>ws://localhost:8080/chat/your-name</code>.
If TLS is used, the URL is <code>wss://localhost:8443/chat/your-name</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The endpoint path is relative to the <a href="http-reference#context-path">root context</a> configured by the <code>quarkus.http.root-path</code> (which is <code>/</code> by default). For example, if you add <code>quarkus.http.root-path=/api</code> to your <code>application.properties</code> then a client can connect to this endpoint using <code><a href="http://localhost:8080/api/chat/the-name" class="bare">http://localhost:8080/api/chat/the-name</a></code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="client-endpoints"><a class="anchor" href="#client-endpoints"></a>5.2. Client endpoints</h3>
<div class="paragraph">
<p>Client endpoints are classes annotated with <code>@io.quarkus.websockets.next.WebSocketClient</code>.
The value of <code>WebSocketClient#path()</code> is used to define the path of the endpoint this client will be connected to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.websockets;

import io.quarkus.websockets.next.WebSocketClient;
import jakarta.inject.Inject;

@WebSocketClient(path = "/chat/{username}") <i class="conum" data-value="1"></i><b>(1)</b>
public class ChatWebSocket {

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Client endpoints are used to consume and send messages. You&#8217;ll need the <a href="#client-connectors">connectors API</a> to configure and open new WebSocket connections.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="path-parameters"><a class="anchor" href="#path-parameters"></a>5.3. Path parameters</h3>
<div class="paragraph">
<p>The path of a WebSocket endpoint can contain path parameters.
The syntax is the same as for JAX-RS resources: <code>{parameterName}</code>.</p>
</div>
<div class="paragraph">
<p>You can access the path parameter values using the <code>io.quarkus.websockets.next.WebSocketConnection#pathParam(String)</code> method, or <code>io.quarkus.websockets.next.WebSocketClientConnection#pathParam(String)</code> respectively.
Alternatively, an endpoint callback method parameter annotated with <code>@io.quarkus.websockets.next.PathParam</code> is injected automatically.</p>
</div>
<div class="listingblock">
<div class="title"><code>WebSocketConnection#pathParam(String)</code> example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject io.quarkus.websockets.next.WebSocketConnection connection;
// ...
String value = connection.pathParam("parameterName");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Path parameter values are always strings.
If the path parameter is not present in the path, the <code>WebSocketConnection#pathParam(String)</code>/<code>WebSocketClientConnection#pathParam(String)</code> method returns <code>null</code>.
If there is an endpoint callback method parameter annotated with <code>@PathParam</code> and the parameter name is not defined in the endpoint path, then the build fails.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Query parameters are not supported. However, you can access the query using <code>WebSocketConnection#handshakeRequest().query()</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cdi-scopes"><a class="anchor" href="#cdi-scopes"></a>5.4. CDI scopes</h3>
<div class="paragraph">
<p>Endpoints are managed as CDI beans.
By default, the <code>@Singleton</code> scope is used.
However, developers can specify alternative scopes to fit their specific requirements.</p>
</div>
<div class="paragraph">
<p><code>@Singleton</code> and <code>@ApplicationScoped</code> endpoints are shared across all WebSocket connections.
Therefore, implementations should be either stateless or thread-safe.</p>
</div>
<div class="sect3">
<h4 id="session-context"><a class="anchor" href="#session-context"></a>5.4.1. Session context</h4>
<div class="paragraph">
<p>If an endpoint is annotated with <code>@SessionScoped</code>, or depends directly or indirectly on a <code>@SessionScoped</code> bean, then each WebSocket connection is associated with its own <em>session context</em>.
The session context is active during endpoint callback invocation.
Subsequent invocations of <a href="#callback-methods">Callback methods</a> within the same connection utilize the same session context.
The session context remains active until the connection is closed (usually when the <code>@OnClose</code> method completes execution), at which point it is terminated.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is also possible to set the <code>quarkus.websockets-next.server.activate-session-context</code> config property to <code>always</code>. In this case, the session context is always activated, no matter if a <code>@SessionScoped</code> bean participates in the dependency tree.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>@SessionScoped</code> Endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.enterprise.context.SessionScoped;

@WebSocket(path = "/ws")
@SessionScoped <i class="conum" data-value="1"></i><b>(1)</b>
public class MyWebSocket {

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This server endpoint is not shared and is scoped to the session/connection.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="request-context"><a class="anchor" href="#request-context"></a>5.4.2. Request context</h4>
<div class="paragraph">
<p>Each WebSocket endpoint callback method execution is associated with a new CDI <em>request context</em> if the endpoint is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotated with the <code>@RequestScoped</code> annotation.</p>
</li>
<li>
<p>Has a method annotated with a security annotation such as <code>@RolesAllowed</code>.</p>
</li>
<li>
<p>Depends directly or indirectly on a <code>@RequestScoped</code> bean.</p>
</li>
<li>
<p>Depends directly or indirectly on a CDI beans secured with a standard security annotation.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is also possible to set the <code>quarkus.websockets-next.server.activate-request-context</code> config property to <code>always</code>. In this case, the request context is always activated when an endpoint callback is invoked.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>@RequestScoped</code> Endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.enterprise.context.RequestScoped;

@WebSocket(path = "/ws")
@RequestScoped <i class="conum" data-value="1"></i><b>(1)</b>
public class MyWebSocket {

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This server endpoint is instantiated for each callback method execution.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="callback-methods"><a class="anchor" href="#callback-methods"></a>5.5. Callback methods</h3>
<div class="paragraph">
<p>A WebSocket endpoint may declare:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At most one <code>@OnTextMessage</code> method: Handles the text messages from the connected client/server.</p>
</li>
<li>
<p>At most one <code>@OnBinaryMessage</code> method: Handles the binary messages from the connected client/server.</p>
</li>
<li>
<p>At most one <code>@OnPingMessage</code> method: Handles the ping messages from the connected client/server.</p>
</li>
<li>
<p>At most one <code>@OnPongMessage</code> method: Handles the pong messages from the connected client/server.</p>
</li>
<li>
<p>At most one <code>@OnOpen</code> method: Invoked when a connection is opened.</p>
</li>
<li>
<p>At most one <code>@OnClose</code> method: Executed when the connection is closed.</p>
</li>
<li>
<p>Any number of <code>@OnError</code> methods: Invoked when an error occurs; that is when an endpoint callback throws a runtime error, or when a conversion errors occurs, or when a returned <code>io.smallrye.mutiny.Uni</code>/<code>io.smallrye.mutiny.Multi</code> receives a failure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only some endpoints need to include all methods.
However, it must contain at least <code>@On[Text|Binary]Message</code> or <code>@OnOpen</code>.</p>
</div>
<div class="paragraph">
<p>An error is thrown at build time if any endpoint violates these rules.
The static nested classes representing sub-websockets adhere to the same guidelines.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Any methods annotated with <code>@OnTextMessage</code>, <code>@OnBinaryMessage</code>, <code>@OnOpen</code>, and <code>@OnClose</code> outside a WebSocket endpoint are considered erroneous and will result in the build failing with an appropriate error message.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="processing-messages"><a class="anchor" href="#processing-messages"></a>5.6. Processing messages</h3>
<div class="paragraph">
<p>Method receiving messages from the client are annotated with <code>@OnTextMessage</code> or <code>@OnBinaryMessage</code>.</p>
</div>
<div class="paragraph">
<p><code>OnTextMessage</code> are invoked for every <em>text</em> message received from the client.
<code>OnBinaryMessage</code> are invoked for every <em>binary</em> message the client receives.</p>
</div>
<div class="sect3">
<h4 id="invocation-rules"><a class="anchor" href="#invocation-rules"></a>5.6.1. Invocation rules</h4>
<div class="paragraph">
<p>When invoking the callback methods, the <em>session</em> scope linked to the WebSocket connection remains active.
In addition, the request scope is active until the completion of the method (or until it produces its result for async and reactive methods).</p>
</div>
<div class="paragraph">
<p>WebSocket Next supports <em>blocking</em> and <em>non-blocking</em> logic, akin to Quarkus REST, determined from the return type of the method and additional annotations such as <code>@Blocking</code> and <code>@NonBlocking</code>.</p>
</div>
<div class="paragraph">
<p>Here are the rules governing execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Methods annotated with <code>@RunOnVirtualThread</code>, <code>@Blocking</code> or <code>@Transactional</code> are considered blocking.</p>
</li>
<li>
<p>Methods declared in a class annotated with <code>@RunOnVirtualThread</code> are considered blocking.</p>
</li>
<li>
<p>Methods annotated with <code>@NonBlocking</code> are considered non-blocking.</p>
</li>
<li>
<p>Methods declared in a class annotated with <code>@Transactional</code> are considered blocking unless annotated with <code>@NonBlocking</code>.</p>
</li>
<li>
<p>If the method does not declare any of the annotations listed above the execution model is derived from the return type:</p>
<div class="ulist">
<ul>
<li>
<p>Methods returning <code>Uni</code> and <code>Multi</code> are considered non-blocking.</p>
</li>
<li>
<p>Methods returning <code>void</code> or any other type are considered blocking.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Kotlin <code>suspend</code> functions are always considered non-blocking and may not be annotated with <code>@Blocking</code>, <code>@NonBlocking</code>
or <code>@RunOnVirtualThread</code> and may not be in a class annotated with <code>@RunOnVirtualThread</code>.</p>
</li>
<li>
<p>Non-blocking methods must execute on the connection&#8217;s event loop thread.</p>
</li>
<li>
<p>Blocking methods must execute on a worker thread unless annotated with <code>@RunOnVirtualThread</code> or in a class annotated
with <code>@RunOnVirtualThread</code>.</p>
</li>
<li>
<p>Methods annotated with <code>@RunOnVirtualThread</code> or declared in class annotated with <code>@RunOnVirtualThread</code> must execute on
a virtual thread, each invocation spawns a new virtual thread.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="method-parameters"><a class="anchor" href="#method-parameters"></a>5.6.2. Method parameters</h4>
<div class="paragraph">
<p>The method must accept exactly one message parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The message object (of any type).</p>
</li>
<li>
<p>A <code>Multi&lt;X&gt;</code> with X as the message type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, it may also accept the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WebSocketConnection</code>/<code>WebSocketClientConnection</code></p>
</li>
<li>
<p><code>HandshakeRequest</code></p>
</li>
<li>
<p><code>String</code> parameters annotated with <code>@PathParam</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The message object represents the data sent and can be accessed as either raw content (<code>String</code>, <code>JsonObject</code>, <code>JsonArray</code>, <code>Buffer</code> or <code>byte[]</code>) or deserialized high-level objects, which is the recommended approach.</p>
</div>
<div class="paragraph">
<p>When receiving a <code>Multi</code>, the method is invoked once per connection, and the provided <code>Multi</code> receives the items transmitted by this connection.
If the method returns a <code>Multi</code> (constructed from the received one), Quarkus will automatically subscribe to it and write the emitted items until completion, failure, or cancellation.
However, if your method does not return a <code>Multi</code>, you must subscribe to the incoming <code>Multi</code> to consume the data.</p>
</div>
<div class="paragraph">
<p>Here are two examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// No need to subscribe to the incoming Multi as the method returns a Multi derived from the incoming one
@OnTextMessage
public Multi&lt;ChatMessage&gt; stream(Multi&lt;ChatMessage&gt; incoming) {
    return incoming.log();
}

// ...

// Must subscribe to the incoming Multi as the method does not return a Multi, otherwise no data will be consumed
@OnTextMessage
public void stream(Multi&lt;ChatMessage&gt; incoming) {
    incoming.subscribe().with(item -&gt; log(item));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#subscribe-or-not-subscribe">When to subscribe to a <code>Uni</code> or <code>Multi</code></a> to learn more about subscribing to the incoming <code>Multi</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="supported-return-types"><a class="anchor" href="#supported-return-types"></a>5.6.3. Supported return types</h4>
<div class="paragraph">
<p>Methods annotated with <code>@OnTextMessage</code> or <code>@OnBinaryMessage</code> can return various types to handle WebSocket communication efficiently:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code>: Indicates a blocking method where no explicit response is sent back to the client.</p>
</li>
<li>
<p><code>Uni&lt;Void&gt;</code>: Denotes a non-blocking method where the completion of the returned <code>Uni</code> signifies the end of processing. No explicit response is sent back to the client.</p>
</li>
<li>
<p>An object of type <code>X</code> represents a blocking method in which the returned object is serialized and sent back to the client as a response.</p>
</li>
<li>
<p><code>Uni&lt;X&gt;</code>: Specifies a non-blocking method where the item emitted by the non-null <code>Uni</code> is sent to the client as a response.</p>
</li>
<li>
<p><code>Multi&lt;X&gt;</code>: Indicates a non-blocking method where the items emitted by the non-null <code>Multi</code> are sequentially sent to the client until completion or cancellation.</p>
</li>
<li>
<p>Kotlin <code>suspend</code> function returning <code>Unit</code>: Denotes a non-blocking method where no explicit response is sent back to the client.</p>
</li>
<li>
<p>Kotlin <code>suspend</code> function returning <code>X</code>: Specifies a non-blocking method where the returned item is sent to the client as a response.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here are some examples of these methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage
void consume(Message m) {
// Process the incoming message. The method is called on an executor thread for each incoming message.
}

@OnTextMessage
Uni&lt;Void&gt; consumeAsync(Message m) {
// Process the incoming message. The method is called on an event loop thread for each incoming message.
// The method completes when the returned Uni emits its item.
}

@OnTextMessage
ResponseMessage process(Message m) {
// Process the incoming message and send a response to the client.
// The method is called for each incoming message.
// Note that if the method returns `null`, no response will be sent to the client.
}

@OnTextMessage
Uni&lt;ResponseMessage&gt; processAsync(Message m) {
// Process the incoming message and send a response to the client.
// The method is called for each incoming message.
// Note that if the method returns `null`, no response will be sent to the client. The method completes when the returned Uni emits its item.
}

@OnTextMessage
Multi&lt;ResponseMessage&gt; stream(Message m) {
// Process the incoming message and send multiple responses to the client.
// The method is called for each incoming message.
// The method completes when the returned Multi emits its completion signal.
// The method cannot return `null` (but an empty multi if no response must be sent)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Methods returning <code>Uni</code> and <code>Multi</code> are considered non-blocking.
In addition, Quarkus automatically subscribes to the returned <code>Multi</code> / <code>Uni</code> and writes the emitted items until completion, failure, or cancellation.
Failure or cancellation terminates the connection.</p>
</div>
</div>
<div class="sect3">
<h4 id="streams"><a class="anchor" href="#streams"></a>5.6.4. Streams</h4>
<div class="paragraph">
<p>In addition to individual messages, WebSocket endpoints can handle streams of messages.
In this case, the method receives a <code>Multi&lt;X&gt;</code> as a parameter.
Each instance of <code>X</code> is deserialized using the same rules listed above.</p>
</div>
<div class="paragraph">
<p>The method receiving the <code>Multi</code> can either return another <code>Multi</code> or <code>void</code>.
If the method returns a <code>Multi</code>, it does not have to subscribe to the incoming <code>multi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage
public Multi&lt;ChatMessage&gt; stream(Multi&lt;ChatMessage&gt; incoming) {
    return incoming.log();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach allows bi-directional streaming.</p>
</div>
<div class="paragraph">
<p>When the method returns <code>void</code>, and so does not return a <code>Multi</code>, the code must subscribe to the incoming <code>Multi</code>.
Otherwise, no data will be consumed, and the connection will not be closed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage
public void stream(Multi&lt;ChatMessage&gt; incoming) {
    incoming.subscribe().with(item -&gt; log(item));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also note that the <code>stream</code> method will complete before the <code>Multi</code> completes.</p>
</div>
<div class="paragraph">
<p>See <a href="#subscribe-or-not-subscribe">When to subscribe to a <code>Uni</code> or <code>Multi</code></a> to learn more about subscribing to the incoming <code>Multi</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="skipping-reply"><a class="anchor" href="#skipping-reply"></a>5.6.5. Skipping reply</h4>
<div class="paragraph">
<p>When a method is intended to produce a message written to the client, it can emit <code>null</code>.
Emitting <code>null</code> signifies no response to be sent to the client, allowing for skipping a response when needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="jsonobject-and-jsonarray"><a class="anchor" href="#jsonobject-and-jsonarray"></a>5.6.6. JsonObject and JsonArray</h4>
<div class="paragraph">
<p>Vert.x <code>JsonObject</code> and <code>JsonArray</code> instances bypass the serialization and deserialization mechanisms.
Messages are sent as text messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="onopen-and-onclose-methods"><a class="anchor" href="#onopen-and-onclose-methods"></a>5.6.7. OnOpen and OnClose methods</h4>
<div class="paragraph">
<p>The WebSocket endpoint can also be notified when a client connects or disconnects.</p>
</div>
<div class="paragraph">
<p>This is done by annotating a method with <code>@OnOpen</code> or <code>@OnClose</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnOpen(broadcast = true)
public ChatMessage onOpen() {
    return new ChatMessage(MessageType.USER_JOINED, connection.pathParam("username"), null);
}

@Inject WebSocketConnection connection;

@OnClose
public void onClose() {
    ChatMessage departure = new ChatMessage(MessageType.USER_LEFT, connection.pathParam("username"), null);
    connection.broadcast().sendTextAndAwait(departure);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@OnOpen</code> is triggered upon client connection, while <code>@OnClose</code> is invoked upon disconnection.</p>
</div>
<div class="paragraph">
<p>These methods have access to the <em>session-scoped</em> <code>WebSocketConnection</code> bean.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters"><a class="anchor" href="#parameters"></a>5.6.8. Parameters</h4>
<div class="paragraph">
<p>Methods annotated with <code>@OnOpen</code> and <code>@OnClose</code> may accept the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WebSocketConnection</code>/<code>WebSocketClientConnection</code></p>
</li>
<li>
<p><code>HandshakeRequest</code></p>
</li>
<li>
<p><code>String</code> parameters annotated with <code>@PathParam</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An endpoint method annotated with <code>@OnClose</code> may also accept the <code>io.quarkus.websockets.next.CloseReason</code> parameter that may indicate a reason for closing a connection.</p>
</div>
</div>
<div class="sect3">
<h4 id="supported-return-types-2"><a class="anchor" href="#supported-return-types-2"></a>5.6.9. Supported return types</h4>
<div class="paragraph">
<p><code>@OnOpen</code> and <code>@OnClose</code> methods support different returned types.</p>
</div>
<div class="paragraph">
<p>For <code>@OnOpen</code> methods, the same rules as <code>@On[Text|Binary]Message</code> apply.
Thus, a method annotated with <code>@OnOpen</code> can send messages to the client immediately after connecting.
The supported return types for <code>@OnOpen</code> methods are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code>: Indicates a blocking method where no explicit message is sent back to the connected client.</p>
</li>
<li>
<p><code>Uni&lt;Void&gt;</code>: Denotes a non-blocking method where the completion of the returned <code>Uni</code> signifies the end of processing. No message is sent back to the client.</p>
</li>
<li>
<p>An object of type <code>X</code>: Represents a blocking method where the returned object is serialized and sent back to the client.</p>
</li>
<li>
<p><code>Uni&lt;X&gt;</code>: Specifies a non-blocking method where the item emitted by the non-null <code>Uni</code> is sent to the client.</p>
</li>
<li>
<p><code>Multi&lt;X&gt;</code>: Indicates a non-blocking method where the items emitted by the non-null <code>Multi</code> are sequentially sent to the client until completion or cancellation.</p>
</li>
<li>
<p>Kotlin <code>suspend</code> function returning <code>Unit</code>: Denotes a non-blocking method where no explicit message is sent back to the client.</p>
</li>
<li>
<p>Kotlin <code>suspend</code> function returning <code>X</code>: Specifies a non-blocking method where the returned item is sent to the client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Items sent to the client are <a href="#serialization">serialized</a> except for the <code>String</code>, <code>io.vertx.core.json.JsonObject</code>, <code>io.vertx.core.json.JsonArray</code>, <code>io.vertx.core.buffer.Buffer</code>, and <code>byte[]</code> types.
In the case of <code>Multi</code>, Quarkus subscribes to the returned <code>Multi</code> and writes the items to the <code>WebSocket</code> as they are emitted.
<code>String</code>, <code>JsonObject</code> and <code>JsonArray</code> are sent as text messages.
<code>Buffers</code> and byte arrays are sent as binary messages.</p>
</div>
<div class="paragraph">
<p>For <code>@OnClose</code> methods, the supported return types include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code>: The method is considered blocking.</p>
</li>
<li>
<p><code>Uni&lt;Void&gt;</code>: The method is considered non-blocking.</p>
</li>
<li>
<p>Kotlin <code>suspend</code> function returning <code>Unit</code>: The method is considered non-blocking.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@OnClose</code> methods declared on a server endpoint cannot send items to the connected client by returning objects.
They can only send messages to the other clients by using the <code>WebSocketConnection</code> object.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="error-handling"><a class="anchor" href="#error-handling"></a>5.7. Error handling</h3>
<div class="paragraph">
<p>WebSocket endpoints can also be notified when an error occurs.
A WebSocket endpoint method annotated with <code>@io.quarkus.websockets.next.OnError</code> is invoked when an endpoint callback throws a runtime error, or when a conversion errors occurs,
or when a returned <code>io.smallrye.mutiny.Uni</code>/<code>io.smallrye.mutiny.Multi</code> receives a failure.</p>
</div>
<div class="paragraph">
<p>The method must accept exactly one <em>error</em> parameter, i.e. a parameter that is assignable from <code>java.lang.Throwable</code>.
The method may also accept the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WebSocketConnection</code>/<code>WebSocketClientConnection</code></p>
</li>
<li>
<p><code>HandshakeRequest</code></p>
</li>
<li>
<p><code>String</code> parameters annotated with <code>@PathParam</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An endpoint may declare multiple methods annotated with <code>@io.quarkus.websockets.next.OnError</code>.
However, each method must declare a different error parameter.
The method that declares a most-specific supertype of the actual exception is selected.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>@io.quarkus.websockets.next.OnError</code> annotation can be also used to declare a global error handler, i.e. a method that is not declared on a WebSocket endpoint. Such a method may not accept <code>@PathParam</code> parameters. Error handlers declared on an endpoint take precedence over the global error handlers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When an error occurs but no error handler can handle the failure, Quarkus uses the strategy specified by <code>quarkus.websockets-next.server.unhandled-failure-strategy</code>.
For server endpoints, the error message is logged and the connection is closed by default.
For client endpoints, the error message is logged by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="serialization"><a class="anchor" href="#serialization"></a>5.8. Serialization and deserialization</h3>
<div class="paragraph">
<p>The WebSocket Next extension supports automatic serialization and deserialization of messages.</p>
</div>
<div class="paragraph">
<p>Objects of type <code>String</code>, <code>JsonObject</code>, <code>JsonArray</code>, <code>Buffer</code>, and <code>byte[]</code> are sent as-is and bypass the serialization and deserialization.
When no codec is provided, the serialization and deserialization convert the message from/to JSON automatically.</p>
</div>
<div class="paragraph">
<p>When you need to customize the serialization and deserialization, you can provide a custom codec.</p>
</div>
<div class="sect3">
<h4 id="custom-codec"><a class="anchor" href="#custom-codec"></a>5.8.1. Custom codec</h4>
<div class="paragraph">
<p>To implement a custom codec, you must provide a CDI bean implementing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.quarkus.websockets.next.BinaryMessageCodec</code> for binary messages</p>
</li>
<li>
<p><code>io.quarkus.websockets.next.TextMessageCodec</code> for text messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how to implement a custom codec for a <code>Item</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class ItemBinaryMessageCodec implements BinaryMessageCodec&lt;Item&gt; {

    @Override
    public boolean supports(Type type) {
        // Allows selecting the right codec for the right type
        return type.equals(Item.class);
    }

    @Override
    public Buffer encode(Item value) {
        // Serialization
        return Buffer.buffer(value.toString());
    }

    @Override
    public Item decode(Type type, Buffer value) {
        // Deserialization
        return new Item(value.toString());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>OnTextMessage</code> and <code>OnBinaryMessage</code> methods can also specify which codec should be used explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage(codec = MyInputCodec.class) <i class="conum" data-value="1"></i><b>(1)</b>
Item find(Item item) {
        //....
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Specify the codec to use for both the deserialization and serialization of the message</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the serialization and deserialization must use a different codec, you can specify the codec to use for the serialization and deserialization separately:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnTextMessage(
        codec = MyInputCodec.class, <i class="conum" data-value="1"></i><b>(1)</b>
        outputCodec = MyOutputCodec.class <i class="conum" data-value="2"></i><b>(2)</b>
Item find(Item item) {
        //....
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Specify the codec to use for the deserialization of the incoming message</p>
</li>
<li>
<p>Specify the codec to use for the serialization of the outgoing message</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pingpong-messages"><a class="anchor" href="#pingpong-messages"></a>5.9. Ping/Pong messages</h3>
<div class="paragraph">
<p>A <a href="https://datatracker.ietf.org/doc/html/rfc6455#section-5.5.2">ping message</a> may serve as a keepalive or to verify the remote endpoint.
A <a href="https://datatracker.ietf.org/doc/html/rfc6455#section-5.5.3">pong message</a> is sent in response to a ping message and it must have an identical payload.</p>
</div>
<div class="sect3">
<h4 id="sending-ping-messages"><a class="anchor" href="#sending-ping-messages"></a>5.9.1. Sending ping messages</h4>
<div class="paragraph">
<p>Ping messages are optional and not sent by default. However, server and client endpoints can be configured to automatically send ping messages on an interval.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.websockets-next.server.auto-ping-interval=2 <i class="conum" data-value="1"></i><b>(1)</b>
quarkus.websockets-next.client.auto-ping-interval=10 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sends a ping message from the server to each connected client every 2 seconds.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sends a ping message from all connected client instances to their remote servers every 10 seconds.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Servers and clients can send ping messages programmatically at any time using <code>WebSocketConnection</code> or <code>WebSocketClientConnection</code>.
There is a non-blocking variant: <code>Sender#sendPing(Buffer)</code> and a blocking variant: <code>Sender#sendPingAndAwait(Buffer)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sending-pong-messages"><a class="anchor" href="#sending-pong-messages"></a>5.9.2. Sending pong messages</h4>
<div class="paragraph">
<p>Server and client endpoints will always respond to a ping message sent from the remote party with a corresponding pong message, using the application data from the ping message.
This behavior is built-in and requires no additional code or configuration.</p>
</div>
<div class="paragraph">
<p>Servers and clients can send unsolicited pong messages that may serve as a unidirectional heartbeat using <code>WebSocketConnection</code> or <code>WebSocketClientConnection</code>. There is a non-blocking variant: <code>Sender#sendPong(Buffer)</code> and a blocking variant: <code>Sender#sendPongAndAwait(Buffer)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="handling-pingpong-messages"><a class="anchor" href="#handling-pingpong-messages"></a>5.9.3. Handling ping/pong messages</h4>
<div class="paragraph">
<p>Because ping messages are handled automatically and pong messages require no response, it is not necessary to write handlers for these messages to comply with the WebSocket protocol.
However, it is sometimes useful to know when ping or pong messages are received by an endpoint.</p>
</div>
<div class="paragraph">
<p>The <code>@OnPingMessage</code> and <code>@OnPongMessage</code> annotations can be used to define callbacks that consume ping or pong messages sent from the remote party.
An endpoint may declare at most one <code>@OnPingMessage</code> callback and at most  one <code>@OnPongMessage</code> callback.
The callback method must return either <code>void</code> or <code>Uni&lt;Void&gt;</code> (or be a Kotlin <code>suspend</code> function returning <code>Unit</code>), and it must accept a single parameter of type <code>Buffer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnPingMessage
void ping(Buffer data) {
    // an incoming ping that will automatically receive a pong
}

@OnPongMessage
void pong(Buffer data) {
    // an incoming pong in response to the last ping sent
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inbound-processing-mode"><a class="anchor" href="#inbound-processing-mode"></a>5.10. Inbound processing mode</h3>
<div class="paragraph">
<p>WebSocket endpoints can define the mode used to process incoming events for a specific connection using the <code>@WebSocket#inboundProcessingMode()</code>, and <code>@WebSocketClient.inboundProcessingMode()</code> respectively.
An incoming event can represent a message (text, binary, pong), opening connection and closing connection.
By default, events are processed serially and ordering is guaranteed.
This means that if an endpoint receives events <code>A</code> and <code>B</code> (in this particular order) then callback for event <code>B</code> will be invoked after the callback for event <code>A</code> completed.
However, in some situations it is preferable to process events concurrently, i.e. with no ordering guarantees but also with no concurrency limits.
For this cases, the <code>InboundProcessingMode#CONCURRENT</code> should be used.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-api"><a class="anchor" href="#server-api"></a>6. Server API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="http-server-configuration"><a class="anchor" href="#http-server-configuration"></a>6.1. HTTP server configuration</h3>
<div class="paragraph">
<p>This extension reuses the <em>main</em> HTTP server.</p>
</div>
<div class="paragraph">
<p>Thus, the configuration of the WebSocket server is done in the <code>quarkus.http.</code> configuration section.</p>
</div>
<div class="paragraph">
<p>WebSocket paths configured within the application are concatenated with the root path defined by <code>quarkus.http.root</code> (which defaults to <code>/</code>).
This concatenation ensures that WebSocket endpoints are appropriately positioned within the application&#8217;s URL structure.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="http-reference">HTTP guide</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="sub-websockets-endpoints"><a class="anchor" href="#sub-websockets-endpoints"></a>6.2. Sub-websockets endpoints</h3>
<div class="paragraph">
<p>A <code>@WebSocket</code> endpoint can encapsulate static nested classes, which are also annotated with <code>@WebSocket</code> and represent <em>sub-websockets</em>.
The resulting path of these sub-websockets concatenates the path from the enclosing class and the nested class.
The resulting path is normalized, following the HTTP URL rules.</p>
</div>
<div class="paragraph">
<p>Sub-websockets inherit access to the path parameters declared in the <code>@WebSocket</code> annotation of both the enclosing and nested classes.
The <code>consumePrimary</code> method within the enclosing class can access the <code>version</code> parameter in the following example.
Meanwhile, the <code>consumeNested</code> method within the nested class can access both <code>version</code> and <code>id</code> parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebSocket(path = "/ws/v{version}")
public class MyPrimaryWebSocket {

    @OnTextMessage
    void consumePrimary(String s)    { ... }

    @WebSocket(path = "/products/{id}")
    public static class MyNestedWebSocket {

      @OnTextMessage
      void consumeNested(String s)    { ... }

    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ws-connection"><a class="anchor" href="#ws-connection"></a>6.3. WebSocket connection</h3>
<div class="paragraph">
<p>The <code>io.quarkus.websockets.next.WebSocketConnection</code> object represents the WebSocket connection.
Quarkus provides a <code>@SessionScoped</code> CDI bean that implements this interface and can be injected in a <code>WebSocket</code> endpoint and used to interact with the connected client.</p>
</div>
<div class="paragraph">
<p>Methods annotated with <code>@OnOpen</code>, <code>@OnTextMessage</code>, <code>@OnBinaryMessage</code>, and <code>@OnClose</code> can access the injected <code>WebSocketConnection</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject WebSocketConnection connection;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that outside of these methods, the <code>WebSocketConnection</code> object is not available. However, it is possible to <a href="#list-open-connections">list all open connections</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The connection can be used to send messages to the client, access the path parameters, broadcast messages to all connected clients, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Send a message:
connection.sendTextAndAwait("Hello!");

// Broadcast messages:
connection.broadcast().sendTextAndAwait(departure);

// Access path parameters:
String param = connection.pathParam("foo");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>WebSocketConnection</code> provides both a blocking and a non-blocking method variants to send messages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sendTextAndAwait(String message)</code>: Sends a text message to the client and waits for the message to be sent. It&#8217;s blocking and should only be called from an executor thread.</p>
</li>
<li>
<p><code>sendText(String message)</code>: Sends a text message to the client. It returns a <code>Uni</code>. It&#8217;s non-blocking. Make sure you or Quarkus subscribes to the returned <code>Uni</code> to send the message.
If you return the <code>Uni</code> from a method invoked by Quarkus (like with Quarkus REST, Quarkus WebSocket Next or Quarkus Messaging), it will subscribe to it and send the message.
For example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@POST
public Uni&lt;Void&gt; send() {
    return connection.sendText("Hello!"); // Quarkus automatically subscribes to the returned Uni and sends the message.
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#subscribe-or-not-subscribe">When to subscribe to a <code>Uni</code> or <code>Multi</code></a> to learn more about subscribing to the <code>Uni</code>.</p>
</div>
<div class="sect3">
<h4 id="list-open-connections"><a class="anchor" href="#list-open-connections"></a>6.3.1. List open connections</h4>
<div class="paragraph">
<p>It is also possible to list all open connections.
Quarkus provides a CDI bean of type <code>io.quarkus.websockets.next.OpenConnections</code> that declares convenient methods to access the connections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.logging.Log;
import io.quarkus.websockets.next.OpenConnections;

class MyBean {

  @Inject
  OpenConnections connections;

  void logAllOpenConnections() {
     Log.infof("Open connections: %s", connections.listAll()); <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>OpenConnections#listAll()</code> returns an immutable snapshot of all open connections at the given time.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are also other convenient methods.
For example, <code>OpenConnections#findByEndpointId(String)</code> makes it easy to find connections for a specific endpoint.</p>
</div>
</div>
<div class="sect3">
<h4 id="user-data"><a class="anchor" href="#user-data"></a>6.3.2. User data</h4>
<div class="paragraph">
<p>It is also possible to associate arbitrary user data with a specific connection.
The <code>io.quarkus.websockets.next.UserData</code> object obtained by the <code>WebSocketConnection#userData()</code> method represents mutable user data associated with a connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.websockets.next.WebSocketConnection;
import io.quarkus.websockets.next.UserData.TypedKey;

@WebSocket(path = "/endpoint/{username}")
class MyEndpoint {

  @Inject
  CoolService service;

  @OnOpen
  void open(WebSocketConnection connection) {
     connection.userData().put(TypedKey.forBoolean("isCool"), service.isCool(connection.pathParam("username"))); <i class="conum" data-value="1"></i><b>(1)</b>
  }

  @OnTextMessage
  String process(String message) {
     if (connection.userData().get(TypedKey.forBoolean("isCool"))) { <i class="conum" data-value="2"></i><b>(2)</b>
        return "Cool message processed!";
     } else {
        return "Message processed!";
     }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>CoolService#isCool()</code> returns <code>Boolean</code> that is associated with the current connection.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>TypedKey.forBoolean("isCool")</code> is the key used to obtain the data stored when the connection was created.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="server-cdi-events"><a class="anchor" href="#server-cdi-events"></a>6.3.3. CDI events</h4>
<div class="paragraph">
<p>Quarkus fires a CDI event of type <code>io.quarkus.websockets.next.WebSocketConnection</code> with qualifier <code>@io.quarkus.websockets.next.Open</code> asynchronously when a new connection is opened.
Moreover, a CDI event of type <code>WebSocketConnection</code> with qualifier <code>@io.quarkus.websockets.next.Closed</code> is fired asynchronously when a connection is closed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.enterprise.event.ObservesAsync;
import io.quarkus.websockets.next.Open;
import io.quarkus.websockets.next.WebSocketConnection;

class MyBean {

  void connectionOpened(@ObservesAsync @Open WebSocketConnection connection) { <i class="conum" data-value="1"></i><b>(1)</b>
     // This observer method is called when a connection is opened...
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An asynchronous observer method is executed using the default blocking executor service.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="websocket-next-security"><a class="anchor" href="#websocket-next-security"></a>6.4. Security</h3>
<div class="paragraph">
<p>Security capabilities are provided by the Quarkus Security extension.
Any <a href="security-identity-providers">Identity provider</a> can be used to convert authentication credentials on the initial HTTP request into a <code>SecurityIdentity</code> instance.
The <code>SecurityIdentity</code> is then associated with the websocket connection.
Authorization options are demonstrated in following sections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When an OpenID Connect extension, <code>quarkus-oidc</code>, is used and token expires, Quarkus automatically closes connection.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="secure-http-upgrade"><a class="anchor" href="#secure-http-upgrade"></a>6.4.1. Secure HTTP upgrade</h4>
<div class="paragraph">
<p>An HTTP upgrade is secured when a standard security annotation is placed on an endpoint class or an HTTP Security policy is defined.
The advantage of securing HTTP upgrade is less processing, the authorization is performed early and only once.
You should always prefer HTTP upgrade security unless you need to perform an action on error (see <a href="#secure-callback-methods">Secure WebSocket endpoint callback methods</a>) or a security check based on the payload (see <a href="#secure-endpoints-with-permission-checkers">Secure server endpoints with permission checkers</a>).</p>
</div>
<div class="listingblock">
<div class="title">Use standard security annotation to secure an HTTP upgrade</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.websockets.next.test.security;

import io.quarkus.security.Authenticated;
import jakarta.inject.Inject;

import io.quarkus.security.identity.SecurityIdentity;
import io.quarkus.websockets.next.OnOpen;
import io.quarkus.websockets.next.OnTextMessage;
import io.quarkus.websockets.next.WebSocket;

@Authenticated <i class="conum" data-value="1"></i><b>(1)</b>
@WebSocket(path = "/end")
public class Endpoint {

    @Inject
    SecurityIdentity currentIdentity;

    @OnOpen
    String open() {
        return "ready";
    }

    @OnTextMessage
    String echo(String message) {
        return message;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initial HTTP handshake ends with the 401 status for anonymous users.
You can also redirect the handshake request on authorization failure with the <code>quarkus.websockets-next.server.security.auth-failure-redirect-url</code> configuration property.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
HTTP upgrade is only secured when a security annotation is declared on an endpoint class next to the <code>@WebSocket</code> annotation.
Placing a security annotation on an endpoint bean will not secure bean methods, only the HTTP upgrade.
You must always verify that your endpoint is secured as intended.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Use HTTP Security policy to secure an HTTP upgrade</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.permission.http-upgrade.paths=/end
quarkus.http.auth.permission.http-upgrade.policy=authenticated</code></pre>
</div>
</div>
<div class="paragraph">
<p>Security annotations used during authentication must be placed on an endpoint class as well, for the <code>SecurityIdentity</code> is created before the websocket connection is opened.</p>
</div>
<div class="listingblock">
<div class="title">Select Bearer token authentication mechanism</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.websockets.next.test.security;

import io.quarkus.oidc.BearerTokenAuthentication;
import io.quarkus.websockets.next.OnTextMessage;
import io.quarkus.websockets.next.WebSocket;

@BearerTokenAuthentication <i class="conum" data-value="1"></i><b>(1)</b>
@WebSocket(path = "/end")
public class Endpoint {

    @OnTextMessage
    String echo(String message) {
        return message;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Require that an opening WebSocket handshake request is authenticated using the bearer token authentication.
See the <a href="security-authentication-mechanisms#use-annotations-for-path-based-auth">Authentication mechanisms in Quarkus</a> guide for more information about selecting authentication mechanisms with annotations.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.auth.proactive=false <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start authenticating an opening WebSocket handshake request only when the <code>io.quarkus.oidc.BearerTokenAuthentication</code> annotation is detected.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="secure-callback-methods"><a class="anchor" href="#secure-callback-methods"></a>6.4.2. Secure WebSocket endpoint callback methods</h4>
<div class="paragraph">
<p>WebSocket endpoint callback methods can be secured with security annotations such as <code>io.quarkus.security.Authenticated</code>,
<code>jakarta.annotation.security.RolesAllowed</code> and other annotations listed in the <a href="security-authorize-web-endpoints-reference#standard-security-annotations">Supported security annotations</a> documentation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.websockets.next.test.security;

import jakarta.annotation.security.RolesAllowed;
import jakarta.inject.Inject;

import io.quarkus.security.ForbiddenException;
import io.quarkus.security.identity.SecurityIdentity;
import io.quarkus.websockets.next.OnError;
import io.quarkus.websockets.next.OnOpen;
import io.quarkus.websockets.next.OnTextMessage;
import io.quarkus.websockets.next.WebSocket;

@WebSocket(path = "/end")
public class Endpoint {

    @Inject
    SecurityIdentity currentIdentity;

    @OnOpen
    String open() {
        return "ready";
    }

    @RolesAllowed("admin")
    @OnTextMessage
    String echo(String message) { <i class="conum" data-value="1"></i><b>(1)</b>
        return message;
    }

    @OnError
    String error(ForbiddenException t) { <i class="conum" data-value="2"></i><b>(2)</b>
        return "forbidden:" + currentIdentity.getPrincipal().getName();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The echo callback method can only be invoked if the current security identity has an <code>admin</code> role.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The error handler is invoked in case of the authorization failure.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="secure-endpoints-with-permission-checkers"><a class="anchor" href="#secure-endpoints-with-permission-checkers"></a>6.4.3. Secure server endpoints with permission checkers</h4>
<div class="paragraph">
<p>WebSocket endpoints can be secured with the <a href="security-authorize-web-endpoints-reference#permission-checker">permission checkers</a>.
We recommend to <a href="#secure-http-upgrade">Secure HTTP upgrade</a> rather than individual endpoint methods. For example:</p>
</div>
<div class="listingblock">
<div class="title">Example of a WebSocket endpoint with secured HTTP upgrade</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.websockets.next.test.security;

import io.quarkus.security.PermissionsAllowed;
import io.quarkus.websockets.next.OnTextMessage;
import io.quarkus.websockets.next.WebSocket;

@PermissionsAllowed("product:premium")
@WebSocket(path = "/product/premium")
public class PremiumProductEndpoint {

    @OnTextMessage
    PremiumProduct getPremiumProduct(int productId) {
        return new PremiumProduct(productId);
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example of a permission checker authorizing the HTTP upgrade</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.websockets.next.test.security;

import io.quarkus.security.identity.SecurityIdentity;
import io.quarkus.security.PermissionChecker;
import io.quarkus.vertx.http.runtime.security.HttpSecurityUtils;
import io.vertx.ext.web.RoutingContext;
import jakarta.enterprise.context.ApplicationScoped;

@ApplicationScoped
public class PermissionChecker {

    @PermissionChecker("product:premium")
    public boolean canGetPremiumProduct(SecurityIdentity securityIdentity) { <i class="conum" data-value="1"></i><b>(1)</b>
        String username = securityIdentity.getPrincipal().getName();

        RoutingContext routingContext = HttpSecurityUtils.getRoutingContextAttribute(securityIdentity);
        String initialHttpUpgradePath = routingContext == null ? null : routingContext.normalizedPath();
        if (!isUserAllowedToAccessPath(initialHttpUpgradePath, username)) {
            return false;
        }

        return isPremiumCustomer(username);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A permission checker authorizing an HTTP upgrade must declare exactly one method parameter, the <code>SecurityIdentity</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to run security checks on every message. For example, a message payload can be accessed like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.websockets.next.test.security;

import io.quarkus.security.PermissionChecker;
import io.quarkus.security.PermissionsAllowed;
import jakarta.inject.Inject;

import io.quarkus.security.ForbiddenException;
import io.quarkus.security.identity.SecurityIdentity;
import io.quarkus.websockets.next.OnError;
import io.quarkus.websockets.next.OnOpen;
import io.quarkus.websockets.next.OnTextMessage;
import io.quarkus.websockets.next.WebSocket;

@WebSocket(path = "/product")
public class ProductEndpoint {

    private record Product(int id, String name) {}

    @Inject
    SecurityIdentity currentIdentity;

    @PermissionsAllowed("product:get")
    @OnTextMessage
    Product getProduct(int productId) { <i class="conum" data-value="1"></i><b>(1)</b>
        return new Product(productId, "Product " + productId);
    }

    @OnError
    String error(ForbiddenException t) { <i class="conum" data-value="2"></i><b>(2)</b>
        return "forbidden:" + currentIdentity.getPrincipal().getName();
    }

    @PermissionChecker("product:get")
    boolean canGetProduct(int productId) {
        String username = currentIdentity.getPrincipal().getName();
        return currentIdentity.hasRole("admin") || canUserGetProduct(productId, username);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>getProduct</code> callback method can only be invoked if the current security identity has an <code>admin</code> role or the user is allowed to get the product detail.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The error handler is invoked in case of the authorization failure.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>More information about permission checkers can be found on the JavaDoc of <a href="https://javadoc.io/doc/io.quarkus.security/quarkus-security/latest/io.quarkus.security.api/io/quarkus/security/PermissionChecker.html"><code>@PermissionChecker</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="bearer-token-authentication"><a class="anchor" href="#bearer-token-authentication"></a>6.4.4. Bearer token authentication</h4>
<div class="paragraph">
<p>The <a href="security-oidc-bearer-token-authentication">OIDC Bearer token authentication</a> expects that the bearer token is passed in the <code>Authorization</code> header during the initial HTTP handshake.
Java WebSocket clients such as <a href="#client-api">WebSockets Next Client</a> and <a href="https://vertx.io/docs/vertx-core/java/#_websockets_on_the_client">Vert.x WebSocketClient</a> support adding custom headers to the WebSocket opening handshake.
However, JavaScript clients that follow the <a href="https://websockets.spec.whatwg.org/#the-websocket-interface">WebSockets API</a> do not support adding custom headers.
Therefore, passing a bearer access token using a custom <code>Authorization</code> header is impossible with JavaScript-based WebSocket clients.
The JavaScript WebSocket client only allows to configure the HTTP <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-WebSocket-Protocol">Sec-WebSocket-Protocol</a> request header for negotiating a sub-protocol.
If absolutely necessary, the <code>Sec-WebSocket-Protocol</code> header might be used as a carrier for custom headers, to provide a workaround the <a href="https://websockets.spec.whatwg.org/#the-websocket-interface">WebSockets API</a> restrictions.
Here is an example of a JavaScript client propagating the <code>Authorization</code> header as a sub-protocol value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const token = getBearerToken()
const quarkusHeaderProtocol = encodeURIComponent("quarkus-http-upgrade#Authorization#Bearer " + token) <i class="conum" data-value="1"></i><b>(1)</b>
const socket = new WebSocket("wss://" + location.host + "/chat/" + username, ["bearer-token-carrier", quarkusHeaderProtocol]) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Expected format for the Quarkus Header sub-protocol is <code>quarkus-http-upgrade#header-name#header-value</code>.
Do not forget to encode the sub-protocol value as a URI component to avoid encoding issues.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicate 2 sub-protocols supported by the client, the sub-protocol of your choice and the Quarkus HTTP upgrade sub-protocol.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the WebSocket server to accept the <code>Authorization</code> passed as a sub-protocol, we must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure our WebSocket server with the supported sub-protocols. When the WebSocket client provides a lists of supported sub-protocols in the HTTP <code>Sec-WebSocket-Protocol</code> request header, the WebSocket server must agree to serve content with one of them.</p>
</li>
<li>
<p>Enable Quarkus HTTP upgrade sub-protocol mapping to the opening WebSocket handshake request headers.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.websockets-next.server.supported-subprotocols=bearer-token-carrier
quarkus.websockets-next.server.propagate-subprotocol-headers=true</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>WebSocket security model is origin-based and is not designed for the client-side authentication with headers or cookies.
For example, web browsers do not enforce the Same-origin policy for the opening WebSocket handshake request.
When you plan to use bearer access tokens during the opening WebSocket handshake request, we strongly recommend to follow the additional security measures listed below to minimize the security risks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Restrict supported Origins to trusted Origins only with the <a href="security-cors#cors-filter">CORS filter</a>.</p>
</li>
<li>
<p>Use the <code>wss</code> protocol to enforce encrypted HTTP connection via TLS.</p>
</li>
<li>
<p>Use a custom WebSocket ticket system which supplies a random token with the HTML page which hosts the JavaScript WebSockets client which must provide this token during the initial handshake request as a query parameter.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before the bearer access token sent on the initial HTTP request expires, you can send a new bearer access token as part of a message and update current <code>SecurityIdentity</code> attached to the WebSocket server connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.websockets.next.test.security;

import io.quarkus.security.Authenticated;
import io.quarkus.security.identity.SecurityIdentity;
import io.quarkus.websockets.next.OnTextMessage;
import io.quarkus.websockets.next.WebSocket;
import io.quarkus.websockets.next.WebSocketSecurity;
import jakarta.inject.Inject;

@Authenticated
@WebSocket(path = "/end")
public class Endpoint {

    record Metadata(String token) {}
    record RequestDto(Metadata metadata, String message) {}

    @Inject
    SecurityIdentity securityIdentity;

    @Inject
    WebSocketSecurity webSocketSecurity;

    @OnTextMessage
    String echo(RequestDto request) {
        if (request.metadata != null &amp;&amp; request.metadata.token != null) {
            webSocketSecurity.updateSecurityIdentity(request.metadata.token); <i class="conum" data-value="1"></i><b>(1)</b>
        }
        String principalName = securityIdentity.getPrincipal().getName(); <i class="conum" data-value="2"></i><b>(2)</b>
        return request.message + " " + principalName;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Asynchronously update the <code>SecurityIdentity</code> attached to the WebSocket server connection.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The current <code>SecurityIdentity</code> instance is still available and can be used during the <code>SecurityIdentity</code> update.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="security-oidc-bearer-token-authentication">OIDC Bearer token authentication</a> mechanism has builtin support for the <code>SecurityIdentity</code> update.
If you use other authentication mechanisms, you must implement the <code>io.quarkus.security.identity.IdentityProvider</code> provider that supports the <code>io.quarkus.websockets.next.runtime.spi.security.WebSocketIdentityUpdateRequest</code> authentication request.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The new bearer access token must have the same <code>sub</code> claim value as the token used during the initial HTTP request.
Please also make sure the <code>SecurityIdentity</code> is only updated when necessary and the WebSocket message with credentials do not appear in your application logs.
Always use the <code>wss</code> protocol to enforce encrypted HTTP connection via TLS when sending credentials as part of the WebSocket message.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>WebSocket client application have to send a new access token before previous one expires:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;script type="module"&gt;
    import Keycloak from 'https://cdn.jsdelivr.net/npm/keycloak-js@26.2.0/lib/keycloak.js'
    const keycloak = new Keycloak({
        url: 'http://localhost:39245',
        realm: 'quarkus',
        clientId: 'websockets-js-client'
    });
    function getToken() {
        return keycloak.token
    }

    await keycloak
        .init({onLoad: 'login-required'})
        .then(() =&gt; console.log('User is now authenticated.'))
        .catch(err =&gt; console.log('User is NOT authenticated.', err));

    // open Web socket - reduced for brevity
    let connectionOpened = true;
    const subprotocols = [ "quarkus", encodeURI("quarkus-http-upgrade" + "#Authorization#Bearer " + getToken()) ]
    const socket = new WebSocket("wss://" + location.host + "/chat/username", subprotocols);

    setInterval(() =&gt; {
        keycloak
            .updateToken(15)
            .then(result =&gt; {
                if (result &amp;&amp; connectionOpened) {
                    console.log('Token updated, sending new token to the server')
                    socket.send(JSON.stringify({
                        metadata: {
                            token: `${getToken()}`
                        }
                    }));
                }
            })
            .catch(err =&gt; console.error(err))
    }, 10000);
&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Complete example is located in the <code>security-openid-connect-websockets-next-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/development/security-openid-connect-websockets-next-quickstart">directory</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inspect-andor-reject-http-upgrade"><a class="anchor" href="#inspect-andor-reject-http-upgrade"></a>6.5. Inspect and/or reject HTTP upgrade</h3>
<div class="paragraph">
<p>To inspect an HTTP upgrade, you must provide a CDI bean implementing the <code>io.quarkus.websockets.next.HttpUpgradeCheck</code> interface.
Quarkus calls the <code>HttpUpgradeCheck#perform</code> method on every HTTP request that should be upgraded to a WebSocket connection.
Inside this method, you can perform any business logic and/or reject the HTTP upgrade.</p>
</div>
<div class="listingblock">
<div class="title">Example HttpUpgradeCheck</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.websockets.next.test;

import io.quarkus.websockets.next.HttpUpgradeCheck;
import io.smallrye.mutiny.Uni;
import jakarta.enterprise.context.ApplicationScoped;

@ApplicationScoped <i class="conum" data-value="1"></i><b>(1)</b>
public class ExampleHttpUpgradeCheck implements HttpUpgradeCheck {

    @Override
    public Uni&lt;CheckResult&gt; perform(HttpUpgradeContext ctx) {
        if (rejectUpgrade(ctx)) {
            return CheckResult.rejectUpgrade(400); <i class="conum" data-value="2"></i><b>(2)</b>
        }
        return CheckResult.permitUpgrade();
    }

    private boolean rejectUpgrade(HttpUpgradeContext ctx) {
        var headers = ctx.httpRequest().headers();
        // implement your business logic in here
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The CDI beans implementing <code>HttpUpgradeCheck</code> interface can be either <code>@ApplicationScoped</code>, <code>@Singleton</code> or <code>@Dependent</code> beans, but never the <code>@RequestScoped</code> beans.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Reject the HTTP upgrade. Initial HTTP handshake ends with the 400 Bad Request response status code.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can choose WebSocket endpoints to which the <code>HttpUpgradeCheck</code> is applied with the <code>HttpUpgradeCheck#appliesTo</code> method.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tls"><a class="anchor" href="#tls"></a>6.6. TLS</h3>
<div class="paragraph">
<p>As a direct consequence of the fact this extension reuses the <em>main</em> HTTP server, all the relevant server configurations apply. See Refer to the <a href="http-reference#ssl">HTTP guide</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="hibernate-multitenancy"><a class="anchor" href="#hibernate-multitenancy"></a>6.7. Hibernate multitenancy</h3>
<div class="paragraph">
<p>The <code>RoutingContext</code> is not available after the HTTP upgrade. However, it is possible to inject the <code>WebSocketConnection</code> and access the headers of the initial HTTP request.</p>
</div>
<div class="paragraph">
<p>If a custom <code>TenantResolver</code> is used and you would like to combine REST/HTTP and WebSockets, the code may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RequestScoped
@PersistenceUnitExtension
public class CustomTenantResolver implements TenantResolver {

    @Inject
    RoutingContext context;
    @Inject
    WebSocketConnection connection;

    @Override
    public String getDefaultTenantId() {
        return "public";
    }

    @Override
    public String resolveTenantId() {
        String schema;
        try {
            //Handle WebSocket
            schema = connection.handshakeRequest().header("schema");
        } catch ( ContextNotActiveException e) {
            // Handle REST/HTTP
            schema = context.request().getHeader( "schema" );
        }

        if ( schema == null || schema.equalsIgnoreCase( "public" ) ) {
            return "public";
        }

        return schema;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on Hibernate multitenancy, refer to the <a href="https://quarkus.io/guides/hibernate-orm#multitenancy">hibernate documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client-api"><a class="anchor" href="#client-api"></a>7. Client API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="client-connectors"><a class="anchor" href="#client-connectors"></a>7.1. Client connectors</h3>
<div class="paragraph">
<p>A connector can be used to configure and open a new client connection backed by a client endpoint that is used to consume and send messages.
Quarkus provides a CDI bean with bean type <code>io.quarkus.websockets.next.WebSocketConnector&lt;CLIENT&gt;</code> and default qualifer that can be injected in other beans.
The actual type argument of an injection point is used to determine the client endpoint.
The type is validated during build - if it does not represent a client endpoint the build fails.</p>
</div>
<div class="paragraph">
<p>Let’s consider the following client endpoint:</p>
</div>
<div class="listingblock">
<div class="title">Client endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebSocketClient(path = "/endpoint/{name}")
public class ClientEndpoint {

    @OnTextMessage
    void onMessage(@PathParam String name, String message, WebSocketClientConnection connection) {
        // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The connector for this client endpoint is used as follows:</p>
</div>
<div class="listingblock">
<div class="title">Connector</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class MyBean {

    @ConfigProperty(name = "endpoint.uri")
    URI myUri;

    @Inject
    WebSocketConnector&lt;ClientEndpoint&gt; connector; <i class="conum" data-value="1"></i><b>(1)</b>

    void openAndSendMessage() {
        WebSocketClientConnection connection = connector
            .baseUri(uri) <i class="conum" data-value="2"></i><b>(2)</b>
            .pathParam("name", "Roxanne") <i class="conum" data-value="3"></i><b>(3)</b>
            .customizeOptions((connectOptions, clientOptions) -&gt; {  <i class="conum" data-value="4"></i><b>(4)</b>
               // ...
            })
            .connectAndAwait();
        connection.sendTextAndAwait("Hi!"); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the connector for <code>ClientEndpoint</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the base <code>URI</code> is not supplied we attempt to obtain the value from the config. The key consists of the client id and the <code>.base-uri</code> suffix.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the path param value. Throws <code>IllegalArgumentException</code> if the client endpoint path does not contain a parameter with the given name.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Optionally, customize client and connection options not configurable with the connector API or Quarkus configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use the connection to send messages, if needed.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If an application attempts to inject a connector for a missing endpoint, an error is thrown.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Connectors are not thread-safe and should not be used concurrently.
Connectors should also not be reused.
If you need to create multiple connections in a row you&#8217;ll need to obtain a new connector instance programmatically using <code>Instance#get()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.enterprise.inject.Instance;

@Singleton
public class MyBean {

    @Inject
    Instance&lt;WebSocketConnector&lt;MyEndpoint&gt;&gt; connector;

    void connect() {
        var connection1 = connector.get().baseUri(uri)
                .addHeader("Foo", "alpha")
                .connectAndAwait();
        var connection2 = connector.get().baseUri(uri)
                .addHeader("Foo", "bravo")
                .connectAndAwait();
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="basic-connector"><a class="anchor" href="#basic-connector"></a>7.1.1. Basic connector</h4>
<div class="paragraph">
<p>In the case where the application developer does not need the combination of the client endpoint and the connector, a <em>basic connector</em> can be used.
The basic connector is a simple way to create a connection and consume/send messages without defining a client endpoint.</p>
</div>
<div class="listingblock">
<div class="title">Basic connector</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class MyBean {

    @Inject
    BasicWebSocketConnector connector; <i class="conum" data-value="1"></i><b>(1)</b>

    void openAndConsume() {
        WebSocketClientConnection connection = connector
            .baseUri(uri) <i class="conum" data-value="2"></i><b>(2)</b>
            .path("/ws") <i class="conum" data-value="3"></i><b>(3)</b>
            .executionModel(ExecutionModel.NON_BLOCKING) <i class="conum" data-value="4"></i><b>(4)</b>
            .onTextMessage((c, m) -&gt; { <i class="conum" data-value="5"></i><b>(5)</b>
               // ...
            })
            .customizeOptions((connectOptions, clientOptions) -&gt; {  <i class="conum" data-value="6"></i><b>(6)</b>
               // ...
            })
            .connectAndAwait();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the connector.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The base URI must be always set.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The additional path that should be appended to the base URI.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Set the execution model for callback handlers. By default, the callback may block the current thread. However in this case, the callback is executed on the event loop and may not block the current thread.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The lambda will be called for every text message sent from the server.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optionally, customize client and connection options not configurable with the connector API or Quarkus configuration.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic connector is closer to a low-level API and is reserved for advanced users.
However, unlike others low-level WebSocket clients, it is still a CDI bean and can be injected in other beans.
It also provides a way to configure the execution model of the callbacks, ensuring optimal integration with the rest of Quarkus.</p>
</div>
<div class="paragraph">
<p>Connectors are not thread-safe and should not be used concurrently.
Connectors should also not be reused.
If you need to create multiple connections in a row you&#8217;ll need to obtain a new connetor instance programmatically using <code>Instance#get()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.enterprise.inject.Instance;

@Singleton
public class MyBean {

    @Inject
    Instance&lt;BasicWebSocketConnector&gt; connector;

    void connect() {
        var connection1 = connector.get().baseUri(uri)
                .addHeader("Foo", "alpha")
                .connectAndAwait();
        var connection2 = connector.get().baseUri(uri)
                .addHeader("Foo", "bravo")
                .connectAndAwait();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ws-client-connection"><a class="anchor" href="#ws-client-connection"></a>7.2. WebSocket client connection</h3>
<div class="paragraph">
<p>The <code>io.quarkus.websockets.next.WebSocketClientConnection</code> object represents the WebSocket connection.
Quarkus provides a <code>@SessionScoped</code> CDI bean that implements this interface and can be injected in a <code>WebSocketClient</code> endpoint and used to interact with the connected server.</p>
</div>
<div class="paragraph">
<p>Methods annotated with <code>@OnOpen</code>, <code>@OnTextMessage</code>, <code>@OnBinaryMessage</code>, and <code>@OnClose</code> can access the injected <code>WebSocketClientConnection</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject WebSocketClientConnection connection;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that outside of these methods, the <code>WebSocketClientConnection</code> object is not available. However, it is possible to <a href="#list-open-client-connections">list all open client connections</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The connection can be used to send messages to the client, access the path parameters, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Send a message:
connection.sendTextAndAwait("Hello!");

// Broadcast messages:
connection.broadcast().sendTextAndAwait(departure);

// Access path parameters:
String param = connection.pathParam("foo");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>WebSocketClientConnection</code> provides both a blocking and a non-blocking method variants to send messages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sendTextAndAwait(String message)</code>: Sends a text message to the client and waits for the message to be sent. It&#8217;s blocking and should only be called from an executor thread.</p>
</li>
<li>
<p><code>sendText(String message)</code>: Sends a text message to the client. It returns a <code>Uni</code>. It&#8217;s non-blocking. Make sure you or Quarkus subscribes to the returned <code>Uni</code> to send the message.
If you return the <code>Uni</code> from a method invoked by Quarkus (like with Quarkus REST, Quarkus WebSocket Next or Quarkus Messaging), it will subscribe to it and send the message.
For example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@POST
public Uni&lt;Void&gt; send() {
    return connection.sendText("Hello!"); // Quarkus automatically subscribes to the returned Uni and sends the message.
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="list-open-client-connections"><a class="anchor" href="#list-open-client-connections"></a>7.2.1. List open client connections</h4>
<div class="paragraph">
<p>It is also possible to list all open connections.
Quarkus provides a CDI bean of type <code>io.quarkus.websockets.next.OpenClientConnections</code> that declares convenient methods to access the connections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.logging.Log;
import io.quarkus.websockets.next.OpenClientConnections;

class MyBean {

  @Inject
  OpenClientConnections connections;

  void logAllOpenClinetConnections() {
     Log.infof("Open client connections: %s", connections.listAll()); <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>OpenClientConnections#listAll()</code> returns an immutable snapshot of all open connections at the given time.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are also other convenient methods.
For example, <code>OpenClientConnections#findByClientId(String)</code> makes it easy to find connections for a specific endpoint.</p>
</div>
</div>
<div class="sect3">
<h4 id="user-data-2"><a class="anchor" href="#user-data-2"></a>7.2.2. User data</h4>
<div class="paragraph">
<p>It is also possible to associate arbitrary user data with a specific connection.
The <code>io.quarkus.websockets.next.UserData</code> object obtained by the <code>WebSocketClientConnection#userData()</code> method represents mutable user data associated with a connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.websockets.next.WebSocketClientConnection;
import io.quarkus.websockets.next.UserData.TypedKey;

@WebSocketClient(path = "/endpoint/{username}")
class MyEndpoint {

  @Inject
  CoolService service;

  @OnOpen
  void open(WebSocketClientConnection connection) {
     connection.userData().put(TypedKey.forBoolean("isCool"), service.isCool(connection.pathParam("username"))); <i class="conum" data-value="1"></i><b>(1)</b>
  }

  @OnTextMessage
  String process(String message) {
     if (connection.userData().get(TypedKey.forBoolean("isCool"))) { <i class="conum" data-value="2"></i><b>(2)</b>
        return "Cool message processed!";
     } else {
        return "Message processed!";
     }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>CoolService#isCool()</code> returns <code>Boolean</code> that is associated with the current connection.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>TypedKey.forBoolean("isCool")</code> is the key used to obtain the data stored when the connection was created.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="specify-in-connector"><a class="anchor" href="#specify-in-connector"></a>7.2.2.1. Specify in connector</h5>
<div class="paragraph">
<p>In some scenarios you may wish to associate user data with a connection to be created by a <a href="#client-connectors">connector</a>. In this case, you can set values on the connector instance prior to obtaining the connection. This is particularly useful if you need to do something when the connection is opened and the necessary context cannot be otherwise inferred.</p>
</div>
<div class="listingblock">
<div class="title">Connector</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class MyBean {

    @Inject
    MyService service;

    @Inject
    Instance&lt;WebSocketConnector&lt;MyEndpoint&gt;&gt; connectorInstance;

    public void openAndSendMessage(String internalId, String message) {
        var externalId = service.getExternalId(internalId);
        var connection = connectorInstance.get()
            .pathParam("externalId", externalId)
            .userData(TypedKey.forString("internalId"), internalId)
            .connectAndAwait();
        connection.sendTextAndAwait(message);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebSocketClient(path = "/endpoint/{externalId}")
class MyEndpoint {

    @Inject
    MyService service;

    @OnOpen
    void open(WebSocketClientConnection connection) {
        var internalId = connection.userData().get(TypedKey.forString("internalId"));
        service.doSomething(internalId);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="client-cdi-events"><a class="anchor" href="#client-cdi-events"></a>7.2.3. CDI events</h4>
<div class="paragraph">
<p>Quarkus fires a CDI event of type <code>io.quarkus.websockets.next.WebSocketClientConnection</code> with qualifier <code>@io.quarkus.websockets.next.Open</code> asynchronously when a new connection is opened.
Moreover, a CDI event of type <code>WebSocketClientConnection</code> with qualifier <code>@io.quarkus.websockets.next.Closed</code> is fired asynchronously when a connection is closed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.enterprise.event.ObservesAsync;
import io.quarkus.websockets.next.Open;
import io.quarkus.websockets.next.WebSocketClientConnection;

class MyBean {

  void connectionOpened(@ObservesAsync @Open WebSocketClientConnection connection) { <i class="conum" data-value="1"></i><b>(1)</b>
     // This observer method is called when a connection is opened...
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An asynchronous observer method is executed using the default blocking executor service.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-ssltls"><a class="anchor" href="#configuring-ssltls"></a>7.3. Configuring SSL/TLS</h3>
<div class="paragraph">
<p>To establish a TLS connection, you need to configure a <em>named</em> configuration using the <a href="./tls-registry-reference">TLS registry</a>. This is typically done via configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.tls.my-ws-client.trust-store.p12.path=server-truststore.p12
quarkus.tls.my-ws-client.trust-store.p12.password=secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>With a <em>named</em> TLS configuration established, you can then configure the client to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.websockets-next.client.tls-configuration-name=my-ws-client</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can supply the configuration name using the <a href="#client-connectors">connector</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class MyBean {

    @Inject
    WebSocketConnector&lt;MyEndpoint&gt; connector;

    public void connect() {
        connector
            .tlsConfigurationName("my-ws-client")
            .connectAndAwait();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A name supplied to the connector will override any statically configured name. This can be useful for establishing a default configuration which can be overridden at runtime as necessary.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When using the WebSocket client, using a <em>named</em> configuration is required to avoid conflicts with other TLS configurations.
The client will not use the default TLS configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you configure a <em>named</em> TLS configuration, TLS is enabled by default.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="traffic-logging"><a class="anchor" href="#traffic-logging"></a>8. Traffic logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus can log the messages sent and received for debugging purposes.
To enable traffic logging for the server, set the <code>quarkus.websockets-next.server.traffic-logging.enabled</code> configuration property to <code>true</code>.
To enable traffic logging for the client, set the <code>quarkus.websockets-next.client.traffic-logging.enabled</code> configuration property to <code>true</code>.
The payload of text messages is logged as well.
However, the number of logged characters is limited.
The default limit is 100, but you can change this limit with the <code>quarkus.websockets-next.server.traffic-logging.text-payload-limit</code> and <code>quarkus.websockets-next.client.traffic-logging.text-payload-limit</code> configuration property, respectively.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The messages are only logged if the <code>DEBUG</code> level is enabled for the logger <code>io.quarkus.websockets.next.traffic</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example server configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.websockets-next.server.traffic-logging.enabled=true <i class="conum" data-value="1"></i><b>(1)</b>
quarkus.websockets-next.server.traffic-logging.text-payload-limit=50 <i class="conum" data-value="2"></i><b>(2)</b>

quarkus.log.category."io.quarkus.websockets.next.traffic".level=DEBUG <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables traffic logging.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the number of characters of a text message payload which will be logged.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Enable <code>DEBUG</code> level is for the logger <code>io.quarkus.websockets.next.traffic</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="subscribe-or-not-subscribe"><a class="anchor" href="#subscribe-or-not-subscribe"></a>9. When to subscribe to a <code>Uni</code> or <code>Multi</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>Uni</code> and <code>Multi</code> are lazy types, which means that they do not start processing until they are subscribed to.</p>
</div>
<div class="paragraph">
<p>When you get (from a parameter or from a method you called) a <code>Uni</code> or a <code>Multi</code>, whether you should subscribe to it depends on the context:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if you return the <code>Uni</code> or <code>Multi</code> in a method invoked by Quarkus (like with Quarkus REST, Quarkus WebSocket Next or Quarkus Messaging), Quarkus subscribes to it and processes the items emitted by the <code>Multi</code> or the item emitted by the <code>Uni</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Incoming("...")
@Outgoing("...")
public Multi&lt;String&gt; process(Multi&lt;String&gt; input) {
    // No need to subscribe to the input Multi, the `process` method is called by Quarkus (Messaging).
    return input.map(String::toUpperCase);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a <code>Uni</code> or <code>Multi</code> is returned from a method annotated with <code>@OnOpen</code>, <code>@OnTextMessage</code>, <code>@OnBinaryMessage</code>, or <code>@OnClose</code>, Quarkus subscribes to it automatically.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if you do not return the <code>Uni</code> or <code>Multi</code> in a method invoked by Quarkus, you should subscribe to it:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Incoming("...")
@Outgoing("...")
public void process(Multi&lt;String&gt; input) {
    input.map(String::toUpperCase)
        .subscribe().with(s -&gt; log(s));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="telemetry"><a class="anchor" href="#telemetry"></a>10. Telemetry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the OpenTelemetry extension is present, traces for opened and closed WebSocket connections are collected by default.
If you do not require WebSocket traces, you can disable collecting of traces like in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.websockets-next.server.traces.enabled=false
quarkus.websockets-next.client.traces.enabled=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the Micrometer extension is present, Quarkus can collect metrics for messages, errors and bytes transferred.
If you require a WebSocket metrics, you can enable the metrics like in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.websockets-next.server.metrics.enabled=true
quarkus.websockets-next.client.metrics.enabled=true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Telemetry for the <code>BasicWebSocketConnector</code> is currently not supported.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="websocket-next-configuration-reference"><a class="anchor" href="#websocket-next-configuration-reference"></a>11. Configuration reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> Configuration property fixed at build time - All other configuration properties are overridable at runtime <input type="search" id="config-search-0" placeholder="FILTER CONFIGURATION" disabled></p>
</div>
<table class="tableblock frame-all grid-all stretch configuration-reference searchable configuration-reference-all-rows">
<colgroup>
<col style="width: 80%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><span class="header-title">Configuration property</span></p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">Type</p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">Default</p></th>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-websockets-next_quarkus-websockets-next-server-activate-request-context"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-activate-request-context"><code>quarkus.websockets-next.server.activate-request-context</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.activate-request-context' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-1" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Specifies the activation strategy for the CDI request context during endpoint callback invocation. By default, the request context is only activated if needed, i.e. if there is a bean with the given scope, or a bean annotated with a security annotation (such as <code>@RolesAllowed</code>), in the dependency tree of the endpoint.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-74992">QUARKUS_WEBSOCKETS_NEXT_SERVER_ACTIVATE_REQUEST_CONTEXT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-74992" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><span class="asciidoc-tooltip-wrapper"><code>auto</code><span class="asciidoc-tooltip">The context is only activated if needed.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>always</code><span class="asciidoc-tooltip">The context is always activated.</span></span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="asciidoc-tooltip-wrapper"><code>auto</code><span class="asciidoc-tooltip">The context is only activated if needed.</span></span></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-websockets-next_quarkus-websockets-next-server-activate-session-context"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-activate-session-context"><code>quarkus.websockets-next.server.activate-session-context</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.activate-session-context' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-2" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Specifies the activation strategy for the CDI session context during endpoint callback invocation. By default, the session context is only activated if needed, i.e. if there is a bean with the given scope in the dependency tree of the endpoint.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-74993">QUARKUS_WEBSOCKETS_NEXT_SERVER_ACTIVATE_SESSION_CONTEXT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-74993" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><span class="asciidoc-tooltip-wrapper"><code>auto</code><span class="asciidoc-tooltip">The context is only activated if needed.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>always</code><span class="asciidoc-tooltip">The context is always activated.</span></span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="asciidoc-tooltip-wrapper"><code>auto</code><span class="asciidoc-tooltip">The context is only activated if needed.</span></span></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-websockets-next_quarkus-websockets-next-server-propagate-subprotocol-headers"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-propagate-subprotocol-headers"><code>quarkus.websockets-next.server.propagate-subprotocol-headers</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.propagate-subprotocol-headers' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-3" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If enabled, the WebSocket opening handshake headers are enhanced with the 'Sec-WebSocket-Protocol' sub-protocol that match format 'quarkus-http-upgrade#header-name#header-value'. If the WebSocket client interface does not support setting headers to the WebSocket opening handshake, this is a way how to set authorization header required to authenticate user. The 'quarkus-http-upgrade' sub-protocol is removed and server selects from the sub-protocol one that is supported (don&#8217;t forget to configure the 'quarkus.websockets-next.server.supported-subprotocols' property). <strong>IMPORTANT: We strongly recommend to only enable this feature if the HTTP connection is encrypted via TLS, CORS origin check is enabled and custom WebSocket ticket system is in place. Please see the Quarkus WebSockets Next reference for more information.</strong></p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-74994">QUARKUS_WEBSOCKETS_NEXT_SERVER_PROPAGATE_SUBPROTOCOL_HEADERS</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-74994" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-offer-per-message-compression"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-offer-per-message-compression"><code>quarkus.websockets-next.client.offer-per-message-compression</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.offer-per-message-compression' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-4" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Compression Extensions for WebSocket are supported by default.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://datatracker.ietf.org/doc/html/rfc7692">RFC 7692</a></p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-74995">QUARKUS_WEBSOCKETS_NEXT_CLIENT_OFFER_PER_MESSAGE_COMPRESSION</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-74995" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-compression-level"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-compression-level"><code>quarkus.websockets-next.client.compression-level</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.compression-level' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-5" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The compression level must be a value between 0 and 9. The default value is <code>io.vertx.core.http.HttpClientOptions#DEFAULT_WEBSOCKET_COMPRESSION_LEVEL</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-74996">QUARKUS_WEBSOCKETS_NEXT_CLIENT_COMPRESSION_LEVEL</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-74996" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-max-message-size"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-max-message-size"><code>quarkus.websockets-next.client.max-message-size</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.max-message-size' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-6" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The maximum size of a message in bytes. The default values is <code>io.vertx.core.http.HttpClientOptions#DEFAULT_MAX_WEBSOCKET_MESSAGE_SIZE</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-74997">QUARKUS_WEBSOCKETS_NEXT_CLIENT_MAX_MESSAGE_SIZE</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-74997" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-max-frame-size"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-max-frame-size"><code>quarkus.websockets-next.client.max-frame-size</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.max-frame-size' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-7" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The maximum size of a frame in bytes. The default values is <code>io.vertx.core.http.HttpClientOptions#DEFAULT_MAX_WEBSOCKET_FRAME_SIZE</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-74998">QUARKUS_WEBSOCKETS_NEXT_CLIENT_MAX_FRAME_SIZE</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-74998" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-auto-ping-interval"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-auto-ping-interval"><code>quarkus.websockets-next.client.auto-ping-interval</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.auto-ping-interval' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-8" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The interval after which, when set, the client sends a ping message to a connected server automatically.</p>
</div>
<div class="paragraph">
<p>Ping messages are not sent automatically by default.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-74999">QUARKUS_WEBSOCKETS_NEXT_CLIENT_AUTO_PING_INTERVAL</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-74999" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Duration.html">Duration</a> <a href="#duration-note-anchor-quarkus-websockets-next_quarkus-websockets-next"><span class="icon"><i class="fa fa-question-circle" title="More information about the Duration format"></i></span></a></p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-connection-idle-timeout"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-connection-idle-timeout"><code>quarkus.websockets-next.client.connection-idle-timeout</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.connection-idle-timeout' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-9" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If set then a connection will be closed if no data is received nor sent within the given timeout.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75000">QUARKUS_WEBSOCKETS_NEXT_CLIENT_CONNECTION_IDLE_TIMEOUT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75000" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Duration.html">Duration</a> <a href="#duration-note-anchor-quarkus-websockets-next_quarkus-websockets-next"><span class="icon"><i class="fa fa-question-circle" title="More information about the Duration format"></i></span></a></p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-connection-closing-timeout"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-connection-closing-timeout"><code>quarkus.websockets-next.client.connection-closing-timeout</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.connection-closing-timeout' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-10" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The amount of time a client will wait until it closes the TCP connection after sending a close frame. Any value will be <code>Duration#toSeconds() converted to seconds</code> and limited to <code>Integer#MAX_VALUE</code>. The default value is `io.vertx.core.http.HttpClientOptions#DEFAULT_WEBSOCKET_CLOSING_TIMEOUT`s</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75001">QUARKUS_WEBSOCKETS_NEXT_CLIENT_CONNECTION_CLOSING_TIMEOUT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75001" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Duration.html">Duration</a> <a href="#duration-note-anchor-quarkus-websockets-next_quarkus-websockets-next"><span class="icon"><i class="fa fa-question-circle" title="More information about the Duration format"></i></span></a></p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-unhandled-failure-strategy"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-unhandled-failure-strategy"><code>quarkus.websockets-next.client.unhandled-failure-strategy</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.unhandled-failure-strategy' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-11" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The strategy used when an error occurs but no error handler can handle the failure.</p>
</div>
<div class="paragraph">
<p>By default, the error message is logged when an unhandled failure occurs.</p>
</div>
<div class="paragraph">
<p>Note that clients should not close the WebSocket connection arbitrarily. See also RFC-6455 <a href="https://datatracker.ietf.org/doc/html/rfc6455#section-7.3">section 7.3</a>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75002">QUARKUS_WEBSOCKETS_NEXT_CLIENT_UNHANDLED_FAILURE_STRATEGY</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75002" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><span class="asciidoc-tooltip-wrapper"><code>log-and-close</code><span class="asciidoc-tooltip">Log the error message and close the connection.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>close</code><span class="asciidoc-tooltip">Close the connection silently.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>log</code><span class="asciidoc-tooltip">Log the error message.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>noop</code><span class="asciidoc-tooltip">No operation.</span></span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="asciidoc-tooltip-wrapper"><code>log</code><span class="asciidoc-tooltip">Log the error message.</span></span></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-tls-configuration-name"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-tls-configuration-name"><code>quarkus.websockets-next.client.tls-configuration-name</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.tls-configuration-name' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-12" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The name of the TLS configuration to use.</p>
</div>
<div class="paragraph">
<p>If a name is configured, it uses the configuration from <code>quarkus.tls.&lt;name&gt;.*</code> If a name is configured, but no TLS configuration is found with that name then an error will be thrown.</p>
</div>
<div class="paragraph">
<p>The default TLS configuration is <strong>not</strong> used by default.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75003">QUARKUS_WEBSOCKETS_NEXT_CLIENT_TLS_CONFIGURATION_NAME</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75003" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-traffic-logging-enabled"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-traffic-logging-enabled"><code>quarkus.websockets-next.client.traffic-logging.enabled</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.traffic-logging.enabled' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-13" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If set to true then binary/text messages received/sent are logged if the <code>DEBUG</code> level is enabled for the logger <code>io.quarkus.websockets.next.traffic</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75004">QUARKUS_WEBSOCKETS_NEXT_CLIENT_TRAFFIC_LOGGING_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75004" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-traffic-logging-text-payload-limit"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-traffic-logging-text-payload-limit"><code>quarkus.websockets-next.client.traffic-logging.text-payload-limit</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.traffic-logging.text-payload-limit' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-14" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The number of characters of a text message which will be logged if traffic logging is enabled. The payload of a binary message is never logged.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75005">QUARKUS_WEBSOCKETS_NEXT_CLIENT_TRAFFIC_LOGGING_TEXT_PAYLOAD_LIMIT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75005" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>100</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-traces-enabled"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-traces-enabled"><code>quarkus.websockets-next.client.traces.enabled</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.traces.enabled' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-15" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If collection of WebSocket traces is enabled. Only applicable when the OpenTelemetry extension is present.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75006">QUARKUS_WEBSOCKETS_NEXT_CLIENT_TRACES_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75006" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-client-metrics-enabled"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-client-metrics-enabled"><code>quarkus.websockets-next.client.metrics.enabled</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.client.metrics.enabled' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-16" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If collection of WebSocket metrics is enabled. Only applicable when the Micrometer extension is present.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75007">QUARKUS_WEBSOCKETS_NEXT_CLIENT_METRICS_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75007" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-supported-subprotocols"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-supported-subprotocols"><code>quarkus.websockets-next.server.supported-subprotocols</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.supported-subprotocols' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-17" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>See <a href="https://datatracker.ietf.org/doc/html/rfc6455#page-12">The WebSocket Protocol</a></p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75008">QUARKUS_WEBSOCKETS_NEXT_SERVER_SUPPORTED_SUBPROTOCOLS</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75008" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-per-message-compression-supported"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-per-message-compression-supported"><code>quarkus.websockets-next.server.per-message-compression-supported</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.per-message-compression-supported' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-18" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Compression Extensions for WebSocket are supported by default.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://datatracker.ietf.org/doc/html/rfc7692">RFC 7692</a></p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75009">QUARKUS_WEBSOCKETS_NEXT_SERVER_PER_MESSAGE_COMPRESSION_SUPPORTED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75009" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-compression-level"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-compression-level"><code>quarkus.websockets-next.server.compression-level</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.compression-level' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-19" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The compression level must be a value between 0 and 9. The default value is <code>io.vertx.core.http.HttpServerOptions#DEFAULT_WEBSOCKET_COMPRESSION_LEVEL</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75010">QUARKUS_WEBSOCKETS_NEXT_SERVER_COMPRESSION_LEVEL</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75010" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-max-message-size"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-max-message-size"><code>quarkus.websockets-next.server.max-message-size</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.max-message-size' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-20" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The maximum size of a message in bytes. The default values is <code>io.vertx.core.http.HttpServerOptions#DEFAULT_MAX_WEBSOCKET_MESSAGE_SIZE</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75011">QUARKUS_WEBSOCKETS_NEXT_SERVER_MAX_MESSAGE_SIZE</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75011" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-max-frame-size"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-max-frame-size"><code>quarkus.websockets-next.server.max-frame-size</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.max-frame-size' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-21" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The maximum size of a frame in bytes. The default values is <code>io.vertx.core.http.HttpServerOptions#DEFAULT_MAX_WEBSOCKET_FRAME_SIZE</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75012">QUARKUS_WEBSOCKETS_NEXT_SERVER_MAX_FRAME_SIZE</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75012" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-auto-ping-interval"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-auto-ping-interval"><code>quarkus.websockets-next.server.auto-ping-interval</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.auto-ping-interval' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-22" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The interval after which, when set, the server sends a ping message to a connected client automatically.</p>
</div>
<div class="paragraph">
<p>Ping messages are not sent automatically by default.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75013">QUARKUS_WEBSOCKETS_NEXT_SERVER_AUTO_PING_INTERVAL</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75013" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Duration.html">Duration</a> <a href="#duration-note-anchor-quarkus-websockets-next_quarkus-websockets-next"><span class="icon"><i class="fa fa-question-circle" title="More information about the Duration format"></i></span></a></p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-unhandled-failure-strategy"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-unhandled-failure-strategy"><code>quarkus.websockets-next.server.unhandled-failure-strategy</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.unhandled-failure-strategy' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-23" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The strategy used when an error occurs but no error handler can handle the failure.</p>
</div>
<div class="paragraph">
<p>By default, the error message is logged and the connection is closed when an unhandled failure occurs.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75014">QUARKUS_WEBSOCKETS_NEXT_SERVER_UNHANDLED_FAILURE_STRATEGY</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75014" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><span class="asciidoc-tooltip-wrapper"><code>log-and-close</code><span class="asciidoc-tooltip">Log the error message and close the connection.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>close</code><span class="asciidoc-tooltip">Close the connection silently.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>log</code><span class="asciidoc-tooltip">Log the error message.</span></span>, <span class="asciidoc-tooltip-wrapper"><code>noop</code><span class="asciidoc-tooltip">No operation.</span></span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="asciidoc-tooltip-wrapper"><code>log-and-close</code><span class="asciidoc-tooltip">Log the error message and close the connection.</span></span></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-security-auth-failure-redirect-url"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-security-auth-failure-redirect-url"><code>quarkus.websockets-next.server.security.auth-failure-redirect-url</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.security.auth-failure-redirect-url' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-24" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>Quarkus redirects HTTP handshake request to this URL if an HTTP upgrade is rejected due to the authorization failure. This configuration property takes effect when you secure endpoint with a standard security annotation. For example, the HTTP upgrade is secured if an endpoint class is annotated with the <code>@RolesAllowed</code> annotation.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75015">QUARKUS_WEBSOCKETS_NEXT_SERVER_SECURITY_AUTH_FAILURE_REDIRECT_URL</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75015" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-dev-mode-connection-messages-limit"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-dev-mode-connection-messages-limit"><code>quarkus.websockets-next.server.dev-mode.connection-messages-limit</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.dev-mode.connection-messages-limit' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-25" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The limit of messages kept for a Dev UI connection. If less than zero then no messages are stored and sent to the Dev UI view.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75016">QUARKUS_WEBSOCKETS_NEXT_SERVER_DEV_MODE_CONNECTION_MESSAGES_LIMIT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75016" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1000</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-traffic-logging-enabled"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-traffic-logging-enabled"><code>quarkus.websockets-next.server.traffic-logging.enabled</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.traffic-logging.enabled' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-26" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If set to true then binary/text messages received/sent are logged if the <code>DEBUG</code> level is enabled for the logger <code>io.quarkus.websockets.next.traffic</code>.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75017">QUARKUS_WEBSOCKETS_NEXT_SERVER_TRAFFIC_LOGGING_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75017" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-traffic-logging-text-payload-limit"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-traffic-logging-text-payload-limit"><code>quarkus.websockets-next.server.traffic-logging.text-payload-limit</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.traffic-logging.text-payload-limit' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-27" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>The number of characters of a text message which will be logged if traffic logging is enabled. The payload of a binary message is never logged.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75018">QUARKUS_WEBSOCKETS_NEXT_SERVER_TRAFFIC_LOGGING_TEXT_PAYLOAD_LIMIT</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75018" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>100</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-traces-enabled"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-traces-enabled"><code>quarkus.websockets-next.server.traces.enabled</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.traces.enabled' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-28" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If collection of WebSocket traces is enabled. Only applicable when the OpenTelemetry extension is present.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75019">QUARKUS_WEBSOCKETS_NEXT_SERVER_TRACES_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75019" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr class="row-collapsible row-collapsed row-with-desc odd">
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-websockets-next_quarkus-websockets-next-server-metrics-enabled"></a> <span class="property-path"><a href="#quarkus-websockets-next_quarkus-websockets-next-server-metrics-enabled"><code>quarkus.websockets-next.server.metrics.enabled</code></a></span>
<button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-text='quarkus.websockets-next.server.metrics.enabled' title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
<div id="conf-collapsible-desc-29" class="openblock description description-collapsed">
<div class="content">
<div class="paragraph">
<p>If collection of WebSocket metrics is enabled. Only applicable when the Micrometer extension is present.</p>
</div>
<div class="paragraph">
<p>Environment variable: <code id="env-var-75020">QUARKUS_WEBSOCKETS_NEXT_SERVER_METRICS_ENABLED</code><button class="btn-copy fa fa-clipboard inline-btn-copy" data-clipboard-action="copy" data-clipboard-target="#env-var-75020" title="Copy to clipboard" do-not-collapse="true"></button></p>
</div>
</div>
</div>
<div class="paragraph description-decoration">
<p><i class="fa fa-chevron-down"></i><span>Show more</span></p>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div id="duration-note-anchor-quarkus-websockets-next_quarkus-websockets-next" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">About the Duration format</div>
<div class="paragraph">
<p>To write duration values, use the standard <code>java.time.Duration</code> format.
See the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Duration.html#parse(java.lang.CharSequence)">Duration#parse() Java API documentation</a> for more information.</p>
</div>
<div class="paragraph">
<p>You can also use a simplified format, starting with a number:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the value is only a number, it represents time in seconds.</p>
</li>
<li>
<p>If the value is a number followed by <code>ms</code>, it represents time in milliseconds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other cases, the simplified format is translated to the <code>java.time.Duration</code> format for parsing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the value is a number followed by <code>h</code>, <code>m</code>, or <code>s</code>, it is prefixed with <code>PT</code>.</p>
</li>
<li>
<p>If the value is a number followed by <code>d</code>, it is prefixed with <code>P</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#the-websocket-protocol">1. The WebSocket protocol</a></li>
<li><a href="#http-and-websocket-architecture-styles">2. HTTP and WebSocket architecture styles</a></li>
<li><a href="#quarkus-websockets-vs-quarkus-websockets-next">3. Quarkus WebSockets vs. Quarkus WebSockets Next</a></li>
<li><a href="#project-setup">4. Project setup</a></li>
<li><a href="#endpoints">5. Endpoints</a>
<ul class="sectlevel2">
<li><a href="#server-endpoints">5.1. Server endpoints</a></li>
<li><a href="#client-endpoints">5.2. Client endpoints</a></li>
<li><a href="#path-parameters">5.3. Path parameters</a></li>
<li><a href="#cdi-scopes">5.4. CDI scopes</a></li>
<li><a href="#callback-methods">5.5. Callback methods</a></li>
<li><a href="#processing-messages">5.6. Processing messages</a></li>
<li><a href="#error-handling">5.7. Error handling</a></li>
<li><a href="#serialization">5.8. Serialization and deserialization</a></li>
<li><a href="#pingpong-messages">5.9. Ping/Pong messages</a></li>
<li><a href="#inbound-processing-mode">5.10. Inbound processing mode</a></li>
</ul>
</li>
<li><a href="#server-api">6. Server API</a>
<ul class="sectlevel2">
<li><a href="#http-server-configuration">6.1. HTTP server configuration</a></li>
<li><a href="#sub-websockets-endpoints">6.2. Sub-websockets endpoints</a></li>
<li><a href="#ws-connection">6.3. WebSocket connection</a></li>
<li><a href="#websocket-next-security">6.4. Security</a></li>
<li><a href="#inspect-andor-reject-http-upgrade">6.5. Inspect and/or reject HTTP upgrade</a></li>
<li><a href="#tls">6.6. TLS</a></li>
<li><a href="#hibernate-multitenancy">6.7. Hibernate multitenancy</a></li>
</ul>
</li>
<li><a href="#client-api">7. Client API</a>
<ul class="sectlevel2">
<li><a href="#client-connectors">7.1. Client connectors</a></li>
<li><a href="#ws-client-connection">7.2. WebSocket client connection</a></li>
<li><a href="#configuring-ssltls">7.3. Configuring SSL/TLS</a></li>
</ul>
</li>
<li><a href="#traffic-logging">8. Traffic logging</a></li>
<li><a href="#subscribe-or-not-subscribe">9. When to subscribe to a <code>Uni</code> or <code>Multi</code></a></li>
<li><a href="#telemetry">10. Telemetry</a></li>
<li><a href="#websocket-next-configuration-reference">11. Configuration reference</a></li>
</ul></div>
    </div>
  </div>
  <h2>Related content</h2>
  <div class="grid-wrapper relations">
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same extensions</h3>
      <ul class="related-content">
      
        
        <li class="tutorial"><a href="/version/main/guides/websockets-next-tutorial">Getting started with WebSockets Next</a></li>
      </ul>
    </div>
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same topics</h3>
      <ul class="related-content">
      
        
        <li class="tutorial"><a href="/version/main/guides/websockets-next-tutorial">Getting started with WebSockets Next</a></li>
      
        
        <li class="guide"><a href="/version/main/guides/websockets">Using WebSockets with Undertow</a></li>
      
        
        <li class="reference"><a href="/version/main/guides/http-reference">HTTP Reference</a></li>
      
        
        <li class="reference"><a href="/version/main/guides/load-shedding-reference">Load Shedding reference guide</a></li>
      
        
        <li class="guide"><a href="/version/main/guides/web">Quarkus for the Web</a></li>
      
        
        <li class="guide"><a href="/version/main/guides/reactive-routes">Using Reactive Routes</a></li>
      
        
        <li class="guide"><a href="/version/main/guides/web-dependency-locator">Web dependency locator</a></li>
      </ul>
    </div>
    </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="/brand" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
