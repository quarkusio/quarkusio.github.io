<!DOCTYPE html>
<html lang="en">







<head>
  <title>Migrate from Vert.x OIDC to Quarkus OIDC - main - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com https://ajax.googleapis.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />

  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration" />
  <meta property="og:title" content="Migrate from Vert.x OIDC to Quarkus OIDC - main" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/security-vertx-oidc-to-quarkus-oidc-migration">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  
  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">WHAT IS QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">DEVELOPER JOY</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">STANDARDS</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTAINER FIRST</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">GET STARTED</a></li>
          <li><a href="/guides" class="active">DOCUMENTATION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">BOOKS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
          <li><a href="https://quarkus.io/extensions/" class="">BROWSE EXTENSIONS</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USE EXTENSIONS</a></li>
          <li><a href="/guides/writing-extensions" class="">CREATE EXTENSIONS</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">SHARE EXTENSIONS</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SUPPORT</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSSION</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">ROADMAP</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">START CODING</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/main/guides/security-vertx-oidc-to-quarkus-oidc-migration">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    







<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/main/guides/"> Back to Guides</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" selected>Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.31.4 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        
        
        
        
        
        
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <a class="editlink" href="https://github.com/quarkusio/quarkus/edit/main/docs/src/main/asciidoc/security-vertx-oidc-to-quarkus-oidc-migration.adoc">Edit this Page</a>
      
      <h1 class="text-caps">Migrate from Vert.x OIDC to Quarkus OIDC </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Learn how to migrate your Vert.x OIDC application to Quarkus and choose to either retain Vert.x OIDC or replace it with Quarkus OIDC.</p>
</div>
<div class="paragraph">
<p>We will start with an original Vert.x <a href="https://how-to.vertx.io/web-and-oauth2-oidc/">Securing a Web Application with OAuth2/OpenID Connect</a> <code>how-to</code> tutorial which shows how a <a href="https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/authenticating-to-the-rest-api-with-an-oauth-app">GitHub OAuth2 application</a> can be implemented with Vert.x OIDC. You may have already worked through this tutorial before as a Vert.x OIDC user.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Even though GitHub supports <code>OAuth2</code> only, we will use a <code>Vert.x OIDC</code> term.
OIDC is built on top of OAuth2 and the Vert.x <a href="https://how-to.vertx.io/web-and-oauth2-oidc/">Securing a Web Application with OAuth2/OpenID Connect</a> tutorial also <a href="https://how-to.vertx.io/web-and-oauth2-oidc/#openid-connect">talks about OIDC</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, you will learn how to migrate the Vert.x application to Quarkus, while <code>completely retaining</code> the Vert.x OIDC code.</p>
</div>
<div class="paragraph">
<p>Finally, an option of replacing the Vert.x OIDC with Quarkus OIDC will be explained for you to analyze and consider implementing it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vertx-oidc-vertx"><a class="anchor" href="#vertx-oidc-vertx"></a>Vert.x OIDC on Vert.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s start with the <a href="https://how-to.vertx.io/web-and-oauth2-oidc/">Securing a Web Application with OAuth2/OpenID Connect</a> <code>how-to</code> tutorial.</p>
</div>
<div class="paragraph">
<p><a href="https://how-to.vertx.io/web-and-oauth2-oidc/#create-a-project">Create the project</a>, you should end up with a <code>pom.xml</code> which contains the following properties and dependencies:</p>
</div>
<div class="listingblock xml">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;project&gt;
  &lt;groupId&gt;howto&lt;/groupId&gt;
  &lt;artifactId&gt;oauth-oidc&lt;/artifactId&gt;
  &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;

  &lt;properties&gt;
    &lt;! ... --&gt;
    &lt;vertx.version&gt;5.0.16&lt;/vertx.version&gt;
    &lt;main.verticle&gt;howto.oauth_oidc.MainVerticle&lt;/main.verticle&gt;
    &lt;launcher.class&gt;io.vertx.launcher.application.VertxApplication&lt;/launcher.class&gt;
  &lt;/properties&gt;

  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;io.vertx&lt;/groupId&gt;
        &lt;artifactId&gt;vertx-stack-depchain&lt;/artifactId&gt;
        &lt;version&gt;${vertx.version}&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.vertx&lt;/groupId&gt;
      &lt;artifactId&gt;vertx-launcher-application&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.vertx&lt;/groupId&gt;
      &lt;artifactId&gt;vertx-web-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.vertx&lt;/groupId&gt;
      &lt;artifactId&gt;vertx-web-templ-handlebars&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.vertx&lt;/groupId&gt;
      &lt;artifactId&gt;vertx-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.vertx&lt;/groupId&gt;
      &lt;artifactId&gt;vertx-auth-oauth2&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;! ... --&gt;
  &lt;/dependencies&gt;
  &lt;! ... --&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Register the GitHub application as described in the <a href="https://how-to.vertx.io/web-and-oauth2-oidc/">Securing a Web Application with OAuth2/OpenID Connect</a> tutorial, the only difference is that you should register a <code><a href="http://localhost:8080/login" class="bare">http://localhost:8080/login</a></code> callback url, instead of <code><a href="http://localhost:8080/callback" class="bare">http://localhost:8080/callback</a></code>.</p>
</div>
<div class="paragraph">
<p>The final version of the <code>MainVerticle</code> Java class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package howto.oauth_oidc;

import io.vertx.core.Future;
import io.vertx.core.VerticleBase;
import io.vertx.ext.auth.authorization.PermissionBasedAuthorization;
import io.vertx.ext.auth.oauth2.OAuth2Auth;
import io.vertx.ext.auth.oauth2.authorization.ScopeAuthorization;
import io.vertx.ext.auth.oauth2.providers.GithubAuth;
import io.vertx.ext.web.Router;
import io.vertx.ext.web.handler.AuthorizationHandler;
import io.vertx.ext.web.handler.OAuth2AuthHandler;
import io.vertx.ext.web.handler.SessionHandler;
import io.vertx.ext.web.sstore.LocalSessionStore;
import io.vertx.ext.web.templ.handlebars.HandlebarsTemplateEngine;

public class MainVerticle extends VerticleBase {

    private static final String CLIENT_ID = System.getenv("GITHUB_CLIENT_ID");
    private static final String CLIENT_SECRET = System.getenv("GITHUB_CLIENT_SECRET");

    @Override
    public Future&lt;?&gt; start() {

        HandlebarsTemplateEngine engine = HandlebarsTemplateEngine.create(vertx); <i class="conum" data-value="1"></i><b>(1)</b>

        Router router = Router.router(vertx); <i class="conum" data-value="2"></i><b>(2)</b>

        router.route().handler(SessionHandler.create(LocalSessionStore.create(vertx))); <i class="conum" data-value="3"></i><b>(3)</b>

        router.get("/").handler(ctx -&gt; { <i class="conum" data-value="4"></i><b>(4)</b>
            // we pass the client id to the template
            ctx.put("client_id", CLIENT_ID);
            // and now delegate to the engine to render it.
            engine.render(ctx.data(), "views/index.hbs").onSuccess(buffer -&gt; {
                ctx.response().putHeader("Content-Type", "text/html").end(buffer);
            }).onFailure(ctx::fail);
        });

        OAuth2Auth authProvider = GithubAuth.create(vertx, CLIENT_ID, CLIENT_SECRET); <i class="conum" data-value="5"></i><b>(5)</b>

        router.get("/protected").handler(

                OAuth2AuthHandler.create(vertx, authProvider, "http://localhost:8080/login")
                        .setupCallback(router.route("/login")).withScope("user:email")) <i class="conum" data-value="6"></i><b>(6)</b>
                .handler(AuthorizationHandler.create(PermissionBasedAuthorization.create("user:email"))
                        .addAuthorizationProvider(ScopeAuthorization.create(" "))) <i class="conum" data-value="7"></i><b>(7)</b>
                .handler(new ProtectedProfileHandler(authProvider, engine)); <i class="conum" data-value="8"></i><b>(8)</b>

        return vertx.createHttpServer().requestHandler(router).listen(Integer.getInteger("port", 8080))
                .onSuccess(server -&gt; System.out.println("HTTP server started on port: " + server.actualPort()));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize Handlebars templating engine.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create Vert.x router.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register Vert.x OIDC session handler which keeps the session details in memory.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create a route handler to support a welcome page at the <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code> address.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Initialize OAuth2 GitHub provider with a Vert.x instance, and GitHub client id and secret properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Register OAuth2 handler to secure the <code><a href="http://localhost:8080/protected" class="bare">http://localhost:8080/protected</a></code> endpoint. This handler uses the GitHub provider to authenticate users and requests a <code>user:email</code> scope when redirecting users to GitHub. The handler is set up with a callback route which uses a returned authorizaion code and the provided <code><a href="http://localhost:8080/login" class="bare">http://localhost:8080/login</a></code> redirect URL to complete the authorization code flow and acquire a GitHub access token.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Do not allow access to the <code><a href="http://localhost:8080/protected" class="bare">http://localhost:8080/protected</a></code> endpoint if the GitHub access token does not have a <code>user:email</code> scope. Please note that while the <code>PermissionBasedAuthorization</code> capability to constrain access tokens is great, applying it in the context of this application is not necessary: authorization code flow access tokens, and GitHub access tokens in particular, are not meant to control access to the application that acquired them but for this application to use them on behalf of the authenticated user to access another API, such as GitHub API, as indeed, is demonsrtated below.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ProtectedProfileHandler</code> Java class returns a list of user emails and looks exactly as shown in the <a href="https://how-to.vertx.io/web-and-oauth2-oidc/#create-a-project">Securing a Web Application with OAuth2/OpenID Connect</a> tutorial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package howto.oauth_oidc;

import io.vertx.core.Handler;
import io.vertx.ext.auth.authentication.TokenCredentials;
import io.vertx.ext.auth.oauth2.OAuth2Auth;
import io.vertx.ext.web.RoutingContext;
import io.vertx.ext.web.client.WebClient;
import io.vertx.ext.web.codec.BodyCodec;
import io.vertx.ext.web.templ.handlebars.HandlebarsTemplateEngine;

class ProtectedProfileHandler implements Handler&lt;RoutingContext&gt; {

    private final OAuth2Auth authProvider;
    private final HandlebarsTemplateEngine engine;

    ProtectedProfileHandler(OAuth2Auth authProvider, HandlebarsTemplateEngine engine) {
        this.authProvider = authProvider;
        this.engine = engine;
    }

    @Override
    public void handle(RoutingContext ctx) {
        authProvider.userInfo(ctx.user())
                .onFailure(err -&gt; {
                    ctx.session().destroy();
                    ctx.fail(err);
                }).onSuccess(userInfo -&gt; {
                    WebClient.create(ctx.vertx()).getAbs("https://api.github.com/user/emails") <i class="conum" data-value="1"></i><b>(1)</b>
                            .authentication(new TokenCredentials(ctx.user().&lt;String&gt;get("access_token"))) <i class="conum" data-value="2"></i><b>(2)</b>
                            .as(BodyCodec.jsonArray()).send().onFailure(err -&gt; {
                                ctx.session().destroy();
                                ctx.fail(err);
                            }).onSuccess(res -&gt; {
                                userInfo.put("private_emails", res.body());
                                // we pass the client info to the template
                                ctx.put("userInfo", userInfo); <i class="conum" data-value="3"></i><b>(3)</b>
                                // and now delegate to the engine to render it.
                                engine.render(ctx.data(), "views/protected.hbs").onSuccess(buffer -&gt; {
                                    ctx.response().putHeader("Content-Type", "text/html").end(buffer);
                                }).onFailure(err -&gt; {
                                    ctx.session().destroy();
                                    ctx.fail(err);
                                });
                            });
                });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fetch the user emails with Vert.x WebClient</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the GitHub access token to access GitHub API</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Update UserInfo with a JSON array containing private emails and pass it to the <code>protected.hbs</code> template.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, create <code>index.hbs</code> and <code>protected.hbs</code> templates in the <code>src/main/resources/views</code> directory, copy their content from the <a href="https://how-to.vertx.io/web-and-oauth2-oidc/#create-a-project">Securing a Web Application with OAuth2/OpenID Connect</a> tutorial.</p>
</div>
<div class="paragraph">
<p>Compile and run the application as <code>java -jar target/oauth-oidc-1.0.0-SNAPSHOT-fat.jar</code>, go to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code> and follow the <a href="https://how-to.vertx.io/web-and-oauth2-oidc/#create-a-project">Securing a Web Application with OAuth2/OpenID Connect</a> tutorial to login to GitHub and get your GitHub account email(s) displayed.</p>
</div>
<div class="paragraph">
<p>When you accessed the <code><a href="http://localhost:8080/protected" class="bare">http://localhost:8080/protected</a></code> page the first time, the following redirects happened:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You were redirected by Vert.x OIDC to GitHub to login.</p>
</li>
<li>
<p>You were redirected by GitHub to the <code><a href="http://localhost:8080/login" class="bare">http://localhost:8080/login</a></code> callback route handler which completed the authorization code flow and acquired the GitHub access token.</p>
</li>
<li>
<p>You were redirected by Vert.x OIDC to the <code>original</code> request URL, <code><a href="http://localhost:8080/protected" class="bare">http://localhost:8080/protected</a></code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vertx-oidc-quarkus"><a class="anchor" href="#vertx-oidc-quarkus"></a>Vert.x OIDC on Quarkus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have worked through the original <a href="https://how-to.vertx.io/web-and-oauth2-oidc/#create-a-project">Securing a Web Application with OAuth2/OpenID Connect</a> tutorial in the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> section, and now we can start planning moving the Vert.x applicaton to Quarkus, while retaining Vert.x OIDC.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s update <code>pom.xml</code> as follows:</p>
</div>
<div class="listingblock xml">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;project&gt;
  &lt;groupId&gt;howto&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-oauth-oidc&lt;/artifactId&gt;
  &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;

  &lt;properties&gt;
    &lt;! ... --&gt;
    &lt;quarkus.platform.artifact-id&gt;quarkus-bom&lt;/quarkus.platform.artifact-id&gt;
    &lt;quarkus.platform.group-id&gt;io.quarkus&lt;/quarkus.platform.group-id&gt;
    &lt;quarkus.platform.version&gt;3.24.0&lt;/quarkus.platform.version&gt;
  &lt;/properties&gt;

  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;${quarkus.platform.group-id}&lt;/groupId&gt;
        &lt;artifactId&gt;${quarkus.platform.artifact-id}&lt;/artifactId&gt;
        &lt;version&gt;${quarkus.platform.version}&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;

  &lt;dependencies&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-vertx-http&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-qute&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.vertx&lt;/groupId&gt;
          &lt;artifactId&gt;vertx-web-client&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.vertx&lt;/groupId&gt;
          &lt;artifactId&gt;vertx-auth-oauth2&lt;/artifactId&gt;
      &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;! ... --&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compared to the pom.xml from the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> section, this pom.xml retains only two original Vert.x dependencies in the <code>io.vertx</code> group, <code>vertx-web-client</code> to support GitHub API calls, and <code>vertx-auth-oauth2</code> to continue securing the protected endpoint with the Vert.x GitHub OAuth2 provider.</p>
</div>
<div class="paragraph">
<p>We also introduce two Quarkus dependencies in the <code>io.quarkus</code> group, <code>quarkus-vertx-http</code>, and <code>quarkus-qute</code> which provides <a href="https://quarkus.io/guides/qute">Qute Templating Engine</a> and replaces the Handlebars engine used in the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> section.</p>
</div>
<div class="paragraph">
<p>The <code>MainVerticle</code> Java class has been converted to a CDI <code>ApplicationScoped</code> <code>GitHubProfileService</code> Java bean class which registeres the Vert.x route and handlers on the start-up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package howto.oauth_oidc;

import org.eclipse.microprofile.config.inject.ConfigProperty;

import io.quarkus.qute.Template;
import io.vertx.core.Vertx;
import io.vertx.ext.auth.authorization.PermissionBasedAuthorization;
import io.vertx.ext.auth.oauth2.OAuth2Auth;
import io.vertx.ext.auth.oauth2.authorization.ScopeAuthorization;
import io.vertx.ext.auth.oauth2.providers.GithubAuth;
import io.vertx.ext.web.Router;
import io.vertx.ext.web.handler.AuthorizationHandler;
import io.vertx.ext.web.handler.OAuth2AuthHandler;
import io.vertx.ext.web.handler.SessionHandler;
import io.vertx.ext.web.sstore.LocalSessionStore;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.enterprise.event.Observes;
import jakarta.inject.Inject;

@ApplicationScoped
public class GitHubProfileService {

    OAuth2Auth authProvider;
    @Inject
    Template userEmail;

    public GithubProfileService(Vertx vertx,
            @ConfigProperty(name = "github_client_id") String githubClientId,
            @ConfigProperty(name = "github_client_secret") String githubClientSecret) {
        authProvider = GithubAuth.create(vertx, githubClientId, githubClientSecret); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    void start(@Observes Router router, Vertx vertx) { <i class="conum" data-value="2"></i><b>(2)</b>

        router.route().handler(SessionHandler.create(LocalSessionStore.create(vertx)));

        router.get("/protected").handler(
                OAuth2AuthHandler.create(vertx, authProvider, "http://localhost:8080/login")
                        .setupCallback(router.route("/login")).withScope("user:email"))
                .handler(AuthorizationHandler.create(PermissionBasedAuthorization.create("user:email"))
                        .addAuthorizationProvider(ScopeAuthorization.create(" ")))
                .handler(new ProtectedProfileHandler(authProvider, userEmail)); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize OAuth2 GitHub provider with an injected Vert.x instance, and GitHub client id and secret properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Setup a router at the start up, nearly exactly as it was done in the <code>MainVerticle</code> class in the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> section, with only a small difference, see the next point.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Pass the injected Qute <code>userEmail</code> template to the <code>ProtectedProfileHandler</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ProtectedProfileHandler</code> Java class remains similar to how it was implemented in the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> section, but now it works with the Qute template and looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package howto.oauth_oidc;

import io.quarkus.qute.Template;
import io.vertx.core.Handler;
import io.vertx.ext.auth.authentication.TokenCredentials;
import io.vertx.ext.auth.oauth2.OAuth2Auth;
import io.vertx.ext.web.RoutingContext;
import io.vertx.ext.web.client.WebClient;
import io.vertx.ext.web.codec.BodyCodec;

class ProtectedProfileHandler implements Handler&lt;RoutingContext&gt; {

    private final OAuth2Auth authProvider;
    private final Template userEmail;

    ProtectedProfileHandler(OAuth2Auth authProvider, Template userEmail) {
        this.authProvider = authProvider;
        this.userEmail = userEmail;
    }

    @Override
    public void handle(RoutingContext ctx) {
        authProvider.userInfo(ctx.user()).onSuccess(userInfo -&gt; {
            // fetch the user emails from the github API
            WebClient.create(ctx.vertx()).getAbs("https://api.github.com/user/emails") <i class="conum" data-value="1"></i><b>(1)</b>
                    .authentication(new TokenCredentials(ctx.user().&lt;String&gt;get("access_token"))) <i class="conum" data-value="2"></i><b>(2)</b>
                    .as(BodyCodec.jsonArray()).send().onSuccess(res -&gt; {
                        userInfo.put("private_emails", res.body());

                        userEmail.data("userInfo", userInfo).renderAsync() <i class="conum" data-value="3"></i><b>(3)</b>
                           .whenComplete((result, failure) -&gt; {
		               if (failure == null) {
		                   ctx.response().putHeader("Content-Type", "text/html").end(result);
		               } else {
		                   ctx.session().destroy();
		                   ctx.fail(failure);
		               }
                           });
                    });
        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fetch the user emails with Vert.x WebClient</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the GitHub access token to access GitHub API</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Update UserInfo with a JSON array containing private emails, pass it to the <code>userEmail</code> template and render it asynchronously.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>index.hbs</code> has been renamed to the <code>index.html</code> Qute template and moved to the <code>src/main/resources/META-INF/resources/</code> directory, its content remains the same.</p>
</div>
<div class="paragraph">
<p>The <code>protected.hbs</code> has been converted to the <code>userEmail.html</code> Qute template and moved to the <code>src/main/templates</code> directory. It has been updated to follow Qute rules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;html lang="en"&gt;
&lt;body&gt;
&lt;p&gt;Well, well, well, {userInfo.login}!&lt;/p&gt;
&lt;p&gt;
  {#if userInfo.email} It looks like your public email
    address is {userInfo.email}.
  {#else} It looks like you don't have a public email.
    That's cool.
  {/if}
&lt;/p&gt;
&lt;p&gt;
  {#if userInfo.containsKey('private_emails')}
    With your permission, we were also able to dig up your
    private email addresses:
    {#for email in userInfo.private_emails}
      {email.email}
      {#if email_hasNext},{/if}
    {/for}
  {#else}
    Also, you're a bit secretive about your private email
    addresses.
  {/if}
&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This simple template is quite similar to the Handlebars template you created in the the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> section. Please see the <a href="https://quarkus.io/guides/qute-reference">Qute Reference Guide</a> for more details.</p>
</div>
<div class="paragraph">
<p>Now, you can compile and run the application but let&#8217;s start it the dev mode with <code>mvn quarkus:dev</code>.</p>
</div>
<div class="paragraph">
<p>Go to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code> and follow the <a href="https://how-to.vertx.io/web-and-oauth2-oidc/#create-a-project">Securing a Web Application with OAuth2/OpenID Connect</a> tutorial to login to GitHub and get your GitHub account email(s) displayed.</p>
</div>
<div class="paragraph">
<p>The same sequence of redirects that is described in the end of the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> section also happened in this application, after you accessed <code><a href="http://localhost:8080/protected" class="bare">http://localhost:8080/protected</a></code>.</p>
</div>
<div class="paragraph">
<p>At this point, if you prefer, you can continue learning working with Quarkus, while keeping your existing Veert.x OIDC code.</p>
</div>
<div class="paragraph">
<p>You may also want to have a look at <a href="https://quarkus.io/guides/security-authorize-web-endpoints-reference">how to apply authorization rules to the HTTP request paths</a>, without having to use annotations.</p>
</div>
<div class="paragraph">
<p>If you would like to learn how to migrate Vert.x OIDC to Quarkus OIDC, please follow to the next <a href="#vertx-oidc-to-quarkus-oidc">Migrate to Quarkus OIDC</a> section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vertx-oidc-to-quarkus-oidc"><a class="anchor" href="#vertx-oidc-to-quarkus-oidc"></a>Migrate to Quarkus OIDC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We started with working through the original <a href="https://how-to.vertx.io/web-and-oauth2-oidc/#create-a-project">Securing a Web Application with OAuth2/OpenID Connect</a> tutorial in the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> section. And in the <a href="#vertx-oidc-quarkus">Vert.x OIDC on Quarkus</a> section, we converted it to run on Quarkus, while retaining Vert.x OIDC.</p>
</div>
<div class="paragraph">
<p>In this section, you are going to learn how the Vert.x OIDC code can be converted to Quarkus OIDC.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with updating the <code>pom.xml</code>, it should look like this:</p>
</div>
<div class="listingblock xml">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;project&gt;
  &lt;groupId&gt;howto&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-oauth-oidc&lt;/artifactId&gt;
  &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;

  &lt;properties&gt;
    &lt;! ... --&gt;
    &lt;quarkus.platform.artifact-id&gt;quarkus-bom&lt;/quarkus.platform.artifact-id&gt;
    &lt;quarkus.platform.group-id&gt;io.quarkus&lt;/quarkus.platform.group-id&gt;
    &lt;quarkus.platform.version&gt;3.24.0&lt;/quarkus.platform.version&gt;
  &lt;/properties&gt;

  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;${quarkus.platform.group-id}&lt;/groupId&gt;
        &lt;artifactId&gt;${quarkus.platform.artifact-id}&lt;/artifactId&gt;
        &lt;version&gt;${quarkus.platform.version}&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;

  &lt;dependencies&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-vertx-http&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-qute&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-oidc&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-rest&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-rest-qute&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-rest-client-jackson&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-rest-client-oidc-token-propagation&lt;/artifactId&gt;
      &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;! ... --&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compared to the pom.xml from the <a href="#vertx-oidc-quarkus">Vert.x OIDC on Quarkus</a> section above, this pom.xml no longer has dependencies in the <code>io.vertx</code> group but retains two Quarkus dependencies in the <code>io.quarkus</code> group, <code>quarkus-vertx-http</code> and <code>quarkus-qute</code>, and adds several more Quarkus dependencies.</p>
</div>
<div class="paragraph">
<p>The <code>quarkus-oidc</code> extension is used to protect the secured endpoint and manage the GitHub OAuth2 authentication.
The <code>quarkus-rest</code> extension is used to support JAX-RS REST endpoints, while the <code>quarkus-rest-qute</code> extension makes it easier to render Qute templates with JAX-RS.</p>
</div>
<div class="paragraph">
<p>The <code>quarkus-rest-client-oidc-token-propagation</code> extension supports an easy access token propagation with the REST client, and the <code>quarkus-rest-client-jackson</code> helps to convert REST client responses in JSON format to Java beans and records with Jackson.</p>
</div>
<div class="paragraph">
<p>The <code>GitHubProfileService</code> has now become a JAX-RS REST class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package howto.oauth_oidc;

import java.util.Set;
import java.util.function.Function;

import org.eclipse.microprofile.rest.client.inject.RestClient;

import howto.oauth_oidc.GitHubApiClient.Email;
import io.quarkus.oidc.OidcSession;
import io.quarkus.oidc.UserInfo;
import io.quarkus.qute.Template;
import io.quarkus.qute.TemplateInstance;
import io.quarkus.security.Authenticated;
import io.smallrye.mutiny.Uni;
import jakarta.inject.Inject;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.NotAuthorizedException;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.Response;

@Path("/protected")
@Authenticated <i class="conum" data-value="1"></i><b>(1)</b>
public class GitHubProfileService {

    @Inject
    Template userEmail;

    @Inject
    UserInfo userInfo; <i class="conum" data-value="2"></i><b>(2)</b>

    @Inject
    @RestClient
    GitHubApiClient gitHubApiClient; <i class="conum" data-value="3"></i><b>(3)</b>

    @Inject
    OidcSession oidcSession; <i class="conum" data-value="4"></i><b>(4)</b>

    @GET
    @Produces("text/html")
    public Uni&lt;TemplateInstance&gt; getEmail() { <i class="conum" data-value="5"></i><b>(5)</b>
        return gitHubApiClient.userEmails() <i class="conum" data-value="6"></i><b>(6)</b>
            .onItemOrFailure().transformToUni((emails, throwable) -&gt; {
                if (throwable == null) {
                    return Uni.createFrom().item(toUserEmails(emails)); <i class="conum" data-value="7"></i><b>(7)</b>
                }
                return oidcSession.logout(). <i class="conum" data-value="8"></i><b>(8)</b>
                    onItem().transform(new Function&lt;Void, TemplateInstance&gt;() {
                        @Override
                        public TemplateInstance apply(Void t) {
                            throw new NotAuthorizedException(Response.status(401).build());
                        }
                    });
        });
    }

    private TemplateInstance toUserEmails(Set&lt;Email&gt; emails) { <i class="conum" data-value="7"></i><b>(7)</b>
        return userEmail.data("name", userInfo.getName()).data("email", userInfo.getEmail())
                .data("private_emails", emails);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Require an authenticated access to the <code>/protected</code> endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject GitHub specific UserInfo representation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject GitHub API REST client that is used to request user emails.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Inject the current OIDC session.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>JAX-RS method that returns a <code>userEmail</code> template instance to be rendered. You do not have to use <code>Uni</code> but since you are migrating from Vert.x, you are surely very comfortable with the reactive code supported by <code>Uni</code> in Quarkus.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use the injected REST client to access GitHub API and request the private user emails</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>If the request to the GitHub API succeeded, initialize a template instance with the user email and the returned set of the private email addresses</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>If the request to the GitHub API failed, clear a session cookie by performing a local session logout and return HTTP 401 status.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To acquire the private user emails, <code>GitHubApiClient</code> REST Client is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package howto.oauth_oidc;

import java.util.Set;

import org.eclipse.microprofile.rest.client.inject.RegisterRestClient;

import io.quarkus.oidc.token.propagation.common.AccessToken;
import io.smallrye.mutiny.Uni;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

@RegisterRestClient(configKey = "github-api-client") <i class="conum" data-value="1"></i><b>(1)</b>
@Path("/")
@AccessToken <i class="conum" data-value="2"></i><b>(2)</b>
public interface GitHubApiClient {

    @GET
    @Produces(MediaType.APPLICATION_JSON)
    @Path("user/emails")
    Uni&lt;Set&lt;Email&gt;&gt; userEmails(); <i class="conum" data-value="3"></i><b>(3)</b>

    record Email(String email) {

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Register a REST client, use the <code>github-api-client</code> configuration key</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Request the access token propagation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Return a set of private emails. As in the previous example, you do not have to use <code>Uni</code> but having <code>Uni</code> aligns better with the JAX-RS method which calls this method and returns a <code>Uni</code> response in the <code>GitHubProfileService</code> JAX-RS resource above.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration in the <code>application.properties</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-configuration hljs" data-lang="configuration">quarkus.oidc.provider=github <i class="conum" data-value="1"></i><b>(1)</b>
quarkus.oidc.client-id=${github_client_id}
quarkus.oidc.credentials.secret=${github_client_secret} <i class="conum" data-value="2"></i><b>(2)</b>

# By default, Quarkus GitHub provider submits the client id and secret in the HTTP Authorization header. <i class="conum" data-value="2"></i><b>(2)</b>
# However, GitHub may require that both client id and secret are submitted as form parameters instead.
# In this case, replace 'quarkus.oidc.credentials.secret=${github_client_secret}'
# with the following two properties:
#quarkus.oidc.credentials.client-secret.method=post
#quarkus.oidc.credentials.client-secret.value=${github_client_secret}

quarkus.oidc.authentication.redirect-path=/login <i class="conum" data-value="3"></i><b>(3)</b>
quarkus.oidc.authentication.restore-path-after-redirect=true <i class="conum" data-value="4"></i><b>(4)</b>

quarkus.http.auth.permission.login.paths=/login <i class="conum" data-value="5"></i><b>(5)</b>
quarkus.http.auth.permission.login.policy=authenticated

quarkus.rest-client.github-api-client.url=https://api.github.com <i class="conum" data-value="6"></i><b>(6)</b>

quarkus.rest-client.logging.scope=request-response <i class="conum" data-value="7"></i><b>(7)</b>
quarkus.rest-client.logging.body-limit=200
quarkus.log.category."org.jboss.resteasy.reactive.client.logging".level=DEBUG</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable the Quarkus GitHub provider</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By default, when the Quarkus GitHub provider acquires the access token, it sends the client id and secret as the encoded HTTP Authorization <code>Basic</code> scheme value. In some regions, GitHub may not support such an option, see the comment in the <code>application.properties</code> above how to enable a <code>client_secret_post</code> method instead, for the client id and secret be sent as form parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declare a callback <code>/login</code> path.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Restore the original <code>/protected</code> request path once the authorization code flow has been complete. You may recall that in the examples with Vert.x OIDC in the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> and <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> sections, the original request path is restored by default, without users having to do anything at all. However, by default, Quarkus OIDC gives access to the callback resource, <code>but only after it has completed the authorization code flow</code>, see the next <a href="#vertx-oidc-to-quarkus-oidc-custom-callback">Migrate to Quarkus OIDC with the custom callback method</a> section for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>In Quarkus security, the resource is secured if it is either annotated with one of the security annotations such as <code>@Authenticated</code> or its endpoint path is secured in the configured HTTP security policy. The <code>/login</code> callback resource is virtual - neither JAX-RS method nor an additional callback handler is allocated to process it, therefore it must be secured with the HTTP security policy configuration, for the Quarkus OIDC authentication mechanism to secure it.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Configure the <code>github-api-client</code> REST Client base URL.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Log REST Client request and response data.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>index.html</code> Qute template in the <code>src/main/resources/META-INF/resources/</code> directory and the <code>userEmail.html</code> Qute template in the <code>src/main/templates</code> directory remain unchanged.</p>
</div>
<div class="paragraph">
<p>Now, start the application in the dev mode with <code>mvn quarkus:dev</code>.</p>
</div>
<div class="paragraph">
<p>Go to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>, login to GitHub and get your GitHub account email(s) displayed.</p>
</div>
<div class="paragraph">
<p>When you accessed the <code><a href="http://localhost:8080/protected" class="bare">http://localhost:8080/protected</a></code> page the first time, the following redirects happened:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You were redirected by Quarkus OIDC to GitHub to login.</p>
</li>
<li>
<p>You were redirected by GitHub to the <code><a href="http://localhost:8080/login" class="bare">http://localhost:8080/login</a></code> virtual callback handler, Quarkus OIDC completed the authorization code flow and acquired the GitHub access token.</p>
</li>
<li>
<p>You were redirected by Quarkus OIDC to the <code>original</code> request URL, <code><a href="http://localhost:8080/protected" class="bare">http://localhost:8080/protected</a></code>. The OIDC redirect query parameters such as <code>code</code> and <code>state</code> are also dropped during this final redirect.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vertx-oidc-to-quarkus-oidc-custom-callback"><a class="anchor" href="#vertx-oidc-to-quarkus-oidc-custom-callback"></a>Migrate to Quarkus OIDC with the custom callback method</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When we worked with the first <a href="#vertx-oidc-to-quarkus-oidc">Vertx OIDC to Quarkus OIDC migration example</a>, we had to configure Quarkus OIDC to restore the original request URL, after the authorization code flow is complete.</p>
</div>
<div class="paragraph">
<p>In this section, we are going to look at the alternative, default option, where a custom callback handler is called, but after Quarkus OIDC has completed the authorization code flow.</p>
</div>
<div class="paragraph">
<p>Typically, in production, users that must login are guided to the central login URL first, as opposed to them accessing random secured paths and expecting to be returned to the very same original request paths, likely missing the context available from the central login endpoint. Instead, once the user lands at the secured central login page, this page redirects users further according to the application flow.</p>
</div>
<div class="paragraph">
<p>By nominating the central login endpoint as a callback URL, you have the authenticated users landing on this login endpoint once the authorization code flow is complete without requiring Quarkus OIDC to keep the original request URL as the authorization code flow state to be able to restore it, and also making it possible to secure the callback endpoints with the security annotations.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at how it can be done.</p>
</div>
<div class="paragraph">
<p>The dependencies remain the same as in <a href="#vertx-oidc-to-quarkus-oidc">Migrate to Quarkus OIDC</a> section, but we add one more JAX-RS resource that manages a login callback:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package howto.oauth_oidc;

import io.quarkus.security.Authenticated;
import jakarta.ws.rs.GET;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.Context;
import jakarta.ws.rs.core.Response;
import jakarta.ws.rs.core.UriInfo;

@Path("/login")
@Authenticated <i class="conum" data-value="1"></i><b>(1)</b>
public class LoginService {

    @GET
    public Response login(@Context UriInfo uriInfo) {
        return Response.seeOther(uriInfo.getBaseUriBuilder().path("protected").build()).build(); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>LoginService</code> is a secured callback handler which gets control once Quarkus OIDC completes the authorization code flow.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Do whatever is required by the application once the authenticated users land on this page. In this case, they are redirected to the secured <code>/protected</code> resource. This <code>/protected</code> endpoint may be an internal endpoint. If the secured <code>/protected</code> endpoint is also publicly accessible and unauthenticated users try to access it, then they will still land on this <code>LoginService</code> page first after authenticating with GitHub, and be redirected to the <code>/protected</code> page next.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>GitHubProfileService</code> and <code>GitHubApiClient</code> classes remain the same as in the <a href="#vertx-oidc-to-quarkus-oidc">Migrate to Quarkus OIDC</a> section.</p>
</div>
<div class="paragraph">
<p>The configuration looks much simpler now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-configuration hljs" data-lang="configuration">quarkus.oidc.provider=github <i class="conum" data-value="1"></i><b>(1)</b>
quarkus.oidc.client-id=${github_client_id}
quarkus.oidc.credentials.secret=${github_client_secret}

quarkus.oidc.authentication.redirect-path=/login <i class="conum" data-value="2"></i><b>(2)</b>

quarkus.rest-client.github-api-client.url=https://api.github.com <i class="conum" data-value="3"></i><b>(3)</b>

quarkus.rest-client.logging.scope=request-response <i class="conum" data-value="4"></i><b>(4)</b>
quarkus.rest-client.logging.body-limit=200
quarkus.log.category."org.jboss.resteasy.reactive.client.logging".level=DEBUG</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable the Quarkus GitHub provider</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare a callback <code>/login</code> path.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configure the <code>github-api-client</code> REST Client base URL.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Log REST Client request and response data.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>index.html</code> Qute template in the <code>src/main/resources/META-INF/resources/</code> directory and the <code>userEmail.html</code> Qute template in the <code>src/main/templates</code> directory remain unchanged.</p>
</div>
<div class="paragraph">
<p>Go to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>, login to GitHub and get your GitHub account email(s) displayed.</p>
</div>
<div class="paragraph">
<p>When you accessed the <code><a href="http://localhost:8080/protected" class="bare">http://localhost:8080/protected</a></code> page the first time, the following redirects happened:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You were redirected by Quarkus OIDC to GitHub to login</p>
</li>
<li>
<p>You were redirected by GitHub to the <code><a href="http://localhost:8080/login" class="bare">http://localhost:8080/login</a></code> callback handler, but Quarkus OIDC completes the authorization code flow and acquires the GitHub access token first.</p>
</li>
<li>
<p>Before the <code>/login</code> handler is given control, Quarkus OIDC removes the OIDC redirect <code>code</code> and <code>state</code> properties and redirects the user to the same <code>/login</code> endpoint - this is done to minimize a risk of these parameters remaining visible in the user browser if the applications returns an application error after completing the authorization code flow, with the <code>code</code> and <code>state</code> query parameters still present in the current browser view. If preferred, this final redirect can be disabled with <code>quarkus.oidc.authentication.remove-redirect-parameters=false</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enforce-github-access-token-scope-in-quarkus-oidc"><a class="anchor" href="#enforce-github-access-token-scope-in-quarkus-oidc"></a>Enforce GitHub access token scope in Quarkus OIDC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> and <a href="#vertx-oidc-quarkus">Vert.x OIDC on Quarkus</a> sections demonstrate how you can retrict access to the Vert.x OIDC application by enforcing that the GitHub access token has a <code>user:email</code> scope.</p>
</div>
<div class="paragraph">
<p>Also, in the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> section, we also commented that GitHub access tokens are meant to be used to access GitHub API, and not the application that acquired them, and therefore enforcing a GitHub access token <code>user:email</code> scope was not necessary.</p>
</div>
<div class="paragraph">
<p>If you do wish to continue enforcing a GitHub access token <code>user:email</code> scope after migrating to Quarkus OIDC, you can do as follows.</p>
</div>
<div class="paragraph">
<p>First, replace the <code>@Authenticated</code> annotation with <code>@PermissionsAllowed("user:email")</code>, with the latter implying the former and requiring a user authentication too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/protected")
@PermissionsAllowed("user:email") <i class="conum" data-value="1"></i><b>(1)</b>
public class GitHubProfileService {
//...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the following configuration property: <code>quarkus.oidc.roles.source=accesstoken</code>.</p>
</div>
<div class="paragraph">
<p>The reason you have to add this property is because with the authorization code flow, Quarkus OIDC treats the ID token as the primary token that controls access to the application into where the user has logged in, it uses the access token to access downstream services as required by the application on behalf of the authenticated user who authorized the application to do it.</p>
</div>
<div class="paragraph">
<p>When Quarkus OIDC works with the pure OAuth2 providers such as GitHub, it generates an internal ID token to represent the user authentication. The GitHub access token is still meant to access GitHub API.</p>
</div>
<div class="paragraph">
<p>This is why you have to set <code>quarkus.oidc.roles.source=accesstoken</code>, when you prefer to use an access token acquired by the application during the authorizatuion code flow to access this very same application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="session-management-in-vertx-oidc-and-quarkus-oidc"><a class="anchor" href="#session-management-in-vertx-oidc-and-quarkus-oidc"></a>Session management in Vertx OIDC and Quarkus OIDC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.x OIDC is <code>stateful</code> and some users may assume that, therefore, Vert.x OIDC does not use cookies. It is not the case: it uses an opaque session cookie to track both the authorization code flow progress and the authenticated user session.</p>
</div>
<div class="paragraph">
<p>When you run an application created in either the <a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a> or <a href="#vertx-oidc-quarkus">Vert.x OIDC on Quarkus</a> sections, you can use your browser&#8217;s developer tools to observe that an opaque <code>vertx-web-session</code> session cookie is used to track the user session:</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/vertx-oidc-session-cookie.png" alt="Vertx OIDC session cookie">
</div>
</div>
<div class="paragraph">
<p>The state associated with the current user session is stored on the server.</p>
</div>
<div class="paragraph">
<p>Now, when you run an application created in either the <a href="#vertx-oidc-to-quarkus-oidc">Migrate to Quarkus OIDC</a> or <a href="#vertx-oidc-to-quarkus-oidc-custom-callback">Migrate to Quarkus OIDC with the custom callback method</a> sections, you can observe that Quarkus OIDC also uses a <code>q_session</code> session cookie but it is significantly larger in size:</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/quarkus-oidc-jwe-session-cookie.png" alt="Quarkus OIDC encrypted session cookie">
</div>
</div>
<div class="paragraph">
<p>It is due to the fact that Quarkus OIDC is <code>stateless</code> by default. It encrypts the user session details in the session cookie and no user session related content is stored on the server. This approach offers significantly higher WEB-scale level capabilities.</p>
</div>
<div class="paragraph">
<p>Is it less secure than the <code>stateful</code> approach ? It is hard to give a precise answer. The <code>stateful</code> approach does not protect the session cookie, if the attacker gets hold of it, the secure access is compromised. Thefore, with either approach, using HTTPS and applying additional CORS and CSRF controls must be considered.</p>
</div>
<div class="paragraph">
<p>For the <code>stateless</code> approach, Quarkus allows users to configure a session cookie encryption key, fallbacks to the client secret and finally to a generated secure random key to apply a JSON Web Encryption (JWE) to encrypt a generated content encryption key with the symmetric <code>A256GCMKW</code> algorithm and the <code>A256GCM</code> algorithm to encrypt the actual session cookie content.</p>
</div>
<div class="paragraph">
<p>However, if you do prefer to continue following a stateful approach, you can easily achieve it with Quarkus OIDC.</p>
</div>
<div class="paragraph">
<p>The session state that Quarkus OIDC keeps includes the ID, access and refresh tokens. Additionally, if the authorization code grant response returns the access token expiry and scope properties, then their values are also stored.</p>
</div>
<div class="paragraph">
<p>To start with, you can register a custom <code>quarkus.oidc.TokenStateManager</code> and implement a required session state storage mechanism. For example, Quarkus OIDC does not ship an in-memory <code>TokenStateManager</code> because it does not really work after restarts or across multiple pods, but you can implement the one in order to start experimenting with the custom <code>TokenStateManager</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, Quarkus OIDC ships both a database-aware <code>TokenStateManager</code> that can integrate with most known databases and a Redis <code>TokenStateManager</code>. See the <a href="https://quarkus.io/guides/security-oidc-code-flow-authentication#handling-and-controlling-the-lifetime-of-authentication">section</a> for mor details.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how it works with the Redis <code>TokenStateManager</code>.</p>
</div>
<div class="paragraph">
<p>Update the pom.xml from either the <a href="#vertx-oidc-to-quarkus-oidc">Migrate to Quarkus OIDC</a> or <a href="#vertx-oidc-to-quarkus-oidc-custom-callback">Migrate to Quarkus OIDC with the custom callback method</a> sections by adding this single dependency:</p>
</div>
<div class="listingblock xml">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;project&gt;
  &lt;! ... --&gt;
  &lt;dependencies&gt;
      &lt;! ... -&gt;
      &lt;dependency&gt;
          &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
          &lt;artifactId&gt;quarkus-oidc-redis-token-state-manager&lt;/artifactId&gt;
      &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;! ... --&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is all that you need to do to start using the Redis <code>TokenStateManager</code>.</p>
</div>
<div class="paragraph">
<p>Clear the cookies in the browser, access the protected endpoint again and now you can observe an opaque <code>q_session</code> session cookie only:</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="./images/quarkus-oidc-opaque-session-cookie.png" alt="Quarkus OIDC opaque session cookie">
</div>
</div>
<div class="paragraph">
<p>You may also observe that Vert.x OIDC uses a session cookie to track the authorization code flow progress as well as the authenticated user&#8217;s session.</p>
</div>
<div class="paragraph">
<p>On the other hand, Quarkus OIDC uses a dedicated <code>q_auth_&lt;uuid&gt;</code> state cookie while the authorization code flow is in progress and only creates a session cookie once the code flow is complete. The state cookie names are also unique allowing for a multi-tab authentication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="help-with-the-migration"><a class="anchor" href="#help-with-the-migration"></a>Help with the migration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are considering to migrate from Vert.x OIDC to Quarkus OIDC and have questions that may not have been answered in this guide, please <a href="https://quarkus.io/support/">reach out to the Quarkus team</a>.</p>
</div>
<div class="paragraph">
<p>Please also see the <a href="#references">References</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references"><a class="anchor" href="#references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="security-overview">Quarkus Security overview</a></p>
</li>
<li>
<p><a href="security-oidc-code-flow-authentication">OpenID Connect authorization code flow authentication</a>.</p>
</li>
<li>
<p><a href="security-oidc-bearer-token-authentication">OpenID Connect bearer access token authentication</a>.</p>
</li>
<li>
<p><a href="security-openid-connect-multitenancy">Using OpenID Connect Multi-Tenancy</a></p>
</li>
<li>
<p><a href="security-oidc-expanded-configuration">Expanded OIDC Configuration Reference</a></p>
</li>
</ul>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#vertx-oidc-vertx">Vert.x OIDC on Vert.x</a></li>
<li><a href="#vertx-oidc-quarkus">Vert.x OIDC on Quarkus</a></li>
<li><a href="#vertx-oidc-to-quarkus-oidc">Migrate to Quarkus OIDC</a></li>
<li><a href="#vertx-oidc-to-quarkus-oidc-custom-callback">Migrate to Quarkus OIDC with the custom callback method</a></li>
<li><a href="#enforce-github-access-token-scope-in-quarkus-oidc">Enforce GitHub access token scope in Quarkus OIDC</a></li>
<li><a href="#session-management-in-vertx-oidc-and-quarkus-oidc">Session management in Vertx OIDC and Quarkus OIDC</a></li>
<li><a href="#help-with-the-migration">Help with the migration</a></li>
<li><a href="#references">References</a></li>
</ul></div>
    </div>
  </div>
  <h2>Related content</h2>
  <div class="grid-wrapper relations">
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same extensions</h3>
      <ul class="related-content">
      
        
        <li class="concepts"><a href="/version/main/guides/security-openid-connect-providers">Configuring Well-Known OpenID Connect Providers</a></li>
      
        
        <li class="howto"><a href="/version/main/guides/security-openid-connect-dev-services">Dev Services and Dev UI for OpenID Connect (OIDC)</a></li>
      
        
        <li class="concepts"><a href="/version/main/guides/security-oidc-bearer-token-authentication">OpenID Connect (OIDC) Bearer token authentication</a></li>
      
        
        <li class="reference"><a href="/version/main/guides/security-oidc-configuration-properties-reference">OpenID Connect (OIDC) configuration properties</a></li>
      
        
        <li class="concepts"><a href="/version/main/guides/security-oidc-code-flow-authentication">OpenID Connect authorization code flow mechanism for protecting web applications</a></li>
      
        
        <li class="tutorial"><a href="/version/main/guides/security-oidc-bearer-token-authentication-tutorial">Protect a service application by using OpenID Connect (OIDC) Bearer token authentication</a></li>
      
        
        <li class="tutorial"><a href="/version/main/guides/security-oidc-code-flow-authentication-tutorial">Protect a web application by using OpenID Connect (OIDC) authorization code flow</a></li>
      
        
        <li class="howto"><a href="/version/main/guides/security-keycloak-authorization">Using OpenID Connect (OIDC) and Keycloak to centralize authorization</a></li>
      
        
        <li class="howto"><a href="/version/main/guides/security-openid-connect-multitenancy">Using OpenID Connect (OIDC) multitenancy</a></li>
      </ul>
    </div>
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same topics</h3>
      <ul class="related-content">
      
        
        <li class="concepts"><a href="/version/main/guides/security-openid-connect-providers">Configuring Well-Known OpenID Connect Providers</a></li>
      
        
        <li class="howto"><a href="/version/main/guides/security-openid-connect-dev-services">Dev Services and Dev UI for OpenID Connect (OIDC)</a></li>
      
        
        <li class="reference"><a href="/version/main/guides/security-openid-connect-client-reference">OpenID Connect (OIDC) and OAuth2 client and filters</a></li>
      
        
        <li class="reference"><a href="/version/main/guides/security-openid-connect-client-registration">OpenID Connect (OIDC) and OAuth2 dynamic client registration</a></li>
      
        
        <li class="concepts"><a href="/version/main/guides/security-oidc-bearer-token-authentication">OpenID Connect (OIDC) Bearer token authentication</a></li>
      
        
        <li class="reference"><a href="/version/main/guides/security-oidc-configuration-properties-reference">OpenID Connect (OIDC) configuration properties</a></li>
      
        
        <li class="concepts"><a href="/version/main/guides/security-oidc-code-flow-authentication">OpenID Connect authorization code flow mechanism for protecting web applications</a></li>
      
        
        <li class="tutorial"><a href="/version/main/guides/security-openid-connect-client">OpenID Connect client and token propagation quickstart</a></li>
      
        
        <li class="tutorial"><a href="/version/main/guides/security-oidc-bearer-token-authentication-tutorial">Protect a service application by using OpenID Connect (OIDC) Bearer token authentication</a></li>
      
        
        <li class="tutorial"><a href="/version/main/guides/security-oidc-code-flow-authentication-tutorial">Protect a web application by using OpenID Connect (OIDC) authorization code flow</a></li>
      
        
        <li class="howto"><a href="/version/main/guides/security-keycloak-authorization">Using OpenID Connect (OIDC) and Keycloak to centralize authorization</a></li>
      
        
        <li class="howto"><a href="/version/main/guides/security-openid-connect-multitenancy">Using OpenID Connect (OIDC) multitenancy</a></li>
      
        
        <li class="concepts"><a href="/version/main/guides/security-authentication-mechanisms">Authentication mechanisms in Quarkus</a></li>
      
        
        <li class="reference"><a href="/version/main/guides/security-authorize-web-endpoints-reference">Authorization of web endpoints</a></li>
      
        
        <li class="concepts"><a href="/version/main/guides/security-basic-authentication">Basic authentication</a></li>
      
        
        <li class="guide"><a href="/version/main/guides/security-jwt-build">Build, sign, and encrypt JSON Web Tokens</a></li>
      
        
        <li class="guide"><a href="/version/main/guides/security-csrf-prevention">Cross-Site Request Forgery Prevention</a></li>
      
        
        <li class="howto"><a href="/version/main/guides/security-basic-authentication-howto">Enable Basic authentication</a></li>
      
        
        <li class="tutorial"><a href="/version/main/guides/security-getting-started-tutorial">Getting started with security by using Basic authentication and Jakarta Persistence</a></li>
      
        
        <li class="reference"><a href="/version/main/guides/http-reference">HTTP Reference</a></li>
      </ul>
    </div>
    </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Newsletter</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Roadmap</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Usage</a></li>
          
          
          
            <li><a href="https://github.com/commonhaus/artwork/tree/main/projects/quarkus" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guides</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Get Started</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
